/* eslint-disable */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("airmeet-rtc-sdk",[],t):"object"==typeof exports?exports["airmeet-rtc-sdk"]=t():e["airmeet-rtc-sdk"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return U})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return k})),n.d(t,"i",(function(){return x})),n.d(t,"j",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return B})),n.d(t,"m",(function(){return O})),n.d(t,"n",(function(){return E})),n.d(t,"o",(function(){return P})),n.d(t,"p",(function(){return v})),n.d(t,"q",(function(){return _})),n.d(t,"r",(function(){return T})),n.d(t,"s",(function(){return y})),n.d(t,"t",(function(){return N})),n.d(t,"u",(function(){return C})),n.d(t,"v",(function(){return D})),n.d(t,"w",(function(){return M})),n.d(t,"x",(function(){return L})),n.d(t,"y",(function(){return q})),n.d(t,"z",(function(){return H})),n.d(t,"A",(function(){return A})),n.d(t,"B",(function(){return V})),n.d(t,"C",(function(){return W})),n.d(t,"D",(function(){return G}));var r=n(1),i=!1,o=!1,a="${JSCORE_VERSION}",s=function(e,t){if(!e)throw c(t)},c=function(e){return new Error("Firebase Database ("+a+") INTERNAL ASSERT FAILED: "+e)},u=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],a=i+1<e.length,s=a?e[i+1]:0,c=i+2<e.length,u=c?e[i+2]:0,l=o>>2,d=(3&o)<<4|s>>4,h=(15&s)<<2|u>>6,p=63&u;c||(p=64,a||(h=64)),r.push(n[l],n[d],n[h],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(u(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(s=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{o=e[n++];var s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==c)throw Error();var u=o<<2|a>>4;if(r.push(u),64!==s){var l=a<<4&240|s>>2;if(r.push(l),64!==c){var d=s<<6&192|c;r.push(d)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},d=function(e){var t=u(e);return l.encodeByteArray(t,!0)},h=function(e){try{return l.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function p(e){return f(void 0,e)}function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=f(e[n],t[n]));return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var g=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function v(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function _(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}function E(){return"object"==typeof self&&self.self===self}function y(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function T(){return!0===i||!0===o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var S=function(e){function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,b.prototype.create),o}return Object(r.c)(t,e),t}(Error),b=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],a=o?I(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",c=new S(i,s,r);return c},e}();function I(e,t){return e.replace(R,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var R=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C(e){return JSON.parse(e)}function A(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var w=function(e){var t={},n={},r={},i="";try{var o=e.split(".");t=C(h(o[0])||""),n=C(h(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},N=function(e){var t=w(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},O=function(e){var t=w(e).claims;return"object"==typeof t&&!0===t.admin};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function P(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var o=i[r];n(o[0],o[1])}return t.length?"&"+t.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var U=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],c=this.chain_[1],u=this.chain_[2],l=this.chain_[3],d=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=l^c&(u^l),a=1518500249):(o=c^u^l,a=1859775393):r<60?(o=c&u|l&(c|u),a=2400959708):(o=c^u^l,a=3395469782);i=(s<<5|s>>>27)+o+d+a+n[r]&4294967295;d=l,l=u,u=4294967295&(c<<30|c>>>2),c=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function x(e,t){var n=new j(e,t);return n.subscribe.bind(n)}var j=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=F),void 0===r.error&&(r.error=F),void 0===r.complete&&(r.complete=F);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function F(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var V=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function B(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function W(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(B(e,t,r)+"must be a valid function.")}function G(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(B(e,t,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},q=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}}).call(this,n(8))},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return l}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function a(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}},function(e,t,n){"use strict";var r,i,o=n(1),a=n(0),s=n(3),c=n(5),u=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),l=new a.b("app","Firebase",u),d=((i={})["@firebase/app"]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),h=new c.b("@firebase/app"),p=function(){function e(e,t,n){var r,i,c=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=Object(a.j)(e),this.container=new s.b(t.name),this._addComponent(new s.a("app",(function(){return c}),"PUBLIC"));try{for(var u=Object(o.g)(this.firebase_.INTERNAL.components.values()),l=u.next();!l.done;l=u.next()){var d=l.value;this._addComponent(d)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){return void 0===t&&(t="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t="[DEFAULT]"),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){h.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},e}();p.prototype.name&&p.prototype.options||p.prototype.delete||console.log("dc");var f=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function e(){var t=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var s=o.name;if("string"!=typeof s||!s)throw l.create("bad-app-name",{appName:String(s)});if(Object(a.h)(t,s))throw l.create("duplicate-app",{appName:s});var c=new e(n,o,r);return t[s]=c,c},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=d[e])&&void 0!==r?r:e;n&&(i+="-"+n);var o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){var c=['Unable to register library "'+i+'" with version "'+t+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void h.warn(c.join(" "))}u(new s.a(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:c.c,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw l.create("invalid-log-argument",{appName:name});Object(c.d)(e,t)},apps:null,SDK_VERSION:"8.0.1",INTERNAL:{registerComponent:u,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){if("serverAuth"===t)return null;return t}}};function i(e){if(e=e||"[DEFAULT]",!Object(a.h)(t,e))throw l.create("no-app",{appName:e});return t[e]}function u(s){var c,u,d=s.name;if(n.has(d))return h.debug("There were multiple attempts to register component "+d+"."),"PUBLIC"===s.type?r[d]:null;if(n.set(d,s),"PUBLIC"===s.type){var p=function(e){if(void 0===e&&(e=i()),"function"!=typeof e[d])throw l.create("invalid-app-argument",{appName:d});return e[d]()};void 0!==s.serviceProps&&Object(a.k)(p,s.serviceProps),r[d]=p,e.prototype[d]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._getService.bind(this,d);return n.apply(this,s.multipleInstances?e:[])}}try{for(var f=Object(o.g)(Object.keys(t)),g=f.next();!g.done;g=f.next()){var m=g.value;t[m]._addComponent(s)}}catch(e){c={error:e}}finally{try{g&&!g.done&&(u=f.return)&&u.call(f)}finally{if(c)throw c.error}}return"PUBLIC"===s.type?r[d]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}(p);return t.INTERNAL=Object(o.a)(Object(o.a)({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(a.k)(t,e)},createSubscribe:a.i,ErrorFactory:a.b,deepExtend:a.k}),t}(),g=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(Object(a.n)()&&void 0!==self.firebase){h.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var m=self.firebase.SDK_VERSION;m&&m.indexOf("LITE")>=0&&h.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var v=f.initializeApp;f.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(a.q)()&&h.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),v.apply(void 0,e)};var _=f;!function(e,t){e.INTERNAL.registerComponent(new s.a("platform-logger",(function(e){return new g(e)}),"PRIVATE")),e.registerVersion("@firebase/app","0.6.13",t),e.registerVersion("fire-js","")}(_),t.a=_},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a}));var r=n(1),i=n(0),o=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e}(),a=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return e.prototype.get=function(e){void 0===e&&(e="[DEFAULT]");var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new i.a;this.instancesDeferred.set(t,n);try{var r=this.getOrInitializeService(t);r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=Object(r.a)({identifier:"[DEFAULT]",optional:!1},e),n=t.identifier,i=t.optional,o=this.normalizeInstanceIdentifier(n);try{var a=this.getOrInitializeService(o);if(!a){if(i)return null;throw Error("Service "+this.name+" is not available")}return a}catch(e){if(i)return null;throw e}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService("[DEFAULT]")}catch(e){}try{for(var i=Object(r.g)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=Object(r.e)(o.value,2),s=a[0],c=a[1],u=this.normalizeInstanceIdentifier(s);try{var l=this.getOrInitializeService(u);c.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.clearInstance=function(e){void 0===e&&(e="[DEFAULT]"),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(Object(r.f)(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})),e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()}))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.getOrInitializeService=function(e){var t=this.instances.get(e);return!t&&this.component&&(t=this.component.instanceFactory(this.container,function(e){return"[DEFAULT]"===e?void 0:e}(e)),this.instances.set(e,t)),t||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e},e}();var s=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new a(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VOICE_ACTIVITY_THRESHOLD=t.CUSTOM_MEDIA_USER_ID_PREFIX=t.SCREEN_SHARE_USER_ID_PREFIX=t.rtcRetries=t.logTags=t.defaultRTCVendorSettings=t.defaultScreenSettings=t.defaultMediaSettings=void 0,t.defaultMediaSettings={video:{maxBitrate:200,minBitrate:200,width:320,height:240,frameRate:15,maxActiveSpeakers:8},audio:{bitrate:50,sampleRate:48e3,sampleSize:16,stereo:!1,AGC:!0,AEC:!0,ANS:!0}},t.defaultScreenSettings={optimizationMode:"detail",screenSourceType:"application",minBitrate:1e3,maxBitrate:1e3,height:720,width:1280,frameRate:10},t.defaultRTCVendorSettings={rtcProviderName:"Agora",appId:"13aa3965907d4386ac88dd2c5b1701c6",prefVideoCodec:"vp8"},t.logTags={AM_CONFERENCE:"Conference",AM_DEVICES:"Devices",AM_FIREBASE:"Firebase",AM_ACTIVE_SPEAKERS:"Active-Speakers",AM_CAPTURE:"Capture",AM_PIN:"Pin",AM_PUBLICATION:"Publication",AM_REMOTE_PUBLICATION:"Remote-Publication",AM_SUBSCRIPTION:"Subscription",AM_PLAY:"Play",AM_CONTROLS:"Controls",AM_SS:"Screenshare",AM_RTCSTATS:"RTCStats",AM_STREAMING:"streaming",AM_LEAVE:"leave",AM_REMOTE_TOGGLE:"Remote-Toggle",AM_DUAL_STREAM:"Dual-Stream",AM_TOKEN:"Token",AM_CONN:"Connection",AIMEET_AUDIO_ANALYSER:"Audio-Analyser",AM_LAYOUT:"Layout",AM_RETRY:"Retrying",AM_USERID_MANAGER:"UserId-Manager"},t.rtcRetries={joinRetries:2,captureRetries:2,publishRetries:2,subscribeRetries:0,leaveRetries:1},t.SCREEN_SHARE_USER_ID_PREFIX="260000",t.CUSTOM_MEDIA_USER_ID_PREFIX="290000",t.VOICE_ACTIVITY_THRESHOLD=5},function(e,t,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i;n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return p}));var o,a=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));var s={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},c=o.INFO,u=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),l=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var o=(new Date).toISOString(),a=u[t];if(!a)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[a].apply(console,r(["["+o+"]  "+e.name+":"],n))}},d=function(){function e(e){this.name=e,this._logLevel=c,this._logHandler=l,this._userLogHandler=null,a.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in o))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?s[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],e)),this._logHandler.apply(this,r([this,o.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],e)),this._logHandler.apply(this,r([this,o.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],e)),this._logHandler.apply(this,r([this,o.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],e)),this._logHandler.apply(this,r([this,o.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],e)),this._logHandler.apply(this,r([this,o.ERROR],e))},e}();function h(e){a.forEach((function(t){t.setLogLevel(e)}))}function p(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var s=i.map((function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((function(e){return e})).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:o[n].toLowerCase(),message:s,args:i,type:t.name})}},r=0,i=a;r<i.length;r++){n(i[r])}}},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,i),r(n)},e.once("error",o)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a,s;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)o(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.r(t),n.d(t,"LOG_LEVEL",(function(){return s})),n.d(t,"log",(function(){return u})),n.d(t,"logger",(function(){return l}));let r,i,o=[],a={};const s={VERBOSE:0,INFO:1,WARN:2,ERROR:3,FATAL:4},c={[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error",[s.FATAL]:"error"},u=({prefix:e,color:t,level:n},...u)=>{const l=c[n]||c[s.VERBOSE];if(u[0].src=a,o&&n>=r)for(var d=0;d<o.length;d++)o[d]({level:c[n],data:u});(!i||i&&n>=i)&&console[l](`%c ${e}: `,"color: "+t,...u)},l={log(...e){u({prefix:"AM-VERBOSE",color:"#5d6fca",level:s.VERBOSE},...e)},info(...e){u({prefix:"AM-INFO",color:"#48AFF0",level:s.INFO},...e)},warn(...e){u({prefix:"AM-WARN",color:"#FFC940",level:s.WARN},...e)},error(...e){u({prefix:"AM-ERROR",color:"#DB3737",level:s.ERROR},...e)},fatal(...e){u({prefix:"AM-FATAL",color:"#FF7373",level:s.FATAL},...e)},setIntercept(e,t){r=e,o.push(t)},addLogIdentifierArgs(e){a=Object.assign(a,e)},setLogLevel(e){i=e}};window.addEventListener("error",(function(e){try{l.fatal(e.message,e.error.stack)}catch(e){}})),window.addEventListener("unhandledrejection",(function(e){try{l.fatal(e.message,e.error.stack)}catch(e){}}))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AirmeetRTCClient=t.UserIdManager=t.RTCDevices=void 0;var c=n(6),u=n(13),l=s(n(11)),d=n(7),h=n(4),p=s(n(20)),f=s(n(21)),g=n(4),m=n(28),v=n(29),_=function(){this.videoDevices=[],this.audioInputDevices=[],this.audioOutputDevices=[]};t.RTCDevices=_;var E=function(){function e(){}return e.fetchOriginalUserId=function(e){var t=e.split("_");return t[t.length-1]},e.fetchOriginalScreenId=function(t){return h.SCREEN_SHARE_USER_ID_PREFIX+"_"+e.fetchOriginalUserId(t)},e.isScreenUserId=function(e){return e.split("_")[0]==h.SCREEN_SHARE_USER_ID_PREFIX},e}();t.UserIdManager=E;var y=function(e){function t(t){var n=e.call(this)||this;return n.self=n,n.defInterceptLogLevel="0",n.defConsoleLogLevel="0",n.logInterceptorUrl="wss://stage-interceptor.airmeet.com/",n.fetchChannelsAPIUrl="http://localhost:8080/agora/fetchChannels",n.releasepubConferenceAPIUrl="http://localhost:8080/agora/releasePubChannel",n.AMSocketURl="ws://localhost:3000",n.fetchLastNActiveAPIUrl="http://localhost:8080/agora/fetchLastNActiveSpeaker",n.pinUserApiUrl="http://localhost:8080/agora/pinParticipant",n.conferences={},n.localUserIdtoConferenceMap={},n.deviceChangeMutex=!0,n.harkAudioInit=!1,n.accumulatedVoiceActivityAcrossConferences=[],n.isAutoLayout=!1,n.publishedMediaStatus={isAudioPublished:!1,isVideoPublished:!1},n.capturedMediaStatus={isAudioEnabled:!1,isVideoEnabled:!1},n.audioAnalyserParams={volumeThreshold:-50,samplingInterval:100,sampleSize:6,positiveSampleThreshold:3,speechDurationThreshold:700,isAudioAnalyserLogsEnabled:!1},n.fbReferences={ASLRef:null,publishingUserRef:null,channelAvailabilityRef:null},n.setActiveSpeakersCount=function(e){this.localActiveSpeakersCount=e},n.updateActiveSpeakersCount=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:this.localActiveSpeakersCount,this.localActiveSpeakersCount=e,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.getActiverSpeakersList()];case 2:return t=n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return this.layoutManager.updateMaxSpeakers(e),this.layoutManager.manageNewActiveUsersList(t),[2]}}))}))},n.airmeetClientId=t.airmeetClientId,n.isAutoLayout=!!t.isAutoLayout&&t.isAutoLayout,d.logger.addLogIdentifierArgs({airmeetClientId:t.airmeetClientId}),window.interceptorWS=new WebSocket(n.logInterceptorUrl,t.airmeetAuthToken),d.logger.setIntercept(n.defInterceptLogLevel,n.interceptLog),n.setLogLevel(n.defConsoleLogLevel),n.attachEventListeners(),n.initFirebaseConnection(t.airmeetAuthToken),n.rtcStateManager=new v.RTCStateManager,n}return i(t,e),t.prototype.interceptLog=function(e){var t={eventType:"AirmeetRTC",info:e.data,level:e.level};window.interceptorWS.readyState===WebSocket.OPEN&&window.interceptorWS.send(JSON.stringify(t))},t.prototype.setLogInterceptor=function(e,t){d.logger.setIntercept(e,t)},t.prototype.setLogLevel=function(e){this.airmeetLogLevel=e,d.logger.setLogLevel(e)},t.getAvailableRTCDevices=function(){var e=this;return new Promise((function(n,r){return o(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){t.testStream=e})).catch((function(e){var t={tag:h.logTags.AM_CAPTURE,code:2001,msg:"Failed to fetch available device list : "+e};d.logger.error(t),r(t)}))];case 1:return e.sent(),t.testStream.getAudioTracks().length>0&&t.testStream.getAudioTracks()[0].stop(),t.testStream.getVideoTracks().length>0&&t.testStream.getVideoTracks()[0].stop(),t.rtcDevices=new _,navigator.mediaDevices.enumerateDevices().then((function(e){e.map((function(e){var n=e;switch(e.kind){case"audioinput":t.rtcDevices.audioInputDevices.push(n);break;case"videoinput":t.rtcDevices.videoDevices.push(n);break;case"audiooutput":t.rtcDevices.audioOutputDevices.push(n)}})),d.logger.log({tag:h.logTags.AM_DEVICES,msg:"Devices captured successfully"}),n(t.rtcDevices)})),[2]}}))}))}))},t.captureTestStream=function(e){var n=this;return new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return n=t.formatMediaConstraints(e),[4,navigator.mediaDevices.getUserMedia(n).then((function(e){t.testStream=e,r(e)})).catch((function(e){var t,n;"PermissionDeniedError"==e.name||"NotAllowedError"==e.name?(t="User denied access to the camera.",n={tag:h.logTags.AM_CAPTURE,code:2002,msg:t}):"SourceUnavailableError"==e.name?(t="Camera is being used by another application.",n={tag:h.logTags.AM_CAPTURE,code:2003,msg:t}):(t="The camera is unavailable.",n={tag:h.logTags.AM_CAPTURE,code:2004,msg:t}),d.logger.error(n),i(n)}))];case 1:return o.sent(),[2]}}))}))}))},t.releaseTestStream=function(){t.testStream&&t.testStream.getVideoTracks().length>0&&t.testStream.getVideoTracks()[0].stop(),t.testStream&&t.testStream.getAudioTracks().length>0&&t.testStream.getAudioTracks()[0].stop()},t.prototype.checkCurrentCameraMicState=function(){},t.prototype.checkScreenSharingCapability=function(){},t.formatMediaConstraints=function(e){var t,n;return e.videoProfile&&(t=!!e.videoProfile.isEnabled&&{deviceId:e.videoProfile.cameraId,width:{min:320,ideal:e.videoProfile.width},height:{min:240,ideal:e.videoProfile.height},frameRate:{max:e.videoProfile.frameRate},facingMode:{exact:e.videoProfile.facingMode}}),e.audioProfile&&(n=!!e.audioProfile.isEnabled&&{deviceId:e.audioProfile.microphoneId}),{video:t,audio:n}},t.attachMediaStream=function(e,t){if(null!=t){t.innerHTML="";var n=document.createElement("video");if(n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("muted",""),n.style.height="inherit",t.appendChild(n),void 0!==n.srcObject)n.srcObject=e;else if(void 0!==n.src)t.src=URL.createObjectURL(e);else{r={tag:h.logTags.AM_CAPTURE,code:2006,msg:"Error attaching stream to the media element, incompatible element"};d.logger.error(r)}}else{var r={tag:h.logTags.AM_CAPTURE,code:2005,msg:"No Video HTML Element provided to attach media stream"};d.logger.error(r)}},t.prototype.joinConference=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o,s,c,u,l,p,f,g,m,v,_,E;return a(this,(function(a){switch(a.label){case 0:i=0,a.label=1;case 1:return a.trys.push([1,3,,5]),[4,this.joinChannels(e)];case 2:return a.sent(),t=null,[3,5];case 3:return o=a.sent(),t=o,i++,[4,this.leave()];case 4:return a.sent(),d.logger.log({tag:h.logTags.AM_RETRY,msg:"Failed to Join Channel, Current Retry Count: "+i+", Retries Allowed: "+h.rtcRetries.joinRetries}),[3,5];case 5:if(t&&i<=h.rtcRetries.joinRetries)return[3,1];a.label=6;case 6:return t?[4,this.leave()]:[3,8];case 7:return a.sent(),[2,r(t)];case 8:c=0,a.label=9;case 9:return a.trys.push([9,11,,12]),u=this,[4,this.captureLocalStream(e.mediaProfile)];case 10:return u.capturedMediaStatus=a.sent(),s=null,[3,12];case 11:return l=a.sent(),s=l,c++,d.logger.log({tag:h.logTags.AM_RETRY,msg:"Failed to Cature Local Stream, Current Retry Count: "+c+", Retries Allowed: "+h.rtcRetries.captureRetries}),[3,12];case 12:if(s&&c<=h.rtcRetries.captureRetries)return[3,9];a.label=13;case 13:return s?[4,this.leave()]:[3,15];case 14:return a.sent(),[2,r(s)];case 15:if(p=!this.capturedMediaStatus.isAudioEnabled&&!this.capturedMediaStatus.isVideoEnabled,!(f=!e.isAutoPublishEnabled||e.isAutoPublishEnabled)||p)return[3,23];e.audioAnalyserParams&&this.setAudioAnalyserParams(e.audioAnalyserParams),g=void 0,m=0,a.label=16;case 16:return a.trys.push([16,18,,19]),v=this,[4,this.publishLocalStream()];case 17:return v.publishedMediaStatus=a.sent(),g=null,[3,19];case 18:return _=a.sent(),g=_,m++,d.logger.log({tag:h.logTags.AM_RETRY,msg:"Failed to Publish Local Stream, Current Retry Count: "+m+", Retries Allowed: "+h.rtcRetries.publishRetries}),[3,19];case 19:if(g&&m<=h.rtcRetries.publishRetries)return[3,16];a.label=20;case 20:return g?[4,this.leave()]:[3,22];case 21:a.sent(),r(g),a.label=22;case 22:return[3,24];case 23:f&&p&&d.logger.log({tag:h.logTags.AM_PUBLICATION,msg:"Both Audio and Video Disabled, Returning without Publishing stream"}),a.label=24;case 24:n({capturedMediaStatus:this.capturedMediaStatus,publishedMediaStatus:this.publishedMediaStatus,callId:"dummy-callId-1234"}),a.label=25;case 25:return a.trys.push([25,27,,28]),[4,this.getActiverSpeakersList()];case 26:return E=a.sent(),this.layoutManager.manageNewActiveUsersList(E),[3,28];case 27:return a.sent(),[3,28];case 28:return[2]}}))}))}))]}))}))},t.prototype.joinChannels=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return a(this,(function(r){return this.baseUserId=e.myUserId,t=e.mediaProfile.video.maxActiveSpeakers,this.localActiveSpeakersCount=t||g.defaultMediaSettings.video.maxActiveSpeakers,this.layoutManager=m.LayoutManager.getInstance(this),this.baseConferenceId=e.conferenceId,[2,new Promise((function(t,r){return o(n,void 0,void 0,(function(){var n,i,o,s,c,l;return a(this,(function(a){switch(a.label){case 0:return[4,this.getAllChannels(e.conferenceId)];case 1:if(!(n=a.sent())||!n.subChannels)return i={tag:h.logTags.AM_CONFERENCE,code:1001,msg:"Failed to discover list of channels for pub-sub"},d.logger.error(i),[2,r(i)];this.subChannels=n.subChannels,this.pubconferenceId=n.pubChannel,this.baseConfParams=e,o=0,a.label=2;case 2:if(!(o<this.subChannels.length))return[3,7];e.conferenceId=this.subChannels[o],e.myUserId=this.subChannels[o].split("_")[0]+"_"+this.baseUserId,s=new u.Conference(e),this.conferences[e.conferenceId]={userId:e.myUserId,conferenceObj:s},this.localUserIdtoConferenceMap[e.myUserId]=e.conferenceId,a.label=3;case 3:return a.trys.push([3,5,,6]),[4,s.init()];case 4:return a.sent(),[3,6];case 5:return c=a.sent(),r(c),[3,6];case 6:return++o,[3,2];case 7:this.pubUserId=this.conferences[this.pubconferenceId].userId,this.pubConference=this.conferences[this.pubconferenceId].conferenceObj,d.logger.addLogIdentifierArgs({pubUserId:this.pubUserId,pubConfId:this.pubconferenceId}),d.logger.log({tag:h.logTags.AM_CONFERENCE,msg:"Conferences successfully created, All Conferences : "+JSON.stringify(n)}),a.label=8;case 8:return a.trys.push([8,10,,11]),[4,this.join()];case 9:return a.sent(),[3,11];case 10:return l=a.sent(),r(l),[3,11];case 11:return this.setupFirebaseListeners(),t(),[2]}}))}))}))]}))}))},t.prototype.join=function(){var e=this;return new Promise((function(t,n){return o(e,void 0,void 0,(function(){var e,r,i;return a(this,(function(o){switch(o.label){case 0:e=0,o.label=1;case 1:if(!(e<Object.keys(this.conferences).length))return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,(r=Object.values(this.conferences)[e]).conferenceObj.join()];case 3:return o.sent(),r.conferenceObj.setLogLevel(this.airmeetLogLevel),[3,5];case 4:return i=o.sent(),n(i),[3,5];case 5:return e++,[3,1];case 6:return t(),[2]}}))}))}))},t.prototype.initFirebaseConnection=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t=this,[4,f.default.getInstance(e)];case 1:return t.firebaseClient=a.sent(),n(),[3,3];case 2:return i=a.sent(),o="Failed to initialise Firebase Client : "+JSON.stringify(i),d.logger.error({tag:h.logTags.AM_FIREBASE,code:16002,msg:"Failed to initialise Firebase Client : "+JSON.stringify(i)}),r(o),[3,3];case 3:return[2]}}))}))}))},t.prototype.setupFirebaseListeners=function(){var e=this,t="/rtc/"+this.baseConferenceId+"/activeSpeakers",n="/rtc/"+this.baseConferenceId+"/channelDetails/slotAvailable";this.fbReferences.ASLRef=this.firebaseClient.getDataRef(t),this.fbReferences.publishingUserRef=this.firebaseClient.getDataRef(t).child(this.pubUserId),this.fbReferences.channelAvailabilityRef=this.firebaseClient.getDataRef(n);setTimeout((function(){e.fbReferences.publishingUserRef&&e.fbReferences.publishingUserRef.setWithPriority(-Date.now(),-Date.now())}),2e3),this.fbReferences.publishingUserRef.onDisconnect().remove(),this.fbReferences.channelAvailabilityRef.child(this.pubconferenceId).onDisconnect().set(this.firebaseClient.getDatabase().ServerValue.increment(1)),this.fbReferences.ASLRef.on("value",(function(t){var n=t.val();e.manageFBActiveSpeakerChangeEvent(n)})),this.fbReferences.channelAvailabilityRef.on("child_added",(function(t){var n=t.key;e.manageFBNewSubChannelCreationEvent(n)}))},t.prototype.updateFirebaseDataonLeave=function(){d.logger.log({tag:h.logTags.AM_FIREBASE,msg:"User Left, Updating FB Data"}),this.fbReferences.channelAvailabilityRef&&this.fbReferences.channelAvailabilityRef.child(this.pubconferenceId)&&(console.log("FIREBASE, inside updateFirebaseDataonLeave, incrementing the slot"),this.fbReferences.channelAvailabilityRef.child(this.pubconferenceId).set(this.firebaseClient.getDatabase().ServerValue.increment(1)))},t.prototype.resetFirebaseListeners=function(){this.fbReferences.ASLRef&&this.fbReferences.ASLRef.off(),this.fbReferences.publishingUserRef&&(this.fbReferences.publishingUserRef.off(),this.fbReferences.publishingUserRef.remove()),this.fbReferences.channelAvailabilityRef&&(this.fbReferences.channelAvailabilityRef.child(this.pubconferenceId).onDisconnect().cancel(),this.fbReferences.channelAvailabilityRef.child(this.pubconferenceId).off(),this.fbReferences.channelAvailabilityRef.off())},t.prototype.captureLocalStream=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o,s;return a(this,(function(a){switch(a.label){case 0:this.setMediaProfile(e),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.enableDualStream(!0)];case 2:return a.sent(),[3,4];case 3:return t=a.sent(),console.warn(t),[3,4];case 4:if(!this.pubConference)return[3,9];a.label=5;case 5:return a.trys.push([5,7,,8]),[4,this.pubConference.conferenceManager.captureLocalStream()];case 6:return i=a.sent(),n(i),[3,8];case 7:return o=a.sent(),r(o),[3,8];case 8:return[3,10];case 9:s={tag:h.logTags.AM_PUBLICATION,code:3001,msg:"No Publication Conference found to capture local stream"},d.logger.error(s),r(s),a.label=10;case 10:return[2]}}))}))}))},t.prototype.manageFBActiveSpeakerChangeEvent=function(e){var t=Date.now();t-this.lastASLReceivedTime<1e3?d.logger.warn({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"Received a new Voice activity without an allowed gap of 1 second, dropping the event"}):(this.lastASLReceivedTime=t,d.logger.log({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"New ASL Received: "+JSON.stringify(e)}),e?(this.checkAndEmitCurrentActiveSpeaker(e),this.layoutManager.manageNewActiveUsersList(e)):d.logger.warn({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"No Active Speakers Found in the new ASL"}))},t.prototype.checkAndEmitCurrentActiveSpeaker=function(e){var t=Object.keys(e).reverse()[0];if(e[t]>0){var n=E.fetchOriginalUserId(t);d.logger.log({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"Current Active Speaker : "+n}),this.emit("new-active-speaker",{userId:n})}},t.prototype.manageFBNewSubChannelCreationEvent=function(e){d.logger.log({tag:h.logTags.AM_CONFERENCE,msg:"Received Server side event for New Conference Created, Joining. New Conference Id : "+e}),this.conferences[e]?d.logger.warn({tag:h.logTags.AM_CONFERENCE,msg:"Conference is already joined, avoiding a rejoin."}):this.createAndJoinNewSubConference(e)},t.prototype.createAndJoinNewSubConference=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o,s,c;return a(this,(function(a){switch(a.label){case 0:(t=this.baseConfParams).conferenceId=e,t.myUserId=e.split("_")[0]+"_"+this.baseUserId,i=new u.Conference(t),this.conferences[t.conferenceId]={userId:t.myUserId,conferenceObj:i},this.localUserIdtoConferenceMap[t.myUserId]=t.conferenceId,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,i.init()];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),s={tag:h.logTags.AM_CONFERENCE,msg:"Failed to create New Subscription Conference on-the-fly, "+o},d.logger.error(s),r(s),[3,4];case 4:return a.trys.push([4,6,,7]),[4,i.join()];case 5:return a.sent(),i.setLogLevel(this.airmeetLogLevel),[3,7];case 6:return c=a.sent(),r(c),[3,7];case 7:return d.logger.log({tag:h.logTags.AM_CONFERENCE,msg:"Successfully Joined the New Subscribe-only conference : "+e}),n(this.conferences),[2]}}))}))}))},t.prototype.getAllChannels=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o;return a(this,(function(a){"GET",t={method:"GET",headers:{"Content-Type":"application/json"}};try{return i=function(e){return e.json().then((function(t){return{json:t,response:e}}))},[2,fetch(this.fetchChannelsAPIUrl+"?baseConferenceId="+e,t).then().then(i).then((function(e){var t=e.json;n(t)}))]}catch(e){o={tag:h.logTags.AM_CONFERENCE,code:1001,msg:"Failed to discover list of channels for pub-sub, "+e},d.logger.error(o),r(o)}return[2]}))}))}))},t.prototype.fetchInternalPublishUserInfo=function(e){var t=this.layoutManager.OriginalToInternalRemoteUserIdMap[e];if(t){for(var n,r,i=0;i<t.length;i++){r=t[i];var o=this.layoutManager.remoteUsersInfoList[r];if(o&&o.isPublisher){n=o.conferenceId;break}}return{internalUserId:r,remoteUserconfId:n}}h.logTags.AM_USERID_MANAGER},t.prototype.getPublicationConference=function(){return this.conferences[this.pubconferenceId]?this.conferences[this.pubconferenceId].conferenceObj:null},t.prototype.getConferenceInfo=function(){return this.baseConferenceId?{conferenceId:this.baseConferenceId,userId:this.baseUserId,participantsCount:this.getParticipantCount(),capturedMediaStatus:this.capturedMediaStatus,publishedMediaStatus:this.publishedMediaStatus}:void 0},t.prototype.setMediaProfile=function(e){this.pubConference.conferenceManager.setMediaProfile(e)},t.prototype.enableDualStream=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.enableDualStream(e)];case 2:return o.sent(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_PUBLICATION,code:11001,msg:"No Publication Conference found to enable Dual Stream"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.setStreamFallbackOption=function(e,t){var n=this;return new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:if(!this.pubConference)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.setStreamFallbackOption(e,t)];case 2:return a.sent(),r(),[3,4];case 3:return n=a.sent(),i(n),[3,4];case 4:return[3,6];case 5:o={tag:h.logTags.AM_PUBLICATION,code:11004,msg:"No Publication Conference found to set Stream fallback option"},d.logger.error(o),i(o),a.label=6;case 6:return[2]}}))}))}))},t.prototype.renewToken=function(){var e=this;return new Promise((function(t,n){return o(e,void 0,void 0,(function(){var e,t;return a(this,(function(r){switch(r.label){case 0:e=0,r.label=1;case 1:if(!(e<Object.keys(this.conferences).length))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,Object.values(this.conferences)[e].conferenceObj.conferenceManager.renewToken()];case 3:return r.sent(),[3,5];case 4:return t=r.sent(),n(t),[3,5];case 5:return e++,[3,1];case 6:return[2]}}))}))}))},t.prototype.playLocalStream=function(e,t){return this.isAutoLayout&&(this.layoutManager.addLocalVideoPlaceholder(),t=this.layoutManager.getLocalVideoElement()),this.pubConference.conferenceManager.playLocalStream(e,t)},t.prototype.autoPlayRemoteStream=function(e,t,n){var r,i=this.layoutManager.remoteUsersInfoList[e],o=i?i.conferenceId:null;if(o&&this.conferences[o]&&(r=this.conferences[o].conferenceObj),r)return r.conferenceManager.playRemoteStream(e,t,n);var a={tag:h.logTags.AM_PLAY,code:5003,msg:"Failed to play the subscribed media in Auro-Mode, Conference Object not found for the remote user"};throw d.logger.error(a),a},t.prototype.playRemoteStream=function(e,t,n){var r,i=this.fetchInternalPublishUserInfo(e),o=i.internalUserId,a=i.remoteUserconfId;if(a&&this.conferences[a]&&(r=this.conferences[a].conferenceObj),r)return r.conferenceManager.playRemoteStream(o,t,n);var s={tag:h.logTags.AM_PLAY,code:5003,msg:"Failed to play the subscribed media, Conference Object not found for the remote user"};throw d.logger.error(s),s},t.prototype.playLocalCustomStream=function(e){this.pubConference.conferenceManager.playLocalCustomStream(e)},t.prototype.publishLocalStream=function(e){var t=this;return new Promise((function(e,n){return o(t,void 0,void 0,(function(){var t,r,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.publishLocalStream()];case 2:return t=o.sent(),e(t),this.startAudioAnalyser(),[3,4];case 3:return r=o.sent(),n(r),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No Publication Conference found"},d.logger.error(i),n(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.updatePublication=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.updatePublication(e)];case 2:return o.sent(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No Publication Conference found"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.unpublishLocalStream=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.unpublishLocalStream(e)];case 2:return o.sent(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No Publication Conference found"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.unpublishCustomLocalStream=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.unpublishCustomLocalStream(e)];case 2:return o.sent(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No Publication Conference found"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.muteLocalVideo=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.muteLocalVideo(e)];case 2:return o.sent(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_CONTROLS,code:4001,msg:"No Publication Conference found"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))},t.prototype.muteLocalAudio=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i;return a(this,(function(o){switch(o.label){case 0:if(!this.pubConference)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.muteLocalAudio(e)];case 2:return o.sent(),e&&this.startAudioAnalyser(),n(),[3,4];case 3:return t=o.sent(),r(t),[3,4];case 4:return[3,6];case 5:i={tag:h.logTags.AM_CONTROLS,code:4001,msg:"No Publication Conference found"},d.logger.error(i),r(i),o.label=6;case 6:return[2]}}))}))}))]}))}))},t.prototype.subscribeMedia=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i=this;return a(this,(function(s){return[2,new Promise((function(s,c){return o(i,void 0,void 0,(function(){var i,o,u,l,p,f,g,m;return a(this,(function(a){switch(a.label){case 0:if(n?(o=this.layoutManager.remoteUsersInfoList[e],i=o?o.conferenceId:null):(u=this.fetchInternalPublishUserInfo(e),i=u.remoteUserconfId),i&&this.conferences[i]&&(l=this.conferences[i].conferenceObj),!l)return[3,6];p=void 0,f=0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,l.conferenceManager.subscribeMedia(e,t,r)];case 2:return a.sent(),p=null,[3,4];case 3:return g=a.sent(),p=g,f++,d.logger.log({tag:h.logTags.AM_RETRY,msg:"Failed to Subscribe the user, Current Retry Count: "+f+", Retries Allowed: "+h.rtcRetries.subscribeRetries}),[3,4];case 4:if(p&&f<=h.rtcRetries.leaveRetries)return[3,1];a.label=5;case 5:return p?c(p):s(),[3,7];case 6:m={tag:h.logTags.AM_SUBSCRIPTION,code:5001,msg:"Failed to Subscribe, No Conference found for the specific user: "+e},d.logger.error(m),c(m),a.label=7;case 7:return[2]}}))}))}))]}))}))},t.prototype.unsubscribeMedia=function(e,t,n){return o(this,void 0,void 0,(function(){var r=this;return a(this,(function(i){return[2,new Promise((function(i,s){return o(r,void 0,void 0,(function(){var r,o,c,u,l,p;return a(this,(function(a){switch(a.label){case 0:if(n?(o=this.layoutManager.remoteUsersInfoList[e],r=o?o.conferenceId:null):(c=this.fetchInternalPublishUserInfo(e),r=c.remoteUserconfId),r&&this.conferences[r]&&(u=this.conferences[r].conferenceObj),!u)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,u.conferenceManager.unsubscribeMedia(e,t)];case 2:return a.sent(),i(),[3,4];case 3:return l=a.sent(),s(l),[3,4];case 4:return[3,6];case 5:p={tag:h.logTags.AM_SUBSCRIPTION,code:5004,msg:"Failed to unsubscribe, No Conference found for the specific user: "+e},d.logger.error(p),s(p),a.label=6;case 6:return[2]}}))}))}))]}))}))},t.prototype.publishCustomLocalStream=function(e,t){var n=this;return new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:if(!this.pubConference)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.publishCustomLocalStream(e,t)];case 2:return a.sent(),r(),[3,4];case 3:return n=a.sent(),i(n),[3,4];case 4:return[3,6];case 5:o={tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No Publication Conference found"},d.logger.error(o),i(o),a.label=6;case 6:return[2]}}))}))}))},t.prototype.shareScreen=function(e){var t=this;return new Promise((function(n,r){return o(t,void 0,void 0,(function(){var t,i,o;return a(this,(function(a){switch(a.label){case 0:if(4==this.rtcStateManager.getState("screen"))return o={tag:h.logTags.AM_SS,code:8006,msg:"Screen Share is already active"},d.logger.error(o),[2,r(o)];if(this.rtcStateManager.setState("screen",1),null==e.optimizationMode&&(e.optimizationMode=g.defaultScreenSettings.optimizationMode),null==e.screenSourceType&&(e.screenSourceType=g.defaultScreenSettings.screenSourceType),null==e.maxBitrate&&(e.maxBitrate=g.defaultScreenSettings.maxBitrate),null==e.minBitrate&&(e.minBitrate=g.defaultScreenSettings.minBitrate),null==e.frameRate&&(e.frameRate=g.defaultScreenSettings.frameRate),null==e.width&&(e.width=g.defaultScreenSettings.width),null==e.height&&(e.height=g.defaultScreenSettings.height),!this.pubConference)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.shareScreen(e)];case 2:return t=a.sent(),this.rtcStateManager.setState("screen",4),n(t),[3,4];case 3:return i=a.sent(),this.rtcStateManager.setState("screen",0),r(i),[3,4];case 4:return[3,6];case 5:o={tag:h.logTags.AM_SS,code:4001,msg:"No publication Conference found"},d.logger.error(o),this.rtcStateManager.setState("screen",0),r(o),a.label=6;case 6:return[2]}}))}))}))},t.prototype.endScreenShare=function(){var e=this;return this.rtcStateManager.setState("screen",2),new Promise((function(t,n){return o(e,void 0,void 0,(function(){var e,r;return a(this,(function(i){switch(i.label){case 0:if(!this.pubConference)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.endScreenShare()];case 2:return i.sent(),t(),[3,4];case 3:return e=i.sent(),n(e),[3,4];case 4:return[3,6];case 5:r={tag:h.logTags.AM_SS,code:4001,msg:"No publication Conference found"},d.logger.error(r),n(r),i.label=6;case 6:return this.rtcStateManager.setState("screen",0),[2]}}))}))}))},t.prototype.setNewDeviceId=function(e,t){var n=this;return new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:if(!this.pubConference)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pubConference.conferenceManager.setNewDeviceId(e,t)];case 2:return a.sent(),r(),[3,4];case 3:return n=a.sent(),i(n),[3,4];case 4:return[3,6];case 5:o={tag:h.logTags.AM_SS,code:4001,msg:"No publication Conference found"},d.logger.error(o),i(o),a.label=6;case 6:return[2]}}))}))}))},t.prototype.getRTCStats=function(e,t,n){if("local"==t)return this.pubConference.statsManager.getRTCStats(e,t);if("remote"==t){var r=this.fetchInternalPublishUserInfo(n),i=r.internalUserId,o=r.remoteUserconfId,a=void 0;if(o&&this.conferences[o]&&(a=this.conferences[o].conferenceObj),a)return a.statsManager.getRTCStats(e,t,i);var s={tag:h.logTags.AM_RTCSTATS,code:4001,msg:"Failed to fetch Local stats, No Publication Conference found"};throw d.logger.error(s),s}},t.prototype.getActiverSpeakersList=function(){var e=this;return new Promise((function(t,n){return o(e,void 0,void 0,(function(){var e,r;return a(this,(function(i){return"GET",e={method:"GET",headers:{"Content-Type":"application/json"}},r=function(e){return e.json().then((function(t){return{json:t,response:e}}))},[2,fetch(this.fetchLastNActiveAPIUrl+"?baseConferenceId="+this.baseConferenceId,e).then().then(r).then((function(e){var r=e.json;r?(d.logger.log({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"Successfully fetched the list of current Active Speakers in Base Conference"}),t(r)):n("No Active Speakers Found")})).catch((function(e){var t={tag:h.logTags.AM_ACTIVE_SPEAKERS,code:13001,msg:"Failed to fetch last N Active Speakers from Airmeet server, "+e};d.logger.error(t),n(t)}))]}))}))}))},t.prototype.getMyUserIds=function(){return Object.keys(this.localUserIdtoConferenceMap)},t.prototype.getParticipantCount=function(){var e=this.layoutManager.remoteUsersInfoList?Object.keys(this.layoutManager.remoteUsersInfoList).length:0,t=this.conferences?Object.keys(this.conferences).length:0,n=Math.ceil(e/t)+1;return d.logger.log({tag:h.logTags.AM_CONFERENCE,msg:"Fetching Pax Count, totalUserCount : "+e+", confCount:  "+t+", finalPaxCOunt : "+n}),n},t.prototype.getParticipantsList=function(){var e=this,t=[];return new Promise((function(n,r){return o(e,void 0,void 0,(function(){var e,i,o;return a(this,(function(a){switch(a.label){case 0:e=0,a.label=1;case 1:if(!(e<Object.keys(this.conferences).length))return[3,6];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,Object.values(this.conferences)[e].conferenceObj.conferenceManager.getParticipantsList()];case 3:return i=a.sent(),t.push(i),[3,5];case 4:return o=a.sent(),r(o),[3,5];case 5:return e++,[3,1];case 6:return n(t),[2]}}))}))}))},t.prototype.getConferenceCount=function(){return this.conferences?Object.keys(this.conferences).length:0},t.prototype.cleanup=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.resetFirebaseListeners(),this.updateFirebaseDataonLeave(),this.layoutManager&&this.layoutManager.cleanup(),this.resetVars(),[2]}))}))},t.prototype.resetVars=function(){this.localUserIdtoConferenceMap={},this.baseConferenceId=null,this.baseUserId=null,this.baseConfParams=null,this.pubconferenceId=null,this.pubConference=null,this.subChannels=null,this.pubUserId=null,this.harkAudioInit=null,this.audioAnalyser=null,this.lastASLReceivedTime=null,this.accumulatedVoiceActivityAcrossConferences=[],this.localActiveSpeakersCount=null,this.publishedMediaStatus={isAudioPublished:!1,isVideoPublished:!1},this.capturedMediaStatus={isAudioEnabled:!1,isVideoEnabled:!1},this.fbReferences={ASLRef:null,publishingUserRef:null,channelAvailabilityRef:null}},t.prototype.leave=function(){var e=this;return new Promise((function(t,n){return o(e,void 0,void 0,(function(){var e,r,i,o,s,c,u,l;return a(this,(function(a){switch(a.label){case 0:if(4!=this.rtcStateManager.getState("screen")&&0!=this.rtcStateManager.getState("screen"))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.endScreenShare()];case 2:return a.sent(),[3,4];case 3:return a.sent(),[3,4];case 4:this.cleanup(),e=[],r=Object.keys(this.conferences),i=0,a.label=5;case 5:if(!(i<r.length))return[3,12];o=void 0,s=0,a.label=6;case 6:return a.trys.push([6,9,,10]),c=r[i],(u=this.conferences[c])&&u.conferenceObj&&u.conferenceObj.conferenceManager?[4,u.conferenceObj.conferenceManager.leave()]:[3,8];case 7:a.sent(),a.label=8;case 8:return o=null,delete this.conferences[c],[3,10];case 9:return l=a.sent(),o=l,e.push(o),s++,d.logger.log({tag:h.logTags.AM_RETRY,msg:"Failed to Leave Conference, Current Retry Count: "+s+", Retries Allowed: "+h.rtcRetries.leaveRetries}),[3,10];case 10:if(o&&s<=h.rtcRetries.leaveRetries)return[3,6];a.label=11;case 11:return i++,[3,5];case 12:return this.conferences={},e.length>0?n(e):t(),[2]}}))}))}))},t.prototype.close=function(){this.firebaseClient.disconnect(),d.logger.log({tag:h.logTags.AM_FIREBASE,msg:"Firebase connection closed gracefully"})},t.prototype.getConferenceByUserId=function(e){var t=this.layoutManager.remoteUsersInfoList[e],n=t?t.conferenceId:null;return!(!n||!this.conferences[n])&&this.conferences[n].conferenceObj},t.prototype.logMyVoiceActivity=function(){this.fbReferences.ASLRef&&this.fbReferences.ASLRef.child(this.pubUserId).setWithPriority(Date.now(),Date.now())},t.prototype.setAudioAnalyserParams=function(e){this.audioAnalyserParams=e},t.prototype.initAudioAnalyser=function(){var e=this;if(this.conferences&&this.pubconferenceId&&this.conferences[this.pubconferenceId]){var t=this.conferences[this.pubconferenceId].conferenceObj.conferenceManager.getCurrentLocalStream();if(t){this.harkAudioInit=!0;var n={volumeThreshold:this.audioAnalyserParams.volumeThreshold,samplingInterval:this.audioAnalyserParams.samplingInterval,sampleSize:this.audioAnalyserParams.sampleSize,positiveSampleThreshold:this.audioAnalyserParams.positiveSampleThreshold,isAudioAnalyserLogsEnabled:this.audioAnalyserParams.isAudioAnalyserLogsEnabled};this.audioAnalyser=p.default(n),this.audioAnalyser.init(t),this.audioAnalyser.on("speaking",(function(){d.logger.log({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"Started Speaking"}),e.speakingActivityInterval||(e.speakingActivityInterval=setInterval((function(){e.logMyVoiceActivity()}),e.audioAnalyserParams.speechDurationThreshold))})),this.audioAnalyser.on("stopped_speaking",(function(){d.logger.log({tag:h.logTags.AM_ACTIVE_SPEAKERS,msg:"Stopped Speaking"}),e.speakingActivityInterval&&(clearInterval(e.speakingActivityInterval),e.speakingActivityInterval=null)}))}else{var r={tag:h.logTags.AIMEET_AUDIO_ANALYSER,code:14001,msg:"No Audio Stream found to analyse"};d.logger.error(r)}}else d.logger.error({tag:h.logTags.AM_PUBLICATION,code:4001,msg:"No publication Conference found for Audio Analysis"})},t.prototype.startAudioAnalyser=function(){var e=this.conferences[this.pubconferenceId].conferenceObj.conferenceManager.getCurrentLocalStream();this.audioAnalyser?this.audioAnalyser.init(e):this.initAudioAnalyser()},t.prototype.attachEventListeners=function(){var e=this;this.rtcEventEmitter=l.default.getConferenceEmitter(),this.rtcEventEmitter.on("connection-state-change",(function(t){e.emit("connection-state-change",t)})),this.rtcEventEmitter.on("user-joined",(function(t){e.layoutManager.manageViewPostRemoteUserJoin(t)})),this.rtcEventEmitter.on("user-left",(function(t){return o(e,void 0,void 0,(function(){return a(this,(function(e){return this.layoutManager.manageViewPostRemoteUserLeave(t),[2]}))}))})),this.rtcEventEmitter.on("local-audio-track-captured",(function(){e.emit("local-audio-track-captured")})),this.rtcEventEmitter.on("local-video-track-captured",(function(){e.emit("local-video-track-captured")})),this.rtcEventEmitter.on("remote-audio-track-published",(function(t){return o(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.layoutManager.manageViewOnRemoteTrackPublished(t.userId,"audio")];case 1:return e.sent(),this.emit("remote-audio-track-published",{userId:E.fetchOriginalUserId(t.userId)}),[2]}}))}))})),this.rtcEventEmitter.on("remote-video-track-published",(function(t){return o(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.layoutManager.manageViewOnRemoteTrackPublished(t.userId,"video")];case 1:return e.sent(),this.emit("remote-video-track-published",{userId:E.fetchOriginalUserId(t.userId)}),this.setStreamFallbackOption(t.userId,2),[2]}}))}))})),this.rtcEventEmitter.on("remote-screen-track-published",(function(t){return o(e,void 0,void 0,(function(){return a(this,(function(e){return this.layoutManager.addScreenVideoandUpdateLayout(t.userId),[2]}))}))})),this.rtcEventEmitter.on("remote-audio-track-unpublished",(function(t){e.layoutManager.manageViewOnRemoteTrackUnpublished(t.userId,"audio"),e.emit("remote-audio-track-unpublished",{userId:E.fetchOriginalUserId(t.userId)})})),this.rtcEventEmitter.on("remote-video-track-unpublished",(function(t){e.layoutManager.manageViewOnRemoteTrackUnpublished(t.userId,"video"),e.emit("remote-video-track-unpublished",{userId:E.fetchOriginalUserId(t.userId)})})),this.rtcEventEmitter.on("remote-screen-track-unpublished",(function(t){e.layoutManager.removeScreenVideoandUpdateLayout(t.userId)})),this.rtcEventEmitter.on("network-quality-change",(function(t){e.emit("network-quality-change",t)})),this.rtcEventEmitter.on("stream-type-changed",(function(t){e.emit("stream-type-changed",t)})),this.rtcEventEmitter.on("stream-fallback",(function(t){e.emit("stream-fallback",t)})),this.rtcEventEmitter.on("local-screen-track-unpublished-natively",(function(t){e.rtcStateManager.setState("screen",0),e.emit("local-screen-track-unpublished-natively",t)})),this.rtcEventEmitter.on("token-will-expire",(function(){e.emit("token-will-expire")})),this.rtcEventEmitter.on("token-did-expire",(function(){e.emit("token-did-expire")})),this.rtcEventEmitter.on("volume-indicator",(function(t){t=t.map((function(e){return e.userId=E.fetchOriginalUserId(e.uid),delete e.uid,e.isSpeaking=e.level>h.VOICE_ACTIVITY_THRESHOLD,e})),e.emit("volume-indicator",t)})),navigator.mediaDevices.ondevicechange=function(t){e.deviceChangeMutex&&(d.logger.log({tag:h.logTags.AM_DEVICES,msg:"List of RTC devices has been updated following a change in Input/Output Hardware"}),e.emit("rtc-device-change"),e.deviceChangeMutex=!1,setTimeout((function(){e.deviceChangeMutex=!0}),1e3))}},t.prototype.pinUser=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=this.fetchInternalPublishUserInfo(e).internalUserId,"for_all"!=t?[3,2]:[4,this.pinUserForAll(n,!0)];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.unpinUser=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=this.fetchInternalPublishUserInfo(e).internalUserId,"for_all"!=t?[3,2]:[4,this.pinUserForAll(n,!1)];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.pinUserForAll=function(e,t){var n=this;return new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n,o,s,c,u;return a(this,(function(a){n={"Content-Type":"application/json"},"POST",o=JSON.stringify({baseConferenceId:this.baseConferenceId,userId:e,isPinned:t}),s={method:"POST",headers:n,body:o};try{return c=function(e){return e.json().then((function(t){return{json:t,response:e}}))},[2,fetch(this.pinUserApiUrl,s).then().then(c).then((function(e){var t=e.json;d.logger.log({tag:h.logTags.AM_PIN,msg:"Successfully pinned/unpinned the user: "+t}),r(t)}))]}catch(e){u={tag:h.logTags.AM_PIN,code:15001,msg:"Failed to pin/unpin the user, "+e},d.logger.error(u),i(u)}return[2]}))}))}))},t}(c.EventEmitter);t.AirmeetRTCClient=y},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return i(t,e),t.getConferenceEmitter=function(){return this.rtcEventEmitter||(this.rtcEventEmitter=new t),this.rtcEventEmitter},t}(n(6).EventEmitter);t.default=o},function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var r=this,i=3===arguments.length,o=i?arguments[1]:void 0,a=i?arguments[2]:arguments[1];function s(){r.off(e,s),a.apply(this,arguments)}return this.on(e,o,s),this},t.releaseGroup=function(e){var t,n,r,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,r=(i=this.callbacks[t]).length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(-1!==(n=r.indexOf(t))&&(r.splice(n,1),0===r.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),o=this.callbacks[e],a=this.getWildcardCallbacks(e);if(o)for(t=0,n=(r=o.slice()).length;t<n&&r[t];++t)r[t].apply(this,i);if(a)for(n=a.length,t=0,n=(r=a.slice()).length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},n.mixin(n)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Conference=void 0;var c=n(14),u=n(15),l=n(16),d=n(4),h=function(){function e(e){this.adapterLoaded=!1,this.conferenceId=e.conferenceId,this.myUserId=e.myUserId,this.myRole=e.myRole,this.mode=e.mode,this.rtcProviderName=e.rtcProviderName,this.extraLogArgs=e.extraLogArgs,this.rtcProviderName=e.rtcProviderName?e.rtcProviderName:d.defaultRTCVendorSettings.rtcProviderName,this.prefVideoCodec=e.prefVideoCodec?e.prefVideoCodec:d.defaultRTCVendorSettings.prefVideoCodec,this.appId=e.appId?e.appId:d.defaultRTCVendorSettings.appId}return e.prototype.init=function(){var e=this;return new Promise((function(t,r){return a(e,void 0,void 0,(function(){var e,i;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),this.adapterLoaded?[3,4]:"Agora"!=this.rtcProviderName?[3,2]:[4,Promise.resolve().then((function(){return o(n(17))}))];case 1:e=a.sent().Adapter,this.adapter=new e,a.label=2;case 2:return this.adapterLoaded=!0,[4,this.adapter.initClient(this.appId,this.conferenceId,this.myUserId,this.myRole,this.mode,this.prefVideoCodec,this.extraLogArgs)];case 3:a.sent(),a.label=4;case 4:return this.conferenceManager=new c.ConferenceManager(this.conferenceId,this.adapter),this.statsManager=new u.StatsManager(this.conferenceId,this.adapter),this.streamingManager=new l.StreamingManager(this.adapter),t(),[3,6];case 5:return i=a.sent(),r(i),[3,6];case 6:return[2]}}))}))}))},e.prototype.join=function(){var e=this;return new Promise((function(t,n){return a(e,void 0,void 0,(function(){var e,r;return s(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.adapter.getChannelToken(this.conferenceId)];case 1:return e=i.sent(),this.conferenceToken=e,[4,this.adapter.joinChannel(this.conferenceId,e,this.myUserId)];case 2:return i.sent(),t(),[3,4];case 3:return r=i.sent(),n(r),[3,4];case 4:return[2]}}))}))}))},e.prototype.setLogLevel=function(e){this.adapter.setLogLevel(e)},e.prototype.getConferenceManager=function(){return null==this.conferenceManager?new c.ConferenceManager(this.conferenceId,this.adapter):this.conferenceManager},e.prototype.getStatsManager=function(){return null==this.statsManager?new u.StatsManager(this.conferenceId,this.adapter):this.statsManager},e.prototype.getStreamingManager=function(){return null==this.streamingManager?new l.StreamingManager(this.adapter):this.streamingManager},e}();t.Conference=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConferenceManager=void 0;var o=n(6),a=n(4),s=function(e){function t(t,n){var r=e.call(this)||this;return r.adapter=n,r.confName=t,r}return i(t,e),t.prototype.setMediaProfile=function(e){null==e.audio.bitrate&&(e.audio.bitrate=a.defaultMediaSettings.audio.bitrate),null==e.audio.sampleRate&&(e.audio.sampleRate=a.defaultMediaSettings.audio.sampleRate),null==e.audio.sampleSize&&(e.audio.sampleSize=a.defaultMediaSettings.audio.sampleSize),null==e.audio.stereo&&(e.audio.stereo=a.defaultMediaSettings.audio.stereo),null==e.audio.AGC&&(e.audio.AGC=a.defaultMediaSettings.audio.AGC),null==e.audio.AEC&&(e.audio.AEC=a.defaultMediaSettings.audio.AEC),null==e.audio.ANS&&(e.audio.ANS=a.defaultMediaSettings.audio.ANS),null==e.video.minBitrate&&(e.video.minBitrate=a.defaultMediaSettings.video.minBitrate),null==e.video.maxBitrate&&(e.video.maxBitrate=a.defaultMediaSettings.video.maxBitrate),null==e.video.height&&(e.video.height=a.defaultMediaSettings.video.height),null==e.video.width&&(e.video.width=a.defaultMediaSettings.video.width),null==e.video.frameRate&&(e.video.frameRate=a.defaultMediaSettings.video.frameRate),this.adapter.setMediaProfile(e)},t.prototype.captureLocalStream=function(){return this.adapter.captureLocalStream()},t.prototype.playLocalStream=function(e,t){return this.adapter.playLocalStream(e,t)},t.prototype.playRemoteStream=function(e,t,n){return this.adapter.playRemoteStream(e,t,n)},t.prototype.playLocalCustomStream=function(e){return this.adapter.playLocalCustomStream(e)},t.prototype.publishLocalStream=function(e){return this.adapter.publishLocalStream(e)},t.prototype.publishCustomLocalStream=function(e,t){return this.adapter.publishCustomLocalStream(e,t)},t.prototype.unpublishLocalStream=function(e){return this.adapter.unpublishLocalStream(e)},t.prototype.unpublishCustomLocalStream=function(e){return this.adapter.unpublishCustomLocalStream(e)},t.prototype.subscribeMedia=function(e,t,n){return this.adapter.subscribeMedia(e,t,n)},t.prototype.leave=function(){return this.adapter.leave()},t.prototype.updatePublication=function(e){return this.adapter.updatePublication(e)},t.prototype.unsubscribeMedia=function(e,t){return this.adapter.unsubscribeMedia(e,t)},t.prototype.getCurrentLocalStream=function(){return this.adapter.getCurrentLocalStream()},t.prototype.setNewDeviceId=function(e,t){return this.adapter.setNewDeviceId(e,t)},t.prototype.muteLocalVideo=function(e){var t={isEnabled:e};return this.adapter.muteLocalVideo(t)},t.prototype.muteLocalAudio=function(e){var t={isEnabled:e};return this.adapter.muteLocalAudio(t)},t.prototype.shareScreen=function(e){return null==e.optimizationMode&&(e.optimizationMode=a.defaultScreenSettings.optimizationMode),null==e.maxBitrate&&(e.maxBitrate=a.defaultScreenSettings.maxBitrate),null==e.minBitrate&&(e.minBitrate=a.defaultScreenSettings.minBitrate),null==e.frameRate&&(e.frameRate=a.defaultScreenSettings.frameRate),null==e.width&&(e.width=a.defaultScreenSettings.width),null==e.height&&(e.height=a.defaultScreenSettings.height),this.adapter.shareScreen(e)},t.prototype.endScreenShare=function(){return this.adapter.endScreenShare()},t.prototype.toggleRemoteUserVideo=function(e,t,n){return this.adapter.toggleRemoteUserVideo(e,t,n)},t.prototype.enableDualStream=function(e){return this.adapter.enableDualStream(e)},t.prototype.setStreamFallbackOption=function(e,t){return this.adapter.setStreamFallbackOption(e,t)},t.prototype.renewToken=function(){return this.adapter.renewToken()},t.prototype.getParticipantsList=function(){return this.adapter.getParticipantsList()},t}(o.EventEmitter);t.ConferenceManager=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.StatsManager=void 0;var o=function(e){function t(t,n){var r=e.call(this)||this;return r.adapter=n,r.confName=t,r}return i(t,e),t.prototype.getRTCStats=function(e,t,n){return this.adapter.getRTCStats(e,t,n)},t}(n(6).EventEmitter);t.StatsManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamingManager=void 0;var r=function(){function e(e){this.adapter=e}return e.prototype.setupStreaming=function(e){return this.adapter.setupStreaming(e)},e.prototype.startStreaming=function(e){return this.adapter.startStreaming(e)},e.prototype.stopStreaming=function(e){return this.adapter.stopStreaming(e)},e}();t.StreamingManager=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Adapter=void 0;var i=r(n(18));t.Adapter=i.default},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(19)),s=o(n(11)),c=n(7),u=n(4),l=function(){function e(){this.roomTokenAPIUrl="http://localhost:8080/agora/token",this.turnCredentialsAPIUrl="http://localhost:8080/turn/getTURNTempCredentials",this.participantsMap={},this.accumulatedVoiceActivityAcrossConferences=[],this.publishedMediaStatus={isAudioPublished:!1,isVideoPublished:!1},this.setMediaProfile=function(e){this.localMediaSettings={isAudioEnabled:e.audio.isEnabled,isVideoEnabled:e.video.isEnabled};var t={bitrate:e.audio.bitrate,sampleRate:e.audio.sampleRate,sampleSize:e.audio.sampleSize,stereo:e.audio.stereo},n={bitrateMin:e.video.minBitrate,bitrateMax:e.video.maxBitrate,height:e.video.height,width:e.video.width,frameRate:e.video.frameRate};this.mediaProfile={video:{cameraId:e.video.cameraId,facingMode:e.video.facingMode,optimisationMode:e.video.optimisationMode,encoderConfig:n},audio:{microphoneId:e.audio.microphoneId,AEC:e.audio.AEC,AGC:e.audio.AGC,ANS:e.audio.ANS,encoderConfig:t}},c.logger.log({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Media Profile Set Successfully for capture and publication"})}}return e.prototype.init=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.checkBrowserCompatibility=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){return i(this,(function(e){try{t(a.default.checkSystemRequirements())}catch(e){n(!1)}return[2]}))}))}))},e.prototype.setLogLevel=function(e){a.default.setLogLevel(e)},e.prototype.getTURNCredentials=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,o;return i(this,(function(i){"GET",e={method:"GET",headers:{"Content-Type":"application/json"}};try{return r=function(e){return e.json().then((function(t){return{json:t,response:e}}))},[2,fetch(this.turnCredentialsAPIUrl,e).then().then(r).then((function(e){var n=e.json;t(n)}))]}catch(e){o={tag:u.logTags.AM_CONFERENCE,src:this.logIdentifierArgs,code:1005,msg:"Failed to fetch TURN credentials, "+e},c.logger.error(o),n(o)}return[2]}))}))}))},e.prototype.initClient=function(e,t,n,o,s,l,d){return r(this,void 0,void 0,(function(){var r,h,p,f;return i(this,(function(i){switch(i.label){case 0:c.logger.addLogIdentifierArgs({confId:t,userId:n,extras:d}),this.appId=e;try{this.client=a.default.createClient({mode:s,codec:l})}catch(e){throw r={tag:u.logTags.AM_CONFERENCE,src:this.logIdentifierArgs,code:1001,msg:"Failed to create conference client, "+e},c.logger.error(r),r}return[4,this.getTURNCredentials()];case 1:if((h=i.sent()).turnServers)for(p=0;p<h.turnServers.length;p++)f={turnServerURL:h.turnServers[0].url,password:h.password,udpport:h.turnServers[0].port,username:h.username,forceturn:!0,tcpport:h.turnServers[0].port},f;return this.client.enableAudioVolumeIndicator(),"live"==s&&this.client.setClientRole("host"),this.conferenceMode=s,this.prefCodec=l,this.myUserId=n,this.myRole=o,[2,!0]}}))}))},e.prototype.getChannelToken=function(e,t){var n=this;return new Promise((function(o,a){return r(n,void 0,void 0,(function(){var n,r,s,l,d,h;return i(this,(function(i){if(this.channelId=e,!(n=t||this.myUserId)&&!e)return[2,Promise.reject()];r={"Content-Type":"application/json"},"POST",s=JSON.stringify({agoraUserId:n,channelId:e,role:this.myRole}),l={method:"POST",headers:r,body:s};try{return d=function(e){return e.json().then((function(t){return{json:t,response:e}}))},[2,fetch(this.roomTokenAPIUrl,l).then().then(d).then((function(e){var t=e.json;o(t.token)}))]}catch(e){h={tag:u.logTags.AM_CONFERENCE,src:this.logIdentifierArgs,code:1003,msg:"Failed to fetch Channel Join token, "+e},c.logger.error(h),a(h)}return[2]}))}))}))},e.prototype.joinChannel=function(e,t,n){var o=this;return new Promise((function(a,s){return r(o,void 0,void 0,(function(){var r,o,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.attachEventListeners(),[4,this.client.join(this.appId,e,t,n)];case 1:return r=i.sent(),c.logger.log({tag:u.logTags.AM_CONFERENCE,src:this.logIdentifierArgs,msg:"Successfully Joined the channel: ",channelId:e}),a(r),[3,3];case 2:return o=i.sent(),l={tag:u.logTags.AM_CONFERENCE,src:this.logIdentifierArgs,code:1004,msg:"Failed to join channel, "+o},c.logger.error(l),s(l),[3,3];case 3:return[2]}}))}))}))},e.prototype.captureLocalStream=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,o,l,d,h,p;return i(this,(function(i){switch(i.label){case 0:return e={isAudioEnabled:!1,isVideoEnabled:!1},this.localMediaTracks?(c.logger.info({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Existing captured stream found, releasing it"}),[4,this.releaseLocalStream()]):[3,2];case 1:i.sent(),this.localMediaTracks=null,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,a.default.createMicrophoneAudioTrack(this.mediaProfile.audio)];case 3:return r=i.sent(),[3,5];case 4:return l=i.sent(),c.logger.error({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Failed to capture local Audio stream : "+l}),[3,5];case 5:r&&!this.localMediaSettings.isAudioEnabled&&r.setEnabled(!1),i.label=6;case 6:return i.trys.push([6,8,,9]),[4,a.default.createCameraVideoTrack(this.mediaProfile.video)];case 7:return o=i.sent(),[3,9];case 8:return d=i.sent(),c.logger.error({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Failed to capture local Video stream : "+d}),[3,9];case 9:return o&&!this.localMediaSettings.isVideoEnabled&&o.setEnabled(!1),!this.localMediaSettings.isVideoEnabled||this.localMediaSettings.isAudioEnabled||o?!this.localMediaSettings.isAudioEnabled||this.localMediaSettings.isVideoEnabled||r?this.localMediaSettings.isAudioEnabled&&this.localMediaSettings.isVideoEnabled&&!r&&!o?(h={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3004,msg:"Failed to capture either of the Audio or Video stream",status:e},c.logger.error(h),[2,n(h)]):(this.localMediaTracks={audioTracks:r?[r]:[],videoTracks:o?[o]:[]},e={isAudioEnabled:this.localMediaSettings.isAudioEnabled&&!!r,isVideoEnabled:this.localMediaSettings.isVideoEnabled&&!!o},c.logger.log({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Successfully captured the Local Media, Local Media Status : "+JSON.stringify(e)}),p=s.default.getConferenceEmitter(),e.isAudioEnabled&&p.emit("local-audio-track-captured"),e.isVideoEnabled&&p.emit("local-video-track-captured"),t(e),[2]):(h={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3003,msg:"Failed to capture Audio-only stream",status:e},c.logger.error(h),[2,n(h)]):(h={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3002,msg:"Failed to capture Video-only stream",status:e},c.logger.error(h),[2,n(h)])}}))}))}))},e.prototype.setNewDeviceId=function(e,t){var n=this;return new Promise((function(o,a){return r(n,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),"camera"==e&&this.localMediaTracks.videoTracks[0]?[4,this.localMediaTracks.videoTracks[0].setDevice(t)]:[3,2];case 1:return i.sent(),[3,5];case 2:return"mic"==e&&this.localMediaTracks.audioTracks[0]?[4,this.localMediaTracks.audioTracks[0].setDevice(t)]:[3,4];case 3:return i.sent(),[3,5];case 4:r={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:7005,msg:"Failed to switch to new device, Existing track not found"},c.logger.error(r),a(r),i.label=5;case 5:return c.logger.log({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Successfully switched to new RTC Device, deviceType : "+e+", deviceId: "+t}),o(),[3,7];case 6:return n=i.sent(),r={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:7006,msg:"Failed to switch to new device: "+n},c.logger.error(r),a(r),[3,7];case 7:return[2]}}))}))}))},e.prototype.releaseLocalStream=function(){var e=this;return new Promise((function(t,n){if(null!=e.localMediaTracks)e.localMediaTracks.audioTracks[0]&&e.localMediaTracks.audioTracks[0].getMediaStreamTrack()&&e.localMediaTracks.audioTracks[0].getMediaStreamTrack().stop(),e.localMediaTracks.videoTracks[0]&&e.localMediaTracks.videoTracks[0].getMediaStreamTrack()&&e.localMediaTracks.videoTracks[0].getMediaStreamTrack().stop(),t();else{var r={tag:u.logTags.AM_CAPTURE,src:e.logIdentifierArgs,msg:"Local Stream not found for release"};c.logger.error(r),n(r)}}))},e.prototype.playLocalStream=function(e,t){if(null==t){var n={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3006,msg:"No Video Element Provided for the "+e+" playback"};throw c.logger.error(n),n}if("video"==e){if(this.localMediaTracks&&this.localMediaTracks.videoTracks&&this.localMediaTracks.videoTracks.length>0)return this.localMediaTracks.videoTracks[0].play(t),!0;n={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3007,msg:"No Video Track found to be played"};throw c.logger.error(n),n}if("screen"==e){if(this.localScreenTrack)return this.localScreenTrack.play(t),!0;n={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3007,msg:"No Screen Track found to be played"};throw c.logger.error(n),n}if("audio"==e){n={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"Cannot Play Local Audio Track as it may lead to feedback noise."};throw c.logger.error(n),n}if(!e){n={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,msg:"No media type provided for local media playback"};throw c.logger.error(n),n}},e.prototype.playLocalCustomStream=function(e){if(null==e){var t={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3006,msg:"No Video Element Provided for the playback"};throw c.logger.error(t),t}if(this.localCustomMediaTracks&&this.localCustomMediaTracks.videoTrack)return this.localCustomMediaTracks.videoTrack.play(e),!0;t={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3007,msg:"No Video Track found to be played"};throw c.logger.error(t),t},e.prototype.publishLocalStream=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,a,s,l;return i(this,(function(i){switch(i.label){case 0:if(!this.localMediaTracks||!this.localMediaSettings.isAudioEnabled&&!this.localMediaSettings.isVideoEnabled||!this.localMediaTracks.audioTracks[0]&&!this.localMediaTracks.videoTracks[0])return l={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4002,msg:"Failed to publish, No Local Stream captured"},c.logger.error(l),[2,o(l)];if(t=this.localMediaTracks.audioTracks[0],r=this.localMediaTracks.videoTracks[0],"audio"==e&&!t)return l={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4003,msg:"Failed to publish the Audio-only stream, No Audio Track available"},c.logger.error(l),[2,o(l)];if("video"==e&&!r)return l={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4004,msg:"Failed to publish the video-only stream, No Video Track available"},c.logger.error(l),[2,o(l)];null==e&&(t||c.logger.warn({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Failed to publish Audio Track, no Audio Track Found"}),r||c.logger.warn({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Failed to publish Video Track, No Video Track Found"})),a=[],"audio"!=e&&null!=e||null==t||!this.localMediaSettings.isAudioEnabled||(a.push(t),this.publishedMediaStatus.isAudioPublished=!0),"video"!=e&&null!=e||null==r||!this.localMediaSettings.isVideoEnabled||(a.push(r),this.publishedMediaStatus.isVideoPublished=!0),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.client.publish(a)];case 2:return i.sent(),c.logger.log({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Successfully published the local stream, Publication Status: "+JSON.stringify(this.publishedMediaStatus)}),n(this.publishedMediaStatus),[3,4];case 3:return s=i.sent(),l={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4005,mesg:"Failed to Publish Local stream, "+s},c.logger.error(l),o(l),[3,4];case 4:return[2]}}))}))}))},e.prototype.publishCustomLocalStream=function(e,t){var n=this;return new Promise((function(o,s){return r(n,void 0,void 0,(function(){var n,r,l,d,h,p,f;return i(this,(function(i){switch(i.label){case 0:e&&t?(n={encoderConfig:{bitrate:t.audioBitrate,sampleSize:t.audioSampleSize,sampleRate:t.audioSampleRate},mediaStreamTrack:e.getAudioTracks()[0]},r={bitrateMax:t.maxVideoBitrate,bitrateMin:t.minVideoBitrate,optimizationMode:t.videoOptimizationMode,mediaStreamTrack:e.getVideoTracks()[0]}):e?(e.getAudioTracks().length>0&&(n={encoderConfig:{bitrate:this.mediaProfile.audio.encoderConfig.bitrate,sampleSize:this.mediaProfile.audio.encoderConfig.sampleSize,sampleRate:this.mediaProfile.audio.encoderConfig.sampleRate},mediaStreamTrack:e.getAudioTracks()[0]}),e.getVideoTracks().length>0&&(r={bitrateMax:this.mediaProfile.video.encoderConfig.bitrateMin,bitrateMin:this.mediaProfile.video.encoderConfig.bitrateMax,optimizationMode:this.mediaProfile.video.encoderConfig.optimisationMode,mediaStreamTrack:e.getVideoTracks()[0]})):c.logger.error({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3006,msg:"Failed to create custom media, MediaStream not passed"}),r&&(d=a.default.createCustomVideoTrack(r)),n&&(l=a.default.createCustomAudioTrack(n)),null==l&&null==d&&(f={tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3007,msg:"Failed to publish custom media, No Local Custom stream captured"},c.logger.error(f),s(f)),h=[],this.localCustomMediaTracks={},d?(h.push(d),this.localCustomMediaTracks.videoTrack=d):d&&(h.push(l),this.localCustomMediaTracks.audioTrack=l),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.client.publish(h)];case 2:return i.sent(),o(),[3,4];case 3:return p=i.sent(),f={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4009,msg:"Failed to publish custom media, "+p},c.logger.error(f),s(f),[3,4];case 4:return[2]}}))}))}))},e.prototype.subscribeMedia=function(e,t,n){var o=this;return new Promise((function(n,a){return r(o,void 0,void 0,(function(){var r,o,s;return i(this,(function(i){switch(i.label){case 0:if(null==this.participantsMap[e])return s={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5001,msg:"Failed to subscribe "+t+", Remote user - "+e+" not found for subscription"},c.logger.error(s),a(s),[2];s={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"Remote user Found in the Map, time to subscribe"},c.logger.log(s),r=this.participantsMap[e].user,"screen"==t&&(t="video"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.client.subscribe(r,t)];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),s={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5002,msg:"Failed to subscribe "+t+", "+o},c.logger.error(s),a(s),[2];case 4:return c.logger.log({tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"User subscribed successfully, subscribed user  : "+e+", mediaType : "+t}),n(),[2]}}))}))}))},e.prototype.playRemoteStream=function(e,t,n){"screen"==t&&(t="video"),console.log("Inside PlayRemoteStream PARTICIPANT MAP : ",this.participantsMap),console.log("UserId being searched : ",e);var r=this.participantsMap[e]?this.participantsMap[e].user:null;if(!r){var i={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5003,msg:"Failed to play the remote stream, Stream not found"};throw c.logger.error(i),i}try{"video"==t?r.videoTrack.play(n):"audio"==t&&r.audioTrack.play()}catch(e){i={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5003,msg:"Failed to play the subscribed media, "+e};throw c.logger.error(i),i}return c.logger.log({tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"User Media Played successfully, : "+e+", mediaType : "+t}),!0},e.prototype.leave=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r;return i(this,(function(i){switch(i.label){case 0:this.localMediaTracks&&(this.localMediaTracks.videoTracks[0]&&this.localMediaTracks.videoTracks[0].close(),this.localMediaTracks.audioTracks[0]&&this.localMediaTracks.audioTracks[0].close()),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.client.leave()];case 2:return i.sent(),this.screenShareClient?[4,this.screenShareClient.leave()]:[3,4];case 3:i.sent(),i.label=4;case 4:return c.logger.log({tag:u.logTags.AM_LEAVE,src:this.logIdentifierArgs,msg:"User left the conference successfully"}),t(),[3,6];case 5:return e=i.sent(),r={tag:u.logTags.AM_LEAVE,src:this.logIdentifierArgs,code:5003,msg:"Failed to leave the conference, error : "+e},c.logger.error(r),n(r),[3,6];case 6:return[2]}}))}))}))},e.prototype.unpublishLocalStream=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,7,,8]),"video"!=e?[3,2]:[4,this.client.unpublish(this.localMediaTracks.videoTracks[0])];case 1:return i.sent(),[3,6];case 2:return"audio"!=e?[3,4]:[4,this.client.unpublish(this.localMediaTracks.audioTracks[0])];case 3:return i.sent(),[3,6];case 4:return[4,this.client.unpublish()];case 5:i.sent(),i.label=6;case 6:return c.logger.log({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Successfully unpublished "+e+" track"}),n(),[3,8];case 7:return t=i.sent(),r={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4008,msg:"Failed to unpublish "+e+" track, error : "+t},c.logger.error(r),o(r),[3,8];case 8:return[2]}}))}))}))},e.prototype.unpublishCustomLocalStream=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,7,,8]),"video"!=e?[3,2]:[4,this.client.unpublish(this.localCustomMediaTracks.videoTrack)];case 1:return i.sent(),this.localMediaTracks.videoTracks[0].stop(),[3,6];case 2:return"audio"!=e?[3,4]:[4,this.client.unpublish(this.localCustomMediaTracks.audioTrack)];case 3:return i.sent(),this.localMediaTracks.audioTracks[0].stop(),[3,6];case 4:return[4,this.client.unpublish()];case 5:i.sent(),this.localMediaTracks.videoTracks[0].stop(),this.localMediaTracks.audioTracks[0].stop(),i.label=6;case 6:return c.logger.log({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Successfully unpublished custom "+e+" track"}),n(),[3,8];case 7:return t=i.sent(),r={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4008,msg:"Failed to unpublish custom "+e+" track, error : "+t},c.logger.error(r),o(r),[3,8];case 8:return[2]}}))}))}))},e.prototype.updatePublication=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,a;return i(this,(function(i){switch(i.label){case 0:if(!e.video)return[3,5];t={bitrateMin:e.video.minBitrate,bitrateMax:e.video.maxBitrate,height:e.video.height,width:e.video.width,frameRate:e.video.frameRate},i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.localMediaTracks.videoTracks[0].setEnabled(e.video.isEnabled)];case 2:return i.sent(),[4,this.localMediaTracks.videoTracks[0].setEncoderConfiguration(t)];case 3:return i.sent(),c.logger.log({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Publication video Profile updated successfully, New VideoProfile: "+JSON.stringify(e.video)}),n(),[3,5];case 4:return r=i.sent(),c.logger.error({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4006,msg:"Failed to update Published video Profile, VideoProfile: "+JSON.stringify(e.video)+", Error: "+r}),o(r),[3,5];case 5:if(e.audio)try{this.localMediaTracks.audioTracks[0].setEnabled(e.audio.isEnabled),c.logger.log({tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,msg:"Publication Audio Profile updated successfully, New AudioProfile: "+JSON.stringify(e.video)}),n()}catch(t){a={tag:u.logTags.AM_PUBLICATION,src:this.logIdentifierArgs,code:4007,msg:"Failed to update Published Audio Profile, AudioProfile: "+JSON.stringify(e.audio)+", Error: "+t},c.logger.error(a),o(a)}return[2]}}))}))}))},e.prototype.unsubscribeMedia=function(e,t){var n=this;return new Promise((function(o,a){return r(n,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:if(null==this.participantsMap[e])return r={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5004,msg:"Failed to unsubscribe "+t+" track, Remote user - "+e+" not found"},c.logger.error(r),a(r),[2];if(n=this.participantsMap[e].user,"video"!=t&&"screen"!=t||!n.hasVideo||!n.videoTrack)return[3,5];n.videoTrack.stop(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.client.unsubscribe(n,t)];case 2:return i.sent(),c.logger.log({tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"Successfully unsubscribed the user "+e}),o(),[3,4];case 3:return i.sent(),r={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5005,msg:"Failed to unsubscribe Video track, track not found for the user - "+e},c.logger.error(r),a(r),[3,4];case 4:return[3,11];case 5:if("audio"!=t||!n.hasAudio||!n.audioTrack)return[3,10];n.videoTrack.stop(),i.label=6;case 6:return i.trys.push([6,8,,9]),[4,this.client.unsubscribe(n,t)];case 7:return i.sent(),c.logger.log({tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"Successfully unsubscribed the user "+e}),o(),[3,9];case 8:return i.sent(),r={tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,code:5005,msg:"Failed to unsubscribe Audio track, track not found for the user"},c.logger.error(r),a(r),[3,9];case 9:return[3,11];case 10:c.logger.warn({tag:u.logTags.AM_SUBSCRIPTION,src:this.logIdentifierArgs,msg:"track not found, failed to stop and unsubscribe"}),o(),i.label=11;case 11:return[2]}}))}))}))},e.prototype.getCurrentLocalStream=function(){if(!this.localMediaTracks||null==this.localMediaTracks.audioTracks&&this.localMediaTracks.videoTracks)return c.logger.error({tag:u.logTags.AM_CAPTURE,src:this.logIdentifierArgs,code:3005,msg:"Failed to get current local stream, no captured stream found"}),null;var e=new MediaStream;if(this.localMediaTracks.audioTracks[0]){var t=this.localMediaTracks.audioTracks[0].getMediaStreamTrack();e.addTrack(t)}if(this.localMediaTracks.videoTracks[0]){var n=this.localMediaTracks.videoTracks[0].getMediaStreamTrack();e.addTrack(n)}return e},e.prototype.muteLocalAudio=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,a;return i(this,(function(i){switch(i.label){case 0:(null==this.localMediaTracks||null==this.localMediaTracks.audioTracks||this.localMediaTracks.audioTracks.length<1)&&(a={tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,code:7001,msg:"Failed to toggle the Audio, track not found"},c.logger.error(a),o(a)),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.localMediaTracks.audioTracks[0].setEnabled(e.isEnabled)];case 2:return i.sent(),t=e.isEnabled?"unmuted":"muted",c.logger.log({tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,msg:"Successfully "+t+" the Audio"}),this.localMediaSettings.isAudioEnabled=e.isEnabled,!e.isEnabled||this.publishedMediaStatus.isAudioPublished?[3,4]:[4,this.publishLocalStream("audio")];case 3:i.sent(),i.label=4;case 4:return n(),[3,6];case 5:return r=i.sent(),a={tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,code:7002,msg:"Failed to toggle the Audio, "+r},c.logger.error(a),o(a),[3,6];case 6:return[2]}}))}))}))},e.prototype.muteLocalVideo=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,a;return i(this,(function(i){switch(i.label){case 0:(null==this.localMediaTracks||null==this.localMediaTracks.videoTracks||this.localMediaTracks.videoTracks.length<1)&&(a={tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,code:7003,msg:"Failed to toggle the Video, track not found"},c.logger.error(a),o(a)),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.localMediaTracks.videoTracks[0].setEnabled(e.isEnabled)];case 2:return i.sent(),t=e.isEnabled?"unpaused":"paused",c.logger.log({tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,msg:"Successfully "+t+" the Video"}),this.localMediaSettings.isVideoEnabled=e.isEnabled,!e.isEnabled||this.publishedMediaStatus.isVideoPublished?[3,4]:[4,this.publishLocalStream("video")];case 3:i.sent(),i.label=4;case 4:return n(),[3,6];case 5:return r=i.sent(),a={tag:u.logTags.AM_CONTROLS,src:this.logIdentifierArgs,code:7004,msg:"Failed to toggle the Video, "+r},c.logger.error(a),o(a),[3,6];case 6:return[2]}}))}))}))},e.prototype.shareScreen=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,s,l,d,h,p,f,g,m,v;return i(this,(function(i){switch(i.label){case 0:t=u.SCREEN_SHARE_USER_ID_PREFIX+"_"+this.myUserId,r={screenSourceType:e.screenSourceType,optimizationMode:e.optimizationMode,encoderConfig:{bitrateMax:e.maxBitrate,bitrateMin:e.minBitrate,frameRate:e.frameRate,width:e.width,height:e.height}},i.label=1;case 1:return i.trys.push([1,3,,4]),s=this,[4,a.default.createScreenVideoTrack(r)];case 2:return s.localScreenTrack=i.sent(),c.logger.log({tag:u.logTags.AM_SS,src:this.logIdentifierArgs,msg:"Successfully captured the screen stream"}),[3,4];case 3:return l=i.sent(),v={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8003,msg:"Failed to capture the screen stream, "+l},c.logger.error(v),[2,o(v)];case 4:if(null!=this.screenShareClient)return[3,8];try{this.screenShareClient=a.default.createClient({mode:this.conferenceMode,codec:this.prefCodec})}catch(e){return v={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8001,msg:"Failed to create client for screen sharing, "+e},c.logger.error(v),[2,o(v)]}i.label=5;case 5:return i.trys.push([5,7,,8]),d=this,[4,this.getChannelToken(this.channelId,t)];case 6:return d.screenShareToken=i.sent(),[3,8];case 7:return h=i.sent(),v={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8002,msg:"Failed to join the new channel for screen sharing, err : "+h},c.logger.error(v),[2,o(v)];case 8:return i.trys.push([8,10,,11]),[4,this.screenShareClient.join(this.appId,this.channelId,this.screenShareToken,t)];case 9:return i.sent(),c.logger.log({tag:u.logTags.AM_SS,src:this.logIdentifierArgs,msg:"Successfully Joined the new channel for screen sharing"}),[3,11];case 10:return p=i.sent(),v={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8002,msg:"Failed to join the new channel for screen sharing, err : "+p},c.logger.error(v),[2,o(v)];case 11:this.handleNativeScreenShareEndButton(this.localScreenTrack.getMediaStreamTrack()),i.label=12;case 12:return i.trys.push([12,14,,15]),[4,this.screenShareClient.publish(this.localScreenTrack)];case 13:return i.sent(),c.logger.log({tag:u.logTags.AM_SS,src:this.logIdentifierArgs,msg:"Successfully published the screen stream"}),f=this.localScreenTrack?this.localScreenTrack.getMediaStreamTrack():null,g=f?{settings:f.getSettings(),constraints:f.getConstraints()}:{},n(g),[3,15];case 14:return m=i.sent(),v={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8004,msg:"Failed to publish the screen stream, "+m},c.logger.error(v),o(v),[3,15];case 15:return[2]}}))}))}))},e.prototype.endScreenShare=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.screenShareClient.unpublish()];case 1:return i.sent(),[4,this.screenShareClient.leave()];case 2:return i.sent(),c.logger.log({tag:u.logTags.AM_SS,src:this.logIdentifierArgs,msg:"Successfully ended the screen stream"}),this.localScreenTrack&&(this.localScreenTrack.stop(),this.localScreenTrack.close()),t(),[3,4];case 3:return e=i.sent(),r={tag:u.logTags.AM_SS,src:this.logIdentifierArgs,code:8004,msg:"Failed to end the screen sharing, "+e},c.logger.error(r),n(r),[3,4];case 4:return[2]}}))}))}))},e.prototype.handleNativeScreenShareEndButton=function(e){var t=this;e.onended=function(){return r(t,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.endScreenShare()];case 1:return e.sent(),[3,3];case 2:return e.sent(),[3,3];case 3:return s.default.getConferenceEmitter().emit("local-screen-track-unpublished-natively"),[2]}}))}))}},e.prototype.getScreenUserId=function(e){if(this.isScreenShare(e)){var t=e.split("_");return t.splice(0,1),t.join("_")}return null},e.prototype.isScreenShare=function(e){return e.split("_")[0]==u.SCREEN_SHARE_USER_ID_PREFIX},e.prototype.isLocalScreenShare=function(e){return this.getScreenUserId(e)===this.myUserId},e.prototype.getRTCStats=function(e,t,n){var r;if("local"==t){if(!this.localMediaTracks){var i={tag:u.logTags.AM_RTCSTATS,src:this.logIdentifierArgs,code:9001,msg:"Failed to get RTC Stats, No Local "+e+" track Found for local user"};throw c.logger.warn(i),i}"audio"==e&&this.localMediaTracks.audioTracks[0]?r=this.localMediaTracks.audioTracks[0].getStats():"video"==e&&this.localMediaTracks.videoTracks[0]&&(r=this.localMediaTracks.videoTracks[0].getStats())}else if("remote"==t&&n){var o=null==this.participantsMap[n]?null:this.participantsMap[n].user;if(null==o){i={tag:u.logTags.AM_RTCSTATS,src:this.logIdentifierArgs,code:9002,msg:"Failed to get RTC Stats, Remote user : "+n+" not found"};throw c.logger.warn(i),i}"audio"==e&&o.audioTrack?r=o.audioTrack.getStats():"video"==e&&o.videoTrack&&(r=o.videoTrack.getStats())}else if("remote"==t&&null==n){i={tag:u.logTags.AM_RTCSTATS,src:this.logIdentifierArgs,code:9003,msg:"Failed to get RTC Stats, userId for remote user not provided"};throw c.logger.error(i),i}return r},e.prototype.toggleRemoteUserVideo=function(e,t,n){var r=this;return new Promise((function(i,o){if(c.logger.log({tag:u.logTags.AM_REMOTE_TOGGLE,src:r.logIdentifierArgs,msg:"userId : "+e+", video toggle : "+t}),null==r.participantsMap[e]||null==r.participantsMap[e].user){var a={tag:u.logTags.AM_REMOTE_TOGGLE,src:r.logIdentifierArgs,msg:"Remote user not found for toggle, userId : "+e};c.logger.error(a),o(a)}var s=r.participantsMap[e].user;t?s.videoTrack.stop():s.videoTrack.play(n)}))},e.prototype.getParticipantsList=function(){return Object.keys(this.participantsMap)},e.prototype.setupStreaming=function(e){for(var t=this,n=[],r=0;r<e.length;r++){var i={x:0+320*r,y:0,width:320,height:240,zOrder:0,alpha:1,uid:e[r]};n.push(i)}return new Promise((function(r,i){t.liveTranscodingSetting={width:1280,height:720,videoBitrate:1e3,videoFramerate:30,audioBitrate:48,audioChannels:1,videoGop:30,userCount:e.length,audioSampleRate:48e3,backgroundColor:0,videoCodecProfile:100,transcodingUsers:n},c.logger.log(t.liveTranscodingSetting),t.client.setLiveTranscoding(t.liveTranscodingSetting).then((function(){c.logger.log({tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,msg:"Successfully completed the live transcoding setup"}),r()})).catch((function(e){var n={tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,code:10001,msg:"Failed to setup live transcoding, "+e};c.logger.error(n),i(n)}))}))},e.prototype.startStreaming=function(e){var t=this;return new Promise((function(n,r){t.client.startLiveStreaming(e,!0).then((function(){c.logger.log({tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,msg:"Successfully started the live streaming"}),n()})).catch((function(e){var n={tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,code:10002,msg:"Failed to start the live sreaming, "+e};c.logger.error(n),r(n)}))}))},e.prototype.stopStreaming=function(e){var t=this;return new Promise((function(n,r){t.client.stopLiveStreaming(e).then((function(){c.logger.log({tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,msg:"Successfully stopped the live streaming"}),n()})).catch((function(e){var n={tag:u.logTags.AM_STREAMING,src:t.logIdentifierArgs,code:10003,msg:"Failed to stop the live sreaming, "+e};c.logger.error(n),r(n)}))}))},e.prototype.enableDualStream=function(e){var t=this;return new Promise((function(n,r){e?t.client.enableDualStream().then((function(){c.logger.log({tag:u.logTags.AM_DUAL_STREAM,src:t.logIdentifierArgs,msg:"Dual stream enabled successfully"}),n()})).catch((function(e){var n={tag:u.logTags.AM_DUAL_STREAM,src:t.logIdentifierArgs,code:11002,msg:"Failed to enable Dual Stream, "+e};c.logger.error(n),r(n)})):t.client.disableDualStream().then((function(){c.logger.log({tag:u.logTags.AM_DUAL_STREAM,src:t.logIdentifierArgs,msg:"Dual stream disabled successfully"}),n()})).catch((function(e){var n={tag:u.logTags.AM_DUAL_STREAM,src:t.logIdentifierArgs,code:11003,msg:"Failed to disable Dual Stream, "+e};c.logger.error(n),r(n)}))}))},e.prototype.setStreamFallbackOption=function(e,t){var n=this;return new Promise((function(r,i){n.client.setStreamFallbackOption(e,t).then((function(){c.logger.log({tag:u.logTags.AM_DUAL_STREAM,src:n.logIdentifierArgs,msg:"Fallback option set to LOW RES -> AUDIO"}),r()})).catch((function(e){var t={tag:u.logTags.AM_DUAL_STREAM,src:n.logIdentifierArgs,code:11005,msg:"Failed to set stream fallback option, "+e};c.logger.error(t),i(t)}))}))},e.prototype.setRemoteVideoStreamType=function(e,t){this.client.setRemoteVideoStreamType(e,t)},e.prototype.renewToken=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r;return i(this,(function(i){switch(i.label){case 0:return[4,this.getChannelToken(this.channelId,this.myUserId)];case 1:e=i.sent();try{this.client.renewToken(e),c.logger.log({tag:u.logTags.AM_TOKEN,src:this.logIdentifierArgs,msg:"Successfully renewed the token"}),t()}catch(e){r={tag:u.logTags.AM_DUAL_STREAM,src:this.logIdentifierArgs,code:12001,msg:"Failed to renew the token, "+e},c.logger.error(r),n(r)}return[2]}}))}))}))},e.prototype.attachEventListeners=function(){var e=this,t=s.default.getConferenceEmitter();this.client.on("user-published",(function(n,r){c.logger.log({tag:u.logTags.AM_REMOTE_PUBLICATION,src:e.logIdentifierArgs,msg:"User - "+n.uid+" published "+r+" track"});var i=n.uid,o=!1;if(e.isScreenShare(i)){if(e.isLocalScreenShare(i))return void c.logger.log({tag:u.logTags.AM_SS,src:e.logIdentifierArgs,msg:"Local Screen Stream received, not delegating the event, returning"});o=!0,c.logger.log({tag:u.logTags.AM_SS,src:e.logIdentifierArgs,msg:"Received Video Track from user- "+n.uid+" is a screen track"})}e.participantsMap[i]={user:n},"audio"==r?e.participantsMap[i].isPublishingAudio=!0:"video"==r&&(e.participantsMap[i].isPublishingVideo=!0),o?t.emit("remote-screen-track-published",{userId:i}):"audio"==r?t.emit("remote-audio-track-published",{userId:i}):"video"==r&&t.emit("remote-video-track-published",{userId:i})})),this.client.on("user-joined",(function(n){c.logger.log({tag:u.logTags.AM_CONFERENCE,src:e.logIdentifierArgs,msg:"User - "+n.uid+" joined the channel, details : "+JSON.stringify(n)}),e.participantsMap[n.uid]={user:n,isPublishingAudio:!1,isPublishingVideo:!1},t.emit("user-joined",{confId:e.channelId,userId:n.uid})})),this.client.on("user-left",(function(n,r){c.logger.log({tag:u.logTags.AM_LEAVE,src:e.logIdentifierArgs,msg:"User - "+n.uid+" left the channel"}),delete e.participantsMap[n.uid],t.emit("user-left",{confId:e.channelId,userId:n.uid,message:r})})),this.client.on("user-unpublished",(function(n,r){c.logger.log({tag:u.logTags.AM_REMOTE_PUBLICATION,src:e.logIdentifierArgs,msg:"User - "+n.uid+" unpublished the "+r+" track"});var i=n.uid,o=!1;if(e.isScreenShare(i)){if(e.isLocalScreenShare(i))return void c.logger.log({tag:u.logTags.AM_SS,src:e.logIdentifierArgs,msg:"Local Screen Stream received, not delegating the event, returning"});c.logger.log({tag:u.logTags.AM_SS,src:e.logIdentifierArgs,msg:"Unpublished Video Track by user- "+n.uid+" was a screen track"}),o=!0}e.participantsMap[i]?o?t.emit("remote-screen-track-unpublished",{userId:i}):"audio"==r?(e.participantsMap[i].isPublishingAudio=!1,t.emit("remote-audio-track-unpublished",{userId:i})):"video"==r&&(e.participantsMap[i].isPublishingVideo=!1,t.emit("remote-video-track-unpublished",{userId:i})):c.logger.warn({tag:u.logTags.AM_PUBLICATION,src:e.logIdentifierArgs,msg:"User - "+n.uid+" not found in local participant map"})})),this.client.on("volume-indicator",(function(e){t.emit("volume-indicator",e)})),this.client.on("connection-state-change",(function(e,n,r){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Connection State changed : "+n+" -> "+e}),t.emit("connection-state-change",{currState:e,prevState:n,reason:r})})),this.client.on("network-quality",(function(e){t.emit("network-quality-change",e)})),this.client.on("stream-type-changed",(function(e,n){var r=1==n?"upraded":"downgraded";c.logger.log({tag:u.logTags.AM_DUAL_STREAM,src:this.logIdentifierArgs,msg:"User - "+e+" stream type updated : "+r}),t.emit("stream-type-changed",{userId:e,streamType:n})})),this.client.on("stream-fallback",(function(e,n){c.logger.log({tag:u.logTags.AM_DUAL_STREAM,src:this.logIdentifierArgs,msg:"User - "+e+" stream updated : "+n}),t.emit("stream-fallback",{userId:e,isFallbackOrRecover:n})})),this.client.on("token-privilege-will-expire",(function(){c.logger.log({tag:u.logTags.AM_TOKEN,src:this.logIdentifierArgs,msg:"Token will expire in 30 seconds, Please renew top continue the session"}),t.emit("token-will-expire")})),this.client.on("token-privilege-did-expire",(function(){c.logger.log({tag:u.logTags.AM_TOKEN,src:this.logIdentifierArgs,msg:"Token expired, Please renew top continue the session"}),t.emit("token-did-expire")})),this.client.on("stream-reconnect-start",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Stream Reconnect Started "})})),this.client.on("stream-reconnect-end",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Stream Reconnection Ended"})})),this.client.on("reconnect",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Stream Reconnected Successfully"})})),this.client.on("error",(function(e){c.logger.error({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Agora Error"})})),this.client.on("peer-leave",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Peer left"})})),this.client.on("pubP2PLost",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Publish ICE Lost"})})),this.client.on("recover",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Connection recovered"})})),this.client.on("rejoin-start",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"Channel Rejoin Started"})})),this.client.on("rejoin",(function(e){c.logger.log({tag:u.logTags.AM_CONN,src:this.logIdentifierArgs,msg:"User Rejoined Channel Successfully"})}))},e}();t.default=l},function(module,exports,__webpack_require__){"use strict";(function(global,process){!function(e,t){module.exports=t()}(0,(function(){function Ka(e,t,n){return e(n={path:t,exports:{},require:function(e,t){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},n.exports),n.exports}function Hb(e,t,n){return(e=e.match(t))&&e.length>=n&&S(e[n],10)}function rc(e,t,n){if(e.RTCPeerConnection){var r=(e=e.RTCPeerConnection.prototype).addEventListener;e.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);let o=e=>{(e=n(e))&&i(e)};return this._eventMap=this._eventMap||{},this._eventMap[i]=o,r.apply(this,[e,o])};var i=e.removeEventListener;e.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return i.apply(this,arguments);let r=this._eventMap[n];return delete this._eventMap[n],i.apply(this,[e,r])},ba(e,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function il(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(wg=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function jl(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(xg=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function kb(){"object"!=typeof window||wg||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function Ad(e,t){xg&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ib(e){let{navigator:t}=e,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=Hb(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=Hb(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=Hb(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=Hb(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function yg(e){var t;return"[object Object]"===Object.prototype.toString.call(e)?xe(t=V(e)).call(t,(function(t,n){var r="[object Object]"===Object.prototype.toString.call(e[n]);let i=r?yg(e[n]):e[n];return r=r&&!V(i).length,void 0===i||r?t:Wa(t,{[n]:i})}),{}):e}function ye(e,t,n){var i;t&&!n.has(t.id)&&(n.set(t.id,t),r(i=V(t)).call(i,i=>{if(zg(i).call(i,"Id"))ye(e,e.get(t[i]),n);else if(zg(i).call(i,"Ids")){var o;r(o=t[i]).call(o,t=>{ye(e,e.get(t),n)})}}))}function Ag(e,t,n){let i=n?"outbound-rtp":"inbound-rtp",o=new Y;if(null===t)return o;let a=[];return r(e).call(e,e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),r(a).call(a,t=>{r(e).call(e,n=>{n.type===i&&n.trackId===t.id&&ye(e,n,o)})}),o}function Bg(e){let t=e&&e.navigator;if(t.mediaDevices){var i=Ib(e),o=function(e){var t;if("object"!=typeof e||e.mandatory||e.optional)return e;const i={};var o;return r(t=V(e)).call(t,t=>{if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var o,a=function(e,t){return e?e+t.charAt(0).toUpperCase()+wb(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){i.optional=i.optional||[];let e={};"number"==typeof n.ideal?(e[a("min",t)]=n.ideal,i.optional.push(e),e={},e[a("max",t)]=n.ideal,i.optional.push(e)):(e[a("",t)]=n.ideal,i.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(i.mandatory=i.mandatory||{},i.mandatory[a("",t)]=n.exact):r(o=["min","max"]).call(o,e=>{void 0!==n[e]&&(i.mandatory=i.mandatory||{},i.mandatory[a(e,t)]=n[e])})}}),e.advanced&&(i.optional=n(o=i.optional||[]).call(o,e.advanced)),i},a=function(e,n){if(61<=i.version)return n(e);if((e=JSON.parse(w(e)))&&"object"==typeof e.audio){var r=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};r((e=JSON.parse(w(e))).audio,"autoGainControl","googAutoGainControl"),r(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;if(a=a&&("object"==typeof a?a:{ideal:a}),r=66>i.version,!(!a||"user"!==a.exact&&"environment"!==a.exact&&"user"!==a.ideal&&"environment"!==a.ideal||t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!r)){let r;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?r=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(r=["front"]),r)return t.mediaDevices.enumerateDevices().then(t=>{t=M(t).call(t,e=>"videoinput"===e.kind);let i=R(t).call(t,e=>Cg(r).call(r,t=>{var n;return La(n=e.label.toLowerCase()).call(n,t)}));return!i&&t.length&&La(r).call(r,"back")&&(i=t[t.length-1]),i&&(e.video.deviceId=a.exact?{exact:i.deviceId}:{ideal:i.deviceId}),e.video=o(e.video),Dg("chrome: "+w(e)),n(e)})}e.video=o(e.video)}return Dg("chrome: "+w(e)),n(e)},s=function(e){return 64<=i.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e=function(e,n,r){a(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(s(e))})})},t.getUserMedia=ya(e).call(e,t),t.mediaDevices.getUserMedia){var c;let e=ya(c=t.mediaDevices.getUserMedia).call(c,t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return a(t,t=>e(t).then(e=>{var n;if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw r(n=e.getTracks()).call(n,e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>u.reject(s(e))))}}}}function Eg(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Fg(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)rc(e,"track",e=>(e.transceiver||ba(e,"transceiver",{value:{receiver:e.receiver}}),e));else{ba(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{var n;t.stream.addEventListener("addtrack",n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?R(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.track.id):{track:n.track},(i=new Event("track")).track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),r(n=t.stream.getTracks()).call(n,n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?R(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.id):{track:n},(i=new Event("track")).track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function Gg(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],wb(e=this._senders).call(e)};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;r.apply(this,arguments);let n=E(t=this._senders).call(t,e);var i;-1!==n&&Ma(i=this._senders).call(i,n,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i;this._senders=this._senders||[],n.apply(this,[e]),r(i=e.getTracks()).call(i,e=>{this._senders.push(t(this,e))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t;this._senders=this._senders||[],i.apply(this,[e]),r(t=e.getTracks()).call(t,e=>{var t;let n=R(t=this._senders).call(t,t=>t.track===e);var r,i;n&&Ma(r=this._senders).call(r,E(i=this._senders).call(i,n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return r(e).call(e,e=>e._pc=this),e},ba(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Hg(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,i]=arguments;if(0<arguments.length&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let o=function(e){const t={};return e=e.result(),r(e).call(e,e=>{var n;const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};r(n=e.names()).call(n,t=>{i[t]=e.stat(t)}),t[i.id]=i}),t},a=function(e){var t;return new Y(D(t=V(e)).call(t,t=>[t,e[t]]))};return 2<=arguments.length?t.apply(this,[function(e){n(a(o(e)))},e]):new u((e,n)=>{t.apply(this,[function(t){e(a(o(t)))},n])}).then(n,i)}}}function Ig(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return r(e).call(e,e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>Ag(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return r(e).call(e,e=>e._pc=this),e}),rc(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>Ag(t,e.track,!1))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var n,i;let e,t,o,a=arguments[0];return r(n=this.getSenders()).call(n,t=>{t.track===a&&(e?o=!0:e=t)}),r(i=this.getReceivers()).call(i,e=>(e.track===a&&(t?o=!0:t=e),e.track===a)),o||e&&t?u.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():u.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}}}function Jg(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},D(e=V(this._shimmedLocalStreams)).call(e,e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===E(r=this._shimmedLocalStreams[n.id]).call(r,i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,o,a;this._shimmedLocalStreams=this._shimmedLocalStreams||{},r(t=e.getTracks()).call(t,e=>{var t;if(R(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();i.apply(this,arguments),t=M(o=this.getSenders()).call(o,e=>-1===E(s).call(s,e)),this._shimmedLocalStreams[e.id]=n(a=[e]).call(a,t)};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],o.apply(this,arguments)};let a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&r(t=V(this._shimmedLocalStreams)).call(t,t=>{var n;let r=E(n=this._shimmedLocalStreams[t]).call(n,e);var i;-1!==r&&Ma(i=this._shimmedLocalStreams[t]).call(i,r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),a.apply(this,arguments)}}function Kg(e){function t(e,t){var n;let i=t.sdp;return r(n=V(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],i=i.replace(new RegExp(e._streams[t.id].id,"g"),t.id)}),new RTCSessionDescription({type:t.type,sdp:i})}function n(e,t){var n;let i=t.sdp;return r(n=V(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],i=i.replace(new RegExp(t.id,"g"),e._streams[t.id].id)}),new RTCSessionDescription({type:t.type,sdp:i})}var i;if(e.RTCPeerConnection){var o=Ib(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=o.version)return Jg(e);var a=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=a.apply(this);return this._reverseStreams=this._reverseStreams||{},D(e).call(e,e=>this._reverseStreams[e.id])};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r(n=t.getTracks()).call(n,e=>{var t;if(R(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[t.id]||(n=new e.MediaStream(t.getTracks()),this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n),s.apply(this,[t])};var c=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r,i,o;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let a=wb([]).call(arguments,1);if(1!==a.length||!R(r=a[0].getTracks()).call(r,e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(R(i=this.getSenders()).call(i,e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(r=this._streams[n.id])?(r.addTrack(t),u.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(r=new e.MediaStream([t]),this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)),R(o=this.getSenders()).call(o,e=>e.track===t)},r(i=["createOffer","createAnswer"]).call(i,(function(n){let r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]={[n](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[n=>{n=t(this,n),e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>t(this,e))}}[n]}));var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=n(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};var d=ca(e.RTCPeerConnection.prototype,"localDescription");ba(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=d.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let n;this._streams=this._streams||{},r(t=V(this._streams)).call(t,t=>{var r;R(r=this._streams[t].getTracks()).call(r,t=>e.track===t)&&(n=this._streams[t])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function ze(e){let t=Ib(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n;53>t.version&&r(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,(function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]}));var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>t.version&&arguments[0]&&""===arguments[0].candidate?u.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),u.resolve())}}}function Lg(e){rc(e,"negotiationneeded",e=>{if("stable"===e.target.signalingState)return e})}function kl(e,t){let n=!1;return e=JSON.parse(w(e)),M(e).call(e,e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&Ad("RTCIceServer.url","RTCIceServer.urls");let r="string"==typeof t;return r&&(t=[t]),t=M(t).call(t,e=>0!==E(e).call(e,"stun:")&&((e=Bd(e).call(e,"turn")&&!Bd(e).call(e,"turn:[")&&La(e).call(e,"transport=udp"))&&!n?(n=!0,!0):e&&!n)),delete e.url,e.urls=r?t[0]:t,!!t.length}})}function Mg(e,t,n,r,i){return t=F.writeRtpDescription(e.kind,t),t+=F.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=F.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),t+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(n=e.rtpSender._initialTrackId||e.rtpSender.track.id,e.rtpSender._initialTrackId=n,t=t+"a="+(r="msid:"+(r?r.id:"-")+" "+n+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+F.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+F.localCName+"\r\n"),t}function ll(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=t&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}function Cd(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){return e=r(e.parameters.apt,n),t=r(t.parameters.apt,i),e&&t&&e.name.toLowerCase()===t.name.toLowerCase()};return e.codecs.forEach((function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate&&("rtx"!==r.name.toLowerCase()||!r.parameters||!a.parameters.apt||i(r,a,e.codecs,t.codecs))){(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function Ng(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function Ae(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function Fa(e,t){return(t=Error(t)).name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}function Og(e){var t;e=e&&e.navigator;let n=ya(t=e.mediaDevices.getUserMedia).call(t,e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>u.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function Pg(e){var t;"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=ya(t=e.navigator.getDisplayMedia).call(t,e.navigator)))}function Be(e){let t=Ib(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),15025>t.version)){let t=ca(e.MediaStreamTrack.prototype,"enabled");ba(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);let n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||ba(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);let n=ml(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=kl(e.iceServers,t.version),kb("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function Qg(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function Rg(e){let t=Ib(e),n=e&&e.navigator;if(e=e&&e.MediaStreamTrack,n.getUserMedia=function(e,t,r){Ad("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r;let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},i=ya(r=n.mediaDevices.getUserMedia).call(r,n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(w(e)),t(e.audio,"autoGainControl","mozAutoGainControl"),t(e.audio,"noiseSuppression","mozNoiseSuppression")),i(e)},e&&e.prototype.getSettings){let n=e.prototype.getSettings;e.prototype.getSettings=function(){let e=n.apply(this,arguments);return t(e,"mozAutoGainControl","autoGainControl"),t(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){let n=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(w(e)),t(e,"autoGainControl","mozAutoGainControl"),t(e,"noiseSuppression","mozNoiseSuppression")),n.apply(this,[e])}}}}function Sg(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&ba(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ce(e){let t=Ib(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){var n;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),53>t.version&&r(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,(function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]}));var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>t.version&&arguments[0]&&""===arguments[0].candidate?u.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),u.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,i]=arguments;return a.apply(this,[e||null]).then(e=>{if(53>t.version&&!n)try{r(e).call(e,e=>{e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;r(e).call(e,(t,n)=>{e.set(n,Wa({},t,{type:o[t.type]||t.type}))})}return e}).then(n,i)}}}function Tg(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return r(e).call(e,e=>e._pc=this),e});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):u.resolve(new Y)}}}function Ug(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return r(e).call(e,e=>e._pc=this),e}),rc(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Vg(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t;Ad("removeStream","removeTrack"),r(t=this.getSenders()).call(t,t=>{var n;t.track&&La(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function Wg(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Xg(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n,i,o;this._localStreams||(this._localStreams=[]),La(n=this._localStreams).call(n,e)||this._localStreams.push(e),r(i=e.getAudioTracks()).call(i,n=>t.call(this,n,e)),r(o=e.getVideoTracks()).call(o,n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;return n&&(this._localStreams?La(r=this._localStreams).call(r,n)||this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,n,i;this._localStreams||(this._localStreams=[]);let o=E(t=this._localStreams).call(t,e);if(-1!==o){Ma(n=this._localStreams).call(n,o,1);var a=e.getTracks();r(i=this.getSenders()).call(i,e=>{La(a).call(a,e.track)&&this.removeTrack(e)})}})}}function Yg(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){ba(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{var t;r(t=e.streams).call(t,e=>{var t;this._remoteStreams||(this._remoteStreams=[]),La(t=this._remoteStreams).call(t,e)||(this._remoteStreams.push(e),(t=new Event("addstream")).stream=e,this.dispatchEvent(t))})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){var n;r(n=t.streams).call(n,t=>{var n;e._remoteStreams||(e._remoteStreams=[]),0<=E(n=e._remoteStreams).call(n,t)||(e._remoteStreams.push(t),(n=new Event("addstream")).stream=t,e.dispatchEvent(n))})}),t.apply(e,arguments)}}}function Zg(e){if("object"==typeof e&&e.RTCPeerConnection){var t=(e=e.RTCPeerConnection.prototype).createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(e,n){let r=t.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return n?(r.then(e,n),u.resolve()):r},e.createAnswer=function(e,t){let r=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return t?(r.then(e,t),u.resolve()):r};var a=function(e,t,n){return e=r.apply(this,[e]),n?(e.then(t,n),u.resolve()):e};e.setLocalDescription=a,a=function(e,t,n){return e=i.apply(this,[e]),n?(e.then(t,n),u.resolve()):e},e.setRemoteDescription=a,a=function(e,t,n){return e=o.apply(this,[e]),n?(e.then(t,n),u.resolve()):e},e.addIceCandidate=a}}function $g(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n;e=t.mediaDevices;let r=ya(n=e.getUserMedia).call(n,e);t.mediaDevices.getUserMedia=e=>r(ah(e))}var r;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=ya(r=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}).call(r,t))}function ah(e){return e&&void 0!==e.video?Wa({},e,{video:yg(e.video)}):e}function bh(e){let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Ad("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(w(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&ba(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ch(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&ba(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dh(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){var n,r;void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=R(n=this.getTransceivers()).call(n,e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),n=R(r=this.getTransceivers()).call(r,e=>"video"===e.receiver.track.kind),!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function Dd(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var n;if("object"==typeof e&&e.candidate&&0===E(n=e.candidate).call(n,"a=")&&((e=JSON.parse(w(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){n=new t(e),e=F.parseCandidate(e.candidate);let r=Wa(n,e);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,rc(e,"icecandidate",t=>(t.candidate&&ba(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}}function Sc(e){if(e.RTCPeerConnection){var t=Ib(e);"sctp"in e.RTCPeerConnection.prototype||ba(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});var n=function(e){return!(!e||!e.sdp)&&((e=F.splitSections(e.sdp)).shift(),Cg(e).call(e,e=>{var t;return(e=F.parseMLine(e))&&"application"===e.kind&&-1!==E(t=e.protocol).call(t,"SCTP")}))},r=function(e){return null===(e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/))||2>e.length||(e=S(e[1],10))!=e?-1:e},i=function(e){let n=65536;return"firefox"===t.browser&&(n=57>t.version?-1===e?16384:2147483637:60>t.version?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;return"firefox"===t.browser&&57===t.version&&(r=65535),0<(e=F.matchPrefix(e.sdp,"a=max-message-size:")).length?r=S(e[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&76<=t.version){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&ba(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var s=r(arguments[0]);let t;e=i(s),s=o(arguments[0],s),t=0===e&&0===s?Number.POSITIVE_INFINITY:0===e||0===s?Math.max(e,s):Math.min(e,s),ba(e={},"maxMessageSize",{get:()=>t}),this._sctp=e}return a.apply(this,arguments)}}}function Tc(e){function t(e,t){let n=e.send;e.send=function(){var r=arguments[0];if(r=r.length||r.size||r.byteLength,"open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=n.apply(this,arguments);return t(e,this),e},rc(e,"datachannel",e=>(t(e.channel,e.target),e))}}function De(e){var t;if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype;ba(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),ba(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),r(t=["setLocalDescription","setRemoteDescription"]).call(t,e=>{let t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}}function Ee(e){if(e.RTCPeerConnection){var t=Ib(e);if(!("chrome"===t.browser&&71<=t.version)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t,r;return e&&e.sdp&&-1!==E(t=e.sdp).call(t,"\na=extmap-allow-mixed")&&(e.sdp=M(r=e.sdp.split("\n")).call(r,e=>"a=extmap-allow-mixed"!==tc(e).call(e)).join("\n")),n.apply(this,arguments)}}}}function uc(e){return"string"==typeof e?Wa({},nl[e]):e}function Fe(e){return"string"==typeof e?Wa({},ol[e]):e}function Ed(e){return"string"==typeof e?Wa({},pl[e]):e}function vc(e,t){var n;La(n=V(C)).call(n,e)&&(C[e]=t)}function wc(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function H(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Jb(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function eh(e){return"[object Array]"===xc.call(e)}function fh(e){return null!==e&&"object"==typeof e}function gh(e){return"[object Function]"===xc.call(e)}function Fd(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),eh(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}function hh(){function e(e,n){"object"==typeof t[n]&&"object"==typeof e?t[n]=hh(t[n],e):t[n]=e}for(var t={},n=0,r=arguments.length;n<r;n++)Fd(arguments[n],e);return t}function Ge(){function e(e,n){"object"==typeof t[n]&&"object"==typeof e?t[n]=Ge(t[n],e):t[n]="object"==typeof e?Ge({},e):e}for(var t={},n=0,r=arguments.length;n<r;n++)Fd(arguments[n],e);return t}function ih(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Gd(){this.handlers=[]}function jh(e,t){!I.isUndefined(e)&&I.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function Uc(e){this.defaults=e,this.interceptors={request:new kh,response:new kh}}function He(e){this.message=e}function Hd(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new lh(e),t(n.reason))}))}function mh(e){e=new Id(e);var t=nh(Id.prototype.request,e);return I.extend(t,Id.prototype,e),I.extend(t,e),t}function oh(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function ph(e,t){if("boolean"!=typeof e)throw new m(l.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Xa(e,t,r){var i;if(!La(r).call(r,e))throw new m(l.INVALID_PARAMS,n(i="".concat(t," can only be set as ")).call(i,w(r)))}function W(e,t,r=1,i=1e4,o=!0){var a,s;if(e<r||e>i||o&&("number"!=typeof e||0!=e%1))throw new m(l.INVALID_PARAMS,n(a=n(s="invalid ".concat(t,": the value range is [")).call(s,r,", ")).call(a,i,"]. integer only"))}function Ga(e,t,r=1,i=255,o=!0){if(null==e)throw new m(l.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));var a,s,c;if(!qh(e,r,i,o))throw new m(l.INVALID_PARAMS,n(a=n(s=n(c="Invalid ".concat(t||"string param",": Length of the string: [")).call(c,r,",")).call(s,i,"].")).call(a,o?" ASCII characters only.":""))}function rh(e,t){if(!cc(e))throw new m(l.INVALID_PARAMS,"".concat(t," should be an array"))}function Ie(e){if("string"!=typeof e||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new m(l.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Je(e){var t;if(!("number"==typeof e&&0<=e&&4294967295>=e||qh(e,1,255)))throw k.error(n(t="Invalid UID ".concat(e," ")).call(t,typeof e)),new m(l.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")}function qh(e,t=1,n=255,r=!0){if(t="string"==typeof e&&e.length<=n&&e.length>=t){if(!(r=!r))e:if("string"!=typeof e)r=!1;else{for(r=0;r<e.length;r+=1)if(0>(t=e.charCodeAt(r))||255<t){r=!1;break e}r=!0}t=r}return t}function Jd(){this._listeners={}}function sh(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3]}function n(e,t,n){o[0]=e,t[n]=a[3],t[n+1]=a[2],t[n+2]=a[1],t[n+3]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],o[0]}function i(e,t){return a[3]=e[t],a[2]=e[t+1],a[1]=e[t+2],a[0]=e[t+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];e.writeFloatLE=s?t:n,e.writeFloatBE=s?n:t,e.readFloatLE=s?r:i,e.readFloatBE=s?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,th),e.writeFloatBE=t.bind(null,uh),e.readFloatLE=n.bind(null,vh),e.readFloatBE=n.bind(null,wh)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3],t[n+4]=a[4],t[n+5]=a[5],t[n+6]=a[6],t[n+7]=a[7]}function n(e,t,n){o[0]=e,t[n]=a[7],t[n+1]=a[6],t[n+2]=a[5],t[n+3]=a[4],t[n+4]=a[3],t[n+5]=a[2],t[n+6]=a[1],t[n+7]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],a[4]=e[t+4],a[5]=e[t+5],a[6]=e[t+6],a[7]=e[t+7],o[0]}function i(e,t){return a[7]=e[t],a[6]=e[t+1],a[5]=e[t+2],a[4]=e[t+3],a[3]=e[t+4],a[2]=e[t+5],a[1]=e[t+6],a[0]=e[t+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];e.writeDoubleLE=s?t:n,e.writeDoubleBE=s?n:t,e.readDoubleLE=s?r:i,e.readDoubleBE=s?i:r}():function(){function t(e,t,n,r,i,o){var a=0>r?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((a<<31|r/4294967296)>>>0,i,o+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),e(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,o+t),e((a<<31|s+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047===(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,th,0,4),e.writeDoubleBE=t.bind(null,uh,4,0),e.readDoubleLE=n.bind(null,vh,0,4),e.readDoubleBE=n.bind(null,wh,4,0)}(),e}function th(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function uh(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function vh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function wh(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function za(e,t){this.lo=e>>>0,this.hi=t>>>0}function Vc(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function Ke(){}function ql(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Z(){this.len=0,this.tail=this.head=new Vc(Ke,0,0),this.states=null}function Le(e,t,n){t[n]=255&e}function Me(e,t){this.len=e,this.next=void 0,this.val=t}function Ne(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function Oe(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function yb(){Pe.call(this)}function rl(e,t,n){40>e.length?N.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function lb(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function ra(e){this.buf=e,this.pos=0,this.len=e.length}function Qe(){var e=new xh(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw lb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw lb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function Kd(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function yh(){if(this.pos+8>this.len)throw lb(this,8);return new xh(Kd(this.buf,this.pos+=4),Kd(this.buf,this.pos+=4))}function dc(e){Re.call(this,e)}function Wc(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");N.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function sl(e){return Ga(e.reportId,"params.reportId",0,100,!1),Ga(e.category,"params.category",0,100,!1),Ga(e.event,"params.event",0,100,!1),Ga(e.label,"params.label",0,100,!1),W(e.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function zh(e){return W(e.timeout,"config.timeout",0,1e5),W(e.timeoutFactor,"config.timeoutFactor",0,100,!1),W(e.maxRetryCount,"config.maxRetryConfig",0,1/0),W(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Ah(e){return Ga(e.turnServerURL,"turnServerURL"),Ga(e.username,"username"),Ga(e.password,"password"),W(e.udpport,"udpport",1,99999,!0),e.forceturn&&ph(e.forceturn,"forceturn"),e.tcpport&&W(e.tcpport,"tcpport",1,99999,!0),!0}function Se(e,t){Ga(e.url,"".concat(t,".url"),1,1e3,!1),null==e.x||W(e.x,"".concat(t,".x"),0,1e4),null==e.y||W(e.y,"".concat(t,".y"),0,1e4),null==e.width||W(e.width,"".concat(t,".width"),0,1e4),null==e.height||W(e.height,"".concat(t,".height"),0,1e4),null==e.zOrder||W(e.zOrder,"".concat(t,".zOrder"),0,255),null==e.alpha||W(e.alpha,"".concat(t,".alpha"),0,1,!1)}function tl(e){var t,n;return null==e.width||W(e.width,"config.width",0,1e4),null==e.height||W(e.height,"config.height",0,1e4),null==e.videoBitrate||W(e.videoBitrate,"config.videoBitrate",1,1e6),null==e.videoFrameRate||W(e.videoFrameRate,"config.videoFrameRate"),null==e.lowLatency||ph(e.lowLatency,"config.lowLatency"),null==e.audioSampleRate||Xa(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),null==e.audioBitrate||W(e.audioBitrate,"config.audioBitrate",1,128),null==e.audioChannels||Xa(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),null==e.videoGop||W(e.videoGop,"config.videoGop"),null==e.videoCodecProfile||Xa(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),null==e.userCount||W(e.userCount,"config.userCount",0,17),null==e.backgroundColor||W(e.backgroundColor,"config.backgroundColor",0,16777215),null==e.userConfigExtraInfo||Ga(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&null!=e.transcodingUsers&&(rh(e.transcodingUsers,"config.transcodingUsers"),r(t=e.transcodingUsers).call(t,(e,t)=>{Je(e.uid),null==e.x||W(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),null==e.y||W(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),null==e.width||W(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),null==e.height||W(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),null==e.zOrder||W(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),null==e.alpha||W(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),null==e.watermark||Se(e.watermark,"watermark"),null==e.backgroundImage||Se(e.backgroundImage,"backgroundImage"),e.images&&null!=e.images&&(rh(e.images,"config.images"),r(n=e.images).call(n,(e,t)=>{Se(e,"images[".concat(t,"]"))})),!0}function Bh(e){if(!e.channelName)throw new m(l.INVALID_PARAMS,"invalid channelName in info");if(!e.uid||"number"!=typeof e.uid)throw new m(l.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Ga(e.token,"info.token",1,2047),Je(e.uid),Ie(e.channelName),!0}function Ch(e){return Xa(e,"mediaSource",["screen","window","application"]),!0}function va(e){var t,n,r,i;let o=(e=e||navigator.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===o[1]){var a=e.match(/(OPR(?=\/))\/?(\d+)/i);null!==a&&(o=a)}"Safari"===o[1]&&(null!==(a=e.match(/version\/(\d+)/i))&&(o[2]=a[1])),-1!==E(t=e.toLowerCase()).call(t,"qqbrowser")&&(null!==(t=e.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(o=t)),-1!==E(n=e.toLowerCase()).call(n,"micromessenger")&&(null!==(n=e.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(o=n)),-1!==E(r=e.toLowerCase()).call(r,"edge")&&(null!==(r=e.match(/(edge(?=\/))\/?(\d+)/i))&&(o=r)),-1!==E(i=e.toLowerCase()).call(i,"trident")&&(null!==(i=/\brv[ :]+(\d+)/g.exec(e)||[])&&(o=["","IE",i[1]])),i=null,r=[{s:aa.WIN_10,r:/(Windows 10.0|Windows NT 10.0)/},{s:aa.WIN_81,r:/(Windows 8.1|Windows NT 6.3)/},{s:aa.WIN_8,r:/(Windows 8|Windows NT 6.2)/},{s:aa.WIN_7,r:/(Windows 7|Windows NT 6.1)/},{s:aa.WIN_VISTA,r:/Windows NT 6.0/},{s:aa.WIN_SERVER_2003,r:/Windows NT 5.2/},{s:aa.WIN_XP,r:/(Windows NT 5.1|Windows XP)/},{s:aa.WIN_2000,r:/(Windows NT 5.0|Windows 2000)/},{s:aa.ANDROID,r:/Android/},{s:aa.OPEN_BSD,r:/OpenBSD/},{s:aa.SUN_OS,r:/SunOS/},{s:aa.LINUX,r:/(Linux|X11)/},{s:aa.IOS,r:/(iPhone|iPad|iPod)/},{s:aa.MAC_OS_X,r:/Mac OS X/},{s:aa.MAC_OS,r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:aa.QNX,r:/QNX/},{s:aa.UNIX,r:/UNIX/},{s:aa.BEOS,r:/BeOS/},{s:aa.OS_2,r:/OS\/2/},{s:aa.SEARCH_BOT,r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(let t in r)if((n=r[t]).r.test(e)){i=n.s;break}return{name:o[1],version:o[2],os:i}}function Xc(){return va().name===da.CHROME}function Dh(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function Te(){let e=va();return e.name!==da.EDGE&&e.name!==da.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Eh(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ub(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Eh(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Eh(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function ul(e){if(!e.address||!e.tcp)throw new m(l.UNEXPECTED_RESPONSE,"Invalid address format ".concat(e));return e.address.match(/^[\.:\d]+$/)?"".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(k.info("Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),n(t="".concat(e.address,":")).call(t,e.tcp));var t}function vl(e,t){var r;let i=[".agora.io",".agoraio.cn"],o=-1!==E(t).call(t,i[1])?1:0;return e.addresses=e.addresses||[],{gatewayAddrs:D(r=e.addresses).call(r,e=>{var t,r,a;return e.ip.match(/^[\.:\d]+$/)?n(t=n(r="".concat(e.ip.replace(/[^\d]/g,"-"),".edge")).call(r,i[o++%i.length],":")).call(t,e.port):(k.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),n(a="".concat(e.ip,":")).call(a,e.port))}),uid:e.uid,cid:e.cid,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e}}function wl(e,t){var r;return{addressList:D(r=e.servers).call(r,(e,r)=>{var i,o,a;return n(i=n(o=n(a="wss://".concat(e.address.replace(/\./g,"-"),".edge.")).call(a,0==r%2?"agora.io":"agoraio.cn",":")).call(o,e.wss,"?serviceName=")).call(i,encodeURIComponent(t))}),workerToken:e.workerToken,vid:e.vid}}function zb(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function xl(e){var t;if(!(e=e._encoderConfig))return{};let r={resolution:e.width&&e.height?n(t="".concat(zb(e.width),"x")).call(t,zb(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return"number"==typeof e.frameRate?(r.maxFrameRate=e.frameRate,r.minFrameRate=e.frameRate):e.frameRate&&(r.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,r.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),r}function yl(e){let t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}function Fh(e,t){let n=e.videoSend[0];return n?(t=t&&t.videoSend[0]?t.videoSend[0].inputFrame:void 0,e={id:na(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()},n.inputFrame&&(t&&n.inputFrame.height===t.height||(e.A_fhi=n.inputFrame.height?n.inputFrame.height.toString():"0"),t&&n.inputFrame.width===t.width||(e.A_fwi=n.inputFrame.width?n.inputFrame.width.toString():"0"),t&&n.inputFrame.frameRate===t.frameRate||(e.A_fri=n.inputFrame.frameRate?n.inputFrame.frameRate.toString():"0")),e):null}function zl(e,t){let n=e.videoSend[0];if(!n)return null;switch((e={id:na(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).A_vstd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1",n.sentFrame&&(e.A_fhs=n.sentFrame.height.toString(),e.A_frs=n.sentFrame.frameRate.toString(),e.A_fws=n.sentFrame.width.toString()),n.adaptionChangeReason){case"none":e.A_ac="0";break;case"cpu":e.A_ac="1";break;case"bandwidth":e.A_ac="2";break;case"other":e.A_ac="3"}return e.A_nr=n.nacksCount.toString(),n.avgEncodeMs&&(e.A_aem=n.avgEncodeMs.toFixed(0).toString()),e}function Al(e,t){let n=e.audioSend[0];return n?((e={id:na(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).A_astd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1",n.inputLevel?e.A_ail=Math.round(100*n.inputLevel).toString():e.A_ail=Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apil=Math.round(100*t._source.getAudioAvgLevel()).toString(),e):null}function Bl(e,t){let n=e.videoRecv[0];return n?((e={id:na(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),n.framesRateFirefox&&(e.A_frr=n.framesRateFirefox.toString()),n.receivedFrame&&(e.A_frr=n.receivedFrame.frameRate.toString()),e.A_frd=n.decodeFrameRate.toString(),n.outputFrame&&(e.A_fro=n.outputFrame.frameRate.toString()),void 0!==n.jitterBufferMs&&(e.A_jbm=n.jitterBufferMs.toString()),void 0!==n.currentDelayMs&&(e.A_cdm=n.currentDelayMs.toString()),e.A_fs=n.firsCount.toString(),e.A_ns=n.nacksCount.toString(),e.A_ps=n.plisCount.toString(),t&&(e.A_vrtd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),t._player&&0<t._player.freezeTimeCounterList.length&&(e.A_vrft=Ma(r=t._player.freezeTimeCounterList).call(r,0,1)[0].toString()),e):null;var r}function Cl(e,t){let n=e.audioRecv[0];return n?((e={id:na(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),n.outputLevel?e.A_aol=Math.round(100*n.outputLevel).toString():e.A_aol=Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apol=Math.round(100*t._source.getAudioAvgLevel()).toString(),t&&(e.A_artd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),e.A_jr=n.jitterMs.toString(),e.A_jbm=n.jitterBufferMs.toString(),e.A_cdm=n.jitterBufferMs.toString(),e):null}function Dl(e){return(e=e.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:e.inputFrame&&e.inputFrame.frameRate.toString(),frameRateSent:e.sentFrame&&e.sentFrame.frameRate.toString(),googRtt:e.rttMs.toString()}:null}function El(e,t,n,r){return(e=e.videoRecv[0])?(n=Yc.isRemoteVideoFreeze(r,e,n?n.videoRecv[0]:void 0),t={mediaType:"video",isVideoMute:!1,peerId:t,frameRateReceived:e.receivedFrame&&e.receivedFrame.frameRate.toString(),frameRateDecoded:e.decodedFrame&&e.decodedFrame.frameRate.toString(),isFreeze:n,bytesReceived:e.bytes.toString(),packetsReceived:e.packets.toString(),packetsLost:e.packetsLost.toString()},e.framesRateFirefox&&(t.frameRateDecoded=e.framesRateFirefox.toString(),t.frameRateReceived=e.framesRateFirefox.toString()),t):null}function Fl(e,t,n){return(e=e.audioRecv[0])?(n=Yc.isRemoteAudioFreeze(n),{mediaType:"audio",isAudioMute:!1,peerId:t,googJitterReceived:e.jitterBufferMs.toString(),isFreeze:n,bytesReceived:e.bytes.toString(),packetsReceived:e.packets.toString(),packetsLost:e.packetsLost.toString(),frameReceived:e.receivedFrames.toString(),frameDropped:e.droppedFrames.toString()}):null}function Gh(e){return 0<=e&&.17>e?1:.17<=e&&.36>e?2:.36<=e&&.59>e?3:.59<=e&&1>=e?4:1<e?5:0}function Hh(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Hh(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Hh(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function Ld(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Gl(e,t,n){let r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";let i=Ld(w(e)),o=0,a=[],s=0;for(let c=0;c<r.length;c++)s+=127>=r.charCodeAt(c)?1:3,s<=n-i||(a[a.length]=Ue({},e,{[t]:r.substring(o,c)}),o=c,s=127>=r.charCodeAt(c)?1:3);return o!==r.length-1&&(a[a.length]=Ue({},e,{[t]:r.substring(o)})),a}function Hl(){return new u(e=>{document.body?e():window.addEventListener("load",()=>e())})}function Ab(e){return new u(t=>{window.setTimeout(t,e)})}function Il(e){let t=new m(l.TIMEOUT,"timeout");return new u((n,r)=>{window.setTimeout(()=>r(t),e)})}function na(e=7,t){var r,i;let o=Math.random().toString(16).substr(2,e).toLowerCase();return o.length===e?n(r="".concat(t)).call(r,o):n(i="".concat(t)).call(i,o)+na(e-o.length,"")}function Zc(e){return new u((t,n)=>{let r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r),r.addEventListener("playing",()=>{!r.videoWidth&&va().name===da.FIREFOX||(t([r.videoWidth,r.videoHeight]),document.body.removeChild(r))}),r.srcObject=new MediaStream([e])})}function $c(e){return u.all(D(e).call(e,e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}function Ha(e,t,...n){return 0===e.getListeners(t).length?u.reject(new m(l.UNEXPECTED_ERROR,"can not emit promise")):new u((r,i)=>{e.emit(t,...n,r,i)})}function Ya(e,t,...n){return 0===e.getListeners(t).length?u.resolve():Ha(e,t,...n)}function ec(e,t,...n){return 0===e.getListeners(t).length?null:ad(e,t,...n)}function ad(e,t,...n){let r=null,i=null;if(e.emit(t,...n,e=>{r=e},e=>{i=e}),null!==i)throw i;if(null===r)throw new m(l.UNEXPECTED_ERROR,"handler is not sync");return r}function bd(e,t){-1!==(t=E(e).call(e,t))&&Ma(e).call(e,t,1)}function Ih(e){let t=[];return r(e).call(e,e=>{-1===E(t).call(t,e)&&t.push(e)}),t}function Za(e){u.resolve().then(e)}function Jl(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){let r=e[n];if(M(e).call(e,e=>e===r).length!==M(t).call(t,e=>e===r).length)return!1}return!0}function cd(e,t){Jh[t]||(Jh[t]=!0,e())}function Kl(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Ll(e,t){var r,i,o,a,s;if("motion"===e)return k.debug(n(a=n(s="adjust bitrate for motion, (".concat(t.bitrateMax,", ")).call(s,t.bitrateMin,"}) -> (")).call(a,t.bitrateMax,", undefined)")),{max:t.bitrateMax};if(!t.width||!t.height)return{max:t.bitrateMax,min:t.bitrateMin};if(e=zb(t.width)*zb(t.height),a=Math.max(.25,.1+.03*zb(t.frameRate||20)),19200>e)return{};if(76800>e)s=dd[0];else if(307200>e)s=dd[1];else if(921600>e)s=dd[2];else if(2073600>e)s=dd[3];else{if(!(8294400>e))return{min:t.bitrateMin,max:t.bitrateMax};s=dd[4]}return e=[Math.round((s[0][0]+s[0][1]*e)*a),Math.round((s[1][0]+s[1][1]*e)*a),Math.round((s[2][0]+s[2][1]*e)*a)],e={min:Math.max(e[2],t.bitrateMin||0),max:Math.max(e[2],t.bitrateMax||e[0])},k.debug(n(r=n(i=n(o="adjust bitrate for detail, (".concat(t.bitrateMax,", ")).call(o,t.bitrateMin,"}) -> (")).call(i,e.max,", ")).call(r,e.min,")")),e}function yc(){if(!ed)throw new m(l.NOT_SUPPORT,"can not create audio context");return ed}function fd(e){if(!Ml()){k.debug("polyfill audio node");var t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),La(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?bd(e._inputNodes,r):e._inputNodes=[];for(let n of e._inputNodes)t.call(e,n)}}}function Nl(e){let t=yc();return new u((n,r)=>{t.decodeAudioData(e,e=>{n(e)},e=>{r(new m(l.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}function Ml(){if(null!==Ve)return Ve;var e=yc();let t=e.createBufferSource(),n=e.createGain();e=e.createGain(),t.connect(n),t.connect(e),t.disconnect(n),e=!1;try{t.disconnect(n)}catch(t){e=!0}return t.disconnect(),Ve=e,e}function We(e,t){let n=1/t,r=yc(),i=r.createGain();i.gain.value=0,i.connect(r.destination);let o=!1,a=()=>{const t=r.createOscillator();t.onended=a,t.connect(i),t.start(0),t.stop(r.currentTime+n),e(r.currentTime),o&&(t.onended=()=>{})};return a(),()=>{o=!0}}function Ol(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}function Pl(e){function t(t){"running"===e.state?(n(!1),y&&e.suspend().then(r,r)):"closed"!==e.state&&(y?n(!1):(n(!0),t&&e.resume().then(r,r)))}function n(e){if(S!==e){S=e;for(let t=0,n=T;t<n.length;t+=1){let r=n[t];e?window.addEventListener(r,i,{capture:!0,passive:!0}):window.removeEventListener(r,i,{capture:!0,passive:!0})}}}function r(){t(!1)}function i(){t(!0)}function o(e){if(!I)if(g.paused)if(y)a(!1);else if(e){a(!1),I=!0,e=void 0;try{(e=g.play())?e.then(s,s):(g.addEventListener("playing",s),g.addEventListener("abort",s),g.addEventListener("error",s))}catch(e){s()}}else a(!0);else a(!1),y&&g.pause()}function a(e){if(b!==e){b=e;for(let t=0,n=T;t<n.length;t++){let r=n[t];e?window.addEventListener(r,c,{capture:!0,passive:!0}):window.removeEventListener(r,c,{capture:!0,passive:!0})}}}function s(){g.removeEventListener("playing",s),g.removeEventListener("abort",s),g.removeEventListener("error",s),I=!1,o(!1)}function c(){o(!0)}function u(){v&&_?m||(m=!0,y=!1,g&&o(!0),t(!0)):m&&(m=!1)}function l(){p&&document[p.hidden]===m&&(v=!document[p.hidden],u())}function d(e){if(!e||e.target===window){if(document.hasFocus()){if(_)return;_=!0}else{if(!_)return;_=!1}u()}}function h(e,t){let n;for(n=t;1<e;e--)n+=t;return n}let p;void 0!==document.hidden?p={hidden:"hidden",visibilitychange:"visibilitychange"}:void 0!==document.webkitHidden?p={hidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"}:void 0!==document.mozHidden?p={hidden:"mozHidden",visibilitychange:"mozvisibilitychange"}:void 0!==document.msHidden&&(p={hidden:"msHidden",visibilitychange:"msvisibilitychange"});var f=navigator.userAgent.toLowerCase();f=0<=E(f).call(f,"iphone")&&0>E(f).call(f,"like iphone")||0<=E(f).call(f,"ipad")&&0>E(f).call(f,"like ipad")||0<=E(f).call(f,"ipod")&&0>E(f).call(f,"like ipod");let g,m=!0,v=!0,_=!0,y=!1,T="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),S=!1,b=!1,I=!1;if(f){let e=document.createElement("div");e.innerHTML="<audio x-webkit-airplay='deny'></audio>",g=e.children.item(0),g.controls=!1,g.disableRemotePlayback=!0,g.preload="auto",g.src="data:audio/mpeg;base64,//uQx"+h(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+h(16,"gICA")+h(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+h(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+h(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+h(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+h(97,"V")+"Q==",g.loop=!0,g.load(),o(!0)}e.onstatechange=function(){t(!0)},t(!1),p&&document.addEventListener(p.visibilitychange,l,!0),f&&(window.addEventListener("focus",d,!0),window.addEventListener("blur",d,!0)),l(),d()}async function Kh(e,t){let n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t;return e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}},t.frameRate&&"number"!=typeof t.frameRate?(e.video.mandatory.maxFrameRate=t.frameRate.max,e.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(e.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(e)}async function Ql(e){var t=await Lh(e.mediaSource);return t=await Rl(t),await Kh(t,e)}async function Lh(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let n=Mh();if(!n)throw new m(l.ELECTRON_IS_NULL);e=null;try{e=n.desktopCapturer.getSources({types:t})}catch(t){e=null}e&&e.then||(e=new u((e,r)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?r(t):e(n)})}));try{return await e}catch(e){throw new m(l.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}function Rl(e){return new u((t,n)=>{let r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");let a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let s=document.createElement("div");s.setAttribute("style","text-align: right; padding: 16px 0;");let c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(u);let e=Error("NotAllowedError");e.name="NotAllowedError",n(e)},s.appendChild(c),i.appendChild(o),i.appendChild(a),i.appendChild(s);let u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(r),u.appendChild(i),document.body.appendChild(u),D(e).call(e,e=>{if(e.id){let n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+e.thumbnail.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</span>",n.onclick=()=>{document.body.removeChild(u),t(e.id)},a.appendChild(n)}})})}function Mh(){if(Md)return Md;try{return Md=window.require("electron"),Md}catch(e){return null}}async function Bb(e,t){let r=0,i=null;for(;2>r;)try{i=await Sl(e,t,0<r);break}catch(e){var o,a;if(e instanceof m)throw k.error(n(a="[".concat(t,"] ")).call(a,e.toString())),e;let i=Nd(e.name||e.code||e,e.message);if(i.code!==l.MEDIA_OPTION_INVALID)throw k.error(n(o="[".concat(t,"] ")).call(o,i.toString())),i;k.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Ab(500)}if(!i)throw new m(l.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Sl(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new m(l.NOT_SUPPORT,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));var i=ea;if(r=new MediaStream,e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(Mh())e.screen.sourceId?zc(r,await Kh(e.screen.sourceId,e.screen)):zc(r,await Ql(e.screen));else if(Xc()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new m(l.NOT_SUPPORT,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));var o=await Tl(e.screen.extensionId,t);e.screen.mandatory.chromeMediaSourceId=o,zc(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia)e.screen.mediaSource&&Ch(e.screen.mediaSource),o={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},k.debug("[".concat(t,"] getDisplayMedia:"),w({video:o,audio:!!e.screenAudio})),zc(r,await navigator.mediaDevices.getDisplayMedia({video:o,audio:!!e.screenAudio}));else{if(va().name!==da.FIREFOX)throw k.error("[".concat(t,"] This browser does not support screenSharing")),new m(l.NOT_SUPPORT,"This browser does not support screen sharing");e.screen.mediaSource&&Ch(e.screen.mediaSource),i={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}},k.debug(n(o="[".concat(t,"] getUserMedia: ")).call(o,w(i))),zc(r,await navigator.mediaDevices.getUserMedia(i))}return e.video||e.audio?(e={video:e.video,audio:e.audio},k.debug("[".concat(t,"] GetUserMedia"),w(e)),t=null,(o=va()).name!==da.SAFARI&&o.os!==aa.IOS||(t=await Xe.lock()),o=await navigator.mediaDevices.getUserMedia(e),e.audio&&(Nh=!0),e.video&&(Oh=!0),zc(r,o),t&&t(),r):r}function Nd(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var r;return new m(l.MEDIA_OPTION_INVALID,n(r="".concat(e,": ")).call(r,t));case"NotFoundError":case"DevicesNotFoundError":var i;return new m(l.DEVICE_NOT_FOUND,n(i="".concat(e,": ")).call(i,t));case"NotSupportedError":var o;return new m(l.NOT_SUPPORT,n(o="".concat(e,": ")).call(o,t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var a;return new m(l.PERMISSION_DENIED,n(a="".concat(e,": ")).call(a,t));case"ConstraintNotSatisfiedError":var s;return new m(l.CONSTRAINT_NOT_SATISFIED,n(s="".concat(e,": ")).call(s,t));default:var c;return k.error("getUserMedia unexpected error",e),new m(l.UNEXPECTED_ERROR,n(c="".concat(e,": ")).call(c,t))}}function zc(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0];(t=t.getAudioTracks()[0])&&(r&&e.removeTrack(r),e.addTrack(t)),i&&(n&&e.removeTrack(n),e.addTrack(i))}function Tl(e,t){return new u((r,i)=>{try{chrome.runtime.sendMessage(e,{getStream:!0},e=>{if(!e||!e.streamId)return k.error("[".concat(t,"] No response from Chrome Plugin. Plugin not installed properly"),e),void i(new m(l.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));r(e.streamId)})}catch(r){var o;k.error(n(o="[".concat(t,"] AgoraRTC screensharing plugin is not accessible(")).call(o,e,")"),r.toString()),i(new m(l.CHROME_PLUGIN_NOT_INSTALL))}})}function Ph(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Ph(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Ph(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function Vb(e,t,n){return new u((r,i)=>{t.timeout=t.timeout||C.HTTP_CONNECT_TIMEOUT,t.responseType=t.responseType||"json",t.data&&!n?(t.data=w(t.data),Qh+=Ld(t.data)):n&&(Qh+=t.data.size),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Cb.request(t).then(e=>{"string"==typeof e.data?Ye+=Ld(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Ye+=e.data.byteLength:Ye+=Ld(w(e.data)),r(e.data)}).catch(e=>{Cb.isCancel(e)?i(new m(l.OPERATION_ABORT,"cancel token canceled")):"ECONNABORTED"===e.code?i(new m(l.NETWORK_TIMEOUT,e.message)):e.response?i(new m(l.NETWORK_RESPONSE_ERROR,e.response.status)):i(new m(l.NETWORK_ERROR,e.message))})})}async function Vl(e,t){let n,r=new Blob([t.data],{type:"buffer"});try{n=await Vb(e,Ul({},t,{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}catch(e){throw e}return n}function Rh(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function wa(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Rh(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Rh(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function Ze(e){var t=Wl[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};if(!(t=t[e%1e4])){if(Math.floor(e/1e4)===Ac.ACCESS_POINT){if("1"===(e%=1e4).toString()[0])return{desc:e.toString(),retry:!1};if("2"===e.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return t}function Sh(e){return Xl[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function fc(e,t,n,r){let i=Wa({},Na,r),o=i.timeout,a=async()=>{await Ab(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)},s=!1;return(r=new u(async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return o(new m(l.OPERATION_ABORT));try{const n=await e();if(!t(n,c)||c+1===i.maxRetryCount)return r(n);await a()}catch(e){if(!n(e,c)||c+1===i.maxRetryCount)return o(e);await a()}}})).cancel=()=>s=!0,r}function Th(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Th(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Th(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function Uh(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function af(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Uh(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Uh(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function Vh(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yl(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=Vh(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=Vh(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}async function Zl(e,r,i,o,a){let s=v(),c={sid:i.sid,opid:10,appid:i.appId,string_uid:r},u=e[0];if(0!==(i=await fc(()=>Vb(u+"".concat(-1===E(u).call(u,"?")?"?":"&","action=stringuid"),{data:c,cancelToken:o,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(i,o)=>{if(0===i.code){var a;if(0>=i.uid||i.uid>=Math.pow(2,32))throw k.error(n(a="Invalid Uint Uid ".concat(r," => ")).call(a,i.uid),i),t.reqUserAccount(c.sid,{lts:s,success:!1,serverAddr:u,stringUid:c.string_uid,uid:i.uid,errorCode:l.INVALID_UINT_UID_FROM_STRING_UID,extend:c}),new m(l.INVALID_UINT_UID_FROM_STRING_UID);return t.reqUserAccount(c.sid,{lts:s,success:!0,serverAddr:u,stringUid:c.string_uid,uid:i.uid,errorCode:null,extend:c}),!1}return(a=Ze(i.code)).retry&&(u=e[(o+1)%e.length]),t.reqUserAccount(c.sid,{lts:s,success:!1,serverAddr:u,stringUid:c.string_uid,uid:i.uid,errorCode:a.desc,extend:c}),a.retry},(n,r)=>n.code!==l.OPERATION_ABORT&&(t.reqUserAccount(c.sid,{lts:s,success:!1,serverAddr:u,stringUid:c.string_uid,uid:null,errorCode:n.code,extend:c}),u=e[(r+1)%e.length],!0),a)).code)throw i=Ze(i.code),new m(l.UNEXPECTED_RESPONSE,i.desc);return i}function $l(e,r,i,o){let a=v(),s={command:"convergeAllocateEdge",sid:r.sid,appId:r.appId,token:r.token,uid:r.uid,cname:r.cname,ts:Math.floor(v()/1e3),version:$a,seq:0,requestId:1};return fc(async()=>({res:await Vb(e,{data:{service_name:"webrtc_proxy",json_body:w(s)},cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:e}),e=>{if(!e.res.json_body)throw k.debug("[".concat(r.clientId,"] Get proxy server failed: no json_body")),new m(l.UNEXPECTED_RESPONSE,w(e.res));let t=JSON.parse(e.res.json_body);var i,o;if(200!==t.code)throw k.debug(n(i=n(o="[".concat(r.clientId,"] Get proxy server failed: response code [")).call(o,t.code,"], reason [")).call(i,t.reason,"]")),new m(l.UNEXPECTED_RESPONSE,w(e.res));return k.debug("[".concat(r.clientId,"] App return server length"),t.servers.length),!1},n=>n.code!==l.OPERATION_ABORT&&(t.requestProxyAppCenter(s.sid,{lts:a,succ:!1,APAddr:e,workerManagerList:null,ec:n.code,response:n.message}),!0),o)}function am(e,n,r,i){let o=v(),a=e;Bd(e).call(e,"http")||(a="https://".concat(e,":4000/v2/machine"));let s={command:"request",gatewayType:"http",appId:n.appId,cname:n.cname,uid:(n.uid||"").toString(),sdkVersion:"2.3.1",sid:n.sid,seq:1,ts:v(),requestId:3,clientRequest:{appId:n.appId,cname:n.cname,uid:(n.uid||"").toString(),sid:n.sid}};return fc(async()=>({res:await Vb(a,{data:s,cancelToken:r}),url:e}),e=>{if(!e.res.serverResponse)throw new m(l.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},n=>n.code!==l.OPERATION_ABORT&&(t.requestProxyWorkerManager(s.sid,{lts:o,succ:!1,workerManagerAddr:e,ec:n.code,response:n.message}),!0),i)}function bm(e,r,i,o,a){bf+=1;let s,c,u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(v()/1e3),seq:bf,requestId:bf,version:$a,cname:i.cname},d={service_name:r,json_body:w(u)},h=e[0];return fc(async()=>{s=v();var e=await Vb(h,{data:d,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=v()-s,0!==e.code){var t=new m(l.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw k.error(t.toString()),t}if(200!==(e=JSON.parse(e.json_body)).code)throw e=new m(l.UNEXPECTED_RESPONSE,n(t="live streaming app center error, code: ".concat(e.code,", reason: ")).call(t,e.reason),{code:e.code,responseTime:c}),k.error(e.toString()),e;if(!e.servers||0===e.servers.length)throw t=new m(l.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:e.code,responseTime:c}),k.error(t.toString()),t;return t=wl(e,r),C.LIVE_STREAMING_ADDRESS&&(t.addressList=C.LIVE_STREAMING_ADDRESS instanceof Array?C.LIVE_STREAMING_ADDRESS:[C.LIVE_STREAMING_ADDRESS]),Yl({},t,{responseTime:c})},(n,o)=>(t.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:w(n.addressList),firstSuccess:0===o,responseTime:c,serverIp:e[o%e.length]}),!1),(n,o)=>(t.apworkerEvent(i.sid,{success:!1,sc:n.data&&n.data.code||200,serviceName:r,responseTime:c,serverIp:e[o%e.length]}),!!(n.code!==l.OPERATION_ABORT&&n.code!==l.UNEXPECTED_RESPONSE||n.data&&n.data.retry)&&(h=e[(o+1)%e.length],!0)),a)}function cm(e,t,r,i){t={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:v(),version:$a,cname:t.cname,uid:t.uid.toString(),requestId:cf,seq:cf},cf+=1;let o={service_name:"tele_channel",json_body:w(t)};return fc(async()=>{var t=await Vb(e,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){var i=new m(l.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw k.error(i.toString()),i}if(200!==(t=JSON.parse(t.json_body)).code){var a=new m(l.UNEXPECTED_RESPONSE,n(i="cross channel app center error, code: ".concat(t.code,", reason: ")).call(i,t.reason));throw k.error(a.toString()),a}if(!t.servers||0===t.servers.length)throw i=new m(l.UNEXPECTED_RESPONSE,"cross channel app center empty server"),k.error(i.toString()),i;return{vid:t.vid,workerToken:t.workerToken,addressList:D(a=t.servers).call(a,e=>{var t;return n(t="wss://".concat(e.address.replace(/\./g,"-"),".edge.agora.io:")).call(t,e.wss)})}},void 0,e=>!!(e.code!==l.OPERATION_ABORT&&e.code!==l.UNEXPECTED_RESPONSE||e.data&&e.data.retry),i)}function Wh(e,r,i,o){let a=v(),s={opid:133,flag:4096,ts:v(),key:r.token,cname:r.cname,sid:r.sid,detail:{6:r.stringUid},uid:r.uid||0};return r.multiIP&&r.multiIP.gateway_ip&&(s.detail[5]=w({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]})),fc(async()=>{let t=await Vb(e+"".concat(-1===E(e).call(e,"?")?"?":"&","action=wrtc_gateway"),{data:s,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}});if(C.GATEWAY_ADDRESS&&0<C.GATEWAY_ADDRESS.length){var n;console.log(C.GATEWAY_ADDRESS);let e=D(n=C.GATEWAY_ADDRESS).call(n,(e,n)=>({ip:e.ip,port:e.port,ticket:t.addresses[n].ticket}));t.addresses=e}return vl(t,e)},n=>{if(0===n.res.code)return t.joinChooseServer(r.sid,{lts:a,succ:!0,csAddr:e,serverList:n.gatewayAddrs,ec:null,cid:n.res.cid.toString(),uid:n.res.uid.toString()}),!1;throw n=Ze(n.res.code),new m(l.CAN_NOT_GET_GATEWAY_SERVER,n.desc,{retry:n.retry})},i=>{return i.code!==l.OPERATION_ABORT&&(i.code===l.CAN_NOT_GET_GATEWAY_SERVER?(t.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:i.message}),k.warning(n(o=n(s=n(c="[".concat(r.clientId,"] Choose server ")).call(c,e," failed, message: ")).call(s,i.message,", retry: ")).call(o,i.data.retry)),i.data.retry):(t.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:i.code}),k.warning("[".concat(r.clientId,"] Choose server network error, retry"),i),!0));var o,s,c},o)}async function Xh(e,t,n){return{gatewayInfo:await dm(e,t,n)}}async function em(e,r,i){var o,a;"disabled"!==e.cloudProxyServer&&(r=await fm(e,r,i),"443only"===e.cloudProxyServer?e.proxyServer=C.PROXY_SERVER_TYPE2:e.proxyServer=r.address,e.turnServer={mode:"manual",servers:[{turnServerURL:r.address,tcpport:r.serverResponse.tcpport?r.serverResponse.tcpport:Db.tcpport,udpport:r.serverResponse.udpport?r.serverResponse.udpport:Db.udpport,username:r.serverResponse.username||Db.username,password:r.serverResponse.password||Db.password,forceturn:!0}]},k.debug(n(o=n(a="[".concat(e.clientId,"] set proxy server: ")).call(a,e.proxyServer,", mode: ")).call(o,e.cloudProxyServer)),t.setProxyServer(e.proxyServer),k.setProxyServer(e.proxyServer))}async function Yh(e,t,r,i){let o=C.ACCOUNT_REGISTER,a=[];return a=t.proxyServer?D(o).call(o,e=>{var r;return n(r="https://".concat(t.proxyServer,"/ap/?url=")).call(r,e+"/api/v1")}):D(o).call(o,e=>"https://".concat(e,"/api/v1")),(await Zl(a,e,t,r,i)).uid}async function fm(e,n,i){var o,a;let s=v();var c=D(o=C.PROXY_CS).call(o,e=>"https://".concat(e,"/api/v1"));c=D(c).call(c,t=>$l(t,e,n,i)),o=null;try{o=await $c(c)}catch(t){throw k.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new m(l.CAN_NOT_GET_PROXY_SERVER)}if(r(c).call(c,e=>e.cancel()),c=JSON.parse(o.res.json_body),c=D(a=c.servers).call(a,ul),"443only"===e.cloudProxyServer)return{address:c[0],serverResponse:{tcpport:443,udpport:Db.udpport,username:Db.username,password:Db.password}};t.requestProxyAppCenter(e.sid,{lts:s,succ:!0,APAddr:o.url,workerManagerList:w(c),ec:null,response:w(o.res)}),s=v(),a=D(c).call(c,t=>am(t,e,n,i)),o=null;try{o=await $c(a)}catch(t){throw k.error("[".concat(e.clientId,"] can not get worker manager after trying several times")),new m(l.CAN_NOT_GET_PROXY_SERVER)}return r(a).call(a,e=>e.cancel()),t.requestProxyWorkerManager(e.sid,{lts:s,succ:!0,workerManagerAddr:o.url,ec:null,response:w(o.res)}),{address:o.url,serverResponse:o.res.serverResponse}}async function dm(e,t,i){var o;v();let a=D(o=C.WEBCS_DOMAIN).call(o,t=>{var r;return e.proxyServer?n(r="https://".concat(e.proxyServer,"/ap/?url=")).call(r,t+"/api/v1"):"https://".concat(t,"/api/v1")}),s=null;o=D(a).call(a,n=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),n),Wh(n,e,t,i)));try{var c;s=await $c(n(c=[new u(async(o,a)=>{var c;if(await Ab(1e3),null===s){var u=D(c=C.WEBCS_DOMAIN_BACKUP_LIST).call(c,t=>{var r;return e.proxyServer?n(r="https://".concat(e.proxyServer,"/ap/?url=")).call(r,t+"/api/v1"):"https://".concat(t,"/api/v1")}),l=D(u).call(u,n=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),n),Wh(n,e,t,i)));$c(l).then(e=>{r(l).call(l,e=>e.cancel()),o(e)}).catch(e=>a(e[0]))}})]).call(c,o))}catch(e){throw e[0]}return r(o).call(o,e=>e.cancel()),s}async function Zh(e,t,r,i){var o;let a=D(o=C.UAP_AP).call(o,e=>{var r;return t.proxyServer?n(r="https://".concat(t.proxyServer,"/ap/?url=")).call(r,e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")});try{return await bm(a,e,t,r,i)}catch(e){throw e}}async function gm(e,t,i){var o;let a=D(o=C.UAP_AP).call(o,t=>{var r;return e.proxyServer?n(r="https://".concat(e.proxyServer,"/ap/?url=")).call(r,t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")});o=D(a).call(a,n=>cm(n,e,t,i));try{let e=await $c(o);return r(o).call(o,e=>e.cancel()),e}catch(e){throw e[0]}}async function hm(e,t){var n;let r=R(n=e.getTransceivers()).call(n,e=>"inactive"===e.direction&&e.receiver.track.kind===t.kind);return r?(r.direction="sendrecv",await r.sender.replaceTrack(t),r):e.addTransceiver(t,{direction:"sendrecv"})}function cb(e){if(Array.isArray(e))return e.map((function(e){return e}));if(!$h(e))return e;var t,n={};for(t in e)$h(e[t])||Array.isArray(e[t])?n[t]=cb(e[t]):n[t]=e[t];return n}function $h(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function df(e,t){function n(){this.constructor=e}ai(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ef(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function ff(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((o=0<(o=s.trys).length&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3]))s.label=n[1];else if(6===n[0]&&s.label<o[1])s.label=o[1],o=n;else{if(!(o&&s.label<o[2])){o[2]&&s.ops.pop(),s.trys.pop();continue}s.label=o[2],s.ops.push(n)}}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function im(e,t,n){return(n=e.createShader(n))?(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(t=e.getShaderInfoLog(n),e.deleteShader(n),new m(l.WEBGL_INTERNAL_ERROR,"error compiling shader:"+t).throw())):new m(l.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function jm(e,t,n,i){let o=e.createProgram();if(!o)throw new m(l.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(r(t).call(t,t=>{e.attachShader(o,t)}),n&&r(n).call(n,(t,n)=>{e.bindAttribLocation(o,i?i[n]:n,t)}),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw t=e.getProgramInfoLog(o),e.deleteProgram(o),new m(l.WEBGL_INTERNAL_ERROR,"error in program linking:"+t);return o}function bi(e){var t=new Uint8Array([99,114,121,112,116,105,105]),n=t.length;let r=e.length,i=new Uint8Array(r),o=new Uint8Array(256);for(var a=0;256>a;a++)o[a]=a;a=0;for(var s=0;256>s;s++)a=(a+o[s]+t[s%n])%256,[o[s],o[a]]=[o[a],o[s]];for(a=n=0,s=0;s<0+r;s++)a=(a+o[n=(n+1)%256])%256,[o[n],o[a]]=[o[a],o[n]],t=o[(o[n]+o[a])%256],0<=s&&(i[s-0]=e[s-0]^t);return e=String.fromCharCode.apply(null,Kb(i)),Function("var winSize = 5; return `"+e+"`")()}function gf(e){let t={};return e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId}),e.encoderConfig?(e=uc(e.encoderConfig),t.width=e.width,t.height=e.height,!Dh()&&e.frameRate&&(t.frameRate=e.frameRate),va().name===da.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),va().name===da.FIREFOX&&(t.frameRate={ideal:30,max:30}),t):t}function ci(e){let t={};if(Dh()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC,Xc()&&(t.googAutoGainControl=e.AGC,t.googAutoGainControl2=e.AGC)),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Xc()&&(t.googNoiseSuppression=e.ANS))),e.encoderConfig){let n=Ed(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Xc()&&2===t.channelCount&&(t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1),t}function di(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Od(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=di(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=di(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function hf(e,t){var r=e.match(/a=rtpmap:(\d+) opus/);if(!r||!r[0]||!r[1])return e;var i,o=r[1];return(r=e.match("a=fmtp:".concat(o,".*\r\n")))&&r[0]?(o="a=fmtp:".concat(o," minptime=10;useinbandfec=1;"),t.bitrate&&(o+="maxaveragebitrate=".concat(Math.floor(1e3*t.bitrate),";")),t.sampleRate&&(o+=n(i="maxplaybackrate=".concat(t.sampleRate,";sprop-maxcapturerate=")).call(i,t.sampleRate,";")),t.stereo&&(o+="stereo=1;sprop-stereo-1;"),o+="\r\n",e.replace(r[0],o)):e}function ei(e){return e.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")}function km(e,t){var n,i,o;let a=ya(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/);e=M(i=e.split(/(\r\n|\r|\n)/)).call(i,a),t=M(o=t.split(/(\r\n|\r|\n)/)).call(o,a);let s=null,c=new Y;return r(e).call(e,e=>{let t=e.match(/m=(audio|video)/);t&&t[1]?s=t[1]:s&&(e=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&e[1]&&c.set(s,e[1])}),s=null,D(t).call(t,e=>{var t=e.match(/m=(audio|video)/);if(t&&t[1])return s=t[1],e;if(!s)return e;if((t=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&t[1]){let n=c.get(s);if(n&&n!==t[1])return e.replace(t[1],n)}return e}).join("\r\n")+"\r\n"}function lm(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=zb(t.width),i.height=zb(t.height),t=zb(t.framerate||15),document.body.append(r),document.body.append(i);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let a=i.getContext("2d");if(!a)throw new m(l.UNEXPECTED_ERROR,"can not get canvas context");let s=i.captureStream(ea.supportRequestFrame?0:t).getVideoTracks()[0],c=We(()=>{if(r.paused&&r.play(),2<r.videoHeight&&2<r.videoWidth){const e=r.videoHeight/r.videoWidth*i.width;var t,c,u;2<=Math.abs(e-i.height)&&(k.debug("adjust low stream resolution",n(t=n(c=n(u="".concat(i.width,"x")).call(u,i.height," -> ")).call(c,i.width,"x")).call(t,e)),i.height=e)}a.drawImage(r,0,0,i.width,i.height),s.requestFrame&&s.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},t),u=s.stop;return s.stop=()=>{u.call(s),c(),r.remove(),i.remove(),k.debug("clean low stream renderer")},s}function fi(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function mm(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=fi(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=fi(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function gi(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function jf(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=gi(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=gi(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function hi(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function kf(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=hi(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=hi(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function ii(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wb(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=ii(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=ii(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function ji(e){if(!(e instanceof ki))return new m(l.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo();return e=e.getDestChannelMediaInfo(),t?0===e.size?new m(l.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new m(l.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function li(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bc(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=li(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=li(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}async function nm(e,t){var n=null;if("string"==typeof e){let t=mi.get(e);if(t)return k.debug("use cached audio resource: ",e),t;try{n=(await fc(()=>Cb.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new m(l.FETCH_AUDIO_FILE_FAILED,e.toString())}}else n=await new u((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new m(l.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new m(l.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)});return n=await Nl(n),"string"==typeof e&&t&&mi.set(e,n),n}function ni(e,t){var n=V(e);if(ia){var r=ia(e);t&&(r=M(r).call(r,(function(t){return ca(e,t).enumerable}))),n.push.apply(n,r)}return n}function lf(e){for(var t=1;t<arguments.length;t++){var n,i=null!=arguments[t]?arguments[t]:{};if(t%2)r(n=ni(Object(i),!0)).call(n,(function(t){Pa(e,t,i[t])}));else if(ja)Qa(e,ja(i));else{var o;r(o=ni(Object(i))).call(o,(function(t){ba(e,t,ca(i,t))}))}}return e}function mf(e,t,n,r){if(n.optimizationMode)if(r&&r.width&&r.height){let i=Ll(n.optimizationMode,r);n.encoderConfig=lf({},r,{bitrateMin:i.min,bitrateMax:i.max}),("motion"===n.optimizationMode||"detail"===n.optimizationMode&&r.frameRate&&10>zb(r.frameRate))&&(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?k.debug("[".concat(e,"] set content hint to"),n.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))}else k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig"))}function om(e,t,n,r){let i,o=0,a=null;return new u((s,c)=>{Cc(()=>{i&&(i(),s(o))},t),i=We(()=>{var t;e:if(o>r&&i&&(i(),s(o)),t=n.getContext("2d")){t.drawImage(e,0,0,160,120),t=t.getImageData(0,0,n.width,n.height);var u=Math.floor(t.data.length/3);if(a)for(let e=0;e<u;e+=3)if(t.data[e]!==a[e]){o+=1,t=void(a=t.data);break e}a=t.data,t=void 0}else t=new m(l.UNEXPECTED_ERROR,"can not get canvas 2d context."),k.error(t.toString()),t=void c(t)},30)})}var Lb="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{},Pd=function(e){return e&&e.Math==Math&&e},J=Pd("object"==typeof globalThis&&globalThis)||Pd("object"==typeof window&&window)||Pd("object"==typeof self&&self)||Pd("object"==typeof Lb&&Lb)||Function("return this")(),oa=function(e){try{return!!e()}catch(e){return!0}},la=!oa((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),oi={}.propertyIsEnumerable,pi=Object.getOwnPropertyDescriptor,Qd=pi&&!oi.call({1:2},1)?function(e){return!!(e=pi(this,e))&&e.enumerable}:oi,gc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},pm={}.toString,Eb=function(e){return pm.call(e).slice(8,-1)},qm="".split,Rd=oa((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Eb(e)?qm.call(e,""):Object(e)}:Object,hc=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},db=function(e){return Rd(hc(e))},xa=function(e){return"object"==typeof e?null!==e:"function"==typeof e},Dc=function(e,t){if(!xa(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!xa(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!xa(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!xa(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},rm={}.hasOwnProperty,U=function(e,t){return rm.call(e,t)},Ec=J.document,Sd=xa(Ec)&&xa(Ec.createElement),qi=!la&&!oa((function(){return 7!=Object.defineProperty(Sd?Ec.createElement("div"):{},"a",{get:function(){return 7}}).a})),ri=Object.getOwnPropertyDescriptor,Fc=la?ri:function(e,t){if(e=db(e),t=Dc(t,!0),qi)try{return ri(e,t)}catch(e){}if(U(e,t))return gc(!Qd.call(e,t),e[t])},sm=/#|\.prototype\./,Gc=function(e,t){return(e=tm[um(e)])==vm||e!=wm&&("function"==typeof t?oa(t):!!t)},um=Gc.normalize=function(e){return String(e).replace(sm,".").toLowerCase()},tm=Gc.data={},wm=Gc.NATIVE="N",vm=Gc.POLYFILL="P",fa={},mb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},ic=function(e,t,n){if(mb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Oa=function(e){if(!xa(e))throw TypeError(String(e)+" is not an object");return e},si=Object.defineProperty,eb={f:la?si:function(e,t,n){if(Oa(e),t=Dc(t,!0),Oa(n),qi)try{return si(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},nb=la?function(e,t,n){return eb.f(e,t,gc(1,n))}:function(e,t,n){return e[t]=n,e},xm=Fc,ym=function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t},K=function(e,t){var n,r,i,o,a,s=e.target,c=e.global,u=e.stat,l=e.proto,d=c?J:u?J[s]:(J[s]||{}).prototype,h=c?fa:fa[s]||(fa[s]={}),p=h.prototype;for(r in t){var f=!Gc(c?r:s+(u?".":"#")+r,e.forced)&&d&&U(d,r),g=h[r];f&&(i=e.noTargetGet?(a=xm(d,r))&&a.value:d[r]);var m=f&&i?i:t[r];f&&typeof g==typeof m||(o=e.bind&&f?ic(m,J):e.wrap&&f?ym(m):l&&"function"==typeof m?ic(Function.call,m):m,(e.sham||m&&m.sham||g&&g.sham)&&nb(o,"sham",!0),h[r]=o,l&&(U(fa,n=s+"Prototype")||nb(fa,n,{}),fa[n][r]=m,e.real&&p&&!p[r]&&nb(p,r,m)))}},ti=function(e){return"function"==typeof e?e:void 0},Mb=function(e,t){return 2>arguments.length?ti(fa[e])||ti(J[e]):fa[e]&&fa[e][t]||J[e]&&J[e][t]},Td=Mb("JSON","stringify"),zm=/[\uD800-\uDFFF]/g,ui=/^[\uD800-\uDBFF]$/,vi=/^[\uDC00-\uDFFF]$/,Am=function(e,t,n){var r=n.charAt(t-1);return t=n.charAt(t+1),ui.test(e)&&!vi.test(t)||vi.test(e)&&!ui.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},Bm=oa((function(){return'"\\udf06\\ud834"'!==Td("\udf06\ud834")||'"\\udead"'!==Td("\udead")}));Td&&K({target:"JSON",stat:!0,forced:Bm},{stringify:function(e,t,n){var r=Td.apply(null,arguments);return"string"==typeof r?r.replace(zm,Am):r}}),fa.JSON||(fa.JSON={stringify:JSON.stringify});var w=function(e,t,n){return fa.JSON.stringify.apply(null,arguments)};window.process={env:{DEBUG:void 0}};var Hc={},Cm=0,Dm=Math.random(),Ud=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Cm+Dm).toString(36)},Em=!oa((function(){return Object.isExtensible(Object.preventExtensions({}))})),wi=Ka((function(e){var t=eb.f,n=Ud("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!xa(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!U(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!U(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Em&&a.REQUIRED&&i(e)&&!U(e,n)&&o(e),e}};Hc[n]=!0})),Fm=function(e,t){try{nb(J,e,t)}catch(n){J[e]=t}return t},xi=J["__core-js_shared__"]||Fm("__core-js_shared__",{}),Nb=Ka((function(e){(e.exports=function(e,t){return xi[e]||(xi[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})})),Fb=!!Object.getOwnPropertySymbols&&!oa((function(){return!String(Symbol())})),yi=Fb&&!Symbol.sham&&"symbol"==typeof Symbol(),Vd=Nb("wks"),nf=J.Symbol,Gm=yi?nf:Ud,sa=function(e){return U(Vd,e)||(Fb&&U(nf,e)?Vd[e]=nf[e]:Vd[e]=Gm("Symbol."+e)),Vd[e]},Ob={},Hm=sa("iterator"),Im=Array.prototype,zi=function(e){return void 0!==e&&(Ob.Array===e||Im[Hm]===e)},Jm=Math.ceil,Km=Math.floor,Wd=function(e){return isNaN(e=+e)?0:(0<e?Km:Jm)(e)},Lm=Math.min,ob=function(e){return 0<e?Lm(Wd(e),9007199254740991):0},Mm=sa("toStringTag"),Ai={};Ai[Mm]="z";var of="[object z]"===String(Ai),Nm=sa("toStringTag"),Om="Arguments"==Eb(function(){return arguments}()),Xd=of?Eb:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Nm];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Om?Eb(e):"Object"==(t=Eb(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Pm=sa("iterator"),Bi=function(e){if(null!=e)return e[Pm]||e["@@iterator"]||Ob[Xd(e)]},Ci=function(e,t,n,r){try{return r?t(Oa(n)[0],n[1]):t(n)}catch(n){throw void 0!==(t=e.return)&&Oa(t.call(e)),n}},gd=Ka((function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var a,s;if(n=ic(n,r,i?2:1),!o){if("function"!=typeof(o=Bi(e)))throw TypeError("Target is not iterable");if(zi(o)){for(o=0,r=ob(e.length);r>o;o++)if((a=i?n(Oa(s=e[o])[0],s[1]):n(e[o]))&&a instanceof t)return a;return new t(!1)}e=o.call(e)}for(o=e.next;!(s=o.call(e)).done;)if("object"==typeof(a=Ci(e,n,s.value,i))&&a&&a instanceof t)return a;return new t(!1)}).stop=function(e){return new t(!0,e)}})),pf=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Qm=of?{}.toString:function(){return"[object "+Xd(this)+"]"},Rm=eb.f,Di=sa("toStringTag"),hd=function(e,t,n,r){e&&(e=n?e:e.prototype,U(e,Di)||Rm(e,Di,{configurable:!0,value:t}),r&&!of&&nb(e,"toString",Qm))},pb=function(e){return Object(hc(e))},jc=Array.isArray||function(e){return"Array"==Eb(e)},Sm=sa("species"),qf=function(e,t){var n;return jc(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!jc(n.prototype)?xa(n)&&null===(n=n[Sm])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Tm=[].push,kc=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=5==e||o;return function(s,c,u,l){var d,h,p=pb(s),f=Rd(p);c=ic(c,u,3),u=ob(f.length);var g=0;for(l=l||qf,s=t?l(s,u):n?l(s,0):void 0;u>g;g++)if((a||g in f)&&(h=c(d=f[g],g,p),e))if(t)s[g]=h;else if(h)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:Tm.call(s,d)}else if(i)return!1;return o?-1:r||i?i:s}},Ic=kc(0),Um=kc(1),Vm=kc(2),Wm=kc(3);kc(4);var Xm=kc(5);kc(6);var Ym=Nb("native-function-to-string",Function.toString),Ei=J.WeakMap,Zm="function"==typeof Ei&&/native code/.test(Ym.call(Ei)),Fi=Nb("keys"),Yd=function(e){return Fi[e]||(Fi[e]=Ud(e))},$m=J.WeakMap;if(Zm)var Jc=new $m,an=Jc.get,bn=Jc.has,cn=Jc.set,rf=function(e,t){return cn.call(Jc,e,t),t},Zd=function(e){return an.call(Jc,e)||{}},sf=function(e){return bn.call(Jc,e)};else{var id=Yd("state");Hc[id]=!0,rf=function(e,t){return nb(e,id,t),t},Zd=function(e){return U(e,id)?e[id]:{}},sf=function(e){return U(e,id)}}var ab={set:rf,get:Zd,has:sf,enforce:function(e){return sf(e)?Zd(e):rf(e,{})},getterFor:function(e){return function(t){var n;if(!xa(t)||(n=Zd(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},dn=eb.f,en=ab.set,fn=ab.getterFor,gn=Math.max,hn=Math.min,$d=function(e,t){return 0>(e=Wd(e))?gn(e+t,0):hn(e,t)},Gi=function(e){return function(t,n,r){var i;t=db(t);var o=ob(t.length);if(r=$d(r,o),e&&n!=n){for(;o>r;)if((i=t[r++])!=i)return!0}else for(;o>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},jn=Gi(!0),Hi=Gi(!1),Ii=function(e,t){var n;e=db(e);var r=0,i=[];for(n in e)!U(Hc,n)&&U(e,n)&&i.push(n);for(;t.length>r;)U(e,n=t[r++])&&(~Hi(i,n)||i.push(n));return i},ae="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Xb=Object.keys||function(e){return Ii(e,ae)},Ji=la?Object.defineProperties:function(e,t){Oa(e);for(var n,r=Xb(t),i=r.length,o=0;i>o;)eb.f(e,n=r[o++],t[n]);return e},tf=Mb("document","documentElement"),Ki=Yd("IE_PROTO"),uf=function(){},be=function(){var e=Sd?Ec.createElement("iframe"):{},t=ae.length;for(e.style.display="none",tf.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),be=e.F;t--;)delete be.prototype[ae[t]];return be()},lc=Object.create||function(e,t){var n;return null!==e?(uf.prototype=Oa(e),n=new uf,uf.prototype=null,n[Ki]=e):n=be(),void 0===t?n:Ji(n,t)};Hc[Ki]=!0;var vf=function(e,t,n,r){r&&r.enumerable?e[t]=n:nb(e,t,n)},wf=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:vf(e,r,t[r],n);return e},kn=!oa((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Li=Yd("IE_PROTO"),ln=Object.prototype,xf=kn?Object.getPrototypeOf:function(e){return e=pb(e),U(e,Li)?e[Li]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ln:null};sa("iterator");var Mi=!1,ce,yf,zf;[].keys&&(zf=[].keys(),"next"in zf?(yf=xf(xf(zf)),yf!==Object.prototype&&(ce=yf)):Mi=!0),null==ce&&(ce={});var Ni=ce,de=Mi,mn=function(){return this},nn=function(e,t,n){return t+=" Iterator",e.prototype=lc(Ni,{next:gc(1,n)}),hd(e,t,!1,!0),Ob[t]=mn,e};Object.setPrototypeOf||"__proto__"in{}&&function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}}();var Af=sa("iterator"),on=function(){return this},Bf=function(e,t,n,r,i,o,a){var s,c,u;nn(n,t,r),r=function(e){if(e===i&&f)return f;if(!de&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var l=t+" Iterator",d=!1,h=e.prototype,p=h[Af]||h["@@iterator"]||i&&h[i],f=!de&&p||r(i),g="Array"==t&&h.entries||p;if(g&&(s=xf(g.call(new e)),Ni!==Object.prototype&&s.next&&(hd(s,l,!0,!0),Ob[l]=on)),"values"==i&&p&&"values"!==p.name&&(d=!0,f=function(){return p.call(this)}),a&&h[Af]!==f&&nb(h,Af,f),Ob[t]=f,i)if(c={values:r("values"),keys:o?f:r("keys"),entries:r("entries")},a)for(u in c)!de&&!d&&u in h||vf(h,u,c[u]);else K({target:t,proto:!0,forced:de||d},c);return c},Oi=sa("species"),Pi=function(e){e=Mb(e);var t=eb.f;la&&e&&!e[Oi]&&t(e,Oi,{configurable:!0,get:function(){return this}})},pn=eb.f,Qi=wi.fastKey,Ri=ab.set,Cf=ab.getterFor;!function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=J.Map,s=a&&a.prototype,c={};if(la&&"function"==typeof a&&(i||s.forEach&&!oa((function(){(new a).entries().next()})))){var u=t((function(t,n){en(pf(t,u,e),{type:e,collection:new a}),null!=n&&gd(n,t[o],t,r)})),l=fn(e);Ic("add clear delete forEach get has set keys values entries".split(" "),(function(e){var t="add"==e||"set"==e;!(e in s)||i&&"clear"==e||nb(u.prototype,e,(function(n,r){var o=l(this).collection;return t||!i||xa(n)?(n=o[e](0===n?0:n,r),t?this:n):"get"==e&&void 0}))})),i||dn(u.prototype,"size",{configurable:!0,get:function(){return l(this).collection.size}})}else u=n.getConstructor(t,e,r,o),wi.REQUIRED=!0;hd(u,e,!1,!0),c.Map=u,K({global:!0,forced:!0},c),i||n.setStrong(u,e,r)}("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var i=e((function(e,o){pf(e,i,t),Ri(e,{type:t,index:lc(null),first:void 0,last:void 0,size:0}),la||(e.size=0),null!=o&&gd(o,e[r],e,n)})),o=Cf(t),a=function(e,t,n){var r,i,a=o(e),c=s(e,t);return c?c.value=n:(a.last=c={index:i=Qi(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=c),r&&(r.next=c),la?a.size++:e.size++,"F"!==i&&(a.index[i]=c)),e},s=function(e,t){e=o(e);var n=Qi(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return wf(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,la?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=s(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),la?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=ic(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),wf(i.prototype,n?{get:function(e){return(e=s(this,e))&&e.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),la&&pn(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Cf(t),o=Cf(r);Bf(e,t,(function(e,t){Ri(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Pi(t)}});var Si=function(e){return function(t,n){var r,i;t=String(hc(t)),n=Wd(n);var o=t.length;return 0>n||n>=o?e?"":void 0:55296>(r=t.charCodeAt(n))||56319<r||n+1===o||56320>(i=t.charCodeAt(n+1))||57343<i?e?t.charAt(n):r:e?t.slice(n,n+2):i-56320+(r-55296<<10)+65536}},qn=(Si(!1),Si(!0)),rn=ab.set,sn=ab.getterFor("String Iterator");Bf(String,"String",(function(e){rn(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=sn(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=qn(n,r),t.index+=e.length,{value:e,done:!1})}));var tn=ab.set,un=ab.getterFor("Array Iterator");Bf(Array,"Array",(function(e,t){tn(this,{type:"Array Iterator",target:db(e),index:0,kind:t})}),(function(){var e=un(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),Ob.Arguments=Ob.Array;var vn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ti=sa("toStringTag"),ee;for(ee in vn){var Ui=J[ee],Df=Ui&&Ui.prototype;Df&&!Df[Ti]&&nb(Df,Ti,ee),Ob[ee]=Ob.Array}var Y=fa.Map,wn=sa("match"),Ef=function(e){var t;if(xa(e)&&(void 0!==(t=e[wn])?t:"RegExp"==Eb(e)))throw TypeError("The method doesn't accept regular expressions");return e},xn=sa("match"),Ff=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[xn]=!1,"/./"[e](t)}catch(e){}}return!1},Vi="".endsWith,yn=Math.min,zn=Ff("endsWith");K({target:"String",proto:!0,forced:!zn},{endsWith:function(e){var t=String(hc(this));Ef(e);var n=1<arguments.length?arguments[1]:void 0,r=ob(t.length);return n=void 0===n?r:yn(ob(n),r),r=String(e),Vi?Vi.call(t,r,n):t.slice(n-r.length,n)===r}});var Aa=function(e){return fa[e+"Prototype"]},An=Aa("String").endsWith,Wi=String.prototype,zg=function(e){var t=e.endsWith;return"string"==typeof e||e===Wi||e instanceof String&&t===Wi.endsWith?An:t},jd=function(e,t){var n=[][e];return!n||!oa((function(){n.call(null,t||function(){throw 1},1)}))},Xi=jd("forEach")?function(e){return Ic(this,e,1<arguments.length?arguments[1]:void 0)}:[].forEach;K({target:"Array",proto:!0,forced:[].forEach!=Xi},{forEach:Xi});var Bn=Aa("Array").forEach,Yi=Array.prototype,Cn={DOMTokenList:!0,NodeList:!0},r=function(e){var t=e.forEach;return e===Yi||e instanceof Array&&t===Yi.forEach||Cn.hasOwnProperty(Xd(e))?Bn:t},kd={f:Object.getOwnPropertySymbols},fe=Object.assign,Zi=!fe||oa((function(){var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=fe({},e)[n]||"abcdefghijklmnopqrst"!=Xb(fe({},t)).join("")}))?function(e,t){for(var n=pb(e),r=arguments.length,i=1,o=kd.f,a=Qd;r>i;)for(var s,c=Rd(arguments[i++]),u=o?Xb(c).concat(o(c)):Xb(c),l=u.length,d=0;l>d;)s=u[d++],la&&!a.call(c,s)||(n[s]=c[s]);return n}:fe;K({target:"Object",stat:!0,forced:Object.assign!==Zi},{assign:Zi});var Wa=fa.Object.assign,Dn=oa((function(){Xb(1)}));K({target:"Object",stat:!0,forced:Dn},{keys:function(e){return Xb(pb(e))}});var V=fa.Object.keys,$i=function(e){return function(t,n,r,i){mb(n),t=pb(t);var o=Rd(t),a=ob(t.length),s=e?a-1:0,c=e?-1:1;if(2>r)for(;;){if(s in o){i=o[s],s+=c;break}if(s+=c,e?0>s:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=s:a>s;s+=c)s in o&&(i=n(i,o[s],s,t));return i}},En=[$i(!1),$i(!0)][0];K({target:"Array",proto:!0,forced:jd("reduce")},{reduce:function(e){return En(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Fn=Aa("Array").reduce,aj=Array.prototype,xe=function(e){var t=e.reduce;return e===aj||e instanceof Array&&t===aj.reduce?Fn:t};K({target:"Object",stat:!0,forced:!la,sham:!la},{defineProperty:eb.f});var bj=Ka((function(e){var t=fa.Object;e=e.exports=function(e,n,r){return t.defineProperty(e,n,r)},t.defineProperty.sham&&(e.sham=!0)})),ba=bj,Gn=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,Hn=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Gf=function(e){return function(t){return t=String(hc(t)),1&e&&(t=t.replace(Gn,"")),2&e&&(t=t.replace(Hn,"")),t}};Gf(1),Gf(2);var cj=Gf(3),ge=J.parseInt,In=/^[+-]?0[Xx]/,dj=8!==ge("\t\n\v\f\r \u2028\u2029\ufeff08")||22!==ge("\t\n\v\f\r \u2028\u2029\ufeff0x16")?function(e,t){return e=cj(String(e)),ge(e,t>>>0||(In.test(e)?16:10))}:ge;K({global:!0,forced:parseInt!=dj},{parseInt:dj});var S=fa.parseInt;let wg=!0,xg=!0;var ej=Fc,Jn=oa((function(){ej(1)}));K({target:"Object",stat:!0,forced:!la||Jn,sham:!la},{getOwnPropertyDescriptor:function(e,t){return ej(db(e),t)}});var ca=Ka((function(e){var t=fa.Object;e=e.exports=function(e,n){return t.getOwnPropertyDescriptor(e,n)},t.getOwnPropertyDescriptor.sham&&(e.sham=!0)})),mc=function(e,t,n){(t=Dc(t))in e?eb.f(e,t,gc(0,n)):e[t]=n},ld=Mb("navigator","userAgent")||"",fj=J.process,gj=fj&&fj.versions,hj=gj&&gj.v8,Pb,he;hj?(Pb=hj.split("."),he=Pb[0]+Pb[1]):ld&&(Pb=ld.match(/Edge\/(\d+)/),(!Pb||74<=Pb[1])&&(Pb=ld.match(/Chrome\/(\d+)/),Pb&&(he=Pb[1])));var ie=he&&+he,Kn=sa("species"),md=function(e){return 51<=ie||!oa((function(){var t=[];return(t.constructor={})[Kn]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},ij=sa("isConcatSpreadable"),Ln=51<=ie||!oa((function(){var e=[];return e[ij]=!1,e.concat()[0]!==e})),Mn=md("concat");K({target:"Array",proto:!0,forced:!Ln||!Mn},{concat:function(e){var t,n,r=pb(this),i=qf(r,0),o=0,a=-1;for(t=arguments.length;a<t;a++){var s=n=-1===a?r:arguments[a];if(xa(s)){var c=s[ij];s=void 0!==c?!!c:jc(s)}else s=!1;if(s){if(9007199254740991<o+(c=ob(n.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,o++)s in n&&mc(i,o,n[s])}else{if(9007199254740991<=o)throw TypeError("Maximum allowed index exceeded");mc(i,o++,n)}}return i.length=o,i}});var Nn=Aa("Array").concat,jj=Array.prototype,n=function(e){var t=e.concat;return e===jj||e instanceof Array&&t===jj.concat?Nn:t};K({target:"Array",proto:!0,forced:!md("filter")},{filter:function(e){return Vm(this,e,1<arguments.length?arguments[1]:void 0)}});var On=Aa("Array").filter,kj=Array.prototype,M=function(e){var t=e.filter;return e===kj||e instanceof Array&&t===kj.filter?On:t},Pn=J.Promise,lj=sa("iterator"),mj=!1;try{var Qn=0,nj={next:function(){return{done:!!Qn++}},return:function(){mj=!0}};nj[lj]=function(){return this},Array.from(nj,(function(){throw 2}))}catch(c){}var oj=function(e,t){if(!t&&!mj)return!1;var n=!1;try{(t={})[lj]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Rn=sa("species"),pj=function(e,t){var n;return void 0===(e=Oa(e).constructor)||null==(n=Oa(e)[Rn])?t:mb(n)},qj=/(iphone|ipod|ipad).*applewebkit/i.test(ld),rj=J.location,Hf=J.setImmediate,sj=J.clearImmediate,tj=J.process,uj=J.MessageChannel,If=J.Dispatch,Jf=0,nd={},Kc,Kf,Lf,Mf=function(e){if(nd.hasOwnProperty(e)){var t=nd[e];delete nd[e],t()}},Nf=function(e){return function(){Mf(e)}},vj=function(e){Mf(e.data)},wj=function(e){J.postMessage(e+"",rj.protocol+"//"+rj.host)};Hf&&sj||(Hf=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return nd[++Jf]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Kc(Jf),Jf},sj=function(e){delete nd[e]},"process"==Eb(tj)?Kc=function(e){tj.nextTick(Nf(e))}:If&&If.now?Kc=function(e){If.now(Nf(e))}:uj&&!qj?(Kf=new uj,Lf=Kf.port2,Kf.port1.onmessage=vj,Kc=ic(Lf.postMessage,Lf,1)):!J.addEventListener||"function"!=typeof postMessage||J.importScripts||oa(wj)?Kc="onreadystatechange"in(Sd?Ec.createElement("script"):{})?function(e){tf.appendChild(Sd?Ec.createElement("script"):{}).onreadystatechange=function(){tf.removeChild(this),Mf(e)}}:function(e){setTimeout(Nf(e),0)}:(Kc=wj,J.addEventListener("message",vj,!1)));var Of=Hf,Sn=Fc,xj=J.MutationObserver||J.WebKitMutationObserver,Pf=J.process,Qf=J.Promise,yj="process"==Eb(Pf),zj=Sn(J,"queueMicrotask"),Aj=zj&&zj.value,od,nc,pd,Lc,Rf,Sf,Tf,Bj;Aj||(od=function(){var e;for(yj&&(e=Pf.domain)&&e.exit();nc;){var t=nc.fn;nc=nc.next;try{t()}catch(e){throw nc?Lc():pd=void 0,e}}pd=void 0,e&&e.enter()},yj?Lc=function(){Pf.nextTick(od)}:xj&&!qj?(Rf=!0,Sf=document.createTextNode(""),new xj(od).observe(Sf,{characterData:!0}),Lc=function(){Sf.data=Rf=!Rf}):Qf&&Qf.resolve?(Tf=Qf.resolve(void 0),Bj=Tf.then,Lc=function(){Bj.call(Tf,od)}):Lc=function(){Of.call(J,od)});var Cj=Aj||function(e){e={fn:e,next:void 0},pd&&(pd.next=e),nc||(nc=e,Lc()),pd=e},Tn=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=mb(t),this.reject=mb(n)},je={f:function(e){return new Tn(e)}},Uf=function(e,t){return Oa(e),xa(t)&&t.constructor===e?t:((0,(e=je.f(e)).resolve)(t),e.promise)},Un=function(e,t){var n=J.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},ke=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Vn=sa("species"),Dj=ab.get,Wn=ab.set,Xn=ab.getterFor("Promise"),Ra=Pn,Ej=J.TypeError,Vf=J.document,le=J.process,Yn=Nb("inspectSource");Mb("fetch");var Mc=je.f,Zn=Mc,qd="process"==Eb(le),$n=!!(Vf&&Vf.createEvent&&J.dispatchEvent),me,Fj,ne=Gc("Promise",(function(){if(Yn(Ra)===String(Ra)&&(66===ie||!qd&&"function"!=typeof PromiseRejectionEvent)||!Ra.prototype.finally)return!0;if(51<=ie&&/native code/.test(Ra))return!1;var e=Ra.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[Vn]=t,!(e.then((function(){}))instanceof t)})),ao=ne||!oj((function(e){Ra.all(e).catch((function(){}))})),Gj=function(e){var t;return!(!xa(e)||"function"!=typeof(t=e.then))&&t},Wf=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;Cj((function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var s,c,u,l=r[a++],d=o?l.ok:l.fail,h=l.resolve,p=l.reject,f=l.domain;try{d?(o||(2===t.rejection&&bo(e,t),t.rejection=1),!0===d?s=i:(f&&f.enter(),s=d(i),f&&(f.exit(),u=!0)),s===l.promise?p(Ej("Promise-chain cycle")):(c=Gj(s))?c.call(s,h,p):h(s)):p(i)}catch(e){f&&!u&&f.exit(),p(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&co(e,t)}))}},Hj=function(e,t,n){var r,i;$n?((r=Vf.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),J.dispatchEvent(r)):r={promise:t,reason:n},(i=J["on"+e])?i(r):"unhandledrejection"===e&&Un("Unhandled promise rejection",n)},co=function(e,t){Of.call(J,(function(){var n,r=t.value;if(1!==t.rejection&&!t.parent&&(n=ke((function(){qd?le.emit("unhandledRejection",r,e):Hj("unhandledrejection",e,r)})),t.rejection=qd||1!==t.rejection&&!t.parent?2:1,n.error))throw n.value}))},bo=function(e,t){Of.call(J,(function(){qd?le.emit("rejectionHandled",e):Hj("rejectionhandled",e,t.value)}))},Nc=function(e,t,n,r){return function(i){e(t,n,i,r)}},Oc=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Wf(e,t,!0))},Xf=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw Ej("Promise can't be resolved itself");var i=Gj(n);i?Cj((function(){var r={done:!1};try{i.call(n,Nc(Xf,e,r,t),Nc(Oc,e,r,t))}catch(n){Oc(e,r,n,t)}})):(t.value=n,t.state=1,Wf(e,t,!1))}catch(n){Oc(e,{done:!1},n,t)}}};ne&&(Ra=function(e){pf(this,Ra,"Promise"),mb(e),me.call(this);var t=Dj(this);try{e(Nc(Xf,this,t),Nc(Oc,this,t))}catch(e){Oc(this,t,e)}},me=function(e){Wn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})},me.prototype=wf(Ra.prototype,{then:function(e,t){var n=Xn(this),r=Mc(pj(this,Ra));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=qd?le.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Wf(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Fj=function(){var e=new me,t=Dj(e);this.promise=e,this.resolve=Nc(Xf,e,t),this.reject=Nc(Oc,e,t)},je.f=Mc=function(e){return e===Ra||e===Ij?new Fj(e):Zn(e)}),K({global:!0,wrap:!0,forced:ne},{Promise:Ra}),hd(Ra,"Promise",!1,!0),Pi("Promise");var Ij=Mb("Promise");K({target:"Promise",stat:!0,forced:ne},{reject:function(e){var t=Mc(this);return t.reject.call(void 0,e),t.promise}}),K({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Uf(this===Ij?Ra:this,e)}}),K({target:"Promise",stat:!0,forced:ao},{all:function(e){var t=this,n=Mc(t),r=n.resolve,i=n.reject,o=ke((function(){var n=mb(t.resolve),o=[],a=0,s=1;gd(e,(function(e){var c=a++,u=!1;o.push(void 0),s++,n.call(t,e).then((function(e){u||(u=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Mc(t),r=n.reject,i=ke((function(){var i=mb(t.resolve);gd(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),K({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=je.f(t),r=n.resolve,i=n.reject,o=ke((function(){var n=mb(t.resolve),i=[],o=0,a=1;gd(e,(function(e){var s=o++,c=!1;i.push(void 0),a++,n.call(t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}}),K({target:"Promise",proto:!0,real:!0},{finally:function(e){var t=pj(this,Mb("Promise")),n="function"==typeof e;return this.then(n?function(n){return Uf(t,e()).then((function(){return n}))}:e,n?function(n){return Uf(t,e()).then((function(){throw n}))}:e)}});var u=fa.Promise;K({target:"Array",proto:!0,forced:!md("map")},{map:function(e){return Um(this,e,1<arguments.length?arguments[1]:void 0)}});var eo=Aa("Array").map,Jj=Array.prototype,D=function(e){var t=e.map;return e===Jj||e instanceof Array&&t===Jj.map?eo:t},fo=Math.max,go=Math.min;K({target:"Array",proto:!0,forced:!md("splice")},{splice:function(e,t){var n,r,i,o,a=pb(this),s=ob(a.length),c=$d(e,s),u=arguments.length;if(0===u?n=r=0:1===u?(n=0,r=s-c):(n=u-2,r=go(fo(Wd(t),0),s-c)),9007199254740991<s+n-r)throw TypeError("Maximum allowed length exceeded");for(u=qf(a,r),i=0;i<r;i++)(o=c+i)in a&&mc(u,i,a[o]);if(u.length=r,n<r){for(i=c;i<s-r;i++){var l=i+n;(o=i+r)in a?a[l]=a[o]:delete a[l]}for(i=s;i>s-r+n;i--)delete a[i-1]}else if(n>r)for(i=s-r;i>c;i--)l=i+n-1,(o=i+r-1)in a?a[l]=a[o]:delete a[l];for(i=0;i<n;i++)a[i+c]=arguments[i+2];return a.length=s-r+n,u}});var ho=Aa("Array").splice,Kj=Array.prototype,Ma=function(e){var t=e.splice;return e===Kj||e instanceof Array&&t===Kj.splice?ho:t},Lj=[].indexOf,Mj=!!Lj&&0>1/[1].indexOf(1,-0),io=jd("indexOf");K({target:"Array",proto:!0,forced:Mj||io},{indexOf:function(e){return Mj?Lj.apply(this,arguments)||0:Hi(this,e,1<arguments.length?arguments[1]:void 0)}});var jo=Aa("Array").indexOf,Nj=Array.prototype,E=function(e){var t=e.indexOf;return e===Nj||e instanceof Array&&t===Nj.indexOf?jo:t},ko=sa("species"),lo=[].slice,mo=Math.max;K({target:"Array",proto:!0,forced:!md("slice")},{slice:function(e,t){var n,r=db(this),i=ob(r.length);if(e=$d(e,i),t=$d(void 0===t?i:t,i),jc(r)&&("function"!=typeof(n=r.constructor)||n!==Array&&!jc(n.prototype)?xa(n)&&null===(n=n[ko])&&(n=void 0):n=void 0,n===Array||void 0===n))return lo.call(r,e,t);for(n=new(void 0===n?Array:n)(mo(t-e,0)),i=0;e<t;e++,i++)e in r&&mc(n,i,r[e]);return n.length=i,n}});var no=Aa("Array").slice,Oj=Array.prototype,wb=function(e){var t=e.slice;return e===Oj||e instanceof Array&&t===Oj.slice?no:t},Pj=!0;"find"in[]&&Array(1).find((function(){Pj=!1})),K({target:"Array",proto:!0,forced:Pj},{find:function(e){return Xm(this,e,1<arguments.length?arguments[1]:void 0)}});var oo=Aa("Array").find,Qj=Array.prototype,R=function(e){var t=e.find;return e===Qj||e instanceof Array&&t===Qj.find?oo:t},Rj=[].slice,Yf={};K({target:"Function",proto:!0},{bind:Function.bind||function(e){var t=mb(this),n=Rj.call(arguments,1),r=function(){var i=n.concat(Rj.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Yf)){for(var a=[],s=0;s<o;s++)a[s]="a["+s+"]";Yf[o]=Function("C,a","return new C("+a.join(",")+")")}i=Yf[o](t,i)}else i=t.apply(e,i);return i};return xa(t.prototype)&&(r.prototype=t.prototype),r}});var po=Aa("Function").bind,Sj=Function.prototype,ya=function(e){var t=e.bind;return e===Sj||e instanceof Function&&t===Sj.bind?po:t};K({target:"Array",proto:!0},{includes:function(e){return jn(this,e,1<arguments.length?arguments[1]:void 0)}});var qo=Aa("Array").includes;K({target:"String",proto:!0,forced:!Ff("includes")},{includes:function(e){return!!~String(hc(this)).indexOf(Ef(e),1<arguments.length?arguments[1]:void 0)}});var ro=Aa("String").includes,Tj=Array.prototype,Uj=String.prototype,La=function(e){var t=e.includes;return e===Tj||e instanceof Array&&t===Tj.includes?qo:"string"==typeof e||e===Uj||e instanceof String&&t===Uj.includes?ro:t};K({target:"Array",proto:!0,forced:jd("some")},{some:function(e){return Wm(this,e,1<arguments.length?arguments[1]:void 0)}});var so=Aa("Array").some,Vj=Array.prototype,Cg=function(e){var t=e.some;return e===Vj||e instanceof Array&&t===Vj.some?so:t};let Dg=kb;var Wj=Object.freeze({__proto__:null,shimMediaStream:Eg,shimOnTrack:Fg,shimGetSendersWithDtmf:Gg,shimGetStats:Hg,shimSenderReceiverGetStats:Ig,shimAddTrackRemoveTrackWithNative:Jg,shimAddTrackRemoveTrack:Kg,shimPeerConnection:ze,fixNegotiationNeeded:Lg,shimGetUserMedia:Bg,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{let r=n.video&&n.video.width,i=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n.video&&n.video.frameRate||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),Xj="".startsWith,to=Math.min,uo=Ff("startsWith");K({target:"String",proto:!0,forced:!uo},{startsWith:function(e){var t=String(hc(this));Ef(e);var n=ob(to(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Xj?Xj.call(t,r,n):t.slice(n,n+r.length)===r}});var vo=Aa("String").startsWith,Yj=String.prototype,Bd=function(e){var t=e.startsWith;return"string"==typeof e||e===Yj||e instanceof String&&t===Yj.startsWith?vo:t},c;K({target:"String",proto:!0,forced:(c="trim",oa((function(){return!!"\t\n\v\f\r \u2028\u2029\ufeff"[c]()||""!=""[c]()||"\t\n\v\f\r \u2028\u2029\ufeff"[c].name!==c})))},{trim:function(){return cj(this)}});var wo=Aa("String").trim,Zj=String.prototype,tc=function(e){var t=e.trim;return"string"==typeof e||e===Zj||e instanceof String&&t===Zj.trim?wo:t},F=Ka((function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){var t;return D(t=tc(e).call(e).split("\n")).call(t,(function(e){return tc(e).call(e)}))},t.splitSections=function(e){return e=e.split("\nm="),D(e).call(e,(function(e,t){var n;return tc(n=0<t?"m="+e:e).call(n)+"\r\n"}))},t.getDescription=function(e){return(e=t.splitSections(e))&&e[0]},t.getMediaSections=function(e){return(e=t.splitSections(e)).shift(),e},t.matchPrefix=function(e,n){var r;return M(r=t.splitLines(e)).call(r,(function(e){return 0===E(e).call(e,n)}))},t.parseCandidate=function(e){var t;e={foundation:(t=0===E(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:S(t[1],10),protocol:t[2].toLowerCase(),priority:S(t[3],10),ip:t[4],address:t[4],port:S(t[5],10),type:t[7]};for(var n=8;n<t.length;n+=2)switch(t[n]){case"raddr":e.relatedAddress=t[n+1];break;case"rport":e.relatedPort=S(t[n+1],10);break;case"tcptype":e.tcpType=t[n+1];break;case"ufrag":e.ufrag=t[n+1],e.usernameFragment=t[n+1];break;default:e[t[n]]=t[n+1]}return e},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){e=e.substr(9).split(" ");var t={payloadType:S(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=S(e[1],10),t.channels=3===e.length?S(e[2],10):1,t.numChannels=t.channels,t},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t;return e=e.substr(9).split(" "),{id:S(e[0],10),direction:0<E(t=e[0]).call(t,"/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t={},n=e.substr(E(e).call(e," ")+1).split(";"),r=0;r<n.length;r++){var i,o;e=tc(i=n[r]).call(i).split("="),t[tc(o=e[0]).call(o)]=e[1]}return t},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&V(e.parameters).length){var i,o=[];r(i=V(e.parameters)).call(i,(function(t){e.parameters[t]?o.push(t+"="+e.parameters[t]):o.push(t)})),t+="a=fmtp:"+n+" "+o.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){return{type:(e=e.substr(E(e).call(e," ")+1).split(" ")).shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(e){var t,n="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&r(t=e.rtcpFeedback).call(t,(function(e){n+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),n},t.parseSsrcMedia=function(e){var t=E(e).call(e," "),n={ssrc:S(e.substr(7,t-7),10)},r=E(e).call(e,":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){return{semantics:(e=e.substr(13).split(" ")).shift(),ssrcs:D(e).call(e,(function(e){return S(e,10)}))}},t.getMid=function(e){if(e=t.matchPrefix(e,"a=mid:")[0])return e.substr(6)},t.parseFingerprint=function(e){return{algorithm:(e=e.substr(14).split(" "))[0].toLowerCase(),value:e[1]}},t.getDtlsParameters=function(e,n){return e=t.matchPrefix(e+n,"a=fingerprint:"),{role:"auto",fingerprints:D(e).call(e,t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n,i="a=setup:"+t+"\r\n";return r(n=e.fingerprints).call(n,(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},t.getIceParameters=function(e,r){return e=t.splitLines(e),e=n(e).call(e,t.splitLines(r)),{usernameFragment:M(e).call(e,(function(e){return 0===E(e).call(e,"a=ice-ufrag:")}))[0].substr(12),password:M(e).call(e,(function(e){return 0===E(e).call(e,"a=ice-pwd:")}))[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n,i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(e)[0].split(" "),a=3;a<o.length;a++){var s=o[a],c=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(c){var u;c=t.parseRtpMap(c);var l=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=l.length?t.parseFmtp(l[0]):{},c.rtcpFeedback=D(u=t.matchPrefix(e,"a=rtcp-fb:"+s+" ")).call(u,t.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase())}}}return r(n=t.matchPrefix(e,"a=extmap:")).call(n,(function(e){i.headerExtensions.push(t.parseExtmap(e))})),i},t.writeRtpDescription=function(e,n){var i,o,a,s="";s+="m="+e+" ",s+=0<n.codecs.length?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=D(i=n.codecs).call(i,(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",s+="c=IN IP4 0.0.0.0\r\n",s+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r(o=n.codecs).call(o,(function(e){s+=t.writeRtpMap(e),s+=t.writeFmtp(e),s+=t.writeRtcpFb(e)}));var c,u=0;return r(a=n.codecs).call(a,(function(e){e.maxptime>u&&(u=e.maxptime)})),0<u&&(s+="a=maxptime:"+u+"\r\n"),s+="a=rtcp-mux\r\n",n.headerExtensions&&r(c=n.headerExtensions).call(c,(function(e){s+=t.writeExtmap(e)})),s},t.parseRtpEncodingParameters=function(e){var n,i,o,a,s,c,u,l=[],d=t.parseRtpParameters(e),h=-1!==E(n=d.fecMechanisms).call(n,"RED"),p=-1!==E(i=d.fecMechanisms).call(i,"ULPFEC"),f=0<(n=M(o=D(a=t.matchPrefix(e,"a=ssrc:")).call(a,(function(e){return t.parseSsrcMedia(e)}))).call(o,(function(e){return"cname"===e.attribute}))).length&&n[0].ssrc;0<(o=D(s=t.matchPrefix(e,"a=ssrc-group:FID")).call(s,(function(e){return e=e.substr(17).split(" "),D(e).call(e,(function(e){return S(e,10)}))}))).length&&1<o[0].length&&o[0][0]===f&&(u=o[0][1]),r(c=d.codecs).call(c,(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:f,codecPayloadType:S(e.parameters.apt,10)},f&&u&&(e.rtx={ssrc:u}),l.push(e),h&&((e=JSON.parse(w(e))).fec={ssrc:f,mechanism:p?"red+ulpfec":"red"},l.push(e)))})),0===l.length&&f&&l.push({ssrc:f});var g,m,v=t.matchPrefix(e,"b=");return v.length&&(v=0===E(g=v[0]).call(g,"b=TIAS:")?S(v[0].substr(7),10):0===E(m=v[0]).call(m,"b=AS:")?950*S(v[0].substr(5),10)-16e3:void 0,r(l).call(l,(function(e){e.maxBitrate=v}))),l},t.parseRtcpParameters=function(e){var n,r,i={},o=M(n=D(r=t.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return t.parseSsrcMedia(e)}))).call(n,(function(e){return"cname"===e.attribute}))[0];return o&&(i.cname=o.value,i.ssrc=o.ssrc),n=t.matchPrefix(e,"a=rtcp-rsize"),i.reducedSize=0<n.length,i.compound=0===n.length,e=t.matchPrefix(e,"a=rtcp-mux"),i.mux=0<e.length,i},t.parseMsid=function(e){var n,r,i,o=t.matchPrefix(e,"a=msid:");return 1===o.length?{stream:(i=o[0].substr(7).split(" "))[0],track:i[1]}:0<(e=M(n=D(r=t.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return t.parseSsrcMedia(e)}))).call(n,(function(e){return"msid"===e.attribute}))).length?{stream:(i=e[0].value.split(" "))[0],track:i[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){return n=void 0!==n?n:2,"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,i){return n=t.writeRtpDescription(e.kind,n),n+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender&&(n=n+"a="+(r="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),n},t.getDirection=function(e,n){e=t.splitLines(e);for(var r=0;r<e.length;r++)switch(e[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[r].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){return{kind:(e=t.splitLines(e)[0].substr(2).split(" "))[0],port:S(e[1],10),protocol:e[2],fmt:wb(e).call(e,3).join(" ")}},t.parseOLine=function(e){return{username:(e=t.matchPrefix(e,"o=")[0].substr(2).split(" "))[0],sessionId:e[1],sessionVersion:S(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;e=t.splitLines(e);for(var n=0;n<e.length;n++)if(2>e[n].length||"="!==e[n].charAt(1))return!1;return!0},e.exports=t})),ml=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var i=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){r[e]=i[e].bind(i)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw Fa("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=ll(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;0<o;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=F.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length;return e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&n?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(n=this._createIceAndDtlsTransports(),e.iceTransport=n.iceTransport,e.dtlsTransport=n.dtlsTransport),t||this.transceivers.push(e),e},i.prototype.addTrack=function(t,n){if(this._isClosed)throw Fa("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw Fa("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},i.prototype.addStream=function(e){var n=this;if(15025<=t)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},i.prototype.removeTrack=function(t){if(this._isClosed)throw Fa("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw Fa("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},i.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},i.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},i.prototype._createIceGatherer=function(t,n){var r=this;if(n&&0<t)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&0<n)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate;(e=!a||0===Object.keys(a).length)?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment,a=F.writeCandidate(a),o.candidate=Object.assign(o.candidate,F.parseCandidate(a)),o.candidate.candidate=a,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}),(a=F.getMediaSections(r._localDescription.sdp))[o.candidate.sdpMLineIndex]+=e?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=F.getDescription(r._localDescription.sdp)+a.join(""),a=r.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})),"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),e||r._dispatchEvent("icecandidate",o),a&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){i.onlocalcandidate(e)}))}),0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer),(t=this.transceivers[e].iceTransport)&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport),(t=this.transceivers[e].dtlsTransport)&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,n,r){var i=Cd(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:F.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&0<i.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&15019>t&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(Fa("TypeError",'Unsupported type "'+e.type+'"'));if(!Ng("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(Fa("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));if("offer"===e.type){var n=F.splitSections(e.sdp),r=n.shift();n.forEach((function(e,n){e=F.parseRtpParameters(e),t.transceivers[n].localCapabilities=e})),t.transceivers.forEach((function(e,n){t._gather(e.mid,n)}))}else if("answer"===e.type){n=F.splitSections(t._remoteDescription.sdp),r=n.shift();var i=0<F.matchPrefix(r,"a=ice-lite").length;n.forEach((function(e,n){var o=t.transceivers[n],a=o.iceGatherer,s=o.iceTransport,c=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities;if(!(F.isRejected(e)&&0===F.matchPrefix(e,"a=bundle-only").length||o.rejected)){var d=F.getIceParameters(e,r);e=F.getDtlsParameters(e,r),i&&(e.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===s.state&&s.start(a,d,i?"controlling":"controlled"),"new"===c.state&&c.start(e)),n=Cd(u,l),t._transceive(o,0<n.codecs.length,!1)}}))}return t._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(Fa("TypeError",'Unsupported type "'+i.type+'"'));if(!Ng("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(Fa("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var a={};o.remoteStreams.forEach((function(e){a[e.id]=e}));var s=[],c=F.splitSections(i.sdp),u=c.shift(),l=0<F.matchPrefix(u,"a=ice-lite").length,d=0<F.matchPrefix(u,"a=group:BUNDLE ").length;o.usingBundle=d;var h=F.matchPrefix(u,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!h&&0<=h.substr(14).split(" ").indexOf("trickle"),c.forEach((function(r,c){var h=F.splitLines(r),p=F.getKind(r),f=F.isRejected(r)&&0===F.matchPrefix(r,"a=bundle-only").length,g=h[0].substr(2).split(" ")[2];h=F.getDirection(r,u);var m=F.parseMsid(r),v=F.getMid(r)||F.generateIdentifier();if(f||"application"===p&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:v,kind:p,protocol:g,rejected:!0};else{var _,E;!f&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(p,!0));var y,T,S=F.parseRtpParameters(r);f||(y=F.getIceParameters(r,u),(T=F.getDtlsParameters(r,u)).role="client"),g=F.parseRtpEncodingParameters(r);var b=F.parseRtcpParameters(r),I=0<F.matchPrefix(r,"a=end-of-candidates",u).length;if(r=F.matchPrefix(r,"a=candidate:").map((function(e){return F.parseCandidate(e)})).filter((function(e){return 1===e.component})),("offer"===i.type||"answer"===i.type)&&!f&&d&&0<c&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||f){if("answer"===i.type&&!f){p=(_=o.transceivers[c]).iceGatherer;var R=_.iceTransport,C=_.dtlsTransport,A=_.rtpReceiver;f=_.sendEncodingParameters,v=_.localCapabilities,o.transceivers[c].recvEncodingParameters=g,o.transceivers[c].remoteCapabilities=S,o.transceivers[c].rtcpParameters=b,r.length&&"new"===R.state&&(!l&&!I||d&&0!==c?r.forEach((function(e){Ae(_.iceTransport,e)})):R.setRemoteCandidates(r)),d&&0!==c||("new"===R.state&&R.start(p,y,"controlling"),"new"===C.state&&C.start(T)),!Cd(_.localCapabilities,_.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,o._transceive(_,"sendrecv"===h||"recvonly"===h,"sendrecv"===h||"sendonly"===h),!A||"sendrecv"!==h&&"sendonly"!==h?delete _.rtpReceiver:(E=A.track,m?(a[m.stream]||(a[m.stream]=new e.MediaStream),n(E,a[m.stream]),s.push([E,A,a[m.stream]])):(a.default||(a.default=new e.MediaStream),n(E,a.default),s.push([E,A,a.default])))}}else(_=o.transceivers[c]||o._createTransceiver(p)).mid=v,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(c,d)),r.length&&"new"===_.iceTransport.state&&(!I||d&&0!==c?r.forEach((function(e){Ae(_.iceTransport,e)})):_.iceTransport.setRemoteCandidates(r)),v=e.RTCRtpReceiver.getCapabilities(p),15019>t&&(v.codecs=v.codecs.filter((function(e){return"rtx"!==e.name}))),f=_.sendEncodingParameters||[{ssrc:1001*(2*c+2)}],y=!1,"sendrecv"===h||"sendonly"===h?(y=!_.rtpReceiver,A=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,p),y&&(E=A.track,m&&"-"===m.stream||(m?(a[m.stream]||(a[m.stream]=new e.MediaStream,Object.defineProperty(a[m.stream],"id",{get:function(){return m.stream}})),Object.defineProperty(E,"id",{get:function(){return m.track}}),R=a[m.stream]):(a.default||(a.default=new e.MediaStream),R=a.default)),R&&(n(E,R),_.associatedRemoteMediaStreams.push(R)),s.push([E,A,R]))):_.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===_.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),_.associatedRemoteMediaStreams=[]),_.localCapabilities=v,_.remoteCapabilities=S,_.rtpReceiver=A,_.rtcpParameters=b,_.sendEncodingParameters=f,_.recvEncodingParameters=g,o._transceive(o.transceivers[c],!1,y)}})),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout((function(){o._dispatchEvent("addstream",i)}))}s.forEach((function(e){var t=e[0],i=e[1];n.id===e[2].id&&r(o,t,i,[n])}))}})),s.forEach((function(e){e[2]||r(o,e[0],e[1],[])})),e.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e,e=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",e)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},i.prototype.createOffer=function(n){var r=this;if(r._isClosed)return Promise.reject(Fa("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter((function(e){return"audio"===e.kind})).length,o=r.transceivers.filter((function(e){return"video"===e.kind})).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(i=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(o=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?0>--i&&(e.wantReceive=!1):"video"===e.kind&&0>--o&&(e.wantReceive=!1)}));0<i||0<o;)0<i&&(r._createTransceiver("audio"),i--),0<o&&(r._createTransceiver("video"),o--);var a=F.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);return r.transceivers.forEach((function(n,i){var o=n.track,a=n.kind,s=n.mid||F.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle)),s=e.RTCRtpSender.getCapabilities(a),15019>t&&(s.codecs=s.codecs.filter((function(e){return"rtx"!==e.name}))),s.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),s.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))})),i=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}],o&&15019<=t&&"video"===a&&!i[0].rtx&&(i[0].rtx={ssrc:i[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=s,n.sendEncodingParameters=i})),"max-compat"!==r._config.bundlePolicy&&(a+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){a+=Mg(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,a+="a="+F.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))})),n=new e.RTCSessionDescription({type:"offer",sdp:a}),Promise.resolve(n)},i.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(Fa("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(Fa("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=F.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var i=F.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,o){if(!(o+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var a;e.stream&&("audio"===e.kind?a=e.stream.getAudioTracks()[0]:"video"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&15019<=t&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})),!(o=Cd(e.localCapabilities,e.remoteCapabilities)).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=Mg(e,o,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}}));var o=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(o)},i.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(r,i){if(!n._remoteDescription)return i(Fa("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return i(Fa("OperationError","Can not add ICE candidate"));if(s.rejected)return r();if("tcp"===(a=0<Object.keys(e.candidate).length?F.parseCandidate(e.candidate):{}).protocol&&(0===a.port||9===a.port)||a.component&&1!==a.component)return r();if((0===o||0<o&&s.iceTransport!==n.transceivers[0].iceTransport)&&!Ae(s.iceTransport,a))return i(Fa("OperationError","Can not add ICE candidate"));0===(i=e.candidate.trim()).indexOf("a=")&&(i=i.substr(2)),(t=F.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(a.type?i:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=F.getDescription(n._remoteDescription.sdp)+t.join("")}else for(o=0;o<n.transceivers.length&&(n.transceivers[o].rejected||(n.transceivers[o].iceTransport.addRemoteCandidate({}),(t=F.getMediaSections(n._remoteDescription.sdp))[o]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=F.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));o++);r()}))},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw Fa("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){if((t=e[t])&&t.prototype&&t.prototype.getStats){var n=t.prototype.getStats;t.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r=e[n];e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[r.type]||r.type,t.set(n,e[n])})),t}))}}}));var o=["createOffer","createAnswer"];return o.forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),i},ak=Object.freeze({__proto__:null,shimPeerConnection:Be,shimReplaceTrack:Qg,shimGetUserMedia:Og,shimGetDisplayMedia:Pg}),bk=Object.freeze({__proto__:null,shimOnTrack:Sg,shimPeerConnection:Ce,shimSenderGetStats:Tg,shimReceiverGetStats:Ug,shimRemoveStream:Vg,shimRTCDataChannel:Wg,shimGetUserMedia:Rg,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){return n&&n.video?(!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)):((n=new DOMException("getDisplayMedia without video constraints is undefined")).name="NotFoundError",n.code=8,u.reject(n))})}}),ck=Object.freeze({__proto__:null,shimLocalStreamsAPI:Xg,shimRemoteStreamsAPI:Yg,shimCallbacksAPI:Zg,shimGetUserMedia:$g,shimConstraints:ah,shimRTCIceServerUrls:bh,shimTrackEventTransceiver:ch,shimCreateOfferLegacy:dh}),xo=Object.freeze({__proto__:null,shimRTCIceCandidate:Dd,shimMaxMessageSize:Sc,shimSendThrowTypeError:Tc,shimConnectionState:De,removeAllowExtmapMixed:Ee}),aa,da;!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let n=Ib(e),r={browserDetails:n,commonShim:xo,extractVersion:Hb,disableLog:il,disableWarnings:jl};switch(n.browser){case"chrome":if(!Wj||!ze||!t.shimChrome)return kb("Chrome shim is not included in this adapter release."),r;kb("adapter.js shimming chrome."),r.browserShim=Wj,Bg(e),Eg(e),ze(e),Fg(e),Kg(e),Gg(e),Hg(e),Ig(e),Lg(e),Dd(e),De(e),Sc(e),Tc(e),Ee(e);break;case"firefox":if(!bk||!Ce||!t.shimFirefox)return kb("Firefox shim is not included in this adapter release."),r;kb("adapter.js shimming firefox."),r.browserShim=bk,Rg(e),Ce(e),Sg(e),Vg(e),Tg(e),Ug(e),Wg(e),Dd(e),De(e),Sc(e),Tc(e);break;case"edge":if(!ak||!Be||!t.shimEdge)return kb("MS edge shim is not included in this adapter release."),r;kb("adapter.js shimming edge."),r.browserShim=ak,Og(e),Pg(e),Be(e),Qg(e),Sc(e),Tc(e);break;case"safari":if(!ck||!t.shimSafari)return kb("Safari shim is not included in this adapter release."),r;kb("adapter.js shimming safari."),r.browserShim=ck,bh(e),dh(e),Zg(e),Xg(e),Yg(e),ch(e),$g(e),Dd(e),Sc(e),Tc(e),Ee(e);break;default:kb("Unsupported browser!")}}({window:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS_X="Mac OS X",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(aa||(aa={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(da||(da={}));let $a=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var r,i=t[2];return n(r="".concat(t[1],".")).call(r,i)}return(t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&t[1]&&t[2]?(r=t[2],n(i="".concat(t[1],".")).call(i,Number(r)+100)):"4.0.0.999"}("4.1.0"),Db={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},nl={"90p":H(160,90),"90p_1":H(160,90),"120p":H(160,120,15,30,65),"120p_1":H(160,120,15,65),"120p_3":H(120,120,15,50),"120p_4":H(212,120),"180p":H(320,180,15,140),"180p_1":H(320,180,15,140),"180p_3":H(180,180,15,30,100),"180p_4":H(240,180,15,30,120),"240p":H(320,240,15,40,200),"240p_1":H(320,240,15,40,200),"240p_3":H(240,240,15,40,140),"240p_4":H(424,240,15,40,220),"360p":H(640,360,15,80,400),"360p_1":H(640,360,15,80,400),"360p_3":H(360,360,15,80,260),"360p_4":H(640,360,30,80,600),"360p_6":H(360,360,30,80,400),"360p_7":H(480,360,15,80,320),"360p_8":H(480,360,30,80,490),"360p_9":H(640,360,15,80,800),"360p_10":H(640,360,24,80,800),"360p_11":H(640,360,24,80,1e3),"480p":H(640,480,15,100,500),"480p_1":H(640,480,15,100,500),"480p_2":H(640,480,30,100,1e3),"480p_3":H(480,480,15,100,400),"480p_4":H(640,480,30,100,750),"480p_6":H(480,480,30,100,600),"480p_8":H(848,480,15,100,610),"480p_9":H(848,480,30,100,930),"480p_10":H(640,480,10,100,400),"720p":H(1280,720,15,120,1130),"720p_1":H(1280,720,15,120,1130),"720p_2":H(1280,720,30,120,2e3),"720p_3":H(1280,720,30,120,1710),"720p_5":H(960,720,15,120,910),"720p_6":H(960,720,30,120,1380),"1080p":H(1920,1080,15,120,2080),"1080p_1":H(1920,1080,15,120,2080),"1080p_2":H(1920,1080,30,120,3e3),"1080p_3":H(1920,1080,30,120,3150),"1080p_5":H(1920,1080,60,120,4780),"1440p":H(2560,1440,30,120,4850),"1440p_1":H(2560,1440,30,120,4850),"1440p_2":H(2560,1440,60,120,7350),"4k":H(3840,2160,30,120,8910),"4k_1":H(3840,2160,30,120,8910),"4k_3":H(3840,2160,60,120,13500)},ol={"480p":Jb(640,480,1,5),"480p_1":Jb(640,480,1,5),"480p_2":Jb(640,480,25,30),"720p":Jb(1280,720,1,5),"720p_1":Jb(1280,720,1,5),"720p_2":Jb(1280,720,25,30),"1080p":Jb(1920,1080,1,5),"1080p_1":Jb(1920,1080,1,5),"1080p_2":Jb(1920,1080,25,30)},pl={speech_low_quality:wc(16e3,!1),speech_standard:wc(32e3,!1,18),music_standard:wc(48e3,!1),standard_stereo:wc(48e3,!0,56),high_quality:wc(48e3,!1,128),high_quality_stereo:wc(48e3,!0,192)},C={PROCESS_ID:"",WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-ap-web-2.agoraio.cn"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-ap-web-4.agoraio.cn"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-2.agoraio.cn","cds-ap-web-3.agora.io","cds-ap-web-4.agoraio.cn"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-2.agoraio.cn","sua-ap-web-3.agora.io","sua-ap-web-4.agoraio.cn"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-2.agoraio.cn","uap-ap-web-3.agora.io","uap-ap-web-4.agoraio.cn"],GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"webcollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"webcollector-2.agoraio.cn",WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io"},yo=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],dk=[];var Zf=[],ek=Zf.sort,zo=oa((function(){Zf.sort(void 0)})),Ao=oa((function(){Zf.sort(null)})),Bo=jd("sort");K({target:"Array",proto:!0,forced:zo||!Ao||Bo},{sort:function(e){return void 0===e?ek.call(pb(this)):ek.call(pb(this),mb(e))}});var Co=Aa("Array").sort,fk=Array.prototype,rd=function(e){var t=e.sort;return e===fk||e instanceof Array&&t===fk.sort?Co:t};K({target:"Array",stat:!0},{isArray:jc});var cc=fa.Array.isArray,l;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORT="NOT_SUPPORT",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORT="OPERATION_ABORT",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",e.STREAM_IS_CLOSED="STREAM_IS_CLOSED",e.ABORT_OTHER_INIT="ABORT_OTHER_INIT",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",e.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",e.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",e.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(l||(l={}));var nh=function(e,t){return function(){for(var n=Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},xc=Object.prototype.toString,I={isArray:eh,isArrayBuffer:function(e){return"[object ArrayBuffer]"===xc.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:fh,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===xc.call(e)},isFile:function(e){return"[object File]"===xc.call(e)},isBlob:function(e){return"[object Blob]"===xc.call(e)},isFunction:gh,isStream:function(e){return fh(e)&&gh(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:Fd,merge:hh,deepMerge:Ge,extend:function(e,t,n){return Fd(t,(function(t,r){e[r]=n&&"function"==typeof t?nh(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},gk=function(e,t,n){if(!t)return e;if(n)t=n(t);else if(I.isURLSearchParams(t))t=t.toString();else{var r=[];I.forEach(t,(function(e,t){null!=e&&(I.isArray(e)?t+="[]":e=[e],I.forEach(e,(function(e){I.isDate(e)?e=e.toISOString():I.isObject(e)&&(e=JSON.stringify(e)),r.push(ih(t)+"="+ih(e))})))})),t=r.join("&")}return t&&(-1!==(n=e.indexOf("#"))&&(e=e.slice(0,n)),e+=(-1===e.indexOf("?")?"?":"&")+t),e};Gd.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},Gd.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Gd.prototype.forEach=function(e){I.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var kh=Gd,$f=function(e,t,n){return I.forEach(n,(function(n){e=n(e,t)})),e},hk=function(e){return!(!e||!e.__CANCEL__)},ik=function(e,t){I.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},oe=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},Do="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),Eo=function(e){var t,n,r,i={};return e?(I.forEach(e.split("\n"),(function(e){r=e.indexOf(":"),t=I.trim(e.substr(0,r)).toLowerCase(),n=I.trim(e.substr(r+1)),!t||i[t]&&0<=Do.indexOf(t)||(i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n)})),i):i},Fo=I.isStandardBrowserEnv()?function(){function e(e){return n&&(r.setAttribute("href",e),e=r.href),r.setAttribute("href",e),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");return t=e(window.location.href),function(n){return(n=I.isString(n)?e(n):n).protocol===t.protocol&&n.host===t.host}}():function(){return!0},Go=I.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),I.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),I.isString(r)&&a.push("path="+r),I.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){return(e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)")))?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Ho=function(e){return new Promise((function(t,n){var r=e.data,i=e.headers;I.isFormData(r)&&delete i["Content-Type"];var o=new XMLHttpRequest;if(e.auth&&(i.Authorization="Basic "+btoa((e.auth.username||"")+":"+(e.auth.password||""))),o.open(e.method.toUpperCase(),gk(e.url,e.params,e.paramsSerializer),!0),o.timeout=e.timeout,o.onreadystatechange=function(){if(o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in o?Eo(o.getAllResponseHeaders()):null,i=(r={data:e.responseType&&"text"!==e.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:r,config:e,request:o}).config.validateStatus;!i||i(r.status)?t(r):n(oe(Error("Request failed with status code "+r.status),r.config,null,r.request,r)),o=null}},o.onabort=function(){o&&(n(oe(Error("Request aborted"),e,"ECONNABORTED",o,void 0)),o=null)},o.onerror=function(){n(oe(Error("Network Error"),e,null,o,void 0)),o=null},o.ontimeout=function(){n(oe(Error("timeout of "+e.timeout+"ms exceeded"),e,"ECONNABORTED",o,void 0)),o=null},I.isStandardBrowserEnv()){var a=(e.withCredentials||Fo(e.url))&&e.xsrfCookieName?Go.read(e.xsrfCookieName):void 0;a&&(i[e.xsrfHeaderName]=a)}if("setRequestHeader"in o&&I.forEach(i,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:o.setRequestHeader(t,e)})),e.withCredentials&&(o.withCredentials=!0),e.responseType)try{o.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&o.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){o&&(o.abort(),n(e),o=null)})),void 0===r&&(r=null),o.send(r)}))},Io={"Content-Type":"application/x-www-form-urlencoded"},pe={adapter:function(){var e;return(void 0!==process&&"[object process]"===Object.prototype.toString.call(process)||"undefined"!=typeof XMLHttpRequest)&&(e=Ho),e}(),transformRequest:[function(e,t){return ik(t,"Accept"),ik(t,"Content-Type"),I.isFormData(e)||I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)?e:I.isArrayBufferView(e)?e.buffer:I.isURLSearchParams(e)?(jh(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):I.isObject(e)?(jh(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e},headers:{common:{Accept:"application/json, text/plain, */*"}}};I.forEach(["delete","get","head"],(function(e){pe.headers[e]={}})),I.forEach(["post","put","patch"],(function(e){pe.headers[e]=I.merge(Io)}));var Jo=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},Ko=function(e){return e.cancelToken&&e.cancelToken.throwIfRequested(),e.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e.url)&&(e.url=Jo(e.baseURL,e.url)),e.headers=e.headers||{},e.data=$f(e.data,e.headers,e.transformRequest),e.headers=I.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),I.forEach("delete get head post put patch common".split(" "),(function(t){delete e.headers[t]})),(e.adapter||pe.adapter)(e).then((function(t){return e.cancelToken&&e.cancelToken.throwIfRequested(),t.data=$f(t.data,t.headers,e.transformResponse),t}),(function(t){return hk(t)||(e.cancelToken&&e.cancelToken.throwIfRequested(),t&&t.response&&(t.response.data=$f(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},ag=function(e,t){t=t||{};var n={};return I.forEach(["url","method","params","data"],(function(e){void 0!==t[e]&&(n[e]=t[e])})),I.forEach(["headers","auth","proxy"],(function(r){I.isObject(t[r])?n[r]=I.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:I.isObject(e[r])?n[r]=I.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])})),I.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n};Uc.prototype.request=function(e,t){"string"==typeof e?(e=t||{}).url=e:e=e||{},(e=ag(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var n=[Ko,void 0];for(e=Promise.resolve(e),this.interceptors.request.forEach((function(e){n.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){n.push(e.fulfilled,e.rejected)}));n.length;)e=e.then(n.shift(),n.shift());return e},Uc.prototype.getUri=function(e){return e=ag(this.defaults,e),gk(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},I.forEach(["delete","get","head","options"],(function(e){Uc.prototype[e]=function(t,n){return this.request(I.merge(n||{},{method:e,url:t}))}})),I.forEach(["post","put","patch"],(function(e){Uc.prototype[e]=function(t,n,r){return this.request(I.merge(r||{},{method:e,url:t,data:n}))}}));var Id=Uc;He.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},He.prototype.__CANCEL__=!0;var lh=He;Hd.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Hd.source=function(){var e;return{token:new Hd((function(t){e=t})),cancel:e}};var Gb=mh(pe);Gb.Axios=Id,Gb.create=function(e){return mh(ag(Gb.defaults,e))},Gb.Cancel=lh,Gb.CancelToken=Hd,Gb.isCancel=hk,Gb.all=function(e){return Promise.all(e)},Gb.spread=function(e){return function(t){return e.apply(null,t)}};var Cb=Gb.default=Gb;let qb={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},jk=e=>{for(const t in qb)if(qb[t]===e)return t;return"DEFAULT"};class Lo{constructor(){this.logLevel=qb.DEBUG,this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0,this.uploadURL="https://".concat(C.LOG_UPLOAD_SERVER,"/upload/v1")}debug(...e){var t;e=n(t=[qb.DEBUG]).call(t,e),this.log.apply(this,e)}info(...e){var t;e=n(t=[qb.INFO]).call(t,e),this.log.apply(this,e)}warning(...e){var t;e=n(t=[qb.WARNING]).call(t,e),this.log.apply(this,e)}error(...e){var t;e=n(t=[qb.ERROR]).call(t,e),this.log.apply(this,e)}setLogLevel(e){this.logLevel=e=Math.min(Math.max(0,e),4)}enableLogUpload(){vc("UPLOAD_LOG",!0)}disableLogUpload(){vc("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){var t;this.uploadURL=e?n(t="https://".concat(e,"/ls/?h=")).call(t,C.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(C.LOG_UPLOAD_SERVER,"/upload/v1")}log(...e){var t,r,i,o;let a=Math.max(0,Math.min(4,e[0]));if(e[0]=oh()+" Agora-SDK [".concat(jk(a),"]:"),this.appendLogToWaitingList(a,e),!(a<this.logLevel)){var s=oh()+" %cAgora-SDK [".concat(jk(a),"]:");switch(a){case qb.DEBUG:e=n(t=[s,"color: #64B5F6;"]).call(t,wb(e).call(e,1)),console.log.apply(console,e);break;case qb.INFO:e=n(r=[s,"color: #1E88E5; font-weight: bold;"]).call(r,wb(e).call(e,1)),console.log.apply(console,e);break;case qb.WARNING:e=n(i=[s,"color: #FB8C00; font-weight: bold;"]).call(i,wb(e).call(e,1)),console.warn.apply(console,e);break;case qb.ERROR:e=n(o=[s,"color: #B00020; font-weight: bold;"]).call(o,wb(e).call(e,1)),console.error.apply(console,e)}}}appendLogToWaitingList(e,...t){if(C.UPLOAD_LOG){var n="";r(t).call(t,e=>{"object"==typeof e&&(e=w(e)),n+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}}async uploadLogs(){var e={sdk_version:$a,process_id:C.PROCESS_ID,payload:w(this.uploadLogUploadingList)};if("OK"!==(e=await Cb.post(this.uploadURL,e,{responseType:"text"})).data)throw Error("unexpected upload log response: "+e.data);this.uploadLogUploadingList=[]}uploadLogInterval(){var e;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=Ma(e=this.uploadLogWaitingList).call(e,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(e=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)}))}}let k=new Lo;class m{constructor(e,t="",r){var i;this.name="AgoraRTCException",this.code=e,this.message=n(i="AgoraRTCError ".concat(this.code,": ")).call(i,t),this.data=r}toString(){var e;return this.data?n(e="".concat(this.message," data: ")).call(e,w(this.data)):this.message}throw(){throw k.error(this.toString()),this}}var kk,Ia;!function(e){e.FREE="free",e.UPLOADING="uploading"}(kk||(kk={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied"}(Ia||(Ia={})),K({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),K({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var Mo=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))},No=Ka((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},t.decode=function(e,t,n){for(var i,o=n,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&1<a)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));Jd.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},Jd.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},Jd.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var Oo=sh(sh),Po=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},Qo=Ka((function(e,t){t.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)128>(n=e.charCodeAt(r))?t+=1:2048>n?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],a=0;t<n;)128>(r=e[t++])?o[a++]=r:191<r&&224>r?o[a++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)128>(r=e.charCodeAt(a))?t[n++]=r:2048>r?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}})),Ro=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){return 1>n||n>i?e(n):(a+n>r&&(o=e(r),a=0),n=t.call(o,a,a+=n),7&a&&(a=1+(7|a)),n)}},oc=za.zero=new za(0,0);oc.toNumber=function(){return 0},oc.zzEncode=oc.zzDecode=function(){return this},oc.length=function(){return 1};var So=za.zeroHash="\0\0\0\0\0\0\0\0";za.fromNumber=function(e){if(0===e)return oc;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new za(n,e)},za.from=function(e){if("number"==typeof e)return za.fromNumber(e);if(N.isString(e)){if(!N.Long)return za.fromNumber(parseInt(e,10));e=N.Long.fromString(e)}return e.low||e.high?new za(e.low>>>0,e.high>>>0):oc},za.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},za.prototype.toLong=function(e){return N.Long?new N.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var Yb=String.prototype.charCodeAt;za.fromHash=function(e){return e===So?oc:new za((Yb.call(e,0)|Yb.call(e,1)<<8|Yb.call(e,2)<<16|Yb.call(e,3)<<24)>>>0,(Yb.call(e,4)|Yb.call(e,5)<<8|Yb.call(e,6)<<16|Yb.call(e,7)<<24)>>>0)},za.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},za.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},za.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},za.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var N=Ka((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=Mo,t.base64=No,t.EventEmitter=Jd,t.float=Oo,t.inquire=Po,t.utf8=Qo,t.pool=Ro,t.LongBits=za,t.isNode=!!(void 0!==Lb&&Lb&&Lb.process&&Lb.process.versions&&Lb.process.versions.node),t.global=t.isNode&&Lb||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Lb,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),Pe=Z,bg,qe=N.LongBits,lk=N.base64,mk=N.utf8,nk=function(){return N.Buffer?function(){return(Z.create=function(){return new bg})()}:function(){return new Z}};Z.create=nk(),Z.alloc=function(e){return new N.Array(e)},N.Array!==Array&&(Z.alloc=N.pool(Z.alloc,N.Array.prototype.subarray)),Z.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Vc(e,t,n),this.len+=t,this},Me.prototype=Object.create(Vc.prototype),Me.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},Z.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Me(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},Z.prototype.int32=function(e){return 0>e?this._push(Ne,10,qe.fromNumber(e)):this.uint32(e)},Z.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Z.prototype.uint64=function(e){return e=qe.from(e),this._push(Ne,e.length(),e)},Z.prototype.int64=Z.prototype.uint64,Z.prototype.sint64=function(e){return e=qe.from(e).zzEncode(),this._push(Ne,e.length(),e)},Z.prototype.bool=function(e){return this._push(Le,1,e?1:0)},Z.prototype.fixed32=function(e){return this._push(Oe,4,e>>>0)},Z.prototype.sfixed32=Z.prototype.fixed32,Z.prototype.fixed64=function(e){return e=qe.from(e),this._push(Oe,4,e.lo)._push(Oe,4,e.hi)},Z.prototype.sfixed64=Z.prototype.fixed64,Z.prototype.float=function(e){return this._push(N.float.writeFloatLE,4,e)},Z.prototype.double=function(e){return this._push(N.float.writeDoubleLE,8,e)};var To=N.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Z.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Le,1,0);if(N.isString(e)){var n=Z.alloc(t=lk.length(e));lk.decode(e,n,0),e=n}return this.uint32(t)._push(To,t,e)},Z.prototype.string=function(e){var t=mk.length(e);return t?this.uint32(t)._push(mk.write,t,e):this._push(Le,1,0)},Z.prototype.fork=function(){return this.states=new ql(this),this.head=this.tail=new Vc(Ke,0,0),this.len=0,this},Z.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Vc(Ke,0,0),this.len=0),this},Z.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Z.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Z._configure=function(e){bg=e,Z.create=nk(),bg._configure()},(yb.prototype=Object.create(Pe.prototype)).constructor=yb,yb._configure=function(){yb.alloc=N._Buffer_allocUnsafe,yb.writeBytesBuffer=N.Buffer&&N.Buffer.prototype instanceof Uint8Array&&"set"===N.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},yb.prototype.bytes=function(e){N.isString(e)&&(e=N._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(yb.writeBytesBuffer,t,e),this},yb.prototype.string=function(e){var t=N.Buffer.byteLength(e);return this.uint32(t),t&&this._push(rl,t,e),this},yb._configure();var Re=ra,cg,xh=N.LongBits,Uo=N.utf8,ok="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ra(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ra(e);throw Error("illegal buffer")},pk=function(){return N.Buffer?function(e){return(ra.create=function(e){return N.Buffer.isBuffer(e)?new cg(e):ok(e)})(e)}:ok},fb;ra.create=pk(),ra.prototype._slice=N.Array.prototype.subarray||N.Array.prototype.slice,ra.prototype.uint32=(fb=4294967295,function(){if(fb=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(fb=(fb|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(fb=(fb|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(fb=(fb|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(fb=(fb|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return fb;if((this.pos+=5)>this.len)throw this.pos=this.len,lb(this,10);return fb}),ra.prototype.int32=function(){return 0|this.uint32()},ra.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},ra.prototype.bool=function(){return 0!==this.uint32()},ra.prototype.fixed32=function(){if(this.pos+4>this.len)throw lb(this,4);return Kd(this.buf,this.pos+=4)},ra.prototype.sfixed32=function(){if(this.pos+4>this.len)throw lb(this,4);return 0|Kd(this.buf,this.pos+=4)},ra.prototype.float=function(){if(this.pos+4>this.len)throw lb(this,4);var e=N.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},ra.prototype.double=function(){if(this.pos+8>this.len)throw lb(this,4);var e=N.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},ra.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw lb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},ra.prototype.string=function(){var e=this.bytes();return Uo.read(e,0,e.length)},ra.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw lb(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw lb(this)}while(128&this.buf[this.pos++]);return this},ra.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},ra._configure=function(e){cg=e,ra.create=pk(),cg._configure();var t=N.Long?"toLong":"toNumber";N.merge(ra.prototype,{int64:function(){return Qe.call(this)[t](!1)},uint64:function(){return Qe.call(this)[t](!0)},sint64:function(){return Qe.call(this).zzDecode()[t](!1)},fixed64:function(){return yh.call(this)[t](!0)},sfixed64:function(){return yh.call(this)[t](!1)}})},(dc.prototype=Object.create(Re.prototype)).constructor=dc,dc._configure=function(){N.Buffer&&(dc.prototype._slice=N.Buffer.prototype.slice)},dc.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},dc._configure(),(Wc.prototype=Object.create(N.EventEmitter.prototype)).constructor=Wc,Wc.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return N.asPromise(e,a,t,n,r,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Wc.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var Vo=Ka((function(e,t){t.Service=Wc})),Wo={},Qb=Ka((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=Pe,r.BufferWriter=yb,r.Reader=Re,r.BufferReader=dc,r.util=N,r.rpc=Vo,r.roots=Wo,r.configure=n,n()})),Ja=Qb.Reader,re=Qb.Writer,p=Qb.util,ta=Qb.roots.default||(Qb.roots.default={}),Pc;ta.Events=(Pc={},Pc.Message=function(){function e(e){if(e)for(var t=V(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.msg=p.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=re.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(8).int64(e.id),null!=e.msg&&Object.hasOwnProperty.call(e,"msg")&&t.uint32(18).bytes(e.msg),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ja||(e=Ja.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new ta.Events.Message;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.id=e.int64();break;case 2:n.msg=e.bytes();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof Ja||(e=new Ja(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null==e.id||!e.hasOwnProperty("id")||p.isInteger(e.id)||e.id&&p.isInteger(e.id.low)&&p.isInteger(e.id.high)?null==e.msg||!e.hasOwnProperty("msg")||e.msg&&"number"==typeof e.msg.length||p.isString(e.msg)?null:"msg: buffer expected":"id: integer|Long expected"},e.fromObject=function(e){if(e instanceof ta.Events.Message)return e;var t=new ta.Events.Message;return null!=e.id&&(p.Long?(t.id=p.Long.fromValue(e.id)).unsigned=!1:"string"==typeof e.id?t.id=S(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new p.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber())),null!=e.msg&&("string"==typeof e.msg?p.base64.decode(e.msg,t.msg=p.newBuffer(p.base64.length(e.msg)),0):e.msg.length&&(t.msg=e.msg)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(p.Long){var r=new p.Long(0,0,!1);n.id=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.id=t.longs===String?"0":0;t.bytes===String?n.msg="":(n.msg=[],t.bytes!==Array&&(n.msg=p.newBuffer(n.msg)))}return null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?n.id=t.longs===String?String(e.id):e.id:n.id=t.longs===String?p.Long.prototype.toString.call(e.id):t.longs===Number?new p.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber():e.id),null!=e.msg&&e.hasOwnProperty("msg")&&(n.msg=t.bytes===String?p.base64.encode(e.msg,0,e.msg.length):t.bytes===Array?wb(Array.prototype).call(e.msg):e.msg),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Qb.util.toJSONOptions)},e}(),Pc.ProtoRaws=function(){function e(e){if(this.payloads=[],e)for(var t=V(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sendTs=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.payloads=p.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=re.create()),null!=e.sendTs&&Object.hasOwnProperty.call(e,"sendTs")&&t.uint32(8).int64(e.sendTs),null!=e.payloads&&e.payloads.length)for(var n=0;n<e.payloads.length;++n)ta.Events.Message.encode(e.payloads[n],t.uint32(18).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ja||(e=Ja.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new ta.Events.ProtoRaws;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.sendTs=e.int64();break;case 2:n.payloads&&n.payloads.length||(n.payloads=[]),n.payloads.push(ta.Events.Message.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof Ja||(e=new Ja(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sendTs&&e.hasOwnProperty("sendTs")&&!(p.isInteger(e.sendTs)||e.sendTs&&p.isInteger(e.sendTs.low)&&p.isInteger(e.sendTs.high)))return"sendTs: integer|Long expected";if(null!=e.payloads&&e.hasOwnProperty("payloads")){if(!cc(e.payloads))return"payloads: array expected";for(var t=0;t<e.payloads.length;++t){var n=ta.Events.Message.verify(e.payloads[t]);if(n)return"payloads."+n}}return null},e.fromObject=function(e){if(e instanceof ta.Events.ProtoRaws)return e;var t=new ta.Events.ProtoRaws;if(null!=e.sendTs&&(p.Long?(t.sendTs=p.Long.fromValue(e.sendTs)).unsigned=!1:"string"==typeof e.sendTs?t.sendTs=S(e.sendTs,10):"number"==typeof e.sendTs?t.sendTs=e.sendTs:"object"==typeof e.sendTs&&(t.sendTs=new p.LongBits(e.sendTs.low>>>0,e.sendTs.high>>>0).toNumber())),e.payloads){if(!cc(e.payloads))throw TypeError(".Events.ProtoRaws.payloads: array expected");t.payloads=[];for(var n=0;n<e.payloads.length;++n){if("object"!=typeof e.payloads[n])throw TypeError(".Events.ProtoRaws.payloads: object expected");t.payloads[n]=ta.Events.Message.fromObject(e.payloads[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.payloads=[]),t.defaults)if(p.Long){var r=new p.Long(0,0,!1);n.sendTs=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sendTs=t.longs===String?"0":0;if(null!=e.sendTs&&e.hasOwnProperty("sendTs")&&("number"==typeof e.sendTs?n.sendTs=t.longs===String?String(e.sendTs):e.sendTs:n.sendTs=t.longs===String?p.Long.prototype.toString.call(e.sendTs):t.longs===Number?new p.LongBits(e.sendTs.low>>>0,e.sendTs.high>>>0).toNumber():e.sendTs),e.payloads&&e.payloads.length)for(n.payloads=[],r=0;r<e.payloads.length;++r)n.payloads[r]=ta.Events.Message.toObject(e.payloads[r],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Qb.util.toJSONOptions)},e}(),Pc.APWorkerEvent=function(){function e(e){if(e)for(var t=V(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.cname="",e.prototype.cid=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.lts=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.ip="",e.prototype.uid=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.success=!1,e.prototype.elapse=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.peer=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.serverIp="",e.prototype.firstSuccess=!1,e.prototype.responseTime=0,e.prototype.serviceName="",e.prototype.responseDetail="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=re.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(18).string(e.cname),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(24).int64(e.cid),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(32).int64(e.lts),null!=e.ip&&Object.hasOwnProperty.call(e,"ip")&&t.uint32(42).string(e.ip),null!=e.uid&&Object.hasOwnProperty.call(e,"uid")&&t.uint32(48).int64(e.uid),null!=e.success&&Object.hasOwnProperty.call(e,"success")&&t.uint32(56).bool(e.success),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(64).int64(e.elapse),null!=e.peer&&Object.hasOwnProperty.call(e,"peer")&&t.uint32(72).int64(e.peer),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(80).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(88).int32(e.sc),null!=e.serverIp&&Object.hasOwnProperty.call(e,"serverIp")&&t.uint32(98).string(e.serverIp),null!=e.firstSuccess&&Object.hasOwnProperty.call(e,"firstSuccess")&&t.uint32(104).bool(e.firstSuccess),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(112).int32(e.responseTime),null!=e.serviceName&&Object.hasOwnProperty.call(e,"serviceName")&&t.uint32(122).string(e.serviceName),null!=e.responseDetail&&Object.hasOwnProperty.call(e,"responseDetail")&&t.uint32(130).string(e.responseDetail),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ja||(e=Ja.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new ta.Events.APWorkerEvent;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.sid=e.string();break;case 2:n.cname=e.string();break;case 3:n.cid=e.int64();break;case 4:n.lts=e.int64();break;case 5:n.ip=e.string();break;case 6:n.uid=e.int64();break;case 7:n.success=e.bool();break;case 8:n.elapse=e.int64();break;case 9:n.peer=e.int64();break;case 10:n.ec=e.int32();break;case 11:n.sc=e.int32();break;case 12:n.serverIp=e.string();break;case 13:n.firstSuccess=e.bool();break;case 14:n.responseTime=e.int32();break;case 15:n.serviceName=e.string();break;case 16:n.responseDetail=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof Ja||(e=new Ja(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sid&&e.hasOwnProperty("sid")&&!p.isString(e.sid)?"sid: string expected":null!=e.cname&&e.hasOwnProperty("cname")&&!p.isString(e.cname)?"cname: string expected":null==e.cid||!e.hasOwnProperty("cid")||p.isInteger(e.cid)||e.cid&&p.isInteger(e.cid.low)&&p.isInteger(e.cid.high)?null==e.lts||!e.hasOwnProperty("lts")||p.isInteger(e.lts)||e.lts&&p.isInteger(e.lts.low)&&p.isInteger(e.lts.high)?null!=e.ip&&e.hasOwnProperty("ip")&&!p.isString(e.ip)?"ip: string expected":null==e.uid||!e.hasOwnProperty("uid")||p.isInteger(e.uid)||e.uid&&p.isInteger(e.uid.low)&&p.isInteger(e.uid.high)?null!=e.success&&e.hasOwnProperty("success")&&"boolean"!=typeof e.success?"success: boolean expected":null==e.elapse||!e.hasOwnProperty("elapse")||p.isInteger(e.elapse)||e.elapse&&p.isInteger(e.elapse.low)&&p.isInteger(e.elapse.high)?null==e.peer||!e.hasOwnProperty("peer")||p.isInteger(e.peer)||e.peer&&p.isInteger(e.peer.low)&&p.isInteger(e.peer.high)?null!=e.ec&&e.hasOwnProperty("ec")&&!p.isInteger(e.ec)?"ec: integer expected":null!=e.sc&&e.hasOwnProperty("sc")&&!p.isInteger(e.sc)?"sc: integer expected":null!=e.serverIp&&e.hasOwnProperty("serverIp")&&!p.isString(e.serverIp)?"serverIp: string expected":null!=e.firstSuccess&&e.hasOwnProperty("firstSuccess")&&"boolean"!=typeof e.firstSuccess?"firstSuccess: boolean expected":null!=e.responseTime&&e.hasOwnProperty("responseTime")&&!p.isInteger(e.responseTime)?"responseTime: integer expected":null!=e.serviceName&&e.hasOwnProperty("serviceName")&&!p.isString(e.serviceName)?"serviceName: string expected":null!=e.responseDetail&&e.hasOwnProperty("responseDetail")&&!p.isString(e.responseDetail)?"responseDetail: string expected":null:"peer: integer|Long expected":"elapse: integer|Long expected":"uid: integer|Long expected":"lts: integer|Long expected":"cid: integer|Long expected"},e.fromObject=function(e){if(e instanceof ta.Events.APWorkerEvent)return e;var t=new ta.Events.APWorkerEvent;return null!=e.sid&&(t.sid=String(e.sid)),null!=e.cname&&(t.cname=String(e.cname)),null!=e.cid&&(p.Long?(t.cid=p.Long.fromValue(e.cid)).unsigned=!1:"string"==typeof e.cid?t.cid=S(e.cid,10):"number"==typeof e.cid?t.cid=e.cid:"object"==typeof e.cid&&(t.cid=new p.LongBits(e.cid.low>>>0,e.cid.high>>>0).toNumber())),null!=e.lts&&(p.Long?(t.lts=p.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=S(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==typeof e.lts&&(t.lts=new p.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.ip&&(t.ip=String(e.ip)),null!=e.uid&&(p.Long?(t.uid=p.Long.fromValue(e.uid)).unsigned=!1:"string"==typeof e.uid?t.uid=S(e.uid,10):"number"==typeof e.uid?t.uid=e.uid:"object"==typeof e.uid&&(t.uid=new p.LongBits(e.uid.low>>>0,e.uid.high>>>0).toNumber())),null!=e.success&&(t.success=!!e.success),null!=e.elapse&&(p.Long?(t.elapse=p.Long.fromValue(e.elapse)).unsigned=!1:"string"==typeof e.elapse?t.elapse=S(e.elapse,10):"number"==typeof e.elapse?t.elapse=e.elapse:"object"==typeof e.elapse&&(t.elapse=new p.LongBits(e.elapse.low>>>0,e.elapse.high>>>0).toNumber())),null!=e.peer&&(p.Long?(t.peer=p.Long.fromValue(e.peer)).unsigned=!1:"string"==typeof e.peer?t.peer=S(e.peer,10):"number"==typeof e.peer?t.peer=e.peer:"object"==typeof e.peer&&(t.peer=new p.LongBits(e.peer.low>>>0,e.peer.high>>>0).toNumber())),null!=e.ec&&(t.ec=0|e.ec),null!=e.sc&&(t.sc=0|e.sc),null!=e.serverIp&&(t.serverIp=String(e.serverIp)),null!=e.firstSuccess&&(t.firstSuccess=!!e.firstSuccess),null!=e.responseTime&&(t.responseTime=0|e.responseTime),null!=e.serviceName&&(t.serviceName=String(e.serviceName)),null!=e.responseDetail&&(t.responseDetail=String(e.responseDetail)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.sid="",n.cname="",p.Long){var r=new p.Long(0,0,!1);n.cid=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.cid=t.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.lts=t.longs===String?"0":0,n.ip="",p.Long?(r=new p.Long(0,0,!1),n.uid=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.uid=t.longs===String?"0":0,n.success=!1,p.Long?(r=new p.Long(0,0,!1),n.elapse=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.elapse=t.longs===String?"0":0,p.Long?(r=new p.Long(0,0,!1),n.peer=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.peer=t.longs===String?"0":0,n.ec=0,n.sc=0,n.serverIp="",n.firstSuccess=!1,n.responseTime=0,n.serviceName="",n.responseDetail=""}return null!=e.sid&&e.hasOwnProperty("sid")&&(n.sid=e.sid),null!=e.cname&&e.hasOwnProperty("cname")&&(n.cname=e.cname),null!=e.cid&&e.hasOwnProperty("cid")&&("number"==typeof e.cid?n.cid=t.longs===String?String(e.cid):e.cid:n.cid=t.longs===String?p.Long.prototype.toString.call(e.cid):t.longs===Number?new p.LongBits(e.cid.low>>>0,e.cid.high>>>0).toNumber():e.cid),null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?p.Long.prototype.toString.call(e.lts):t.longs===Number?new p.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.ip&&e.hasOwnProperty("ip")&&(n.ip=e.ip),null!=e.uid&&e.hasOwnProperty("uid")&&("number"==typeof e.uid?n.uid=t.longs===String?String(e.uid):e.uid:n.uid=t.longs===String?p.Long.prototype.toString.call(e.uid):t.longs===Number?new p.LongBits(e.uid.low>>>0,e.uid.high>>>0).toNumber():e.uid),null!=e.success&&e.hasOwnProperty("success")&&(n.success=e.success),null!=e.elapse&&e.hasOwnProperty("elapse")&&("number"==typeof e.elapse?n.elapse=t.longs===String?String(e.elapse):e.elapse:n.elapse=t.longs===String?p.Long.prototype.toString.call(e.elapse):t.longs===Number?new p.LongBits(e.elapse.low>>>0,e.elapse.high>>>0).toNumber():e.elapse),null!=e.peer&&e.hasOwnProperty("peer")&&("number"==typeof e.peer?n.peer=t.longs===String?String(e.peer):e.peer:n.peer=t.longs===String?p.Long.prototype.toString.call(e.peer):t.longs===Number?new p.LongBits(e.peer.low>>>0,e.peer.high>>>0).toNumber():e.peer),null!=e.ec&&e.hasOwnProperty("ec")&&(n.ec=e.ec),null!=e.sc&&e.hasOwnProperty("sc")&&(n.sc=e.sc),null!=e.serverIp&&e.hasOwnProperty("serverIp")&&(n.serverIp=e.serverIp),null!=e.firstSuccess&&e.hasOwnProperty("firstSuccess")&&(n.firstSuccess=e.firstSuccess),null!=e.responseTime&&e.hasOwnProperty("responseTime")&&(n.responseTime=e.responseTime),null!=e.serviceName&&e.hasOwnProperty("serviceName")&&(n.serviceName=e.serviceName),null!=e.responseDetail&&e.hasOwnProperty("responseDetail")&&(n.responseDetail=e.responseDetail),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Qb.util.toJSONOptions)},e}(),Pc.WorkerEvent=function(){function e(e){if(e)for(var t=V(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.cname="",e.prototype.cid=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.lts=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.ip="",e.prototype.uid=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.success=!1,e.prototype.elapse=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.peer=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.command="",e.prototype.actionType="",e.prototype.url="",e.prototype.payload="",e.prototype.serverCode=0,e.prototype.code=0,e.prototype.traceId="",e.prototype.workerType=0,e.prototype.responseTime=0,e.prototype.requestId=p.Long?p.Long.fromBits(0,0,!1):0,e.prototype.packIndex=0,e.prototype.requestByUser=!1,e.prototype.tid="",e.prototype.productType="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=re.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(18).string(e.cname),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(24).int64(e.cid),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(32).int64(e.lts),null!=e.ip&&Object.hasOwnProperty.call(e,"ip")&&t.uint32(42).string(e.ip),null!=e.uid&&Object.hasOwnProperty.call(e,"uid")&&t.uint32(48).int64(e.uid),null!=e.success&&Object.hasOwnProperty.call(e,"success")&&t.uint32(56).bool(e.success),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(64).int64(e.elapse),null!=e.peer&&Object.hasOwnProperty.call(e,"peer")&&t.uint32(72).int64(e.peer),null!=e.command&&Object.hasOwnProperty.call(e,"command")&&t.uint32(82).string(e.command),null!=e.actionType&&Object.hasOwnProperty.call(e,"actionType")&&t.uint32(90).string(e.actionType),null!=e.url&&Object.hasOwnProperty.call(e,"url")&&t.uint32(98).string(e.url),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(106).string(e.payload),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(112).int32(e.serverCode),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(120).int32(e.code),null!=e.traceId&&Object.hasOwnProperty.call(e,"traceId")&&t.uint32(130).string(e.traceId),null!=e.workerType&&Object.hasOwnProperty.call(e,"workerType")&&t.uint32(136).int32(e.workerType),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(144).int32(e.responseTime),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&t.uint32(152).int64(e.requestId),null!=e.packIndex&&Object.hasOwnProperty.call(e,"packIndex")&&t.uint32(160).int32(e.packIndex),null!=e.requestByUser&&Object.hasOwnProperty.call(e,"requestByUser")&&t.uint32(168).bool(e.requestByUser),null!=e.tid&&Object.hasOwnProperty.call(e,"tid")&&t.uint32(178).string(e.tid),null!=e.productType&&Object.hasOwnProperty.call(e,"productType")&&t.uint32(186).string(e.productType),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ja||(e=Ja.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new ta.Events.WorkerEvent;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.sid=e.string();break;case 2:n.cname=e.string();break;case 3:n.cid=e.int64();break;case 4:n.lts=e.int64();break;case 5:n.ip=e.string();break;case 6:n.uid=e.int64();break;case 7:n.success=e.bool();break;case 8:n.elapse=e.int64();break;case 9:n.peer=e.int64();break;case 10:n.command=e.string();break;case 11:n.actionType=e.string();break;case 12:n.url=e.string();break;case 13:n.payload=e.string();break;case 14:n.serverCode=e.int32();break;case 15:n.code=e.int32();break;case 16:n.traceId=e.string();break;case 17:n.workerType=e.int32();break;case 18:n.responseTime=e.int32();break;case 19:n.requestId=e.int64();break;case 20:n.packIndex=e.int32();break;case 21:n.requestByUser=e.bool();break;case 22:n.tid=e.string();break;case 23:n.productType=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof Ja||(e=new Ja(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sid&&e.hasOwnProperty("sid")&&!p.isString(e.sid)?"sid: string expected":null!=e.cname&&e.hasOwnProperty("cname")&&!p.isString(e.cname)?"cname: string expected":null==e.cid||!e.hasOwnProperty("cid")||p.isInteger(e.cid)||e.cid&&p.isInteger(e.cid.low)&&p.isInteger(e.cid.high)?null==e.lts||!e.hasOwnProperty("lts")||p.isInteger(e.lts)||e.lts&&p.isInteger(e.lts.low)&&p.isInteger(e.lts.high)?null!=e.ip&&e.hasOwnProperty("ip")&&!p.isString(e.ip)?"ip: string expected":null==e.uid||!e.hasOwnProperty("uid")||p.isInteger(e.uid)||e.uid&&p.isInteger(e.uid.low)&&p.isInteger(e.uid.high)?null!=e.success&&e.hasOwnProperty("success")&&"boolean"!=typeof e.success?"success: boolean expected":null==e.elapse||!e.hasOwnProperty("elapse")||p.isInteger(e.elapse)||e.elapse&&p.isInteger(e.elapse.low)&&p.isInteger(e.elapse.high)?null==e.peer||!e.hasOwnProperty("peer")||p.isInteger(e.peer)||e.peer&&p.isInteger(e.peer.low)&&p.isInteger(e.peer.high)?null!=e.command&&e.hasOwnProperty("command")&&!p.isString(e.command)?"command: string expected":null!=e.actionType&&e.hasOwnProperty("actionType")&&!p.isString(e.actionType)?"actionType: string expected":null!=e.url&&e.hasOwnProperty("url")&&!p.isString(e.url)?"url: string expected":null!=e.payload&&e.hasOwnProperty("payload")&&!p.isString(e.payload)?"payload: string expected":null!=e.serverCode&&e.hasOwnProperty("serverCode")&&!p.isInteger(e.serverCode)?"serverCode: integer expected":null!=e.code&&e.hasOwnProperty("code")&&!p.isInteger(e.code)?"code: integer expected":null!=e.traceId&&e.hasOwnProperty("traceId")&&!p.isString(e.traceId)?"traceId: string expected":null!=e.workerType&&e.hasOwnProperty("workerType")&&!p.isInteger(e.workerType)?"workerType: integer expected":null!=e.responseTime&&e.hasOwnProperty("responseTime")&&!p.isInteger(e.responseTime)?"responseTime: integer expected":null==e.requestId||!e.hasOwnProperty("requestId")||p.isInteger(e.requestId)||e.requestId&&p.isInteger(e.requestId.low)&&p.isInteger(e.requestId.high)?null!=e.packIndex&&e.hasOwnProperty("packIndex")&&!p.isInteger(e.packIndex)?"packIndex: integer expected":null!=e.requestByUser&&e.hasOwnProperty("requestByUser")&&"boolean"!=typeof e.requestByUser?"requestByUser: boolean expected":null!=e.tid&&e.hasOwnProperty("tid")&&!p.isString(e.tid)?"tid: string expected":null!=e.productType&&e.hasOwnProperty("productType")&&!p.isString(e.productType)?"productType: string expected":null:"requestId: integer|Long expected":"peer: integer|Long expected":"elapse: integer|Long expected":"uid: integer|Long expected":"lts: integer|Long expected":"cid: integer|Long expected"},e.fromObject=function(e){if(e instanceof ta.Events.WorkerEvent)return e;var t=new ta.Events.WorkerEvent;return null!=e.sid&&(t.sid=String(e.sid)),null!=e.cname&&(t.cname=String(e.cname)),null!=e.cid&&(p.Long?(t.cid=p.Long.fromValue(e.cid)).unsigned=!1:"string"==typeof e.cid?t.cid=S(e.cid,10):"number"==typeof e.cid?t.cid=e.cid:"object"==typeof e.cid&&(t.cid=new p.LongBits(e.cid.low>>>0,e.cid.high>>>0).toNumber())),null!=e.lts&&(p.Long?(t.lts=p.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=S(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==typeof e.lts&&(t.lts=new p.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.ip&&(t.ip=String(e.ip)),null!=e.uid&&(p.Long?(t.uid=p.Long.fromValue(e.uid)).unsigned=!1:"string"==typeof e.uid?t.uid=S(e.uid,10):"number"==typeof e.uid?t.uid=e.uid:"object"==typeof e.uid&&(t.uid=new p.LongBits(e.uid.low>>>0,e.uid.high>>>0).toNumber())),null!=e.success&&(t.success=!!e.success),null!=e.elapse&&(p.Long?(t.elapse=p.Long.fromValue(e.elapse)).unsigned=!1:"string"==typeof e.elapse?t.elapse=S(e.elapse,10):"number"==typeof e.elapse?t.elapse=e.elapse:"object"==typeof e.elapse&&(t.elapse=new p.LongBits(e.elapse.low>>>0,e.elapse.high>>>0).toNumber())),null!=e.peer&&(p.Long?(t.peer=p.Long.fromValue(e.peer)).unsigned=!1:"string"==typeof e.peer?t.peer=S(e.peer,10):"number"==typeof e.peer?t.peer=e.peer:"object"==typeof e.peer&&(t.peer=new p.LongBits(e.peer.low>>>0,e.peer.high>>>0).toNumber())),null!=e.command&&(t.command=String(e.command)),null!=e.actionType&&(t.actionType=String(e.actionType)),null!=e.url&&(t.url=String(e.url)),null!=e.payload&&(t.payload=String(e.payload)),null!=e.serverCode&&(t.serverCode=0|e.serverCode),null!=e.code&&(t.code=0|e.code),null!=e.traceId&&(t.traceId=String(e.traceId)),null!=e.workerType&&(t.workerType=0|e.workerType),null!=e.responseTime&&(t.responseTime=0|e.responseTime),null!=e.requestId&&(p.Long?(t.requestId=p.Long.fromValue(e.requestId)).unsigned=!1:"string"==typeof e.requestId?t.requestId=S(e.requestId,10):"number"==typeof e.requestId?t.requestId=e.requestId:"object"==typeof e.requestId&&(t.requestId=new p.LongBits(e.requestId.low>>>0,e.requestId.high>>>0).toNumber())),null!=e.packIndex&&(t.packIndex=0|e.packIndex),null!=e.requestByUser&&(t.requestByUser=!!e.requestByUser),null!=e.tid&&(t.tid=String(e.tid)),null!=e.productType&&(t.productType=String(e.productType)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.sid="",n.cname="",p.Long){var r=new p.Long(0,0,!1);n.cid=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.cid=t.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.lts=t.longs===String?"0":0,n.ip="",p.Long?(r=new p.Long(0,0,!1),n.uid=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.uid=t.longs===String?"0":0,n.success=!1,p.Long?(r=new p.Long(0,0,!1),n.elapse=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.elapse=t.longs===String?"0":0,p.Long?(r=new p.Long(0,0,!1),n.peer=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.peer=t.longs===String?"0":0,n.command="",n.actionType="",n.url="",n.payload="",n.serverCode=0,n.code=0,n.traceId="",n.workerType=0,n.responseTime=0,p.Long?(r=new p.Long(0,0,!1),n.requestId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.requestId=t.longs===String?"0":0,n.packIndex=0,n.requestByUser=!1,n.tid="",n.productType=""}return null!=e.sid&&e.hasOwnProperty("sid")&&(n.sid=e.sid),null!=e.cname&&e.hasOwnProperty("cname")&&(n.cname=e.cname),null!=e.cid&&e.hasOwnProperty("cid")&&("number"==typeof e.cid?n.cid=t.longs===String?String(e.cid):e.cid:n.cid=t.longs===String?p.Long.prototype.toString.call(e.cid):t.longs===Number?new p.LongBits(e.cid.low>>>0,e.cid.high>>>0).toNumber():e.cid),null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?p.Long.prototype.toString.call(e.lts):t.longs===Number?new p.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.ip&&e.hasOwnProperty("ip")&&(n.ip=e.ip),null!=e.uid&&e.hasOwnProperty("uid")&&("number"==typeof e.uid?n.uid=t.longs===String?String(e.uid):e.uid:n.uid=t.longs===String?p.Long.prototype.toString.call(e.uid):t.longs===Number?new p.LongBits(e.uid.low>>>0,e.uid.high>>>0).toNumber():e.uid),null!=e.success&&e.hasOwnProperty("success")&&(n.success=e.success),null!=e.elapse&&e.hasOwnProperty("elapse")&&("number"==typeof e.elapse?n.elapse=t.longs===String?String(e.elapse):e.elapse:n.elapse=t.longs===String?p.Long.prototype.toString.call(e.elapse):t.longs===Number?new p.LongBits(e.elapse.low>>>0,e.elapse.high>>>0).toNumber():e.elapse),null!=e.peer&&e.hasOwnProperty("peer")&&("number"==typeof e.peer?n.peer=t.longs===String?String(e.peer):e.peer:n.peer=t.longs===String?p.Long.prototype.toString.call(e.peer):t.longs===Number?new p.LongBits(e.peer.low>>>0,e.peer.high>>>0).toNumber():e.peer),null!=e.command&&e.hasOwnProperty("command")&&(n.command=e.command),null!=e.actionType&&e.hasOwnProperty("actionType")&&(n.actionType=e.actionType),null!=e.url&&e.hasOwnProperty("url")&&(n.url=e.url),null!=e.payload&&e.hasOwnProperty("payload")&&(n.payload=e.payload),null!=e.serverCode&&e.hasOwnProperty("serverCode")&&(n.serverCode=e.serverCode),null!=e.code&&e.hasOwnProperty("code")&&(n.code=e.code),null!=e.traceId&&e.hasOwnProperty("traceId")&&(n.traceId=e.traceId),null!=e.workerType&&e.hasOwnProperty("workerType")&&(n.workerType=e.workerType),null!=e.responseTime&&e.hasOwnProperty("responseTime")&&(n.responseTime=e.responseTime),null!=e.requestId&&e.hasOwnProperty("requestId")&&("number"==typeof e.requestId?n.requestId=t.longs===String?String(e.requestId):e.requestId:n.requestId=t.longs===String?p.Long.prototype.toString.call(e.requestId):t.longs===Number?new p.LongBits(e.requestId.low>>>0,e.requestId.high>>>0).toNumber():e.requestId),null!=e.packIndex&&e.hasOwnProperty("packIndex")&&(n.packIndex=e.packIndex),null!=e.requestByUser&&e.hasOwnProperty("requestByUser")&&(n.requestByUser=e.requestByUser),null!=e.tid&&e.hasOwnProperty("tid")&&(n.tid=e.tid),null!=e.productType&&e.hasOwnProperty("productType")&&(n.productType=e.productType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Qb.util.toJSONOptions)},e}(),Pc);let Xo={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Ba,pa,qk,a;a=Ba||(Ba={}),a.PUBLISH="publish",a.SUBSCRIBE="subscribe",a.SESSION_INIT="session_init",a.JOIN_CHOOSE_SERVER="join_choose_server",a.REQ_USER_ACCOUNT="req_user_account",a.JOIN_GATEWAY="join_gateway",a.STREAM_SWITCH="stream_switch",a.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",a.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",a.FIRST_VIDEO_RECEIVED="first_video_received",a.FIRST_AUDIO_RECEIVED="first_audio_received",a.FIRST_VIDEO_DECODE="first_video_decode",a.FIRST_AUDIO_DECODE="first_audio_decode",a.ON_ADD_AUDIO_STREAM="on_add_audio_stream",a.ON_ADD_VIDEO_STREAM="on_add_video_stream",a.ON_UPDATE_STREAM="on_update_stream",a.ON_REMOVE_STREAM="on_remove_stream",a.USER_ANALYTICS="req_user_analytics",function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(pa||(pa={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(qk||(qk={}));let Yo=e=>{const t=V(ta.Events);return!!La(t).call(t,e.type)};var A,z,pc,Rb,Ac,sd,rb,Ca,B,O,ua,P,ha,sb,X,G,gb;!function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.STREAM_TYPE_CHANGE="streamTypeChange"}(A||(A={})),(z||(z={})).TRACER="tracer",function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(pc||(pc={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Rb||(Rb={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ac||(Ac={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(sd||(sd={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY"}(rb||(rb={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS"}(Ca||(Ca={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(B||(B={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error"}(O||(O={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(ua||(ua={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway"}(P||(P={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v2",e.REJOIN="rejoin",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata"}(ha||(ha={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats"}(sb||(sb={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.RECEIVE_METADATA="receive_metadata",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio"}(X||(X={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(G||(G={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer"}(gb||(gb={}));let se={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0},te={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0},dg={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1},eg={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1};var Q,ma;!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"}(Q||(Q={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(ma||(ma={}));let Zo={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},fg={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},$o={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},ap={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var hb,Qc,ka,rk,Da,Ea,L,ib,td,ue;!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(hb||(hb={})),(Qc||(Qc={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(ka||(ka={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(rk||(rk={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Da||(Da={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid"}(Ea||(Ea={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ADD_TRACK="@need_add_track",e.NEED_REMOVE_TRACK="@need_remove_track",e.NEED_SESSION_ID="@need_sid",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track"}(L||(L={})),function(e){e.SCREEN_TRACK="screen_track",e.LOW_STREAM="low_stream"}(ib||(ib={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(td||(td={})),(ue||(ue={})).FIRST_FRAME_DECODED="first-frame-decoded",K({target:"Object",stat:!0,forced:!la,sham:!la},{defineProperties:Ji});var Qa=Ka((function(e){var t=fa.Object;e=e.exports=function(e,n){return t.defineProperties(e,n)},t.defineProperties.sham&&(e.sham=!0)})),bp=ae.concat("length","prototype"),gg={f:Object.getOwnPropertyNames||function(e){return Ii(e,bp)}},cp=Mb("Reflect","ownKeys")||function(e){var t=gg.f(Oa(e)),n=kd.f;return n?t.concat(n(e)):t};K({target:"Object",stat:!0,sham:!la},{getOwnPropertyDescriptors:function(e){var t,n;e=db(e);for(var r=Fc,i=cp(e),o={},a=0;i.length>a;)void 0!==(n=r(e,t=i[a++]))&&mc(o,t,n);return o}});var ja=fa.Object.getOwnPropertyDescriptors,sk=gg.f,dp={}.toString,tk="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],uk=function(e){if(tk&&"[object Window]"==dp.call(e))try{var t=sk(e)}catch(e){t=tk.slice()}else t=sk(db(e));return t},vk={f:sa},ep=eb.f,Sa=Yd("hidden"),wk=sa("toPrimitive"),fp=ab.set,xk=ab.getterFor("Symbol"),tb=Object.prototype,Ta=J.Symbol,ud=Mb("JSON","stringify"),yk=Fc,Zb=eb.f,zk=uk,gp=Qd,Sb=Nb("symbols"),vd=Nb("op-symbols"),hg=Nb("string-to-symbol-registry"),ig=Nb("symbol-to-string-registry"),hp=Nb("wks"),jg=J.QObject,kg=!jg||!jg.prototype||!jg.prototype.findChild,lg=la&&oa((function(){return 7!=lc(Zb({},"a",{get:function(){return Zb(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=yk(tb,t);r&&delete tb[t],Zb(e,t,n),r&&e!==tb&&Zb(tb,t,r)}:Zb,Ak=function(e,t){var n=Sb[e]=lc(Ta.prototype);return fp(n,{type:"Symbol",tag:e,description:t}),la||(n.description=t),n},mg=Fb&&"symbol"==typeof Ta.iterator?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Ta},ve=function(e,t,n){return e===tb&&ve(vd,t,n),Oa(e),t=Dc(t,!0),Oa(n),U(Sb,t)?(n.enumerable?(U(e,Sa)&&e[Sa][t]&&(e[Sa][t]=!1),n=lc(n,{enumerable:gc(0,!1)})):(U(e,Sa)||Zb(e,Sa,gc(1,{})),e[Sa][t]=!0),lg(e,t,n)):Zb(e,t,n)},Ck=function(e,t){Oa(e);var n=db(t);return t=Xb(n).concat(ng(n)),Ic(t,(function(t){la&&!Bk.call(n,t)||ve(e,t,n[t])})),e},Bk=function(e){e=Dc(e,!0);var t=gp.call(this,e);return!(this===tb&&U(Sb,e)&&!U(vd,e))&&(!(t||!U(this,e)||!U(Sb,e)||U(this,Sa)&&this[Sa][e])||t)},Dk=function(e,t){if(e=db(e),t=Dc(t,!0),e!==tb||!U(Sb,t)||U(vd,t)){var n=yk(e,t);return!n||!U(Sb,t)||U(e,Sa)&&e[Sa][t]||(n.enumerable=!0),n}},Ek=function(e){e=zk(db(e));var t=[];return Ic(e,(function(e){U(Sb,e)||U(Hc,e)||t.push(e)})),t},ng=function(e){var t=e===tb;e=zk(t?vd:db(e));var n=[];return Ic(e,(function(e){!U(Sb,e)||t&&!U(tb,e)||n.push(Sb[e])})),n};if(Fb||(Ta=function(){if(this instanceof Ta)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ud(e),n=function(e){this===tb&&n.call(vd,e),U(this,Sa)&&U(this[Sa],t)&&(this[Sa][t]=!1),lg(this,t,gc(1,e))};return la&&kg&&lg(tb,t,{configurable:!0,set:n}),Ak(t,e)},vf(Ta.prototype,"toString",(function(){return xk(this).tag})),Qd=Bk,eb.f=ve,Fc=Dk,gg.f=uk=Ek,kd.f=ng,la&&Zb(Ta.prototype,"description",{configurable:!0,get:function(){return xk(this).description}})),yi||(vk.f=function(e){return Ak(sa(e),e)}),K({global:!0,wrap:!0,forced:!Fb,sham:!Fb},{Symbol:Ta}),Ic(Xb(hp),(function(e){var t=fa.Symbol||(fa.Symbol={});U(t,e)||ep(t,e,{value:vk.f(e)})})),K({target:"Symbol",stat:!0,forced:!Fb},{for:function(e){if(e=String(e),U(hg,e))return hg[e];var t=Ta(e);return hg[e]=t,ig[t]=e,t},keyFor:function(e){if(!mg(e))throw TypeError(e+" is not a symbol");if(U(ig,e))return ig[e]},useSetter:function(){kg=!0},useSimple:function(){kg=!1}}),K({target:"Object",stat:!0,forced:!Fb,sham:!la},{create:function(e,t){return void 0===t?lc(e):Ck(lc(e),t)},defineProperty:ve,defineProperties:Ck,getOwnPropertyDescriptor:Dk}),K({target:"Object",stat:!0,forced:!Fb},{getOwnPropertyNames:Ek,getOwnPropertySymbols:ng}),K({target:"Object",stat:!0,forced:oa((function(){kd.f(1)}))},{getOwnPropertySymbols:function(e){return kd.f(pb(e))}}),ud){var ip=!Fb||oa((function(){var e=Ta();return"[null]"!=ud([e])||"{}"!=ud({a:e})||"{}"!=ud(Object(e))}));K({target:"JSON",stat:!0,forced:ip},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(xa(t)||void 0!==e)&&!mg(e))return jc(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!mg(t))return t}),i[1]=t,ud.apply(null,i)}})}Ta.prototype[wk]||nb(Ta.prototype,wk,Ta.prototype.valueOf),hd(Ta,"Symbol"),Hc[Sa]=!0;var ia=fa.Object.getOwnPropertySymbols,Pa=function(e,t,n){return t in e?bj(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},jp=Aa("Array").values,Fk=Array.prototype,kp={DOMTokenList:!0,NodeList:!0},qc=function(e){var t=e.values;return e===Fk||e instanceof Array&&t===Fk.values||kp.hasOwnProperty(Xd(e))?jp:t},lp=!oj((function(e){Array.from(e)}));K({target:"Array",stat:!0,forced:lp},{from:function(e){var t=pb(e),n="function"==typeof this?this:Array,r=arguments.length,i=1<r?arguments[1]:void 0,o=void 0!==i,a=0,s=Bi(t);if(o&&(i=ic(i,2<r?arguments[2]:void 0,2)),null==s||n==Array&&zi(s))for(n=new n(r=ob(t.length));r>a;a++)mc(n,a,o?i(t[a],a):t[a]);else for(r=(t=s.call(t)).next,n=new n;!(s=r.call(t)).done;a++)mc(n,a,o?Ci(t,i,[s.value,a],!0):s.value);return n.length=a,n}});var Kb=fa.Array.from;K({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var v=fa.Date.now;class Ua{constructor(){this._events={},this.addListener=this.on}getListeners(e){var t;return this._events[e]?D(t=this._events[e]).call(t,e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]),e=this._events[e],-1===this._indexOfListener(e,t)&&e.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]),e=this._events[e],-1===this._indexOfListener(e,t)&&e.push({listener:t,once:!0})}off(e,t){if(this._events[e]){var n=this._events[e];-1!==(t=this._indexOfListener(n,t))&&Ma(n).call(n,t,1),0===this._events[e].length&&delete this._events[e]}}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e,...t){var n;this._events[e]||(this._events[e]=[]);let r=D(n=this._events[e]).call(n,e=>e);for(n=0;n<r.length;n+=1){let i=r[n];i.once&&this.off(e,i.listener),i.listener.apply(this,t||[])}}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}class mp extends Ua{constructor(){super(...arguments),this.resultStorage=new Y}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){e=e.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",e,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){e=e.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",e,this.checkVideoDecode(t))}record(e,t,n){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);var i;r&&(r.result.push(n),5<=r.result.length)&&(n=La(i=r.result).call(i,!0),r.isPrevNormal&&!n&&this.emit("exception",Gk[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",Gk[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[])}checkAudioOutputLevel(e){return!(0<e.receiveBitrate&&0===e.receiveLevel)}checkAudioInputLevel(e){return 0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;return t._encoderConfig&&t._encoderConfig.frameRate&&(n=zb(t._encoderConfig.frameRate)),e=e.captureFrameRate,!n||!e||!(10<n&&5>e||10>n&&5<=n&&1>=e)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&5<e.captureFrameRate&&1>=e.sendFrameRate)}checkSendVideoBitrate(e){return 0!==e.sendBitrate}checkSendAudioBitrate(e){return 0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let Gk={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class Yc{constructor(e){this.localConnectionsMap=new Y,this.remoteConnectionsMap=new Y,this.trafficStatsPeerList=[],this.updateStats=()=>{var e,t;r(e=this.remoteConnectionsMap).call(e,e=>{var t;let n=e.audioStats,r=e.videoStats;var i=e.pcStats;let o=Ub({},dg),a=Ub({},eg),s=e.connection.pc.getStats(),c=s.audioRecv[0],u=s.videoRecv[0];i=i?i.videoRecv[0]:void 0;let l=this.trafficStats&&R(t=this.trafficStats.peer_delay).call(t,t=>t.peer_uid===e.connection.getUserId());c&&("opus"!==c.codec&&"aac"!==c.codec||(o.codecType=c.codec),c.outputLevel?o.receiveLevel=Math.round(32767*c.outputLevel):e.connection.user.audioTrack&&(o.receiveLevel=Math.round(32767*e.connection.user.audioTrack.getVolumeLevel())),o.receiveBytes=c.bytes,o.receivePackets=c.packets,o.receivePacketsLost=c.packetsLost,o.packetLossRate=o.receivePacketsLost/o.receivePackets,o.receiveBitrate=n?8*Math.max(0,o.receiveBytes-n.receiveBytes):0,o.totalDuration=n?n.totalDuration+1:1,o.totalFreezeTime=n?n.totalFreezeTime:0,o.freezeRate=o.totalFreezeTime/o.totalDuration,o.receiveDelay=c.jitterBufferMs,t=e.connection.user.audioTrack,10<o.totalDuration&&Yc.isRemoteAudioFreeze(t)&&(o.totalFreezeTime+=1)),u&&("H264"!==u.codec&&"VP8"!==u.codec||(a.codecType=u.codec),a.receiveBytes=u.bytes,a.receiveBitrate=r?8*Math.max(0,a.receiveBytes-r.receiveBytes):0,a.decodeFrameRate=u.decodeFrameRate,a.renderFrameRate=u.decodeFrameRate,u.outputFrame&&(a.renderFrameRate=u.outputFrame.frameRate),u.receivedFrame?(a.receiveFrameRate=u.receivedFrame.frameRate,a.receiveResolutionHeight=u.receivedFrame.height,a.receiveResolutionWidth=u.receivedFrame.width):e.connection.user.videoTrack&&(a.receiveResolutionHeight=e.connection.user.videoTrack._videoHeight||0,a.receiveResolutionHeight=e.connection.user.videoTrack._videoWidth||0),void 0!==u.framesRateFirefox&&(a.receiveFrameRate=Math.round(u.framesRateFirefox)),a.receivePackets=u.packets,a.receivePacketsLost=u.packetsLost,a.packetLossRate=a.receivePacketsLost/a.receivePackets,a.totalDuration=r?r.totalDuration+1:1,a.totalFreezeTime=r?r.totalFreezeTime:0,a.receiveDelay=u.jitterBufferMs||0,Yc.isRemoteVideoFreeze(e.connection.user.videoTrack,u,i)&&(a.totalFreezeTime+=1),a.freezeRate=a.totalFreezeTime/a.totalDuration),l&&(o.end2EndDelay=l.B_ad,a.end2EndDelay=l.B_vd,o.transportDelay=l.B_ed,a.transportDelay=l.B_ed),e.audioStats=o,e.videoStats=a,e.pcStats=s,e.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(e.connection.user.audioTrack,o),e.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(e.connection.user.videoTrack,a)}),r(t=this.localConnectionsMap).call(t,e=>{let t=e.audioStats,n=e.videoStats,r=Ub({},se),i=Ub({},te);var o=e.connection.pc.getStats();let a=o.audioSend[0];o=o.videoSend[0];let s=e.connection.getUserId();a&&("opus"!==a.codec&&"aac"!==a.codec||(r.codecType=a.codec),a.inputLevel?r.sendVolumeLevel=Math.round(32767*a.inputLevel):e.connection.audioTrack&&(r.sendVolumeLevel=Math.round(32767*e.connection.audioTrack.getVolumeLevel())),r.sendBytes=a.bytes,r.sendPackets=a.packets,r.sendPacketsLost=a.packetsLost,r.sendBitrate=t?8*Math.max(0,r.sendBytes-t.sendBytes):0),o&&("H264"!==o.codec&&"VP8"!==o.codec||(i.codecType=o.codec),i.sendBytes=o.bytes,i.sendBitrate=n?8*Math.max(0,i.sendBytes-n.sendBytes):0,o.inputFrame?(i.captureFrameRate=o.inputFrame.frameRate,i.captureResolutionHeight=o.inputFrame.height,i.captureResolutionWidth=o.inputFrame.width):e.connection.videoTrack&&(i.captureResolutionWidth=e.connection.videoTrack._videoWidth||0,i.captureResolutionHeight=e.connection.videoTrack._videoHeight||0),o.sentFrame?(i.sendFrameRate=o.sentFrame.frameRate,i.sendResolutionHeight=o.sentFrame.height,i.sendResolutionWidth=o.sentFrame.width):e.connection.videoTrack&&(i.sendResolutionWidth=e.connection.videoTrack._videoWidth||0,i.sendResolutionHeight=e.connection.videoTrack._videoHeight||0),o.avgEncodeMs&&(i.encodeDelay=o.avgEncodeMs),e.connection.videoTrack&&e.connection.videoTrack._encoderConfig&&e.connection.videoTrack._encoderConfig.bitrateMax&&(i.targetSendBitrate=1e3*e.connection.videoTrack._encoderConfig.bitrateMax),i.sendPackets=o.packets,i.sendPacketsLost=o.packetsLost,i.totalDuration=n?n.totalDuration+1:1,i.totalFreezeTime=n?n.totalFreezeTime:0,this.isLocalVideoFreeze(o)&&(i.totalFreezeTime+=1)),e.audioStats=r,e.videoStats=i,e.audioStats&&e.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(s,e.connection.audioTrack,e.audioStats),e.videoStats&&e.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(s,e.connection.videoTrack,e.videoStats)})},this.clientId=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new mp,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}reset(){this.localConnectionsMap=new Y,this.remoteConnectionsMap=new Y,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.audioStats?e.audioStats:Ub({},se)}getLocalVideoTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.videoStats?e.videoStats:Ub({},te)}getRemoteAudioTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.audioStats?this.trafficStats?((e=R(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.audioStats.publishDuration=e.B_ppad+(v()-this.trafficStats.timestamp)),n.audioStats):n.audioStats:Ub({},dg)}getRemoteVideoTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.videoStats?this.trafficStats?((e=R(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.videoStats.publishDuration=e.B_ppvd+(v()-this.trafficStats.timestamp)),n.videoStats):n.videoStats:Ub({},eg)}getRTCStats(){var e,t;let n=0,i=0,o=0,a=0;return r(e=this.localConnectionsMap).call(e,e=>{e.audioStats&&(n+=e.audioStats.sendBytes,i+=e.audioStats.sendBitrate),e.videoStats&&(n+=e.videoStats.sendBytes,i+=e.videoStats.sendBitrate)}),r(t=this.remoteConnectionsMap).call(t,e=>{e.audioStats&&(o+=e.audioStats.receiveBytes,a+=e.audioStats.receiveBitrate),e.videoStats&&(o+=e.videoStats.receiveBytes,a+=e.videoStats.receiveBitrate)}),e=1,this.trafficStats&&(e+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:e,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(e){this.localConnectionsMap.delete(e),this.remoteConnectionsMap.delete(e)}addLocalConnection(e){let t=e.connectionId;this.localConnectionsMap.has(t)||this.localConnectionsMap.set(t,{connection:e})}addRemoteConnection(e){let t=e.connectionId;this.remoteConnectionsMap.has(t)||this.remoteConnectionsMap.set(t,{connection:e})}updateTrafficStats(e){var t;let n=M(t=e.peer_delay).call(t,e=>{var t;return-1===E(t=this.trafficStatsPeerList).call(t,e.peer_uid)});r(n).call(n,e=>{var t,n;let r=R(t=Kb(qc(n=this.remoteConnectionsMap).call(n))).call(t,t=>t.connection._userId===e.peer_uid);void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r?v()-r.connection.startTime:0),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){var t;this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&k.debug(n(t="[".concat(this.clientId,"]: Period fir changes to ")).call(t,e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){return!!e&&(e=!n||t.framesDecodeCount>n.framesDecodeCount,!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime||!e)}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&5<e.inputFrame.frameRate&&3>e.sentFrame.frameRate}}var Hk;let og=()=>{},Jh={},dd=[[[100,.00520833333333333],[66.6666666666666,.00434027777777778],[66.6666666666667,.00173611111111111]],[[233.333333333333,.00347222222222222],[266.666666666667],[.00173611111111111],[183.333333333333,.000217013888888889]],[[700,.001953125],[200,.001953125],[175,.000244140625]],[[899.999999999998,.00173611111111111],[1200,.000868055555555556],[160,.000260416666666667]],[[2666.66666666667,.000884130658436214],[1166.66666666667,.000884130658436214],[600,482253e-10]]];class np{constructor(){this.fnMap=new Y}throttleByKey(e,t,n,r,...i){if(this.fnMap.has(t)){var o=this.fnMap.get(t);o.threshold!==n?(o.fn(...o.args),clearTimeout(o.timer),o=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:i,skipFn:r})):(o.skipFn&&o.skipFn(...o.args),this.fnMap.set(t,Ue({},o,{fn:e,args:i,skipFn:r})))}else o=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:i,skipFn:r})}}let Ik=new np,Jk=ya(Hk=Ik.throttleByKey).call(Hk,Ik),Kk=window.AudioContext||window.webkitAudioContext,ed=null,wd=new Ua;Kk?(ed=new Kk,ed.onstatechange=()=>{wd.emit("state-change")},Pl(ed)):k.error("your browser is not support web audio");let Ve=null,ea={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1},Md=null;class $b{constructor(){this.lockingPromise=u.resolve(),this.locks=0}get isLocked(){return 0<this.locks}lock(){let e;this.locks+=1;let t=new u(t=>{e=()=>{--this.locks,t()}}),n=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>t),n}}let Xe=new $b,Nh=!1,Oh=!1;class op extends Ua{constructor(){super(),this._state=pc.IDLE,this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new Y,this.init().then(()=>{var e,t;navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",ya(t=this.updateDevicesInfo).call(t,this)),window.setInterval(ya(e=this.updateDevicesInfo).call(e,this),2500)}).catch(e=>k.error(e.toString()))}get state(){return this._state}set state(e){e!==this._state&&(this.emit(Rb.STATE_CHANGE,e),this._state=e)}async enumerateDevices(e,t,n=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new m(l.NOT_SUPPORT,"enumerateDevices() not supported.").throw();var i=await navigator.mediaDevices.enumerateDevices();i=this.checkMediaDeviceInfoIsOk(i);let o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=i=null,c=null;if(!n&&(o||a)){if(Xe.isLocked&&(k.debug("[device manager] wait GUM lock"),(await Xe.lock())(),k.debug("[device manager] GUM unlock")),Nh&&(o=!1,this.isAccessMicrophonePermission=!0),Oh&&(a=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{c=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){if((n=Nd(e.name||e.code||e,e.message)).code===l.PERMISSION_DENIED)throw n;k.warning("getUserMedia failed in getDevices",n)}this.isAccessMicrophonePermission=this.isAccessCameraPermission=!0}else if(o){try{i=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){if((n=Nd(e.name||e.code||e,e.message)).code===l.PERMISSION_DENIED)throw n;k.warning("getUserMedia failed in getDevices",n)}this.isAccessMicrophonePermission=!0}else if(a){try{s=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){if((n=Nd(e.name||e.code||e,e.message)).code===l.PERMISSION_DENIED)throw n;k.warning("getUserMedia failed in getDevices",n)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{var u,d,h;let e=await navigator.mediaDevices.enumerateDevices();return i&&r(u=i.getTracks()).call(u,e=>e.stop()),s&&r(d=s.getTracks()).call(d,e=>e.stop()),c&&r(h=c.getTracks()).call(h,e=>e.stop()),e}catch(e){return new m(l.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(e=!1){return e=await this.enumerateDevices(!0,!1,e),M(e).call(e,e=>"audioinput"===e.kind)}async getCamerasDevices(e=!1){return e=await this.enumerateDevices(!1,!0,e),M(e).call(e,e=>"videoinput"===e.kind)}async getSpeakers(e=!1){return e=await this.enumerateDevices(!0,!1,e),M(e).call(e,e=>"audiooutput"===e.kind)}searchDeviceNameById(e){return(e=this.deviceInfoMap.get(e))?e.device.label||e.device.deviceId:null}searchDeviceIdByName(e){var t;let n=null;return r(t=this.deviceInfoMap).call(t,t=>{t.device.label===e&&(n=t.device.deviceId)}),n}async getDeviceById(e){var t=await this.enumerateDevices(!0,!0,!0);if(!(t=R(t).call(t,t=>t.deviceId===e)))throw new m(l.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=pc.INITING;try{await this.updateDevicesInfo(),this.state=pc.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=pc.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new m(l.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){var e;let t=await this.enumerateDevices(!0,!0,!0),n=v(),i=[];r(t).call(t,e=>{if(e.deviceId){var t=this.deviceInfoMap.get(e.deviceId);if("ACTIVE"!==(t?t.state:"INACTIVE")){let t={initAt:n,updateAt:n,device:e,state:"ACTIVE"};this.deviceInfoMap.set(e.deviceId,t),i.push(t)}t&&(t.updateAt=n)}}),r(e=this.deviceInfoMap).call(e,(e,t)=>{"ACTIVE"===e.state&&e.updateAt!==n&&(e.state="INACTIVE",i.push(e))}),this.state===pc.INITEND&&r(i).call(i,e=>{switch(e.device.kind){case"audioinput":this.emit(Rb.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.emit(Rb.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.emit(Rb.PLAYOUT_DEVICE_CHANGED,e)}})}checkMediaDeviceInfoIsOk(e){let t=M(e).call(e,e=>"audioinput"===e.kind);e=M(e).call(e,e=>"videoinput"===e.kind);let n={audio:!1,video:!1};for(let e of t)if(e.label&&e.deviceId){n.audio=!0;break}for(let t of e)if(t.label&&t.deviceId){n.video=!0;break}return n}}let ub=new op;var pp=[].slice,qp=/MSIE .\./.test(ld),Lk=function(e){return function(t,n){var r=2<arguments.length,i=r?pp.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};K({global:!0,bind:!0,forced:qp},{setTimeout:Lk(J.setTimeout),setInterval:Lk(J.setInterval)});var Cc=fa.setTimeout;let Qh=0,Ye=0,Mk=(e,t)=>(t=ta.Events[e].create(t),ta.Events[e].encode(t).finish());class rp{constructor(){var e,t;this.baseInfoMap=new Y,this.clientList=dk,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=v(),this.customReportCount=0,this.url="https://".concat(C.EVENT_REPORT_DOMAIN,":6443"),this.backupUrl="https://".concat(C.EVENT_REPORT_BACKUP_DOMAIN,":6443"),this.eventUploadTimer=window.setInterval(ya(e=this.doSend).call(e,this),C.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(ya(t=this.appendSessionId).call(t,this),C.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;let r=v(),i=this.apiInvokeCount+=1,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options}),a=!!C.SHOW_REPORT_INVOKER_LOG;a&&k.info("".concat(t.name," start"),t.options);let s=!1;Ab(t.timeout).then(()=>{s||(this.sendApiInvoke(wa({},o(),{error:l.API_INVOKE_TIMEOUT,success:!1})),k.debug("".concat(t.name," timeout")))});let c=new m(l.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{let r=()=>{if(s)throw c;return s=!0,this.sendApiInvoke(wa({},o(),{success:!0},t.reportResult&&{result:e})),a&&k.info("".concat(t.name," onSuccess")),e};return n?Jk(r,t.name+"Success",n,()=>s=!0):r()},onError:e=>{let r=()=>{if(s)throw e;s=!0,this.sendApiInvoke(wa({},o(),{success:!1,error:e.toString()})),a&&k.info("".concat(t.name," onFailure"),e.toString())};return n?Jk(r,t.name+"Error",n,()=>s=!0):r()}}}sessionInit(e,t){if(!this.baseInfoMap.has(e)){var n=v();(e=this.createBaseInfo(e,n)).cname=t.cname;var r=Wa({},{willUploadConsoleLog:C.UPLOAD_LOG},t.extend),i=v();t=wa({},e,{eventType:Ba.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:"v4.1.0-0-g64d4440(9/4/2020, 5:57:23 PM)",lts:i,elapse:i-n,extend:w(r),mode:t.mode,process:C.PROCESS_ID,success:!0,version:$a}),this.send({type:pa.SESSION,data:t},!0)}}joinChooseServer(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-e.startTime,success:t.succ,chooseServerAddrList:w(t.serverList),uid:t.uid?S(t.uid):null,cid:t.cid?S(t.cid):null}),this.send({type:pa.JOIN_CHOOSE_SERVER,data:t},!0)}}reqUserAccount(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:r-e.startTime,eventElapse:r-t.lts,extend:w(t.extend)}),this.send({type:pa.REQ_USER_ACCOUNT,data:t},!0)}}joinGateway(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;var r=v();n=wa({},n,{eventType:Ba.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:r-e.startTime,eventElapse:r-t.lts}),t.succ&&(e.lastJoinSuccessTime=r),this.send({type:pa.JOIN_GATEWAT,data:n},!0)}}joinChannelTimeout(e,t){if(e=this.baseInfoMap.get(e)){var n=v();t=wa({},e.info,{lts:n,timeout:t,elapse:n-e.startTime}),this.send({type:pa.JOIN_CHANNEL_TIMEOUT,data:t},!0)}}publish(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.PUBLISH,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid}),this.send({type:pa.PUBLISH,data:t},!0)}}subscribe(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();e=wa({},n,{eventType:Ba.SUBSCRIBE,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid}),"string"==typeof t.peerid?e.peerSuid=t.peerid:e.peer=t.peerid,this.send({type:pa.SUBSCRIBE,data:e},!0)}}firstRemoteFrame(e,t,n,r){if(e=this.baseInfoMap.get(e)){var i=e.info,o=v();t=wa({},i,{},r,{elapse:o-e.startTime,eventType:t,lts:o}),this.send({type:n,data:t},!0)}}onGatewayStream(e,t,n,r){(e=this.baseInfoMap.get(e))&&(t=wa({},e.info,{},r,{eventType:t,lts:v()}),this.send({type:n,data:t},!0))}streamSwitch(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-e.startTime,success:t.succ}),this.send({type:pa.STREAM_SWITCH,data:t},!0)}}requestProxyAppCenter(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:pa.REQUEST_PROXY_APPCENTER,data:t},!0)}}requestProxyWorkerManager(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{eventType:Ba.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:pa.REQUEST_PROXY_WORKER_MANAGER,data:t},!0)}}setProxyServer(e){(this.proxyServer=e)?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e)),e||(this.url="https://".concat(C.EVENT_REPORT_DOMAIN,":6443"),this.backupUrl="https://".concat(C.EVENT_REPORT_BACKUP_DOMAIN,":6443"))}peerPublishStatus(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:0<t.audioPublishDuration?1:-1,videotag:0<t.videoPublishDuration?1:-1,lts:r,elapse:r-e.startTime,joinChannelSuccessElapse:r-(e.lastJoinSuccessTime||r)}),this.send({type:pa.PEER_PUBLISH_STATUS,data:t},!0)}}workerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,i=v();t=Gl(wa({},n,{},t,{elapse:i-e.startTime,lts:i,productType:"WebRTC"}),"payload",1300),r(t).call(t,e=>this.send({type:"WorkerEvent",data:e,isPb:!0,id:156},!0))}}apworkerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=v();t=wa({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:"APWorkerEvent",data:t,isPb:!0,id:160},!0)}}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>C.CUSTOM_REPORT_LIMIT)throw new m(l.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3)),t=D(t).call(t,t=>({type:pa.USER_ANALYTICS,data:wa({sid:e},t)})),t={msgType:"EventMessages",sentTs:Math.round(v()/1e3),payloads:D(t).call(t,e=>w(e))};try{await this.postDataToStatsCollector(t)}catch(e){throw k.error("send custom report message failed",e.toString()),new m(l.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){var t=C.NOT_REPORT_EVENT;if(!(e.tag&&La(t)&&La(t).call(t,e.tag))){if(null===e.sid)return void this.apiInvokeUploadPendingItems.push(e);if(!(t=this.baseInfoMap.get(e.sid)))return void this.apiInvokeUploadPendingItems.push(e);var{cname:n,uid:r,cid:i}=t.info;e.lts=e.lts||v(),e={invokeId:e.invokeId,sid:e.sid,cname:n,cid:i,uid:r,lts:e.lts,success:e.success,elapse:e.lts-t.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?w(e.options):void 0,execStates:e.states?w(e.states):void 0,execResult:e.result?w(e.result):void 0,errorCode:e.error?w(e.error):void 0},this.send({type:pa.API_INVOKE,data:e},!1)}}appendSessionId(){var e;let t=!1;r(e=this.clientList).call(e,e=>{var n;e._sessionId&&(r(n=this.apiInvokeUploadPendingItems).call(n,t=>{t.sid=e._sessionId,this.sendApiInvoke(Wa({},t))}),t=!0)}),t&&(this.apiInvokeUploadPendingItems=[])}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>C.NORMAL_EVENT_QUEUE_CAPACITY&&Ma(n=this.normalEventUploadPendingItems).call(n,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=v()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r=[],i=[];for(var o=[];e.length;){let t=e.shift();Yo(t)?20>i.length?i.push(t):o.push(t):20>r.length?r.push(t):o.push(t)}e.push(...o);for(let e of[...r,...i]){var a,s;-1!==E(a=this.ltsList).call(a,e.data.lts)?(e.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(e.data.lts)):(this.ltsList.push(e.data.lts),rd(s=this.ltsList).call(s,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=v()),o={msgType:"EventMessages",sentTs:Math.round(v()/1e3),payloads:D(r).call(r,e=>w(e))},a=Mk("ProtoRaws",{sentTs:Math.round(v()/1e3),payloads:D(i).call(i,e=>({id:e.id,msg:Mk(e.type,e.data)}))}),s=e=>r=>{var i,o,a;t?this.keyEventUploadPendingItems=n(i=this.keyEventUploadPendingItems).call(i,e):(this.normalEventUploadPendingItems=n(o=this.normalEventUploadPendingItems).call(o,e),this.normalEventUploadPendingItems.length>C.NORMAL_EVENT_QUEUE_CAPACITY&&(Ma(a=this.normalEventUploadPendingItems).call(a,0,this.normalEventUploadPendingItems.length-C.NORMAL_EVENT_QUEUE_CAPACITY),k.warning("report: drop normal events")))},i.length&&this.postDataToStatsCollector(a,!0).catch(s(i)),r.length&&this.postDataToStatsCollector(o).catch(s(r)),e}async postDataToStatsCollector(e,t=!1){var r,i,o;let a=t?"/events/proto-raws":"/events/messages",s=this.proxyServer?n(r=n(i="https://".concat(this.proxyServer,"/rs/?h=")).call(i,C.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(r,a):n(o="".concat(this.url)).call(o,a);for(r=0;2>r;r+=1){var c,u,l;1===r&&(s=this.proxyServer?n(c=n(u="https://".concat(this.proxyServer,"/rs/?h=")).call(u,C.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(c,a):n(l="".concat(this.backupUrl)).call(l,a));try{t?await Vl(s,{timeout:1e4,data:e}):await Vb(s,{timeout:1e4,data:e})}catch(e){if(1===r)throw e;continue}break}}createBaseInfo(e,t){let n=Wa({},Xo);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}}let t=new rp,Wl={[Ac.ACCESS_POINT]:{[Ca.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ca.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ca.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ca.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ca.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ac.UNILBS]:{[rb.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[rb.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[rb.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[rb.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[rb.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[rb.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[rb.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[rb.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[rb.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1}},[Ac.STRING_UID_ALLOCATOR]:{[sd.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[sd.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[sd.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},Xl={[B.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[B.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[B.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[B.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[B.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[B.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[B.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[B.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"recover"},[B.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[B.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[B.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[B.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[B.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[B.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[B.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[B.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[B.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[B.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[B.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[B.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[B.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[B.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[B.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[B.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[B.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[B.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[B.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[B.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[B.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[B.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[B.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[B.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[B.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[B.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[B.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[B.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[B.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[B.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[B.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[B.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[B.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[B.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[B.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[B.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[B.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[B.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[B.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[B.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[B.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[B.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[B.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[B.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[B.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[B.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"}},Na={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};class pg extends Ua{constructor(e,t){super(),this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.name=e,this.retryConfig=t}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Q.RECONNECTING,this.reconnectMode):"connected"===this._state?this.emit(Q.CONNECTED):"closed"===this._state?this.emit(Q.CLOSED):"failed"===this._state&&this.emit(Q.FAILED))}init(e){return new u((t,n)=>{this.urls=e;let r=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(r).then(t).catch(n),this.once(Q.CLOSED,()=>n(new m(l.WS_DISCONNECT))),this.once(Q.CONNECTED,()=>t())})}close(e,t){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?Cc(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed"}reconnect(e){this.websocket?(void 0!==e&&(this.reconnectMode=e),e=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),e&&ya(e).call(e,this.websocket)({code:9999})):k.warning("[".concat(this.name,"] can not reconnect, no websocket"))}sendMessage(e){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new m(l.WS_ABORT,"websocket is not ready");e=w(e);try{this.websocket.send(e)}catch(e){throw new m(l.WS_ERR,"send websocket message error"+e.toString())}}async createWebSocketConnection(e){let t=this.connectionID+=1;return new u((r,i)=>{var o,a;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),C.GATEWAY_WSS_ADDRESS&&Bd(o=this.name).call(o,"gateway")&&(e=C.GATEWAY_WSS_ADDRESS),k.debug(n(a="[".concat(this.name,"] start connect, url: ")).call(a,e));try{this.websocket=new WebSocket(e),this.websocket.binaryType="arraybuffer"}catch(e){var s;return o=new m(l.WS_ERR,"init websocket failed! Error: ".concat(e.toString())),k.error(n(s="[".concat(this.name,"]")).call(s,o)),void i(o)}Ab(5e3).then(()=>{t===this.connectionID&&this.websocket&&this.websocket.readyState!==WebSocket.OPEN&&this.websocket&&this.websocket.close()}),this.websocket.onopen=()=>{k.debug("[".concat(this.name,"] websockect opened:"),e),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,r()},this.websocket.onclose=async e=>{var t,o,a,s;if(k.debug(n(t=n(o=n(a=n(s="[".concat(this.name,"] websocket close ")).call(s,this.websocket&&this.websocket.url,", code: ")).call(a,e.code,", reason: ")).call(o,e.reason,", current mode: ")).call(t,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){if("connected"===this.state&&(this.state="reconnecting"),t=ec(this,Q.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,t=await this.reconnectWithAction(t),"closed"===this.state)return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!t)return i(new m(l.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),void this.close(!0);r()}else i(new m(l.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close()},this.websocket.onmessage=e=>{this.emit(Q.ON_MESSAGE,e)}})}async reconnectWithAction(e,t){var r,i;if(!t&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||"closed"===this.state)return!1;if(t=this.retryConfig,t=Math.min(t.maxRetryTimeout,t.timeout*Math.pow(t.timeoutFactor,this.reconnectCount)),k.debug(n(r=n(i="[".concat(this.name,"] wait ")).call(i,t,"ms to reconnect websocket, mode: ")).call(r,e)),await Ab(t),"closed"===this.state)return!1;this.reconnectCount+=1;try{if("retry"===e)await this.createWebSocketConnection(this.urls[this.currentURLIndex]);else if("tryNext"===e){var o,a;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");k.debug(n(o=n(a="[".concat(this.name,"] websocket url length: ")).call(a,this.urls.length," current index: ")).call(o,this.currentURLIndex)),await this.createWebSocketConnection(this.urls[this.currentURLIndex])}else"recover"===e&&(k.debug("[".concat(this.name,"] request new urls")),this.urls=await Ha(this,Q.REQUEST_NEW_URLS),this.currentURLIndex=0,await this.createWebSocketConnection(this.urls[this.currentURLIndex]));return!0}catch(t){return k.error("[".concat(this.name,"] reconnect failed"),t.toString()),await this.reconnectWithAction(e)}}}class sp{constructor(e){this.input=[],this.size=e}add(e){var t;this.input.push(e),this.input.length>this.size&&Ma(t=this.input).call(t,0,1)}mean(){var e;return 0===this.input.length?0:xe(e=this.input).call(e,(e,t)=>e+t)/this.input.length}}class tp extends Ua{constructor(e){super(),this._connectionState=ua.CLOSED,this.openConnectionTime=v(),this.lastMsgTime=v(),this.uploadCache=[],this.rttRolling=new sp(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=e=>{if(e.data instanceof ArrayBuffer)this.emit(P.ON_BINARY_DATA,e.data);else if(e=JSON.parse(e.data),this.lastMsgTime=v(),e.hasOwnProperty("_id")){let t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(e.hasOwnProperty("_type")&&(this.emit(e._type,e._message),e._type===X.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===X.ON_USER_BANNED))switch(e._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=e.clientId,this.spec=e,this.websocket=new pg("gateway-".concat(this.clientId),this.spec.retryConfig),this.handleWebsocketEvents()}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===ua.CONNECTED?this.emit(P.WS_CONNECTED):e===ua.RECONNECTING?this.emit(P.WS_RECONNECTING):e===ua.CLOSED&&this.emit(P.WS_CLOSED,this._disconnectedReason))}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(e,t,r){var i,o,a,s,c;let d=na(6,"");var h={_id:d,_type:e,_message:t};let p=this.websocket.connectionID;var f=()=>new u((e,t)=>{if(this.connectionState===ua.CONNECTED)return e();const n=()=>{this.off(P.WS_CLOSED,r),e()},r=()=>{this.off(P.WS_CONNECTED,n),t(new m(l.WS_ABORT))};this.once(P.WS_CONNECTED,n),this.once(P.WS_CLOSED,r)});this.connectionState!==ua.CONNECTING&&this.connectionState!==ua.RECONNECTING||e===ha.JOIN||e===ha.REJOIN||await f();var g=new u((n,r)=>{let i=!1;const o=(e,t)=>{i=!0,n({isSuccess:"success"===e,message:t||{}}),this.off(P.WS_CLOSED,a),this.off(P.WS_RECONNECTING,a)};this.once("res-@".concat(d),o);const a=()=>{r(new m(l.WS_ABORT,"type: ".concat(e))),this.off(P.WS_CLOSED,a),this.off(P.WS_RECONNECTING,a),this.off("res-@".concat(d),o)};this.once(P.WS_CLOSED,a),this.once(P.WS_RECONNECTING,a),Ab(C.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==p||i||(k.warning("ws request timeout, type: ".concat(e)),this.onRequestTimeout&&this.onRequestTimeout(e,t))})});this.websocket.sendMessage(h),h=null;try{h=await g}catch(n){if(this.connectionState===ua.CLOSED||e===ha.LEAVE)throw new m(l.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?n.throw():e===ha.JOIN||e===ha.REJOIN?null:(await f(),await this.request(e,t))}return h.isSuccess?h.message:(f=Sh(r=Number(h.message.error_code||h.message.code)),g=new m(l.UNEXPECTED_RESPONSE,n(i="".concat(f.desc,": ")).call(i,h.message.error_str),{code:r,data:h.message}),"success"===f.action?h.message:(k.warning(n(o=n(a=n(s=n(c="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(c,e,", error_code: ")).call(s,r,", message: ")).call(a,f.desc,", action: ")).call(o,f.action)),"failed"===f.action?g.throw():"quit"===f.action?(this.initError=g,this.close(),g.throw()):(r===B.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover")):this.reconnect(f.action),e===ha.JOIN||e===ha.REJOIN?null:await this.request(e,t))))}waitMessage(e,t){return new u(n=>{let r=i=>{t&&!t(i)||(this.off(e,r),n(i))};this.on(e,r)})}upload(e,t){e={_type:e,_message:t};try{this.websocket.sendMessage(e)}catch(r){var n;t=C.MAX_UPLOAD_CACHE||50,this.uploadCache.push(e),this.uploadCache.length>t&&Ma(n=this.uploadCache).call(n,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var e;if(this.connectionState===ua.CONNECTED){var t=Ma(e=this.uploadCache).call(e,0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}},C.UPLOAD_CACHE_INTERVAL||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new u((t,n)=>{this.once(P.WS_CONNECTED,()=>t(this.joinResponse)),this.once(P.WS_CLOSED,()=>n(this.initError||new m(l.WS_ABORT))),this.connectionState=ua.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=e||"LEAVE",this.connectionState=ua.CLOSED,this.websocket.close()}async join(){var e;if(!this.joinResponse){var t=ad(this,P.REQUEST_JOIN_INFO);if(!(t=await this.request(ha.JOIN,t)))return this.emit(P.REPORT_JOIN_GATEWAY,l.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ua.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(ya(e=this.handlePingPong).call(e,this),3e3),!0}async rejoin(){var e,t;if(!this.reconnectToken)throw new m(l.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var n=ad(this,P.REQUEST_REJOIN_INFO);return n.token=this.reconnectToken,!!(n=await this.request(ha.REJOIN,n))&&(this.connectionState=ua.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(ya(e=this.handlePingPong).call(e,this),3e3),n.peers&&r(t=n.peers).call(t,e=>{this.emit(X.ON_USER_ONLINE,{uid:e.uid}),e.audio_mute?this.emit(X.MUTE_AUDIO,{uid:e.uid}):this.emit(X.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(X.MUTE_VIDEO,{uid:e.uid}):this.emit(X.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(X.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(X.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(X.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(X.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(X.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id}),e.audio&&this.emit(X.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0}),e.video&&this.emit(X.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0})}),!0)}reconnect(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e)}handleNotification(e){k.debug("[".concat(this.clientId,"] receive notification: "),e),"success"!==(e=Sh(e.code)).action&&("failed"!==e.action?"quit"!==e.action?this.reconnect(e.action):this.close():k.error("[".concat(this.clientId,"] ignore error: "),e.desc))}handlePingPong(){if(this.websocket&&"connected"===this.websocket.state){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var e=C.PING_PONG_TIME_OUT,t=v();this.pingpongTimeoutCount>=e&&(k.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>C.WEBSOCKET_TIMEOUT_MIN)?this.reconnect():this.request(ha.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=v()-t;this.rttRolling.add(e),C.REPORT_STATS&&this.send(ha.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}}handleWebsocketEvents(){this.websocket.on(Q.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Q.CLOSED,()=>{this.connectionState=ua.CLOSED}),this.websocket.on(Q.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=ua.CLOSED}),this.websocket.on(Q.RECONNECTING,e=>{this.joinResponse=void 0,this.connectionState===ua.CONNECTED?this.connectionState=ua.RECONNECTING:this.connectionState=ua.CONNECTING}),this.websocket.on(Q.WILL_RECONNECT,(e,t)=>{let n=ad(this,P.IS_P2P_DISCONNECTED);if(console.log("rec",e,n),n&&"retry"===e)return this.reconnectToken=void 0,this.emit(P.NEED_RENEW_SESSION),this.emit(P.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(this.reconnectToken=void 0,this.emit(P.NEED_RENEW_SESSION),this.emit(P.DISCONNECT_P2P)),t(e)}),this.websocket.on(Q.CONNECTED,()=>{this.openConnectionTime=v(),this.reconnectToken?this.rejoin().catch(e=>{var t;k.warning(n(t="[".concat(this.clientId,"] rejoin failed ")).call(t,e)),this.reconnect("tryNext")}):this.join().catch(e=>{if(this.emit(P.REPORT_JOIN_GATEWAY,e.code,this.url||""),e instanceof m&&e.code===l.UNEXPECTED_RESPONSE&&e.data.code===B.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover");k.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext"):(this.initError=e,this.close())})}),this.websocket.on(Q.REQUEST_NEW_URLS,(e,t)=>{Ha(this,P.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})}}class Nk extends Ua{constructor(e,t){super(),this._hints=[],this._ID=t||na(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=e}getTrackId(){return this._ID}getMediaStreamTrack(){return this._mediaStreamTrack}}class qg extends Nk{constructor(e,t){super(e,t),this._enabled=!0,this._isClosed=!1,this._trackProcessors=[],this._enabledMutex=new $b,this._handleTrackEnded=()=>{this.emit(td.TRACK_ENDED)},e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var e;this.stop(),r(e=this._trackProcessors).call(e,e=>e.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&this._mediaStreamTrack.stop(),k.debug("[".concat(this.getTrackId(),"] close")),this.emit(L.NEED_CLOSE),this._isClosed=!0}async _registerTrackProcessor(e){var t;if(-1===E(t=this._trackProcessors).call(t,e)){var n=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(e),e.onOutputChange=async()=>{this._mediaStreamTrack=e.output||this._originMediaStreamTrack,this._updatePlayerSource(),await Ya(this,L.NEED_REPLACE_TRACK,this._mediaStreamTrack)},n?(n.onOutputChange=async()=>{n.output&&await e.setInput(n.output)},await e.setInput(n.output||n.input||this._originMediaStreamTrack)):await e.setInput(this._originMediaStreamTrack)}}_getOutputFromProcessors(){if(0===this._trackProcessors.length)return this._originMediaStreamTrack;let e=this._trackProcessors[this._trackProcessors.length-1];return e.output||e.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(e,t){e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,0<this._trackProcessors.length?(await this._trackProcessors[0].setInput(e),this._mediaStreamTrack=this._getOutputFromProcessors()):this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ya(this,L.NEED_REPLACE_TRACK,this._mediaStreamTrack))}_getDefaultPlayerConfig(){return{}}}class Ok extends Ua{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=this.audioLevelBase=0,this.audioOutputLevelCache=null,this.audioOutputLevelCacheMaxLength=C.AUDIO_SOURCE_AVG_VOLUME_DURATION/C.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||15,this.isDestroyed=!1,this._noAudioInputCount=0,this.context=yc(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),fd(this.outputNode),this.analyserNode=this.context.createAnalyser()}get isNoAudioInput(){return 3<=this.noAudioInputCount}get noAudioInputCount(){return this._noAudioInputCount}set noAudioInputCount(e){3>this._noAudioInputCount&&3<=e?this.onNoAudioInput&&this.onNoAudioInput():3<=this._noAudioInputCount&&0==this._noAudioInputCount%10&&this.onNoAudioInput&&this.onNoAudioInput(),this._noAudioInputCount=e}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(gb.ON_AUDIO_BUFFER,Ol(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ea.webAudioMediaStreamDest)throw new m(l.NOT_SUPPORT,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&Za(()=>{wd.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAudioLevel(){return this.audioOutputLevel}getAudioAvgLevel(){var e;return null===this.audioOutputLevelCache&&(this.audioOutputLevelCache=[this.audioOutputLevel]),xe(e=this.audioOutputLevelCache).call(e,(e,t)=>e+t)/this.audioOutputLevelCache.length}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}setMute(e){e?(this.disconnect(),this.audioLevelBase=0,this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect(),window.clearInterval(this.updateAudioOutputLevelInterval)}connect(){var e;this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode),this.updateAudioOutputLevelInterval=window.setInterval(ya(e=this.updateAudioOutputLevel).call(e,this),C.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||400)}updateAudioOutputLevel(){if(this.analyserNode){if(this.analyserNode.getFloatTimeDomainData){var e=new Float32Array(this.analyserNode.frequencyBinCount);this.analyserNode.getFloatTimeDomainData(e)}else{var t;e=new Uint8Array(this.analyserNode.frequencyBinCount),this.analyserNode.getByteTimeDomainData(e);let n=!0;e=new Float32Array(D(t=Kb(e)).call(t,e=>(128!==e&&(n=!1),.0078125*(e-128)))),n?this.noAudioInputCount+=1:this.noAudioInputCount=0}for(t=0;t<e.length;t+=1)Math.abs(e[t])>this.audioLevelBase&&(this.audioLevelBase=Math.abs(e[t]),1<this.audioLevelBase&&(this.audioLevelBase=1));this.audioOutputLevel=this.audioLevelBase,this.audioLevelBase/=4,null!==this.audioOutputLevelCache&&(this.audioOutputLevelCache.push(this.audioOutputLevel),this.audioOutputLevelCache.length>this.audioOutputLevelCacheMaxLength&&this.audioOutputLevelCache.shift())}}}class Pk extends Ok{constructor(e,t){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=()=>{if(!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume",this.getAudioLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0,e=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(e),fd(this.sourceNode),this.analyserNode=this.context.createAnalyser();let t=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(t,this.context.currentTime),fd(this.outputNode),this.connect(),this.audioElement.srcObject=e,this.isPlayed&&this.play(this.playNode)},"audio"!==e.kind)throw new m(l.UNEXPECTED_ERROR);this.track=e,e=new MediaStream([this.track]),this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(e),fd(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=e,e=va(),t&&e.os===aa.IOS&&(wd.on("state-change",this.rebuildWebAudio),this.onNoAudioInput=()=>{document.body.addEventListener("click",this.rebuildWebAudio,!0),this.rebuildWebAudio(),document.body.click()})}get isFreeze(){return!1}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1,e=new MediaStream([e]),this.sourceNode=this.context.createMediaStreamSource(e),fd(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=e}destroy(){this.audioElement.remove(),wd.off("state-change",this.rebuildWebAudio),super.destroy()}}class up{constructor(){this.elementMap=new Y,this.elementsNeedToResume=[],this.sinkIdMap=new Y,this.autoResumeAudioElement()}async setSinkID(e,t){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new m(l.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t){if(!this.elementMap.has(t)){var n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.elementMap.set(t,n),(e=this.sinkIdMap.get(t))&&n.setSinkId(e).catch(e=>{k.warning("[".concat(t,"] set sink id failed"),e.toString())}),(e=n.play())&&e.then&&e.catch(e=>{k.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),Za(()=>{this.onAutoplayFailed&&this.onAutoplayFailed()}))})}}updateTrack(e,t){(e=this.elementMap.get(e))&&(e.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)}setVolume(e,t){(e=this.elementMap.get(e))&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(e){var t,n;let r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),r){var i=E(t=this.elementsNeedToResume).call(t,r);Ma(n=this.elementsNeedToResume).call(n,i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e)}}autoResumeAudioElement(){let e=()=>{var e;r(e=this.elementsNeedToResume).call(e,e=>{e.play().then(e=>{k.debug("Auto resume audio element success")}).catch(e=>{k.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};Hl().then(()=>{document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)})}}let jb=new up;class Va extends qg{constructor(e,t,n){super(e,n),this.trackMediaType="audio",this._enabled=!0,this._useAudioElement=!1,this._encoderConfig=t,this._source=new Pk(e),ea.webAudioWithAEC||(this._useAudioElement=!0)}get isPlaying(){return this._useAudioElement?jb.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(e){W(e,"volume",0,1e3);let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),e]},300);this._source.setVolume(e/100);try{let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ya(this,L.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}n.onSuccess()}getVolumeLevel(){return this._source.getAudioLevel()}async setPlaybackDevice(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),e]});if(!this._useAudioElement)throw new m(l.NOT_SUPPORT,"your browser does not support setting the audio output device");try{await jb.setSinkID(this.getTrackId(),e)}catch(e){throw n.onError(e),e}n.onSuccess()}async setEnabled(e){var t;if(e!==this._enabled){k.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var r=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.enabled=!1;try{await Ya(this,L.NEED_REMOVE_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),r(),e}return this._enabled=!1,r()}this._originMediaStreamTrack.enabled=!0;try{await Ya(this,L.NEED_ADD_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),r(),e}k.info(n(t="[".concat(this.getTrackId(),"] setEnabled to ")).call(t,e," success")),this._enabled=!0,r()}}getStats(){return cd(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ec(this,L.GET_STATS)||$e({},se)}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(gb.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(gb.ON_AUDIO_BUFFER),this._source.on(gb.ON_AUDIO_BUFFER,t=>e(t))}play(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),jb.play(this._mediaStreamTrack,this.getTrackId())):this._source.play(),e.onSuccess()}stop(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?jb.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){k.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&jb.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ya(this,L.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}}class rg extends Va{constructor(e,t,n,r){super(e,t.encoderConfig?Ed(t.encoderConfig):{},r),this._deviceName="default",this._enabled=!0,this._config=t,this._constraints=n,this._deviceName=e.label}async setDevice(e){var r,i;let o=t.reportApiInvoke(null,{tag:z.TRACER,name:A.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),e]});k.info(n(r="[".concat(this.getTrackId,"] start set device to ")).call(r,e));try{await ub.getDeviceById(e),(r={}).audio=$e({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let t=null;try{t=await Bb(r,this.getTrackId())}catch(e){throw k.error("[track-".concat(this.getTrackId(),"] setDevice failed"),e.toString()),t=await Bb({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(t.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(t.getAudioTracks()[0],!1),this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw o.onError(e),k.error("[track-".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}o.onSuccess(),k.info(n(i="[".concat(this.getTrackId,"] set device to ")).call(i,e," success"))}async setEnabled(e,t){if(t)return k.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(e);if(e!==this._enabled){if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),t=await this._enabledMutex.lock(),!e){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),this._enabled=!1;try{await Ya(this,L.NEED_REMOVE_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),t(),e}return void t()}e=$e({},this._constraints);var n=ub.searchDeviceIdByName(this._deviceName);n&&!e.deviceId&&(e.deviceId=n);try{let e=await Bb({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await Ya(this,L.NEED_ADD_TRACK,this)}catch(e){throw t(),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}this._enabled=!0,k.info("[".concat(this.getTrackId(),"] setEnabled success")),t()}}}class vp extends Va{constructor(e,t,n,r){super(t.createOutputTrack(),n,r),this.source=e,this._bufferSource=t,this._bufferSource.on(gb.AUDIO_SOURCE_STATE_CHANGE,e=>{this.emit(td.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),e,this.duration]});e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer(),n.onSuccess()}pauseProcessAudioBuffer(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),e.onSuccess()}seekAudioBuffer(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(e),n.onSuccess()}resumeProcessAudioBuffer(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),e.onSuccess()}stopProcessAudioBuffer(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),e.onSuccess()}}class Rc extends Va{constructor(){let e=yc().createMediaStreamDestination();super(e.stream.getAudioTracks()[0]);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){var t;return-1!==E(t=this.trackList).call(t,e)}addAudioTrack(e){var t;-1===E(t=this.trackList).call(t,e)?(k.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):k.warning("track is already added")}removeAudioTrack(e){var t;if(-1!==E(t=this.trackList).call(t,e)){k.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}bd(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){var e;let t={};r(e=this.trackList).call(e,e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}}let sg=new Y;class wp extends Ua{constructor(e){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new Y,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this.clientId=e.clientId,this.spec=e,this.signal=new tp(af({},e,{retryConfig:e.websocketRetryConfig})),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this.handleSignalEvents()}get state(){return this._state}set state(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(Ea.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Ea.CONNECTION_STATE_CHANGE,e,t)}}async join(e,n){var r;"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let i=v();var o=sg.get(e.cname);if(o||(o=new Y,sg.set(e.cname,o)),o.has(e.uid))throw o=new m(l.UID_CONFLICT),t.joinGateway(e.sid,{lts:i,succ:!1,ec:o.code,addr:null,uid:e.uid,cid:e.cid}),o;o.set(e.uid,!0),this.joinInfo=e,this.key=n,n=D(r=e.gatewayAddrs).call(r,e=>"wss://".concat(e)),r=0,this.joinGatewayStartTime=i;try{r=(await this.signal.init(n)).uid}catch(n){throw k.error("[".concat(this.clientId,"] User join failed"),n.toString()),t.joinGateway(e.sid,{lts:i,succ:!1,ec:n.code===l.UNEXPECTED_ERROR?n.message:n.code,addr:this.signal.url,uid:e.uid,cid:e.cid}),o.delete(e.uid),this.signal.close(),n}return this.state="CONNECTED",this.inChannelInfo.joinAt=v(),k.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{k.warning("[".concat(this.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(Ea.NETWORK_QUALITY,{uplinkNetworkQuality:Gh(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Gh(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ea.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),r}async leave(e=!1){if("DISCONNECTED"!==this.state){this.state="DISCONNECTING";try{if(!e&&this.signal.connectionState===ua.CONNECTED){var t=this.signal.request(ha.LEAVE,void 0,!0);await u.race([t,Il(3e3)])}}catch(e){k.warning("[".concat(this.clientId,"] leave request failed, ignore"),e)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(e,t){if(!this.joinInfo)throw new m(l.UNEXPECTED_ERROR,"publish no joinInfo");let n=e.getUserId(),r=e.videoTrack?xl(e.videoTrack):{};if(e.on(G.NEED_ANSWER,(i,o,a)=>{var s;let c={state:"offer",stream_type:t,p2p_id:e.pc.ID,sdp:w(i),audio:!!e.audioTrack,video:!!e.videoTrack,screen:e.videoTrack&&-1!==E(s=e.videoTrack._hints).call(s,ib.SCREEN_TRACK),attributes:r,dtx:e.audioTrack instanceof rg&&e.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:C.PUB_EXTEND};this.signal.request(ha.PUBLISH,c,!0).then(e=>{n&&this.needToSendUnpubUnsub.set(n,!0),o(JSON.parse(e.sdp))}).catch(t=>{if(i.retry&&t.data&&t.data.code===B.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.clientId,"] receiver publish error code, retry"),t.toString()),Ha(e,G.NEED_UNPUB).then(()=>{i.retry=!1,Ha(e,G.NEED_ANSWER,i).then(o).catch(a)});t.code!==l.WS_ABORT&&a(t)})}),e.on(G.NEED_RENEGOTIATE,(n,r,i)=>{this.signal.request(ha.PUBLISH,{state:"negotiation",stream_type:t,p2p_id:e.pc.ID,sdp:n},!0).then(e=>{r(JSON.parse(e.sdp))}).catch(e=>{e.code!==l.WS_ABORT&&i(e)})}),e.on(G.NEED_UNPUB,r=>n&&!this.needToSendUnpubUnsub.has(n)?r(!1):"RECONNECTING"===this.state?r(!0):void this.signal.request(ha.UNPUBLISH,{stream_id:e.getUserId(),stream_type:t},!0).then(()=>r(!1)).catch(e=>{k.warning("unpublish warning: ",e),r(!0)})),e.on(G.NEED_UPLOAD,(e,n)=>{this.signal.upload(e,{stream_type:t,stats:n})}),e.on(G.NEED_SIGNAL_RTT,e=>{e(this.signal.rtt)}),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new m(l.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await e.startP2PConnection()}else e.readyToReconnectPC()}async subscribe(e){if(!this.joinInfo)throw new m(l.UNEXPECTED_ERROR,"subscribe no joinInfo");let t=e.getUserId();if(e.on(G.NEED_ANSWER,(n,r,i)=>{var o=e.subscribeOptions;o={stream_id:e.getUserId(),audio:!!o.audio,video:!!o.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:e.pc.ID,sdp:w(n),tcc:!!C.SUBSCRIBE_TCC,extend:C.SUB_EXTEND},this.signal.request(ha.SUBSCRIBE,o,!0).then(e=>{this.needToSendUnpubUnsub.set(t,!0),r(JSON.parse(e.sdp))}).catch(t=>{if(n.retry&&t.data&&t.data.code===B.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),t.toString()),Ha(e,G.NEED_UNSUB).then(()=>{n.retry=!1,Ha(e,G.NEED_ANSWER,n).then(r).catch(i)});t.code!==l.WS_ABORT&&i(t)})}),e.on(G.NEED_UNSUB,n=>this.needToSendUnpubUnsub.has(t)?"RECONNECTING"===this.state?n(!0):void this.signal.request(ha.UNSUBSCRIBE,{stream_id:e.getUserId()},!0).then(()=>n(!1)).catch(e=>{k.warning("unsubscribe warning",e),n(!0)}):n(!1)),e.on(G.NEED_UPLOAD,(t,n)=>{this.signal.upload(t,{stream_id:e.getUserId(),stats:n})}),e.on(G.NEED_SIGNAL_RTT,e=>{e(this.signal.rtt)}),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new m(l.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await e.startP2PConnection()}else e.readyToReconnectPC()}async subscribeChange(e,t){var r,i;if(!this.joinInfo)throw new m(l.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await e.setSubscribeOptions(t),"RECONNECTING"!==this.state){if("CONNECTED"!==this.state)return new m(l.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();k.debug(n(r=n(i="[".concat(this.clientId,"] send subscribe change, audio: ")).call(i,t.audio,", video: ")).call(r,t.video)),await this.signal.request(ha.SUBSCRIBE_CHANGE,{stream_id:e.getUserId(),audio:!!t.audio,video:!!t.video},!0)}}async unsubscribe(e){await e.closeP2PConnection()}getGatewayInfo(){return this.signal.request(ha.GATEWAY_INFO)}renewToken(e){return this.signal.request(ha.RENEW_TOKEN,{token:e})}async setClientRole(e){e!==this.role&&("CONNECTED"===this.state?(await this.signal.request(ha.SET_CLIENT_ROLE,{role:e}),this.role=e):this.role=e)}async setRemoteVideoStreamType(e,t){await this.signal.request(ha.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setStreamFallbackOption(e,t){await this.signal.request(ha.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=v()-this.inChannelInfo.joinAt),af({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ha.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=v()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=sg.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new Y,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){var e;this.joinInfo&&((e=(e=(this.signal.url||"").match(/wss:\/\/([^:]+):(\d+)/))?{username:Db.username,password:Db.password,turnServerURL:e[1],tcpport:S(e[2])+30,udpport:S(e[2])+30,forceturn:!1}:null)&&"off"!==this.joinInfo.turnServer.mode&&this.joinInfo.turnServer.servers.push(af({},Db,{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport})))}async updateTrafficStats(){var e;if("CONNECTED"===this.state){var t=await this.signal.request(ha.TRAFFIC_STATS,void 0,!0);t.timestamp=v(),r(e=t.peer_delay).call(e,e=>{var t;let n=this._statsCollector.trafficStats&&R(t=this._statsCollector.trafficStats.peer_delay).call(t,t=>t.peer_uid===e.peer_uid);n&&n.B_st!==e.B_st&&Za(()=>{this.emit(Ea.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(t)}}getJoinMessage(){if(!this.joinInfo||!this.key)throw new m(l.UNEXPECTED_ERROR,"can not generate join message, no join info");let e=Wa({},this.joinInfo.apResponse),t={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:$a,browser:navigator.userAgent,process_id:C.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extends:C.JOIN_EXTEND,details:{6:this.joinInfo.stringUid},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo};return this.joinInfo.stringUid&&(t.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(t.aes_mode=this.joinInfo.aesmode,t.aes_secret=this.joinInfo.aespassword),e.addresses[this.signal.websocket.currentURLIndex]&&(t.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),t}getRejoinMessage(){if(!this.joinInfo)throw new m(l.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(P.WS_RECONNECTING,()=>{this.joinInfo&&(this.state="RECONNECTING",t.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=v())}),this.signal.on(P.WS_CLOSED,e=>{this.reset(),this._disconnectedReason=e,this.state="DISCONNECTED"}),this.signal.on(P.WS_CONNECTED,()=>{this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&t.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(X.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(P.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new m(l.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ha(this,Ea.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(P.REQUEST_JOIN_INFO,e=>{e(this.getJoinMessage())}),this.signal.on(P.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(P.REPORT_JOIN_GATEWAY,(e,n)=>{this.joinInfo&&t.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(P.IS_P2P_DISCONNECTED,e=>{e(ad(this,Ea.IS_P2P_DISCONNECTED))}),this.signal.on(P.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new Y,this.emit(Ea.DISCONNECT_P2P)}),this.signal.on(P.NEED_RENEW_SESSION,()=>{this.emit(Ea.NEED_RENEW_SESSION)})}}class xp{constructor(e){this.client=e}updateConfig(e,r){if(r){null!=r.uploadLog&&(vc("UPLOAD_LOG",r.uploadLog),t.reportApiInvoke(this.client._sessionId||null,{name:A.SET_CONFIG_DISTRIBUTE,options:{feature:"uploadLog",value:r.uploadLog}}).onSuccess()),null!=r.dualStream&&(this.client._isDualStreamEnabled=r.dualStream,t.reportApiInvoke(this.client._sessionId||null,{name:A.SET_CONFIG_DISTRIBUTE,options:{feature:"dualStream",value:r.dualStream}}).onSuccess()),null==r.streamFallbackOptions||(this.client._defaultStreamFallbackType=r.streamFallbackOptions);try{var i,o;k.debug(n(i="[".concat(e,"] setParameter in distribution: ")).call(i,w(r))),D(o=V(r)).call(o,e=>vc(e,r[e]))}catch(t){var a;k.debug(n(a="[".concat(e,"] setParameter in distribution failed: ")).call(a,w(r)))}}}}let bf=1,cf=1;var tg=function(){function e(e){this.input=[],this.size=e}return e.prototype.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},e.prototype.diffMean=function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},e}(),ai=function(e,t){return(ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},ug=function(){return(ug=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},xd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},Qk={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},Rk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Sk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Tk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},vg=function(){function e(e,t){var n=this;this.stats=cb(xd),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=e,this.options=t,this.intervalTimer=window.setInterval((function(){return ef(n,void 0,void 0,(function(){return ff(this,(function(e){return this.updateStats(),[2]}))}))}),this.options.updateInterval)}return e.prototype.getStats=function(){return this.stats},e.prototype.destroy=function(){window.clearInterval(this.intervalTimer)},e.prototype.calcLossRate=function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,o=0,a=0,s=function(s){e[s].forEach((function(e,c){if(t.lossRateWindowStats[n-1][s][c]&&t.lossRateWindowStats[0][s][c]){var u=t.lossRateWindowStats[n-1][s][c].packets-t.lossRateWindowStats[0][s][c].packets;c=t.lossRateWindowStats[n-1][s][c].packetsLost-t.lossRateWindowStats[0][s][c].packetsLost,"videoSend"===s||"audioSend"===s?(r+=u,o+=c):(i+=u,a+=c),e.packetLostRate=0>=u||0>=c?0:c/u}}))},c=0,u=["videoSend","audioSend","videoRecv","audioRecv"];c<u.length;c++)s(u[c]);e.sendPacketLossRate=0>=r||0>=o?0:o/r,e.recvPacketLossRate=0>=i||0>=a?0:a/i},e}(),yp=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=xd,t.lastDecodeVideoReceiverStats=new Map,t}return df(t,e),t.prototype.updateStats=function(){return ef(this,void 0,void 0,(function(){var e,t,n,r;return ff(this,(function(i){switch(i.label){case 0:return[4,this._getStats()];case 1:return e=i.sent(),t=this.statsResponsesToObjects(e),this._stats=cb(xd),n=t.filter((function(e){return"ssrc"===e.type})),this.processSSRCStats(n),(r=t.find((function(e){return"VideoBwe"===e.type})))&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}}))}))},t.prototype.processBandwidthStats=function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)},t.prototype.processSSRCStats=function(e){var t=this;e.forEach((function(e){var n=e.id.includes("send");switch(e.mediaType+"_"+(n?"send":"recv")){case"video_send":(n=cb(Rk)).codec=e.googCodecName,n.adaptionChangeReason="none",e.googCpuLimitedResolution&&(n.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(n.adaptionChangeReason="bandwidth"),n.avgEncodeMs=Number(e.googAvgEncodeMs),n.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.firsCount=Number(e.googFirReceived),n.nacksCount=Number(e.googNacksReceived),n.plisCount=Number(e.googPlisReceived),n.frameCount=Number(e.framesEncoded),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(n),t._stats.rtt=n.rttMs;break;case"video_recv":n=cb(Qk);var r=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(n.codec=e.googCodecName,n.targetDelayMs=Number(e.googTargetDelayMs),n.renderDelayMs=Number(e.googRenderDelayMs),n.currentDelayMs=Number(e.googCurrentDelayMs),n.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),n.decodeMs=Number(e.googDecodeMs),n.maxDecodeMs=Number(e.googMaxDecodeMs),n.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},n.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},n.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},n.jitterBufferMs=Number(e.googJitterBufferMs),n.firsCount=Number(e.googFirsSent),n.nacksCount=Number(e.googNacksSent),n.plisCount=Number(e.googPlisSent),n.framesDecodeCount=Number(e.framesDecoded),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),0<n.packets&&!t.isFirstVideoReceived&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(),t.isFirstVideoReceived=!0),0<n.framesDecodeCount&&!t.isFirstVideoDecoded&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(n.decodedFrame.width,n.decodedFrame.height),t.isFirstVideoDecoded=!0),r){e=r.stats;var i=Date.now()-r.lts;n.framesDecodeFreezeTime=e.framesDecodeFreezeTime,n.framesDecodeInterval=e.framesDecodeInterval,n.framesDecodeCount>e.framesDecodeCount?(r.lts=Date.now(),n.framesDecodeInterval=i,500<=n.framesDecodeInterval&&(n.framesDecodeFreezeTime+=n.framesDecodeInterval)):n.framesDecodeCount<r.stats.framesDecodeCount&&(n.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:ug({},n),lts:Date.now()}),t._stats.videoRecv.push(n);break;case"audio_recv":(n=cb(Tk)).codec=e.googCodecName,n.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,n.decodingCNG=Number(e.googDecodingCNG),n.decodingCTN=Number(e.googDecodingCTN),n.decodingCTSG=Number(e.googDecodingCTSG),n.decodingNormal=Number(e.googDecodingNormal),n.decodingPLC=Number(e.googDecodingPLC),n.decodingPLCCNG=Number(e.googDecodingPLCCNG),n.expandRate=Number(e.googExpandRate),n.accelerateRate=Number(e.googAccelerateRate),n.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),n.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),n.speechExpandRate=Number(e.googSpeechExpandRate),n.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),n.jitterBufferMs=Number(e.googJitterBufferMs),n.jitterMs=Number(e.googJitterReceived),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),n.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),0<n.receivedFrames&&!t.isFirstAudioReceived&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(),t.isFirstAudioReceived=!0),0<n.decodingNormal&&!t.isFirstAudioDecoded&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(),t.isFirstAudioDecoded=!0),t._stats.audioRecv.push(n);break;case"audio_send":(n=cb(Sk)).codec=e.googCodecName,n.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,n.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),n.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),n.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),n.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.rtt=n.rttMs,t._stats.audioSend.push(n)}}))},t.prototype._getStats=function(){var e=this;return new Promise((function(t,n){e.pc.getStats(t,n)}))},t.prototype.statsResponsesToObjects=function(e){var t=[];return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t.push(n)})),t},t}(vg),ac;!function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(ac||(ac={}));var Uk=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=xd,t.lastDecodeVideoReceiverStats=new Map,t.lastVideoFramesRecv=new Map,t.lastVideoFramesSent=new Map,t.lastVideoFramesDecode=new Map,t.mediaBytesSent=new Map,t.mediaBytesRetransmit=new Map,t.mediaBytesTargetEncode=new Map,t.lastEncoderMs=new Map,t}return df(t,e),t.prototype.updateStats=function(){return ef(this,void 0,void 0,(function(){var e,t=this;return ff(this,(function(n){switch(n.label){case 0:return e=this,[4,this.pc.getStats()];case 1:return e.report=n.sent(),this._stats=cb(xd),this.report.forEach((function(e){switch(e.type){case ac.OUTBOUND:"audio"===e.mediaType?t.processAudioOutboundStats(e):"video"===e.mediaType&&t.processVideoOutboundStats(e);break;case ac.INBOUND:"audio"===e.mediaType?t.processAudioInboundStats(e):"video"===e.mediaType&&t.processVideoInboundStats(e);break;case ac.TRANSPORT:(e=t.report.get(e.selectedCandidatePairId))&&t.processCandidatePairStats(e);break;case ac.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}}))}))},t.prototype.processCandidatePairStats=function(e){this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}))},t.prototype.processAudioInboundStats=function(e){var t=this._stats.audioRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=cb(Tk),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,e.trackId&&this.processAudioTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),0<t.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),t.outputLevel&&0<t.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},t.prototype.processVideoInboundStats=function(e){var t=this._stats.videoRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=cb(Qk),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(n){var o=n.stats,a=i-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,t.framesDecodeCount>o.framesDecodeCount?(n.lts=Date.now(),t.framesDecodeInterval=a,500<=t.framesDecodeInterval&&(t.framesDecodeFreezeTime+=t.framesDecodeInterval)):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0)}r&&800<=i-r.lts?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),e.trackId&&this.processVideoTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),0<t.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),0<t.framesDecodeCount&&!this.isFirstVideoDecoded&&(r=t.decodedFrame?t.decodedFrame.width:0,i=t.decodedFrame?t.decodedFrame.height:0,this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r,i),this.isFirstVideoDecoded=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ug({},t),lts:n?n.lts:Date.now()})},t.prototype.processVideoOutboundStats=function(e){var t=this._stats.videoSend.find((function(t){return t.ssrc===e.ssrc}));t||(t=cb(Rk),this._stats.videoSend.push(t));var n,r=this.mediaBytesSent.get(e.ssrc);(r?r.add(e.bytesSent):((n=new tg(10)).add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)),void 0!==e.retransmittedBytesSent&&((r=this.mediaBytesRetransmit.get(e.ssrc))?r.add(e.retransmittedBytesSent):((n=new tg(10)).add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,n))),e.totalEncodedBytesTarget)&&((r=this.mediaBytesTargetEncode.get(e.ssrc))?r.add(e.totalEncodedBytesTarget):((n=new tg(10)).add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,n)));t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,e.totalEncodeTime&&e.framesEncoded&&(r=this.lastEncoderMs.get(e.ssrc),t.avgEncodeMs=!r||r.lastFrameCount>e.framesEncoded?1e3*e.totalEncodeTime/e.framesEncoded:1e3*(e.totalEncodeTime-r.lastEncoderTime)/(e.framesEncoded-r.lastFrameCount),this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lts:Date.now()})),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),e.trackId&&this.processVideoTrackSenderStats(e.trackId,t),e.remoteId?this.processRemoteInboundStats(e.remoteId,t):(r=this.findRemoteStatsId(e.ssrc,ac.REMOTE_INBOUND))&&this.processRemoteInboundStats(r,t)},t.prototype.processAudioOutboundStats=function(e){var t=this._stats.audioSend.find((function(t){return t.ssrc===e.ssrc}));if(t||(t=cb(Sk),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.trackId&&this.processAudioTrackSenderStats(e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,ac.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}},t.prototype.findRemoteStatsId=function(e,t){var n=Array.from(this.report.values()).find((function(n){return n.type===t&&n.ssrc===e}));return n?n.id:null},t.prototype.processVideoMediaSource=function(e,t){(e=this.report.get(e))&&(t.inputFrame={width:e.width,height:e.height,frameRate:e.framesPerSecond})},t.prototype.processAudioMediaSource=function(e,t){(e=this.report.get(e))&&(t.inputLevel=e.audioLevel)},t.prototype.processVideoTrackSenderStats=function(e,t){if(e=this.report.get(e)){var n=0,r=Date.now(),i=this.lastVideoFramesSent.get(t.ssrc);i&&800<=r-i.lts?(n=Math.round((e.framesSent-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:n})):i?n=i.rate:this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:0}),t.sentFrame={width:e.frameWidth,height:e.frameHeight,frameRate:n}}},t.prototype.processVideoTrackReceiverStats=function(e,t){if(e=this.report.get(e)){var n=this.lastVideoFramesRecv.get(t.ssrc),r=Date.now();t.framesReceivedCount=e.framesReceived;var i=0;n&&800<=r-n.lts?(i=Math.round((e.framesReceived-n.count)/((r-n.lts)/1e3)),this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:i})):n?i=n.rate:this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:0}),t.receivedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:i||0},t.decodedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},t.outputFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(t.jitterBufferMs=1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount,t.currentDelayMs=1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount)}},t.prototype.processAudioTrackSenderStats=function(e,t){(e=this.report.get(e))&&(t.aecReturnLoss=e.echoReturnLoss||0,t.aecReturnLossEnhancement=e.echoReturnLossEnhancement||0)},t.prototype.processAudioTrackReceiverStats=function(e,t){if(e=this.report.get(e)){e.removedSamplesForAcceleration&&e.totalSamplesReceived&&(t.accelerateRate=e.removedSamplesForAcceleration/e.totalSamplesReceived),e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(t.jitterBufferMs=1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount),t.outputLevel=e.audioLevel;var n=1920;e.totalSamplesDuration&&e.totalSamplesReceived&&(n=e.totalSamplesReceived/e.totalSamplesDuration/50,t.receivedFrames=Math.round(e.totalSamplesReceived/n)),e.concealedSamples&&(t.droppedFrames=Math.round(e.concealedSamples/n))}},t.prototype.processRemoteInboundStats=function(e,t){(e=this.report.get(e))&&(t.packetsLost=e.packetsLost,e.roundTripTime&&(t.rttMs=1e3*e.roundTripTime))},t.prototype.getCodecFromCodecStats=function(e){return(e=this.report.get(e))&&(e=e.mimeType.match(/\/(.*)$/))&&e[1]?e[1]:""},t.prototype.updateSendBitrate=function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach((function(t){e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((function(e){t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((function(e){n=null===n?e.diffMean():n+e.diffMean()})),this._stats.bitrate={actualEncoded:8*(null!==t?e-t:e)/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))},t}(vg),zp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return df(t,e),t.prototype.updateStats=function(){return Promise.resolve()},t}(vg);class Vk{constructor(e){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=Wk,Wk+=1,this.spec=e,this.createPeerConnection(),e=this.pc;var t,n=void 0,r=void 0;void 0===n&&(n=250),void 0===r&&(r=8),this.statsFilter=(t=(t=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&t[0]?Number(t[0].split("/")[1]):null)?76>t?new yp(e,{updateInterval:n,lossRateInterval:r}):new Uk(e,{updateInterval:n,lossRateInterval:r}):window.RTCStatsReport&&e.getStats()instanceof Promise?new Uk(e,{updateInterval:n,lossRateInterval:r}):new zp(e,{updateInterval:n,lossRateInterval:r})}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{let e=await this.pc.createOffer(this.offerOptions);if(!e.sdp)throw Error("offer sdp is empty");return e.sdp}catch(e){throw k.error("create offer error:",e.toString()),new m(l.CREATE_OFFER_FAILED,e.toString())}}async setOfferSDP(e){try{await this.pc.setLocalDescription({type:"offer",sdp:e})}catch(e){throw k.error("set local offer error",e.toString()),new m(l.CREATE_OFFER_FAILED,e.toString())}}async setAnswerSDP(e){try{await this.pc.setRemoteDescription({type:"answer",sdp:e})}catch(e){if("InvalidStateError"!==e.name||"stable"!==this.pc.signalingState)throw k.error("set remote answer error",e.toString()),new m(l.SET_ANSWER_FAILED,e.toString());k.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.close()}catch(e){}this.statsFilter.destroy()}createPeerConnection(){let e={iceServers:[{urls:"stun:webcs.agora.io:3478"}]};var t;this.spec.iceServers?e.iceServers=this.spec.iceServers:this.spec.turnServer&&"off"!==this.spec.turnServer.mode&&r(t=this.spec.turnServer.servers).call(t,t=>{var r,i;e.iceServers&&e.iceServers.push({username:t.username,credential:t.password,credentialType:"password",urls:n(r="turn:".concat(t.turnServerURL,":")).call(r,t.udpport,"?transport=udp")}),t.tcpport&&e.iceServers&&e.iceServers.push({username:t.username,credential:t.password,credentialType:"password",urls:n(i="turn:".concat(t.turnServerURL,":")).call(i,t.tcpport,"?transport=tcp")}),t.forceturn&&(e.iceTransportPolicy="relay")}),C.CHROME_FORCE_PLAN_B&&Te()&&(e.sdpSemantics="plan-b",ea.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(e),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{"closed"===this.pc.connectionState&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=e=>{if(!e.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void k.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},Cc(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,k.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},C.CANDIDATE_TIMEOUT)}}class Xk extends Vk{constructor(e){super(e)}async addStream(e){e=e.getTracks();for(let t of e)await this.addTrack(t)}async replaceTrack(e){if(!ea.supportReplaceTrack){var t="audio"===e.kind?this.audioTrack:this.videoTrack;if(!t)throw new m(l.UNEXPECTED_ERROR,"can not find replaced track");return this.removeTrack(t),await this.addTrack(e),!0}let n=this.getSender(e.kind),r=R(t=this.mediaStream.getTracks()).call(t,t=>t.kind===e.kind);r&&this.mediaStream.removeTrack(r),this.mediaStream.addTrack(e);try{await n.replaceTrack(e),"audio"===e.kind?this.audioTrack=e:this.videoTrack=e}catch(e){throw new m(l.SENDER_REPLACE_FAILED,e.toString())}return!1}removeTrack(e){let t=this.getSender(e.kind);this.mediaStream.removeTrack(e);try{this.pc.removeTrack(t)}catch(e){k.warning("[pc-".concat(this.ID,"] remove track error, ignore"),e)}"audio"===e.kind?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}async addTrack(e){let t,n,r=ea;if("audio"===e.kind&&this.audioTrack||"video"===e.kind&&this.videoTrack)throw new m(l.UNEXPECTED_ERROR,"Can't add multiple stream");this.mediaStream.addTrack(e),r.supportUnifiedPlan?(t=await hm(this.pc,e),n=t.sender):n=this.pc.addTrack(e,this.mediaStream),"audio"===e.kind?(this.audioTrack=e,this.audioSender=n,this.audioTransceiver=t):(this.videoTrack=e,this.videoSender=n,this.videoTransceiver=t)}async setRtpSenderParameters(e,t){if(e=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0)){var n=e.getParameters();n.degradationPreference=t;try{await e.setParameters(n)}catch(e){k.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),e.toString())}}}getSender(e){var t,n,r=null;ea.supportUnifiedPlan?r=(r=R(t=this.pc.getTransceivers()).call(t,t=>t.sender.track&&t.sender.track.kind===e))?r.sender:null:r=R(n=this.pc.getSenders()).call(n,t=>t.track&&t.track.kind===e)||null;if(!r)throw new m(l.SENDER_NOT_FOUND);return r}}class Yk extends Vk{constructor(e){super(e),this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(e,t)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e,t),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),ea.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=e=>{"audio"===e.track.kind?this.audioTrack=e.track:this.videoTrack=e.track,this.onTrack&&this.onTrack(e.track,e.streams[0])}}}let Wk=1,Zk=1,Ap=1/0;class $k extends Ua{constructor(e,t){super(),this.startTime=v(),this.createTime=v(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=Zk,Zk+=1,this.joinInfo=e,this._userId=t,this.createPC()}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this.emit(G.CONNECTION_STATE_CHANGE,e,this._connectionState),this._connectionState=e)}get connectionId(){var e,t;return n(e=n(t="".concat(this.joinInfo.clientId,"-")).call(t,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(e,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadStats(e,this.lastUploadPCStats),this.lastUploadPCStats=e},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadSlowStats(e)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadRelatedStats(e,this.lastRelatedPcStats),this.lastRelatedPcStats=e},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new u((e,t)=>{"disconnected"===this.connectionState?t():"connected"===this.connectionState?e():this.once(G.CONNECTION_STATE_CHANGE,n=>{"connected"===n?e():t()})})}async reconnectPC(e){if(this.readyToReconnect=!1,e&&this.onPCDisconnected(e),this.currentReconnectCount>Ap)throw k.debug("[".concat(this.connectionId,"] cannot reconnect pc")),e||new m(l.UNEXPECTED_ERROR);if(this.stopUploadStats(),k.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return k.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(G.GATEWAY_P2P_LOST),this.icePromise=new u((e,t)=>{this.pc.onICEConnectionStateChange=r=>{var i,o;k.info(n(i=n(o="[".concat(this.connectionId,"] ice-state: ")).call(o,this.type," p2p ")).call(i,r)),"connected"===r&&e(),"failed"!==r&&"closed"!==r||this.reconnectPC(new m(l.ICE_FAILED)).catch(e=>{this.emit(G.P2P_LOST),t(e)})},this.pc.onConnectionStateChange=e=>{var r,i;k.info(n(r=n(i="[".concat(this.connectionId,"] connection-state: ")).call(i,this.type," p2p ")).call(r,e)),"failed"!==e&&"closed"!==e||this.reconnectPC(new m(l.PC_CLOSED)).catch(e=>{this.emit(G.P2P_LOST),t(e)})},this.removeAllListeners(G.GATEWAY_P2P_LOST),this.once(G.GATEWAY_P2P_LOST,e=>{var r;if(this.pc.ID.toString()===e.toString()){if(k.info(n(r="[".concat(this.connectionId,"] ")).call(r,this.type," p2p gateway lost")),this.pc.allCandidateReceived&&0===this.pc.localCandidateCount)return this.disconnectedReason=new m(l.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new m(l.GATEWAY_P2P_LOST)).catch(e=>{this.emit(G.P2P_LOST),t(e)})}})})}}class al{constructor(e){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=Ia.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Ia.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Ia.CANPLAY;break;case"stalled":this.videoElementStatus=Ia.STALLED;break;case"suspend":this.videoElementStatus=Ia.SUSPEND;break;case"pause":this.videoElementStatus=Ia.PAUSED,this.videoElement&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ia.WAITING;break;case"abort":this.videoElementStatus=Ia.ABORT;break;case"ended":this.videoElementStatus=Ia.ENDED;break;case"emptied":this.videoElementStatus=Ia.EMPTIED;break;case"timeupdate":{if(e=v(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=e,500<t&&(this.freezeTime+=t),this.playbackTime+=t;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);Cc(e,500)};!this.isGettingVideoDimensions&&e()},this.slot=e.element,this.trackId=e.trackId,this.updateConfig(e)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){var t,r;e!==this._videoElementStatus&&(k.debug(n(t=n(r="[".concat(this.trackId,"] video-element-status change ")).call(r,this._videoElementStatus," => ")).call(t,e)),this._videoElementStatus=e)}updateConfig(e){this.config=e,this.trackId=e.trackId,(e=e.element)!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(){if(this.videoElement){let e=this.videoElement.play();e&&e.catch&&e.catch(e=>{k.warning("[".concat(this.trackId,"] play warning: "),e)})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");return t?(t.drawImage(this.videoElement,0,0,e.width,e.height),t=t.getImageData(0,0,e.width,e.height),e.remove(),t):(k.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(this.videoElement&&(this.videoElement.srcObject=null,this.videoElement=void 0),this.container){try{this.slot.removeChild(this.container)}catch(e){}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Ia.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Ia.ERROR,this.container&&this.container.appendChild(this.videoElement),r(we).call(we,e=>{this.videoElement&&this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Ia.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0",this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null):this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null;let e=this.videoElement.play();void 0!==e&&e.catch(e=>{k.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}removeVideoElement(){if(this.videoElement){r(we).call(we,e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=void 0,this.videoElementStatus=Ia.NONE}}}let we="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");class Bp{get output(){return this._output}async setInput(e){if(e!==this.input){if(e.kind!==this.kind)throw new m(l.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=e,await this._setInput(e)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(e){this.output!==e&&(this._output=e,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(e,t){var n,r;let i=R(n=e.getTracks()).call(n,e=>e.kind===this.kind);i&&e.removeTrack(i),t=R(r=t.getTracks()).call(r,e=>e.kind===this.kind),void 0===this.output&&t&&e.addTrack(t),this.output&&(k.debug("replace ".concat(this.output.kind," track to origin media stream")),e.addTrack(this.output))}}var bl;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(bl=HTMLCanvasElement.prototype.getContext,function(){let e=arguments;return"webgl"===e[0]&&(e=wb([]).call(arguments),e[0]="experimental-webgl"),bl.apply(null,e)}));let Cp=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],Dp=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class cl{constructor(e,t){this.gl=e,this.kernel=t||Dp,e=this.gl,t=bi(this.kernel),t=[bi(Cp),t];for(var n=[],r=0;r<t.length;++r)n.push(im(e,t[r],0===r?e.VERTEX_SHADER:e.FRAGMENT_SHADER));t=jm(e,n,void 0,void 0),n=e.getAttribLocation(t,"a_position"),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),n=e.getAttribLocation(t,"a_texCoord"),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.program=t}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(e,1)}}class Tb extends cl{constructor(e,t,n,r){super(e,t),this.denoiseLevel=5,this.xOffset=1/n,this.yOffset=1/r}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),n=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(t,this.xOffset,this.yOffset),this.gl.uniform1f(n,this.denoiseLevel),this.gl.uniform1f(e,1)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel)}setSize(e,t){this.xOffset=1/e,this.yOffset=1/t}}let Ep=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class Fp extends Tb{constructor(e,t,n){super(e,Ep,t,n)}}let Gp=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class Hp extends Tb{constructor(e,t,n){super(e,Gp,t,n)}}let Ip=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class Jp extends Tb{constructor(e,t,n){super(e,Ip,t,n)}}let Kp=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],Lp=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],dl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],Mp=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class Np extends Tb{constructor(e,t,n,r){super(e,Kp,n,r),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=t,this.init()}setUniforms(){var e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(t,this.denoiseLevel),this.gl.uniform1f(e,1),e=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(e,this.lightLevel),e=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(e,this.rednessLevel),e=this.gl.getUniformLocation(this.program,"skin_he_max"),t=this.gl.getUniformLocation(this.program,"skin_he_min");var n=this.gl.getUniformLocation(this.program,"skin_hc_max"),r=this.gl.getUniformLocation(this.program,"skin_hc_min");let i=this.gl.getUniformLocation(this.program,"skin_hc_axis"),o=this.gl.getUniformLocation(this.program,"facts_rotate_c"),a=this.gl.getUniformLocation(this.program,"facts_rotate_le"),s=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(e,this.mskin_he_max),this.gl.uniform1f(t,this.mskin_he_min),this.gl.uniform1f(n,this.mskin_hc_max),this.gl.uniform1f(r,this.mskin_hc_min),this.gl.uniform1f(i,this.mskin_hc_axis),this.gl.uniform1f(o,this.mfacts_rotate_c),this.gl.uniform1f(a,this.mfacts_rotate_le),this.gl.uniform1f(s,this.mfacts_rotate_ge),e=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(e,2),e=["lighten_lut"],t=[this.gl.TEXTURE3],n=0;n<e.length;n++)r=this.gl.getUniformLocation(this.program,e[n]),this.gl.activeTexture(t[n]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[n]),this.gl.uniform1i(r,n+3)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel),void 0!==e.lightLevel&&(this.lightLevel=e.lightLevel),void 0!==e.rednessLevel&&(this.rednessLevel=e.rednessLevel,this.updateRedness(this.rednessLevel)),e.lighteningContrastLevel&&this.updateLut(e.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(dl);let e=[this.tab_addr],t=[256],n=[1];for(let r=0;r<e.length;r++){let i=this.gl.createTexture();if(!i)throw new m(l.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(i)}}updateRedness(e){var t=e;1<e&&(e=1),0>e&&(e=0),1<t&&(t=1),0>t&&(t=0),this.mfacts_rotate_c=.8*e,.8>t&&(t=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*t)/180*3.141593,this.mskin_hc_min=(116-4*t)/180*3.141593,this.mskin_hc_axis=(117-4*t)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),e=this.mskin_he_max-this.mskin_hc_max,t=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<e?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c,e=this.mskin_hc_min-this.mskin_he_min,t=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<e?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c}updateLut(e){var t=null;if(0===e&&(t=dl),1===e&&(t=Mp),2===e&&(t=Lp),!t)throw new m(l.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+e);this.tab_addr=new Uint8Array(t),e=[this.tab_addr],t=[256];let n=[1];for(let r=0;r<e.length;r++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[r]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r])}}class Op{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(e){this.enableBeauty=!!e}init(e,t,n){if(!ea.supportWebGL)throw new m(l.NOT_SUPPORT,"your browser is not support webGL");if(this.gl=n.getContext("webgl"),!this.gl)throw new m(l.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(e,t),!this.inputTexture)throw new m(l.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=n,this.programs.push(new cl(this.gl)),this.programs.push(new Fp(this.gl,e,t)),this.programs.push(new Hp(this.gl,e,t)),this.programs.push(new Jp(this.gl,e,t)),this.programs.push(new Np(this.gl,this.inputTexture,e,t)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(e){if(this.gl&&this.commonProgram&&this.canvas){var t=0;if(this.originalFrameHeight===e.videoWidth&&this.originalFrameWidth===e.videoHeight)t=2;else if(this.originalFrameHeight!==e.videoHeight||this.originalFrameWidth!==e.videoWidth){var r,i,o;if(k.debug(n(r=n(i=n(o="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(o,this.originalFrameHeight," -> ")).call(i,e.videoWidth,"x")).call(r,e.videoHeight)),0===e.videoHeight||0===e.videoWidth)return void k.debug("beauty effect: skip 0 resolution frame");this.canvas.width=e.videoWidth,this.canvas.height=e.videoHeight,e.setAttribute("width",e.videoWidth.toString()),e.setAttribute("height",e.videoHeight.toString()),this.release(),this.init(e.videoWidth,e.videoHeight,this.canvas)}for(this.gl.viewport(0,0,e.videoWidth,e.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e=this.enableBeauty?this.programs.length-1:0,r=0;r<=e;r++)i=this.programs[r].program,this.gl.useProgram(i),i=this.gl.getUniformLocation(i,"u_image"),this.programs[r].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[t+r%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[t+r%2]),this.gl.uniform1i(i,0);this.gl.useProgram(this.commonProgram),t=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(t,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}else k.warning("video effect manager is not init!")}setDenoiseLevel(e){var t;r(t=this.programs).call(t,t=>{t instanceof Tb&&t.setParameters({denoiseLevel:e})}),this.denoiseLevel=e}setLightLevel(e){var t;r(t=this.programs).call(t,t=>{t instanceof Tb&&t.setParameters({lightLevel:e})}),this.lightLevel=e}setRednessLevel(e){var t;r(t=this.programs).call(t,t=>{t instanceof Tb&&t.setParameters({rednessLevel:e})}),this.rednessLevel=e}setContrastLevel(e){var t;r(t=this.programs).call(t,t=>{t instanceof Tb&&t.setParameters({lighteningContrastLevel:e})}),this.lighteningContrastLevel=e}setSize(e,t){var n;r(n=this.programs).call(n,n=>{n instanceof Tb&&n.setSize(e,t)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(e,t){if(!this.gl)throw new m(l.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let n=0;4>n;n++){let r=this.gl.createTexture();if(!r)throw new m(l.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>n?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let i=this.gl.createFramebuffer();if(!i)throw new m(l.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,r,0),this.outputTextures.push(r),this.fbos.push(i)}this.gl.viewport(0,0,e,t),this.originalFrameWidth=e,this.originalFrameHeight=t}}class Pp{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}async startRecordBeautyEffectOutput(e,t=4){if(this.recordID)throw new m(l.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let n=na(6,"");return this.recordID=n,this.targetFrameRate=e,this.recordedFrameCount=0,this.recordingTime=t,await Ab(1e3*this.recordingTime),this.recordID!==n?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(k.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(k.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Qp extends Bp{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new Pp,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new Op}async setBeautyEffectOptions(e,t){void 0!==t.smoothnessLevel&&W(t.smoothnessLevel,"options.smoothnessLevel",0,1,!1),void 0!==t.lighteningLevel&&W(t.lighteningLevel,"options.lighteningLevel",0,1,!1),void 0!==t.rednessLevel&&W(t.rednessLevel,"options.rednessLevel",0,1,!1),void 0!==t.lighteningContrastLevel&&Xa(t.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),void 0!==t.smoothnessLevel&&this.manager.setDenoiseLevel(Math.max(.1,10*t.smoothnessLevel)),void 0!==t.lighteningLevel&&this.manager.setLightLevel(Math.max(.1,t.lighteningLevel/2)),void 0!==t.rednessLevel&&this.manager.setRednessLevel(Math.max(.01,t.rednessLevel)),void 0!==t.lighteningContrastLevel&&this.manager.setContrastLevel(t.lighteningContrastLevel),this.enabled!==e&&(this.manager.setEnableBeauty(e),this.enabled=e,e?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){let e=va();if(!this.input)return void k.warning("video track is null, fail to start video effect!");if(this.output)return void k.warning("video effect is already enabled");let t=await this.renderWithWebGL();await this.updateOutput(t),k.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(e=>{e||this.onOverload&&this.onOverload()});let n=()=>{requestAnimationFrame(n);const e=v(),t=1e3/this.fps,r=this.lastRenderTime?e-this.lastRenderTime:t;r<t||(this.lastRenderTime=e-(r-t),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(n),e.name===da.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=We(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){k.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.video=this.canvas=void 0,await this.updateOutput(void 0)}async _setInput(e){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var e;if(!this.input)throw new m(l.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);let t=new u(e=>{const t=()=>{this.video&&this.video.removeEventListener("playing",t),e()};this.video&&this.video.addEventListener("playing",t)}),r=this.input.getSettings(),i=r.width,o=r.height;if(r.frameRate&&this.fps!==r.frameRate&&(this.fps=r.frameRate,k.debug("beauty video processor: set fps to",this.fps)),k.debug(n(e="beauty video processor: width ".concat(i," height ")).call(e,o)),!i||!o)throw new m(l.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return this.canvas.width=i,this.canvas.height=o,this.video.setAttribute("width",i.toString()),this.video.setAttribute("height",o.toString()),this.manager.init(i,o,this.canvas),this.video.play(),await t,this.canvas.captureStream(ea.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}class bb extends qg{constructor(e,t,n,r){super(e,r),this.trackMediaType="video",this._enabled=!0,Zc(e).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(og),this._encoderConfig=t,this._optimizationMode=n}get isPlaying(){return!!this._player}play(e,r={}){let i=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",r]});if(!(e instanceof HTMLElement)){let t=document.getElementById(e.toString());var o;t?e=t:(k.warning(n(o="[track-".concat(this.getTrackId(),'] can not find "#')).call(o,e,'" element, use document.body')),e=document.body)}k.debug("[track-".concat(this.getTrackId(),"] start video playback"),w(r)),e=Od({},this._getDefaultPlayerConfig(),{},r,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new al(e),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),i.onSuccess()}stop(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,k.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}async setEnabled(e){if(e!==this._enabled){k.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var t=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.enabled=!1;try{await Ya(this,L.NEED_REMOVE_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),t(),e}return this._enabled=!1,k.info("[".concat(this.getTrackId(),"] setEnabled to false success")),t()}this._originMediaStreamTrack.enabled=!0;try{await Ya(this,L.NEED_ADD_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),t(),e}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),this._enabled=!0,t()}}getStats(){return cd(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ec(this,L.GET_STATS)||Od({},te)}async setBeautyEffect(e,n={}){let r=t.reportApiInvoke(null,{tag:z.TRACER,name:A.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),e,n]});if(e||this._videoBeautyProcessor){if(!this._enabled&&e)throw e=new m(l.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),r.onError(e),e;k.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),e,w(n));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(e,n):(this._videoBeautyProcessor=new Qp,this._videoBeautyProcessor.onOverload=()=>{Za(()=>this.emit(td.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(e,n),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(e){throw k.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),e.toString()),r.onError(e),e}k.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),r.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}}class el extends bb{constructor(e,t,n,r,i){super(e,t.encoderConfig?uc(t.encoderConfig):{},r,i),this._enabled=!0,this._deviceName="default",this._config=t,this._constraints=n,this._deviceName=e.label,this._config.encoderConfig&&(this._encoderConfig=uc(this._config.encoderConfig))}async setDevice(e){var r;let i=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),e]});if(!this._enabled)throw e=new m(l.TRACK_IS_DISABLED,"can not set device when track is disabled"),i.onError(e),e;k.info(n(r="[".concat(this.getTrackId(),"] set device to ")).call(r,e));try{let t=await ub.getDeviceById(e);(r={}).video=Od({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let n=null;try{n=await Bb(r,this.getTrackId())}catch(e){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),n=await Bb({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),Zc(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw i.onError(e),k.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}k.info("[".concat(this.getTrackId(),"] setDevice success")),i.onSuccess()}async setEnabled(e){if(e!==this._enabled){k.info("[".concat(this.getTrackId(),"] start setEnabled"),e);var t=await this._enabledMutex.lock();if(!e){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),this._enabled=!1;try{await Ya(this,L.NEED_REMOVE_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),t(),e}return k.info("[".concat(this.getTrackId(),"] setEnabled to false success")),t()}e=Od({},this._constraints);var n=ub.searchDeviceIdByName(this._deviceName);n&&!e.deviceId&&(e.deviceId={exact:n});try{let e=await Bb({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),await Ya(this,L.NEED_ADD_TRACK,this)}catch(e){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),t(),e}Zc(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),this._enabled=!0,t()}}async setEncoderConfiguration(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),e]});if(!this._enabled)throw e=new m(l.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),n.onError(e),e;e=uc(e);let r=JSON.parse(w(this._config));r.encoderConfig=e;let i=gf(r);k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),w(e),w(i));try{await this._originMediaStreamTrack.applyConstraints(i),Zc(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e})}catch(t){throw e=new m(l.UNEXPECTED_ERROR,t.toString()),k.error("[track-".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),n.onError(e),e}this._config=r,this._constraints=i,this._encoderConfig=e;try{await Ya(this,L.NEED_RENEGOTIATE)}catch(e){return n.onError(e),e.throw()}n.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}}class fl extends $k{constructor(e,t,n,r){super(t,t.stringUid||t.uid),this.type="pub",this.detecting=!1,this.renegotiateWithGateway=async()=>(k.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new u(async(e,t)=>{this.connectionState="connecting";let n=r=>{"connected"===r&&(this.off(G.CONNECTION_STATE_CHANGE,n),e()),"disconnected"===r&&(this.off(G.CONNECTION_STATE_CHANGE,n),t(new m(l.OPERATION_ABORT,"renegotiate abort")))};this.on(G.CONNECTION_STATE_CHANGE,n);var r=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(r=hf(r,this.audioTrack._encoderConfig)),await this.pc.setOfferSDP(r);let i=await Ha(this,G.NEED_RENEGOTIATE,r);r=km(r,this.updateAnswerSDP(i.sdp)),await this.pc.setAnswerSDP(r),k.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(e,t)=>{"connected"===this.connectionState?this.renegotiateWithGateway().then(e).catch(t):e()},this.handleReplaceTrack=(e,t,n)=>{if(this.audioTrack instanceof Rc&&"audio"===e.kind)return u.resolve();this.pc.replaceTrack(e).then(e=>e?this.renegotiateWithGateway():u.resolve()).then(t).catch(n)},this.handleCloseAudioTrack=e=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.handleGetLocalVideoStats=e=>{e(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=e=>{e(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.isLowStreamConnection=!!r,this.codec=n,this.statsCollector=e,this.statsCollector.addLocalConnection(this)}getAllTracks(){let e=[];return this.videoTrack&&e.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof Rc?e=n(e).call(e,this.audioTrack.trackList):this.audioTrack&&e.push(this.audioTrack),e}async addTracks(e){let t=ea;if("connecting"===this.connectionState)try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(e)}catch(e){throw new m(l.OPERATION_ABORT,"publish abort")}var n=!1;let i=this.getAllTracks();e=Ih(e=M(e).call(e,e=>-1===E(i).call(i,e)));for(let r=0;r<e.length;r+=1){var o=e[r];if(!(o instanceof qg))return new m(l.INVALID_LOCAL_TRACK).throw();if(o instanceof bb&&this.videoTrack)return new m(l.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(o instanceof Va&&this.audioTrack)if(this.audioTrack instanceof Rc)this.audioTrack.addAudioTrack(o);else{if(!t.webAudioMediaStreamDest)throw new m(l.NOT_SUPPORT,"your browser is not support audio mixing");(n=new Rc).addAudioTrack(this.audioTrack),n.addAudioTrack(o),n=await this.addTrackWithPC(n)}else o instanceof bb&&this.isLowStreamConnection?(o=lm(o,n=this.lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50}),(o=new bb(o,{bitrateMax:n.bitrate,bitrateMin:n.bitrate}))._hints.push(ib.LOW_STREAM),n=await this.addTrackWithPC(o)):(this.detecting=!0,Cc(()=>{this.detecting=!1},8e3),n=await this.addTrackWithPC(o))}n&&await this.renegotiateWithGateway(),r(e).call(e,e=>this.bindTrackEvents(e))}async removeTracks(e,t){let r=this.getAllTracks();e=Ih(e=M(e).call(e,e=>-1!==E(r).call(r,e)));let i=[];for(let t=0;t<e.length;t+=1){let n=e[t];this.unbindTrackEvents(n),this.audioTrack instanceof Rc&&n instanceof Va?(this.audioTrack.removeAudioTrack(n),0===this.audioTrack.trackList.length&&(i.push(this.audioTrack),this.audioTrack=void 0)):n instanceof Va?(i.push(n),this.audioTrack=void 0):n instanceof bb&&(i.push(n),this.isLowStreamConnection&&n.close(),this.videoTrack=void 0)}if(this.videoTrack||this.audioTrack){if(0!==i.length){if("connecting"===this.connectionState)try{await this.createWaitConnectionConnectedPromise()}catch(e){return}for(let e of i){var o;k.debug(n(o="[".concat(this.connectionId,"] remove ")).call(o,e.trackMediaType," from pc")),await this.pc.removeTrack(e._mediaStreamTrack)}await this.renegotiateWithGateway()}}else await this.closeP2PConnection(t)}startP2PConnection(){return new u(async(e,n)=>{if(!this.audioTrack&&!this.videoTrack)return n(new m(l.UNEXPECTED_ERROR,"no track to publish"));let r=i=>{var o;if("connected"===i&&(t.publish(this.joinInfo.sid,{lts:this.startTime,succ:!0,ec:null,audioName:this.audioTrack&&this.audioTrack.getTrackLabel(),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||-1===E(o=this.videoTrack._hints).call(o,ib.SCREEN_TRACK)),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID}),this.off(G.CONNECTION_STATE_CHANGE,r),e()),"disconnected"===i){if(this.off(G.CONNECTION_STATE_CHANGE,r),this.disconnectedReason)return n(this.disconnectedReason);n(new m(l.OPERATION_ABORT,"publish abort"))}};this.on(G.CONNECTION_STATE_CHANGE,r),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=v();try{!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack);let e=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(e=hf(e,this.audioTrack._encoderConfig)),await this.pc.setOfferSDP(e),k.debug("[".concat(this.connectionId,"] create and set offer success"));let t=await Ha(this,G.NEED_ANSWER,{messageType:"OFFER",sdp:e,offererSessionId:104,retry:!0}),n=this.updateAnswerSDP(t.sdp);await this.pc.setAnswerSDP(n),k.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(e){var i;this.off(G.CONNECTION_STATE_CHANGE,r),this.connectionState="disconnected",t.publish(this.joinInfo.sid,{lts:this.startTime,succ:!1,ec:e.code,audioName:this.audioTrack&&this.audioTrack.getTrackLabel(),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||-1===E(i=this.videoTrack._hints).call(i,ib.SCREEN_TRACK)),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID}),k.error("[".concat(this.connectionId,"] connection error"),e.toString()),n(e)}})}async closeP2PConnection(e){let t=this.getAllTracks();var n;r(t).call(t,e=>{this.unbindTrackEvents(e)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof Rc&&r(n=this.audioTrack.trackList).call(n,e=>{this.audioTrack.removeAudioTrack(e)}),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(e),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var e,t=this.pc.getStats();if(!t.videoSend[0]&&!t.audioSend[0])return 1;var n=ec(this,G.NEED_SIGNAL_RTT),r=t.videoSend[0]?t.videoSend[0].rttMs:void 0;let i=t.audioSend[0]?t.audioSend[0].rttMs:void 0;return r=r&&i?(r+i)/2:r||i,n=.17>(n=70*t.sendPacketLossRate/50+.3*((r&&n?(r+n)/2:r||n)||0)/1500)?1:.36>n?2:.59>n?3:.1>n?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&-1===E(e=this.videoTrack._hints).call(e,ib.SCREEN_TRACK)&&(e=this.videoTrack._encoderConfig.bitrateMax,t=t.bitrate.actualEncoded,e&&t)?yo[.15>(t=(1e3*e-t)/(1e3*e))?0:.3>t?1:.45>t?2:.6>t?3:4][n]:n}uploadStats(e,t){let n=this.audioTrack?Al(e,this.audioTrack):void 0,r=this.videoTrack?zl(e,this.videoTrack):void 0,i=Fh(e,t),o=yl(e);n&&Za(()=>this.emit(G.NEED_UPLOAD,sb.PUBLISH_STATS,n)),r&&Za(()=>this.emit(G.NEED_UPLOAD,sb.PUBLISH_STATS,mm({},r,{},i))),o&&Za(()=>this.emit(G.NEED_UPLOAD,sb.PUBLISH_STATS,o))}uploadSlowStats(e){let t=Fh(e);t&&Za(()=>this.emit(G.NEED_UPLOAD,sb.PUBLISH_STATS,t))}uploadRelatedStats(e){let t=Dl(e);t&&Za(()=>{this.emit(G.NEED_UPLOAD,sb.PUBLISH_RELATED_STATS,t)})}bindTrackEvents(e){this.isLowStreamConnection||(e instanceof Va?(e.addListener(L.GET_STATS,this.handleGetLocalAudioStats),e.addListener(L.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof bb&&(e.addListener(L.GET_STATS,this.handleGetLocalVideoStats),e.addListener(L.NEED_CLOSE,this.handleCloseVideoTrack)),e.addListener(L.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.addListener(L.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(L.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(e){this.isLowStreamConnection||(e instanceof Va?(e.off(L.GET_STATS,this.handleGetLocalAudioStats),e.off(L.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof bb&&(e.off(L.GET_STATS,this.handleGetLocalVideoStats),e.off(L.NEED_CLOSE,this.handleCloseVideoTrack)),e.off(L.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.off(L.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(L.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(e){if("connecting"===this.connectionState)return new m(l.INVALID_OPERATION,"last publish operation has not finished").throw();var t=this.videoTrack;let n=!1;return this.audioTrack&&e instanceof Va?(this.audioTrack=e,k.debug("[".concat(this.connectionId,"] replace pc audio track")),n=await this.pc.replaceTrack(e._mediaStreamTrack)):this.videoTrack&&e instanceof bb?(this.videoTrack=e,k.debug("[".concat(this.connectionId,"] replace pc video track")),n=await this.pc.replaceTrack(e._mediaStreamTrack)):e instanceof Va?(this.audioTrack=e,k.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(e._mediaStreamTrack),n=!0):e instanceof bb&&(this.videoTrack=e,k.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(e._mediaStreamTrack),n=!0),e=ea,this.videoTrack!==t&&this.videoTrack&&e.supportSetRtpSenderParameters&&(t={},e="balanced",this.videoTrack._encoderConfig&&(t.maxBitrate=this.videoTrack._encoderConfig.bitrateMax?1e3*this.videoTrack._encoderConfig.bitrateMax:void 0),"motion"===this.videoTrack._optimizationMode?e="maintain-framerate":"detail"===this.videoTrack._optimizationMode&&(e="maintain-resolution"),k.debug("[".concat(this.connectionId,"] set pc rtp sender"),t,e),await this.pc.setRtpSenderParameters(t,e)),"disconnected"!==this.connectionState&&n}updateAnswerSDP(e){var t,r;if(this.videoTrack&&-1!==E(t=this.videoTrack._hints).call(t,ib.SCREEN_TRACK)&&(e=e.replace("a=x-google-flag:conference\r\n",""),"detail"===this.videoTrack._optimizationMode&&(k.debug("[".concat(this.connectionId,"] remove pc abs extension and remb")),e=e.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,""))),this.videoTrack&&this.videoTrack._encoderConfig&&-1===E(r=this.videoTrack._hints).call(r,ib.SCREEN_TRACK)){t=this.codec;var i=this.videoTrack._encoderConfig,o=ea;r=i.bitrateMin,i=i.bitrateMax;let l=e.match(/m=video.*\r\n/)||e.match(/m=video.*\n/);var a,s,c,u;if(l&&0<l.length&&o.supportMinBitrate&&r)o=null,"h264"===t?o=e.match(/a=rtpmap:(\d+) H264\/90000\r\n/)||e.match(/a=rtpmap:(\d+) H264\/90000\n/):"vp8"===t&&(o=e.match(/a=rtpmap:(\d+) VP8\/90000\r\n/)||e.match(/a=rtpmap:(\d+) VP8\/90000\n/)),o&&o[1]&&(e=e.replace(l[0],n(a=n(s="".concat(l[0],"a=fmtp:")).call(s,o[1]," x-google-min-bitrate=")).call(a,r,"\r\n")));if(l&&0<l.length&&i)a="AS",va().name===da.FIREFOX&&(i=1e3*(i>>>0),a="TIAS"),e=e.replace(l[0],n(c=n(u="".concat(l[0],"b=")).call(u,a,":")).call(c,i,"\r\n"))}return this.audioTrack&&this.audioTrack._encoderConfig&&(e=hf(e,this.audioTrack._encoderConfig)),c=e,(u=va()).name!==da.SAFARI&&u.os!==aa.IOS?c:c.replace(/a=.*video-orientation\r\n/g,"")}createPC(){this.pc=new Xk({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(e){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!e&&await Ha(this,G.NEED_UNPUB)}onPCDisconnected(e){var n;t.publish(this.joinInfo.sid,{lts:this.startTime,succ:!1,ec:e.code,audioName:this.audioTrack&&this.audioTrack.getTrackLabel(),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||-1===E(n=this.videoTrack._hints).call(n,ib.SCREEN_TRACK)),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID})}}class gl extends Nk{constructor(e,t,n){super(e),this._isDestroyed=!1,this._userId=t,this._uintId=n}getUserId(){return this._userId}_updateOriginMediaStreamTrack(e){this._mediaStreamTrack=this._originMediaStreamTrack=e,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,k.info("[track-".concat(this.getTrackId(),"] is destroyed")),this.stop()}}class yd extends gl{constructor(e,t,n){super(e,t,n),this.trackMediaType="video",Zc(e).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(og)}get isPlaying(){return!!this._player}getStats(){return cd(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ec(this,L.GET_STATS)||jf({},eg)}play(e,r={}){let i=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",r]});if("string"==typeof e){let t=document.getElementById(e);var o;t?e=t:(k.warning(n(o="[track-".concat(this.getTrackId(),'] can not find "#')).call(o,e,'" element, use document.body')),e=document.body)}k.debug("[track-".concat(this.getTrackId(),"] start video playback"),w(r)),e=jf({fit:"cover"},r,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new al(e),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(ue.FIRST_FRAME_DECODED)}),this._player.play(),i.onSuccess()}stop(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,k.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}_updatePlayerSource(){k.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class zd extends gl{constructor(e,t,n){super(e,t,n),this.trackMediaType="audio",this._useAudioElement=!1,this._source=new Pk(e,!0),this._source.once(gb.RECEIVE_TRACK_BUFFER,()=>{this.emit(ue.FIRST_FRAME_DECODED)}),ea.webAudioWithAEC||(this._useAudioElement=!0)}get isPlaying(){return this._useAudioElement?jb.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(gb.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(gb.ON_AUDIO_BUFFER),this._source.on(gb.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),e]},300);this._useAudioElement?jb.setVolume(this.getTrackId(),e):this._source.setVolume(e/100),n.onSuccess()}async setPlaybackDevice(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),e]});if(!this._useAudioElement)throw new m(l.NOT_SUPPORT,"your browser does not support setting the audio output device");try{await jb.setSinkID(this.getTrackId(),e)}catch(e){throw n.onError(e),e}n.onSuccess()}getVolumeLevel(){return this._source.getAudioLevel()}getStats(){return cd(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ec(this,L.GET_STATS)||jf({},dg)}play(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[track-".concat(this.getTrackId(),"] use audio element to play")),jb.play(this._mediaStreamTrack,this.getTrackId())):this._source.play(),e.onSuccess()}stop(){let e=t.reportApiInvoke(null,{tag:z.TRACER,name:A.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?jb.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){k.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&jb.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class Rp extends $k{constructor(e,t,r,i){super(r,e.uid),this.type="sub",this.unusedTracks=[],this.onTrack=e=>{var t,r,i,o;if("audio"===e.kind&&!this.subscribeOptions.audio||"video"===e.kind&&!this.subscribeOptions.video)return this.unusedTracks.push(e),void k.debug(n(r="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(r,e.kind));k.debug(n(t="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(t,e.kind),e),(t="audio"===e.kind?this.user._audioTrack:this.user._videoTrack)?t._updateOriginMediaStreamTrack(e):"audio"===e.kind?(this.user._audioTrack=new zd(e,this.getUserId(),this.user._uintid),k.info(n(i="[".concat(this.connectionId,"] create remote audio track: ")).call(i,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new yd(e,this.getUserId(),this.user._uintid),k.info(n(o="[".concat(this.connectionId,"] create remote video track: ")).call(o,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=e=>{e(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=e=>{e(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.user=e,this.statsCollector=t,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=i}async startP2PConnection(){return new u(async(e,r)=>{let i=n=>{if("connected"===n&&(t.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(G.CONNECTION_STATE_CHANGE,i),e()),"disconnected"===n){if(this.off(G.CONNECTION_STATE_CHANGE,i),this.disconnectedReason)return r(this.disconnectedReason);r(new m(l.OPERATION_ABORT,"subscribe abort"))}};if(this.on(G.CONNECTION_STATE_CHANGE,i),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=v(),!this.subscribeOptions)return void r(new m(l.UNEXPECTED_ERROR,"no subscribe options"));let o=new MediaStream,a=new u(e=>{this.pc.onTrack=(t,r)=>{var i,a;if("audio"===t.kind&&!this.subscribeOptions.audio||"video"===t.kind&&!this.subscribeOptions.video)return this.unusedTracks.push(t),void k.debug(n(a="[".concat(this.connectionId,"] unused ontrack event ")).call(a,t.kind));o.addTrack(t),a={audio:0<o.getAudioTracks().length,video:0<o.getVideoTracks().length},k.debug(n(i="[".concat(this.connectionId,"] subscribe ontrack: ")).call(i,t.kind),r,t);e:{var s,c;for(t=this.subscribeOptions,r=rd(s=V(a)).call(s),s=rd(c=V(t)).call(c),c=0;c<r.length;c+=1){if(r[c]!==s[c]){a=!1;break e}if(a[r[c]]!==t[r[c]]){a=!1;break e}}a=!0}a&&(this.pc.onTrack=this.onTrack,k.debug("[".concat(this.connectionId,"] get all subscribed tracks")),e(o))}});try{let e=ei(await this.pc.createOfferSDP());await this.pc.setOfferSDP(e),k.debug("[".concat(this.connectionId,"] create and set offer success"));let t=await Ha(this,G.NEED_ANSWER,{messageType:"OFFER",sdp:e,offererSessionId:104,retry:!0});await this.pc.setAnswerSDP(ei(t.sdp)),k.debug("[".concat(this.connectionId,"] set answer success"));let r=await u.all([a,this.icePromise]),i=r[0].getAudioTracks()[0],o=r[0].getVideoTracks()[0];var s,c;i&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(i):(this.user._audioTrack=new zd(i,this.getUserId(),this.user._uintid),k.info(n(s="[".concat(this.connectionId,"] create remote audio track: ")).call(s,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),o&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(o):(this.user._videoTrack=new yd(o,this.getUserId(),this.user._uintid),k.info(n(c="[".concat(this.connectionId,"] create remote video track: ")).call(c,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(e){this.off(G.CONNECTION_STATE_CHANGE,i),this.connectionState="disconnected",t.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:e.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),r(e)}})}async closeP2PConnection(e){"disconnected"!==this.connectionState&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(e),this.removeAllListeners())}getNetworkQuality(){var e=this.pc.getStats();if(!e.audioRecv[0]&&!e.videoRecv[0])return 1;var t=ec(this,G.NEED_SIGNAL_RTT),n=e.rtt;t=(n&&t?(n+t)/2:n||t)||0,n=e.audioRecv[0]?e.audioRecv[0].jitterMs:void 0;let r=70*(e=e.recvPacketLossRate)/50+.3*t/1500;return n&&(r=60*e/50+.2*t/1500+.2*n/400),.1>r?1:.17>r?2:.36>r?3:.59>r?4:5}uploadStats(e){let t=this.user.audioTrack?Cl(e,this.user.audioTrack):void 0,n=this.user.videoTrack?Bl(e,this.user.videoTrack):void 0;t&&Za(()=>this.emit(G.NEED_UPLOAD,sb.SUBSCRIBE_STATS,t)),n&&Za(()=>this.emit(G.NEED_UPLOAD,sb.SUBSCRIBE_STATS,n))}uploadSlowStats(e){}uploadRelatedStats(e,t){let n=Fl(e,this.getUserId(),this.user.audioTrack),r=El(e,this.getUserId(),t,this.user.videoTrack);n&&Za(()=>{this.emit(G.NEED_UPLOAD,sb.SUBSCRIBE_RELATED_STATS,n)}),r&&Za(()=>{this.emit(G.NEED_UPLOAD,sb.SUBSCRIBE_RELATED_STATS,r)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var e,t=this.subscribeOptions.video;if(this.subscribeOptions.audio){var n;let e=R(n=this.unusedTracks).call(n,e=>"audio"===e.kind&&"live"===e.readyState);bd(this.unusedTracks,e),e&&this.onTrack(e)}if(t)t=R(e=this.unusedTracks).call(e,e=>"video"===e.kind&&"live"===e.readyState),bd(this.unusedTracks,t),t&&this.onTrack(t)}}async setSubscribeOptions(e){var t,r,i,o;if(e.audio!==this.subscribeOptions.audio||e.video!==this.subscribeOptions.video){if("connecting"===this.connectionState)try{await this.createWaitConnectionConnectedPromise()}catch(e){throw new m(l.OPERATION_ABORT,"can not update subscribe options, operation abort")}e.audio===this.subscribeOptions.audio&&e.video===this.subscribeOptions.video||(k.debug(n(t=n(r=n(i=n(o="[".concat(this.connectionId,"] update subscribe options [a: ")).call(o,this.subscribeOptions.audio,", v: ")).call(i,this.subscribeOptions.video,"] -> [a: ")).call(r,e.audio,", v: ")).call(t,e.video,"]")),this.subscribeOptions=e,!e.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!e.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new Yk({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{t.firstRemoteFrame(this.joinInfo.sid,Ba.FIRST_AUDIO_DECODE,pa.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:v()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{t.firstRemoteFrame(this.joinInfo.sid,Ba.FIRST_AUDIO_RECEIVED,pa.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:v()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(e,n)=>{t.firstRemoteFrame(this.joinInfo.sid,Ba.FIRST_VIDEO_DECODE,pa.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:e,videoheight:n,subscribeElapse:v()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{t.firstRemoteFrame(this.joinInfo.sid,Ba.FIRST_VIDEO_RECEIVED,pa.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:v()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(e){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!e&&await Ha(this,G.NEED_UNSUB)}onPCDisconnected(e){t.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:e.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(e){e instanceof zd?e.addListener(L.GET_STATS,this.handleGetRemoteAudioStats):e instanceof yd&&e.addListener(L.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(e){e instanceof zd?e.off(L.GET_STATS,this.handleGetRemoteAudioStats):e instanceof yd&&e.off(L.GET_STATS,this.handleGetRemoteVideoStats)}}class Sp extends Ua{constructor(e,r,i,o){super(),this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=e=>{var r;e.data&&((e=JSON.parse(e.data)).requestId?this.emit(n(r="@".concat(e.requestId,"-")).call(r,e.sid),e):this.serviceMode===ma.INJECT?this.emit(hb.INJECT_STREAM_STATUS,e):(t.workerEvent(this.spec.sid,{actionType:"status",serverCode:e.code,workerType:this.serviceMode===ma.TRANSCODE?1:2}),this.emit(hb.PUBLISH_STREAM_STATUS,e)))},this.spec=r,this.token=e,this.serviceMode=o,this.websocket=new pg("live-streaming",i),this.websocket.on(Q.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Q.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Q.REQUEST_NEW_URLS,(e,t)=>{Ha(this,hb.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Q.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,r,i,o){this.reqId+=1,"request"===e&&(this.commandReqId+=1);let a=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new m(l.UNEXPECTED_ERROR);var c=kf({command:e,sdkVersion:"4.1.0"===$a?"0.0.1":$a,seq:s,requestId:s,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(v()/1e3)},r);if("closed"===this.websocket.state)throw new m(l.WS_DISCONNECT);let d=()=>new u((e,t)=>{this.websocket.once(Q.CLOSED,()=>t(new m(l.WS_ABORT))),this.websocket.once(Q.CONNECTED,e)});"connected"!==this.websocket.state&&await d(),c.clientRequest&&(c.clientRequest.workerToken=this.token);let h=new u((e,t)=>{var r;const i=()=>{t(new m(l.WS_ABORT))};this.websocket.once(Q.RECONNECTING,i),this.websocket.once(Q.CLOSED,i),this.once(n(r="@".concat(s,"-")).call(r,this.spec.sid),t=>{e(t)})});o&&t.workerEvent(this.spec.sid,kf({},o,{requestId:a,actionType:"request",payload:w(r.clientRequest),serverCode:0,code:0}));let p=v();this.websocket.sendMessage(c),c=null;try{c=await h}catch(t){if("closed"===this.websocket.state)throw t;return await d(),await this.request(e,r,i)}return o&&t.workerEvent(this.spec.sid,kf({},o,{requestId:a,actionType:"response",payload:w(c.serverResponse),serverCode:c.code,success:200===c.code,responseTime:v()-p})),200!==c.code&&this.handleResponseError(c),c}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.1.0"===$a?"0.0.1":$a;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(v()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case ka.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case ka.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ka.LIVE_STREAM_RESPONSE_BAD_STREAM:case ka.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new m(l.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case ka.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ka.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new m(l.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case ka.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new m(l.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(hb.WARNING,t,e.serverResponse.url);case ka.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return t=new m(l.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(hb.WARNING,t,e.serverResponse.url);case ka.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ka.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new m(l.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:e.code}).throw();case ka.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return t=new m(l.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(hb.WARNING,t,e.serverResponse.url);case ka.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case ka.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ka.LIVE_STREAM_RESPONSE_WORKER_LOST:case ka.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ka.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ka.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new m(l.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(og)},6e3)}}class Tp extends Ua{constructor(e,t=Na,n=Na){super(),this.retryTimeout=1e4,this.streamingTasks=new Y,this.isStartingStreamingTask=!1,this.taskMutex=new $b,this.cancelToken=Cb.CancelToken.source(),this.injectConfig=Wb({},ap),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Y,this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){var t;let i=Wb({},$o,{},e);var o,a,s,c;if(66!==i.videoCodecProfile&&77!==i.videoCodecProfile&&100!==i.videoCodecProfile&&(k.debug(n(o="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(o,i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=D(a=i.transcodingUsers).call(a,e=>Wb({},Zo,{},e,{zOrder:e.zOrder?e.zOrder+1:1}))),tl(i),e=[],i.images&&e.push(...D(s=i.images).call(s,e=>Wb({},fg,{},e,{zOrder:255}))),i.backgroundImage&&(e.push(Wb({},fg,{},i.backgroundImage,{zOrder:0})),delete i.backgroundImage),i.watermark&&(e.push(Wb({},fg,{},i.watermark,{zOrder:255})),delete i.watermark),i.images=e,i.transcodingUsers&&(i.userConfigs=D(c=i.transcodingUsers).call(c,e=>Wb({},e)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers),s=D(t=i.userConfigs||[]).call(t,e=>"number"==typeof e.uid?u.resolve(e.uid):Yh(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),t=await u.all(s),r(t).call(t,(e,t)=>{i.userConfigs&&i.userConfigs[t]&&(i.userConfigs[t].uid=e)}),this.transcodingConfig=i,this.connection)try{var l,d,h;let e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:D(l=Kb(qc(d=this.streamingTasks).call(d))).call(l,e=>e.taskId).join("#")});k.debug(n(h="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(h,e.code,", config:"),w(this.transcodingConfig))}catch(e){var p;if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),r(p=this.streamingTasks).call(p,t=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{var e;k.debug(n(e="[".concat(this.spec.clientId,"] live streaming republish ")).call(e,t.url," success"))}).catch(e=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}setInjectStreamConfig(e,t){this.injectConfig=Wa({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,r){var i,o,a,s;if(R(i=Kb(qc(o=this.streamingTasks).call(o))).call(i,e=>e.mode===ma.INJECT)&&t===ma.INJECT)return new m(l.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===ma.TRANSCODE)throw new m(l.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(i={command:"PublishStream",ts:v(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:30},k.debug(n(a=n(s="[".concat(this.spec.clientId,"] start live streaming ")).call(s,e,", mode: ")).call(a,t)),a=await this.taskMutex.lock(),this.connection||!r){if(this.streamingTasks.get(e)&&!r)return a(),new m(l.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw a(),e}switch(t){case ma.TRANSCODE:i.transcodingConfig=Wb({},this.transcodingConfig);break;case ma.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:v(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,s=this.lastTaskId++;try{var c;let o=new u((t,n)=>{Ab(this.retryTimeout).then(()=>{if(r)return n(r);const t=this.statusError.get(e);return t?(this.statusError.delete(e),n(t)):void 0})}),l=await u.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===ma.TRANSCODE?1:2,requestByUser:!r,tid:s.toString()}),o]);this.isStartingStreamingTask=!1,k.debug(n(c="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(c,l.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:s}),a()}catch(n){if(a(),this.isStartingStreamingTask=!1,!n.data||!n.data.retry||r)throw n;return n.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,n)):await this.startLiveStreamingTask(e,t,n)}}else a()}stopLiveStreamingTask(e){return new u((t,r)=>{let i=this.streamingTasks.get(e);if(!i||!this.connection)return new m(l.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let o=i.mode;i.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:o===ma.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:o===ma.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(r=>{var i;k.debug(n(i="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(i,r.code)),this.streamingTasks.delete(e),t(),o===ma.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,e)}).catch(r)})}async controlInjectStream(e,t,n,r){let i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==ma.INJECT)throw new m(l.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;let t=Kb(qc(e=this.streamingTasks).call(e));this.terminate();for(let e of t)this.startLiveStreamingTask(e.url,e.mode).catch(t=>{this.onLiveStreamError&&this.onLiveStreamError(e.url,t)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Y,this.isStartingStreamingTask=!1,this.statusError=new Y,this.cancelToken=Cb.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new m(l.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await Ha(this,Qc.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new Sp(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(hb.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(hb.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(hb.INJECT_STREAM_STATUS,e=>this.handleInjectStreamServerStatus(e)),this.connection.on(hb.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new m(l.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ha(this,Qc.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){var t=e.serverStatus.url;let n=this.streamingTasks.get(t);switch(e.code){case ka.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ka.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let r=new m(l.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return k.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)break;this.statusError.set(t,r)}case ka.LIVE_STREAM_RESPONSE_WORKER_LOST:case ka.LIVE_STREAM_RESPONSE_WORKER_QUIT:var r;if(this.connection){this.connection.tryNextAddress(),t=Kb(qc(r=this.streamingTasks).call(r));for(let n of t)n.abortTask?n.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new m(l.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{k.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}}}handleInjectStreamServerStatus(e){let t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,t,n),void this.streamingTasks.delete(n);default:return void k.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class ki{constructor(){this.destChannelMediaInfos=new Y}setSrcChannelInfo(e){Bh(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Bh(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Ie(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class Up extends Ua{constructor(e,t,n){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=e=>{this.emit("close"),this.dispose()},this.onMessage=e=>{if(!(e=JSON.parse(e.data))||"serverResponse"!==e.command||!e.requestId)return e&&"serverStatus"===e.command&&e.serverStatus&&e.serverStatus.command?(this.emit("status",e.serverStatus),void this.emit(e.serverStatus.command,e.serverStatus)):void 0;this.emit("req_".concat(e.requestId),e)},this.joinInfo=e,this.clientId=t,this.ws=new pg("cross-channel-".concat(this.clientId),n),this.ws.on(Q.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Q.CONNECTED,this.onOpen),this.ws.on(Q.ON_MESSAGE,this.onMessage),this.ws.on(Q.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new u((t,n)=>{let r=window.setTimeout(()=>{n(new m(l.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new m(l.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t()}),this.once("dispose",()=>{window.clearTimeout(r),n(new m(l.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new m(l.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new u((e,t)=>{this.ws.once(Q.CLOSED,()=>t(new m(l.WS_ABORT))),this.ws.once(Q.CONNECTED,e)}))();let t=this.sendMessage(e);if(!(e=await new u((e,n)=>{const r=()=>{n(new m(l.WS_ABORT))};this.ws.once(Q.RECONNECTING,r),this.ws.once(Q.CLOSED,r),this.once("req_".concat(t),e),Ab(3e3).then(()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(Q.RECONNECTING,r),this.ws.off(Q.CLOSED,r),n(new m(l.TIMEOUT,"cross channel ws request timeout"))})}))||200!==e.code)throw new m(l.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(w(e)));return e}async connect(e){this.ws.removeAllListeners(Q.REQUEST_NEW_URLS),this.ws.on(Q.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Vp extends Ua{constructor(e,t,r,i){super(),this.cancelToken=Cb.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=e=>{var t;k.debug(n(t="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(t,w(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),"onVideoPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{"RELAY_STATE_IDLE"!==this.state&&(k.error("auto restart channel media relay failed",e.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=e,this.clientId=t,this.signal=new Up(this.joinInfo,this.clientId,r),this.httpRetryConfig=i}set state(e){e!==this._state&&("RELAY_STATE_FAILURE"!==e&&(this.errorCode="RELAY_OK"),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}async startChannelMediaRelay(e){if("RELAY_STATE_IDLE"!==this.state)throw new m(l.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new m(l.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new m(l.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new m(l.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if("RELAY_STATE_RUNNING"!==this.state)throw new m(l.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Cb.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await gm(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){var t=this.genMessage(Da.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),t=this.genMessage(Da.SetSdkProfile,e),await this.signal.request(t),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),t=this.genMessage(Da.SetSourceChannel,e),await this.signal.request(t),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),t=this.genMessage(Da.SetSourceUserId,e),await this.signal.request(t),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),t=this.genMessage(Da.SetDestChannel,e),await this.signal.request(t),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),e=this.genMessage(Da.StartPacketTransfer,e),await this.signal.request(e),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(e){e=this.genMessage(Da.UpdateDestChannel,e),await this.signal.request(e),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(Da.StopPacketTransfer);await this.signal.request(e),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let n=[],i=[],o=[];this.requestId+=1;let a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:$a,sid:this.joinInfo.sid,ts:v(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.1.0"===a.sdkVersion&&(a.sdkVersion="0.0.1");let s=null,c=null;switch(e){case Da.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case Da.SetSourceChannel:if(c=t&&t.getSrcChannelMediaInfo(),!c)throw new m(l.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},a;case Da.SetSourceUserId:if(c=t&&t.getSrcChannelMediaInfo(),!c)throw new m(l.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:c.uid+""},a;case Da.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new m(l.UNEXPECTED_ERROR,"can not find dest config");return r(s).call(s,e=>{n.push(e.channelName),i.push(e.uid+""),o.push(e.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:o},a;case Da.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case Da.Reconnect:return a.clientRequest={command:"Reconnect"},a;case Da.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case Da.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new m(l.UNEXPECTED_ERROR,"can not find dest config");return r(s).call(s,e=>{n.push(e.channelName),i.push(e.uid+""),o.push(e.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:o},a}return a}}class Wp{constructor(e,t){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=e,this._uintid=t}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}class Xp extends Ua{constructor(e){var i,o,a,s;super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new $b,this._publishMutex=new $b,this._subscribeMutex=new Y,this._remoteStream=new Y,this._encryptionMode="none",this._encryptionSecret=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new Y,this._remoteStreamTypeCacheMap=new Y,this._axiosCancelSource=Cb.CancelToken.source(),this._handleLocalTrackEnable=(e,t,n)=>{this.publish(e,!1).then(t).catch(n)},this._handleLocalTrackDisable=(e,t,n)=>{this.unpublish(e,!1).then(t).catch(n)},this._handleUserOnline=e=>{var t;this.isStringUID&&"string"!=typeof e.uid&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let n=R(t=this._users).call(t,t=>t.uid===e.uid);n?n._trust_in_room_=!0:(t=new Wp(e.uid,e.uint_id||e.uid),this._users.push(t),k.debug("[".concat(this._clientId,"] user online"),e.uid),this.emit(O.USER_JOINED,t))},this._handleUserOffline=e=>{var t;let n=R(t=this._users).call(t,t=>t.uid===e.uid);n&&(this._handleRemoveStream(e),bd(this._users,n),this._remoteStreamTypeCacheMap.delete(n.uid),this._streamFallbackTypeCacheMap.delete(n.uid),k.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.emit(O.USER_LEAVED,n,e.reason))},this._handleAddAudioOrVideoStream=(e,r,i)=>{var o,a,s;let c=R(o=this._users).call(o,e=>e.uid===r);var u,l;c?(k.debug(n(a=n(s="[".concat(this._clientId,"] stream added with uid ")).call(s,r,", type ")).call(a,e)),o="audio"===e?c.hasAudio:c.hasVideo,c._uintid||(c._uintid=i||r),c._trust_stream_added_state_=!0,"audio"===e?c._audio_added_=!0:c._video_added_=!0,("audio"===e?c.hasAudio:c.hasVideo)&&!o&&(k.info(n(u=n(l="[".concat(this._clientId,"] remote user ")).call(l,c.uid," published ")).call(u,e)),this.emit(O.USER_PUBLISHED,c,e)),"video"===e?t.onGatewayStream(this._sessionId,Ba.ON_ADD_VIDEO_STREAM,pa.ON_ADD_VIDEO_STREAM,{peer:i||r}):t.onGatewayStream(this._sessionId,Ba.ON_ADD_AUDIO_STREAM,pa.ON_ADD_AUDIO_STREAM,{peer:i||r}),(e=this._remoteStream.get(r))&&e.readyToReconnect&&"connecting"===e.connectionState&&e.reconnectPC().catch(e=>{k.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})):k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"))},this._handleRemoveStream=e=>{var r,i;let o=R(r=this._users).call(r,t=>t.uid===e.uid);o?(k.debug(n(i="[".concat(this._clientId,"] stream removed with uid ")).call(i,e.uid)),r=()=>{},o.hasAudio&&o.hasVideo?r=()=>{var e,t;k.info(n(e="[".concat(this._clientId,"] remote user ")).call(e,o.uid," unpublished audio track")),this.emit(O.USER_UNPUBLISHED,o,"audio"),k.info(n(t="[".concat(this._clientId,"] remote user ")).call(t,o.uid," unpublished video track")),this.emit(O.USER_UNPUBLISHED,o,"video")}:o.hasVideo?r=()=>{var e;k.info(n(e="[".concat(this._clientId,"] remote user ")).call(e,o.uid," unpublished video track")),this.emit(O.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(r=()=>{var e;k.info(n(e="[".concat(this._clientId,"] remote user ")).call(e,o.uid," unpublished audio track")),this.emit(O.USER_UNPUBLISHED,o,"audio")}),o._trust_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,(i=this._remoteStream.get(o.uid))&&(i.closeP2PConnection(),this._remoteStream.delete(o.uid)),t.onGatewayStream(this._sessionId,Ba.ON_REMOVE_STREAM,pa.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),r()):k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"))},this._handleSetStreamLocalEnable=(e,t,r)=>{var i,o,a,s,c,u;let l=R(i=this._users).call(i,e=>e.uid===t);if(l){if(k.debug(n(o=n(a=n(s="[".concat(this._clientId,"] local ")).call(s,e," ")).call(a,r?"enabled":"disabled"," with uid ")).call(o,t)),i="audio"===e?l.hasAudio:l.hasVideo,"audio"===e){l._trust_audio_enabled_state_=!0;var d,h,p=l._audio_enabled_;if(l._audio_enabled_=r,l._audio_enabled_===p)return;r=l._audio_enabled_?"enable-local-audio":"disable-local-audio",k.debug(n(d=n(h="[".concat(this._clientId,"] user-info-updated, uid: ")).call(h,t,", msg: ")).call(d,r)),this.emit(O.USER_INFO_UPDATED,t,r)}else{if(l._trust_video_enabled_state_=!0,d=l._video_enabled_,l._video_enabled_=r,l._video_enabled_===d)return;var f;r=l._video_enabled_?"enable-local-video":"disable-local-video",k.debug(n(p=n(f="[".concat(this._clientId,"] user-info-update, uid: ")).call(f,t,", msg: ")).call(p,r)),this.emit(O.USER_INFO_UPDATED,t,r)}if(i!==(r="audio"===e?l.hasAudio:l.hasVideo)){var g,m;if(!i&&r)return k.info(n(g=n(m="[".concat(this._clientId,"] remote user ")).call(m,t," published ")).call(g,e)),void this.emit(O.USER_PUBLISHED,l,e);(g=this._remoteStream.get(t))&&((m=Bc({},g.subscribeOptions)).audio=!!l.hasAudio&&m.audio,m.video=!!l.hasVideo&&m.video,m.audio||m.video?g.setSubscribeOptions(m):(g.closeP2PConnection().catch(e=>{k.warning("close sub pc error",e)}),this._remoteStream.delete(l.uid))),k.info(n(c=n(u="[".concat(this._clientId,"] remote user ")).call(u,l.uid," unpublished ")).call(c,e)),this.emit(O.USER_UNPUBLISHED,l,e)}}else k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"))},this._handleMuteStream=(e,t,r)=>{var i,o,a;k.debug("[".concat(this._clientId,"] receive mute message"),e,t,r);let s=R(i=this._users).call(i,t=>t.uid===e);var c;if(s){if(i="audio"===t?s.hasAudio:s.hasVideo,"audio"===t){s._trust_audio_mute_state_=!0;var u,l,d=s._audio_muted_;if(s._audio_muted_=r,s._audio_muted_===d)return;r=s._audio_muted_?"mute-audio":"unmute-audio",k.debug(n(u=n(l="[".concat(this._clientId,"] user-info-update, uid: ")).call(l,e,", msg: ")).call(u,r)),this.emit(O.USER_INFO_UPDATED,e,r)}else{if(s._trust_video_mute_state_=!0,u=s._video_muted_,s._video_muted_=r,s._video_muted_===u)return;var h;r=s._video_muted_?"mute-video":"unmute-video",k.debug(n(d=n(h="[".concat(this._clientId,"] user-info-update, uid: ")).call(h,e,", msg: ")).call(d,r)),this.emit(O.USER_INFO_UPDATED,e,r)}if(i!==(r="audio"===t?s.hasAudio:s.hasVideo)){var p,f;if(!i&&r)return k.info(n(p=n(f="[".concat(this._clientId,"] remote user ")).call(f,e," published ")).call(p,t)),void this.emit(O.USER_PUBLISHED,s,t);(p=this._remoteStream.get(e))&&((f=Bc({},p.subscribeOptions)).audio=!!s.hasAudio&&f.audio,f.video=!!s.hasVideo&&f.video,f.audio||f.video?p.setSubscribeOptions(f):(p.closeP2PConnection().catch(e=>{k.warning("close sub pc error",e)}),this._remoteStream.delete(s.uid))),k.info(n(o=n(a="[".concat(this._clientId,"] remote user ")).call(a,e," unpublished ")).call(o,t)),this.emit(O.USER_UNPUBLISHED,s,t)}}else k.warning(n(c="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(c,e))},this._handleP2PLost=e=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),e);let t=null;if(this._highStream&&this._highStream.pc.ID===e.p2pid)t=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===e.p2pid)t=this._lowStream;else{var n;r(n=this._remoteStream).call(n,n=>{n.pc.ID===e.p2pid&&(t=n)})}t?t.emit(G.GATEWAY_P2P_LOST,e.p2pid):k.warning("P2PLost stream not found",e)},this._handleTokenWillExpire=()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(O.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=e=>{void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var e;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.emit(O.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let t={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(t.uplinkNetworkQuality=this._highStream.getNetworkQuality());let n=0;r(e=this._remoteStream).call(e,e=>n+=e.getNetworkQuality()),0<this._remoteStream.size&&(t.downlinkNetworkQuality=Math.round(n/this._remoteStream.size)),this.emit(O.NETWORK_QUALITY,t)},this._codec=e.codec,this._mode=e.mode,e.proxyServer&&(this._proxyServer=e.proxyServer,t.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer)),e.turnServer&&(this._turnServer=Bc({},this._turnServer,{mode:"manual"},e.turnServer)),this._clientId=na(5,"client-"),k.info(n(i=n(o=n(a=n(s="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(s,$a," build: ")).call(a,"v4.1.0-0-g64d4440(9/4/2020, 5:57:23 PM)",", mode: ")).call(o,this._mode,", codec: ")).call(i,this._codec)),this._statsCollector=new Yc(this._clientId),this._statsCollector.onStatsException=(e,t,r)=>{var i,o,a;k.debug(n(i=n(o=n(a="[".concat(this._clientId,"] receive exception msg, code: ")).call(a,e,", msg: ")).call(o,t,", uid: ")).call(i,r)),this.emit(O.EXCEPTION,{code:e,msg:t,uid:r})},this._statsCollector.onUploadPublishDuration=(e,n,r,i)=>{var o;let a=R(o=this._users).call(o,t=>t.uid===e);a&&t.peerPublishStatus(this._sessionId,{subscribeElapse:i,audioPublishDuration:n,videoPublishDuration:r,peer:a._uintid})},this._gateway=new wp({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:e.websocketRetryConfig||Na,httpRetryConfig:e.httpRetryConfig||Na,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role}),this._config=e,this._configDistribute=new xp(this),this._handleGatewayEvents(),dk.push(this)}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(e,r,i,o,a){var s;let c=t.reportApiInvoke(this._sessionId,{name:A.JOIN,options:[e,r,i,o],tag:z.TRACER});try{if(!i&&null!==i)throw new m(l.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Ga(i,"token",1,2047),Ie(r),o&&Je(o),a&&Ga(a,"optionalInfo",1,2047)}catch(e){throw c.onError(e),e}if(k.info(n(s="[".concat(this._clientId,"] start join channel ")).call(s,r)),this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),"DISCONNECTED"!==this.connectionState)throw e=new m(l.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),c.onError(e),e;this._sessionId=na(32,"").toUpperCase(),this._gateway.state="CONNECTING";let u={clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:"string"!=typeof o?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a};"string"==typeof o&&(u.stringUid=o,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret&&(u.aesmode=this._encryptionMode,u.aespassword=this._encryptionSecret),t.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r,appid:e,mode:this._mode}),Cc(()=>{"CONNECTING"===this.connectionState&&t.joinChannelTimeout(this._sessionId,5)},5e3);try{var d;if(await em(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Na),u.stringUid&&!u.uid){var h;let e=await Yh(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||Na);k.debug(n(h="getUserAccount Success ".concat(u.stringUid," => ")).call(h,e)),u.uid=e}let t=await Xh(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Na);var p;u.proxyServer&&(t.gatewayInfo.gatewayAddrs=D(p=t.gatewayInfo.gatewayAddrs).call(p,e=>{var t,r;return e=e.split(":"),n(t=n(r="".concat(u.proxyServer,"/ws/?h=")).call(r,e[0],"&p=")).call(t,e[1])})),this._configDistribute.updateConfig(this._clientId,t.configDistribute),this._key=i||e,this._joinInfo=Bc({},u,{cid:t.gatewayInfo.cid,uid:u.uid?u.uid:t.gatewayInfo.uid,vid:t.gatewayInfo.vid,apResponse:t.gatewayInfo.res,uni_lbs_ip:t.gatewayInfo.uni_lbs_ip,gatewayAddrs:t.gatewayInfo.gatewayAddrs});let o=await this._gateway.join(this._joinInfo,this._key);return c.onSuccess(o),this._appId=e,this._channelName=u.cname,this._uid=o,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),k.info(n(d="[".concat(this._clientId,"] Joining channel success: ")).call(d,r)),o}catch(e){throw k.error("[".concat(this._clientId,"] Joining channel failed, rollback"),e),e.code!==l.OPERATION_ABORT&&(this._gateway.state="DISCONNECTED",this._reset()),c.onError(e),e}}async leave(){let e=t.reportApiInvoke(this._sessionId,{name:A.LEAVE,options:[],tag:z.TRACER});k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset();let n=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),n(),e.onSuccess();await this._gateway.leave("CONNECTED"!==this.connectionState),k.info("[".concat(this._clientId,"] Leaving channel success")),n(),e.onSuccess()}async publish(e,i=!0){var o,a;cc(e)||(e=[e]);let s=t.reportApiInvoke(this._sessionId,{name:A.PUBLISH,options:D(e).call(e,e=>e.getTrackId()),tag:z.TRACER});if(0===e.length)return e=new m(l.INVALID_PARAMS,"track list is empty"),s.onError(e),e.throw();for(let t of e)if(!t._enabled&&i)return e=new m(l.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(t.getTrackId())),s.onError(e),e.throw();k.info(n(o="[".concat(this._clientId,"] Publishing tracks, id ")).call(o,D(e).call(e,e=>"".concat(e.getTrackId()," ")))),o=await this._publishMutex.lock();try{if("live"===this._mode&&"audience"===this._gateway.role)throw new m(l.INVALID_OPERATION,"audience can not publish stream");let t=await this._publishHighStream(e),n=(t.audioTrack,t.videoTrack);this._isDualStreamEnabled&&n&&!this._lowStream&&await this._publishLowStream(n),i&&r(e).call(e,e=>{var t;-1===E(t=this._bindEnabledTracks).call(t,e)&&(e.addListener(L.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.addListener(L.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(e))}),o(),s.onSuccess()}catch(e){throw o(),s.onError(e),k.error("[".concat(this._clientId,"] publish error"),e.toString()),e}k.info(n(a="[".concat(this._clientId,"] Publish success, id ")).call(a,D(e).call(e,e=>"".concat(e.getTrackId()," "))))}async unpublish(e,i=!0){var o,a,s;if(!this._highStream)return void k.warning("[".concat(this._clientId,"] Could not find tracks to unpublish"));var c=this._highStream.getAllTracks();e?cc(e)||(e=[e]):e=this._highStream.getAllTracks(),c=Jl(c,e);let u=t.reportApiInvoke(this._sessionId,{name:A.UNPUBLISH,options:D(e).call(e,e=>e.getTrackId()),tag:z.TRACER});if(k.info(n(o=n(a="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(a,D(e).call(e,e=>"".concat(e.getTrackId()," ")),", isClosePC: ")).call(o,c)),o=c?void 0:await this._publishMutex.lock(),!this._highStream)return k.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(o&&o());try{this._lowStream&&0<M(e).call(e,e=>"video"===e.trackMediaType).length&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),c?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(e),o&&o()}catch(e){if(e.code!==l.OPERATION_ABORT)throw u.onError(e),k.error("[".concat(this._clientId,"] unpublish error"),e.toString()),o&&o(),e;k.debug("[".concat(this._clientId,"] ignore unpub operation abort"))}this._highStream&&"disconnected"===this._highStream.connectionState&&(this._highStream=void 0,this._lowStream=void 0),i&&r(e).call(e,e=>{var t,n;let r=E(t=this._bindEnabledTracks).call(t,e);-1!==r&&(e.off(L.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(L.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Ma(n=this._bindEnabledTracks).call(n,r,1))}),k.info(n(s="[".concat(this._clientId,"] Unpublish success,tracks ")).call(s,D(e).call(e,e=>"".concat(e.getTrackId())))),u.onSuccess()}async subscribe(e,r){var i,o,a,s;Xa(r,"mediaType",["audio","video"]);let c=t.reportApiInvoke(this._sessionId,{name:A.SUBSCRIBE,options:[e.uid,r],tag:z.TRACER});if(!this._joinInfo)throw r=new m(l.INVALID_OPERATION,"Can't subscribe stream, no join info"),c.onError(r),r;if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw r=new m(l.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state")),c.onError(r),r;var u,d;if(!R(i=this._users).call(i,t=>t===e))throw r=new m(l.INVALID_REMOTE_USER,"user is not in the channel"),k.error(n(u="[".concat(this._clientId,"] can not subscribe ")).call(u,e.uid,", this user is not in the channel")),c.onError(r),r;if(!e.hasAudio&&!e.hasVideo)throw r=new m(l.INVALID_REMOTE_USER,"user is not published"),k.error(n(d="[".concat(this._clientId,"] can not subscribe ")).call(d,e.uid,", user is not published")),c.onError(r),r;if(u={audio:"audio"===r,video:"video"===r},!e.hasAudio&&u.audio||!e.hasVideo&&u.video){var h,p,f=new m(l.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error(n(h=n(p="[".concat(this._clientId,"] can not subscribe ")).call(p,e.uid," with mediaType ")).call(h,r,", remote track is not published")),c.onError(f),f}(h=this._subscribeMutex.get(e.uid))||(h=new $b,this._subscribeMutex.set(e.uid,h)),k.info(n(o=n(a="[".concat(this._clientId,"] subscribe user ")).call(a,e.uid,", mediaType: ")).call(o,r)),o=await h.lock(),a=this._remoteStream.get(e.uid);try{if(a)u.audio=u.audio||a.subscribeOptions.audio,u.video=u.video||a.subscribeOptions.video,await this._gateway.subscribeChange(a,u);else{a=new Rp(e,this._statsCollector,this._joinInfo,u),this._remoteStream.set(e.uid,a);try{await this._gateway.subscribe(a)}catch(t){throw this._remoteStream.delete(e.uid),t}a.on(G.CONNECTION_STATE_CHANGE,(t,n)=>{"connecting"===t?this.emit(O.MEDIA_RECONNECT_START,e.uid):"connected"===t&&this.emit(O.MEDIA_RECONNECT_END,e.uid)})}o()}catch(t){var g;throw c.onError(t),o(),k.error(n(g="[".concat(this._clientId,"] subscribe user ")).call(g,e.uid," error"),t),t}return k.info(n(f=n(s="[".concat(this._clientId,"] subscribe success user ")).call(s,e.uid,", mediaType: ")).call(f,r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}),(r="audio"===r?e.audioTrack:e.videoTrack)?(c.onSuccess(r.getTrackId()),r):(r=new m(l.UNEXPECTED_ERROR,"can not find remote track in user object"),c.onError(r),r.throw())}async unsubscribe(e,r){var i,o,a,s,c;r&&Xa(r,"mediaType",["audio","video"]);let u=t.reportApiInvoke(this._sessionId,{name:A.UNSUBSCRIBE,options:[e.uid,r],tag:z.TRACER});var d,h;if(!R(i=this._users).call(i,t=>t===e))throw r=new m(l.INVALID_REMOTE_USER,"user is not in the channel"),k.error(n(d="[".concat(this._clientId,"] can not subscribe ")).call(d,e.uid,", user is not in the channel")),u.onError(r),r;if(k.info(n(o=n(a="[".concat(this._clientId,"] unsubscribe uid: ")).call(a,e.uid,", mediaType: ")).call(o,r)),(d=this._subscribeMutex.get(e.uid))||(d=new $b,this._subscribeMutex.set(e.uid,d)),d=await d.lock(),!(i=this._remoteStream.get(e.uid)))return k.warning(n(h="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(h,e.uid)),void u.onSuccess();h=Bc({},i.subscribeOptions),"audio"===r?h.audio=!1:("video"===r||(h.audio=!1),h.video=!1);try{h.audio||h.video?await this._gateway.subscribeChange(i,h):(await i.closeP2PConnection(),this._remoteStream.delete(e.uid)),d()}catch(t){var p;if(t.code!==l.OPERATION_ABORT)throw u.onError(t),d(),k.error(n(p="[".concat(this._clientId,"] unsubscribe user ")).call(p,e.uid," error"),t.toString()),t;k.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}k.info(n(s=n(c="[".concat(this._clientId,"] unsubscribe success uid: ")).call(c,e.uid,", mediaType: ")).call(s,r)),u.onSuccess()}setLowStreamParameter(e){if(!e)throw new m(l.INVALID_PARAMS);null==e.width||W(e.width,"streamParameter.width"),null==e.height||W(e.height,"streamParameter.height"),null==e.framerate||W(e.framerate,"streamParameter.framerate"),null==e.bitrate||W(e.bitrate,"streamParameter.bitrate");let n=t.reportApiInvoke(this._sessionId,{name:A.SET_LOW_STREAM_PARAMETER,options:[e],tag:z.TRACER});(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),w(e)),this._lowStreamParameter=e,n.onSuccess()}async enableDualStream(){let e=t.reportApiInvoke(this._sessionId,{name:A.ENABLE_DUAL_STREAM,options:[],tag:z.TRACER});if(!ea.supportDualStream){t.streamSwitch(this._sessionId,{lts:v(),isdual:!0,succ:!1});var n=new m(l.NOT_SUPPORT,"Your browser is not support dual stream");throw e.onError(n),n}if(this._isDualStreamEnabled)throw n=new m(l.INVALID_OPERATION,"Dual stream is already enabled"),e.onError(n),n;if(this._highStream&&"connected"===this._highStream.connectionState&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(n){throw t.streamSwitch(this._sessionId,{lts:v(),isdual:!0,succ:!1}),e.onError(n),n}this._isDualStreamEnabled=!0,this._highStream&&(this._highStream.lowStreamConnection=this._lowStream),t.streamSwitch(this._sessionId,{lts:v(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream")),e.onSuccess()}async disableDualStream(){let e=t.reportApiInvoke(this._sessionId,{name:A.DISABLE_DUAL_STREAM,options:[],tag:z.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(n){throw t.streamSwitch(this._sessionId,{lts:v(),isdual:!1,succ:!1}),e.onError(n),n}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),t.streamSwitch(this._sessionId,{lts:v(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream")),e.onSuccess()}async setClientRole(e){Xa(e,"role",["audience","host"]);let r=t.reportApiInvoke(this._sessionId,{name:A.SET_CLIENT_ROLE,options:[e],tag:z.TRACER});if("rtc"===this._mode)return k.warning("rtc mode can not use setClientRole"),e=new m(l.INVALID_OPERATION,"rtc mode can not use setClientRole"),r.onError(e),e.throw();try{var i;if("audience"===e&&this._highStream)throw new m(l.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e),k.info(n(i="[".concat(this._clientId,"] set client role to ")).call(i,e)),r.onSuccess()}catch(e){throw r.onError(e),e}}setProxyServer(e){Ga(e,"proxyServer");let n=t.reportApiInvoke(this._sessionId,{name:A.SET_PROXY_SERVER,options:[e],tag:z.TRACER});if("DISCONNECTED"!==this.connectionState)throw new m(l.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new m(l.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=e,t.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),n.onSuccess()}setTurnServer(e){cc(e)||(e=[e]),r(e).call(e,e=>Ah(e));let n=t.reportApiInvoke(this._sessionId,{name:A.SET_TURN_SERVER,options:e,tag:z.TRACER});if("DISCONNECTED"!==this.connectionState)throw new m(l.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new m(l.INVALID_OPERATION,"You have already set the proxy");this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver.")),n.onSuccess()}startProxyServer(e){let n=t.reportApiInvoke(this._sessionId,{name:A.START_PROXY_SERVER,options:[],tag:z.TRACER});if("DISCONNECTED"!==this.connectionState)throw new m(l.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode)throw new m(l.INVALID_OPERATION,"You have already set the proxy");this._cloudProxyServerMode=e?"443only":"normal",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),n.onSuccess()}stopProxyServer(){let e=t.reportApiInvoke(this._sessionId,{name:A.STOP_PROXY_SERVER,options:[],tag:z.TRACER});if("DISCONNECTED"!==this.connectionState)throw new m(l.INVALID_OPERATION,"Stop proxy server after leave channel");t.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},e.onSuccess()}async setRemoteVideoStreamType(e,r){var i,o;Xa(r,"streamType",[0,1]);let a=t.reportApiInvoke(this._sessionId,{name:A.SET_REMOTE_VIDEO_STREAM_TYPE,options:[e,r],tag:z.TRACER});try{await this._gateway.setRemoteVideoStreamType(e,r)}catch(e){throw a.onError(e),k.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}k.info(n(i=n(o="[".concat(this._clientId,"] set remote ")).call(o,e," video stream type to ")).call(i,r)),this._remoteStreamTypeCacheMap.set(e,r),a.onSuccess()}async setStreamFallbackOption(e,r){var i,o;Xa(r,"fallbackType",[0,1,2]);let a=t.reportApiInvoke(this._sessionId,{name:A.SET_STREAM_FALLBACK_OPTION,options:["too long to show",r],tag:z.TRACER});try{await this._gateway.setStreamFallbackOption(e,r)}catch(e){throw a.onError(e),k.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}k.info(n(i=n(o="[".concat(this._clientId,"] set remote ")).call(o,e," stream fallback type to ")).call(i,r)),this._streamFallbackTypeCacheMap.set(e,r),a.onSuccess()}setEncryptionConfig(e,n){Xa(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","none"]),Ga(n,"secret");let r=t.reportApiInvoke(this._sessionId,{name:A.SET_ENCRYPTION_CONFIG,options:[e],tag:z.TRACER});this._encryptionMode=e,this._encryptionSecret=n,r.onSuccess()}async renewToken(e){Ga(e,"token",1,2047);let n=t.reportApiInvoke(this._sessionId,{name:A.RENEW_TOKEN,options:[e],tag:z.TRACER});if(!this._key)return e=new m(l.INVALID_OPERATION,"renewToken should not be called before user join"),n.onError(e),e.throw();this._key=e;try{await this._gateway.renewToken(e)}catch(e){throw n.onError(e),k.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}k.debug("[".concat(this._clientId,"] renewToken success")),n.onSuccess()}enableAudioVolumeIndicator(){let e=t.reportApiInvoke(this._sessionId,{name:A.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:z.TRACER});if(this._audioVolumeIndicationInterval)return k.warning("you have already enabled audio volume indicator!"),e.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var e,t,n;let r=rd(e=D(t=Kb(qc(n=this._remoteStream).call(n))).call(t,e=>({level:e.user.audioTrack?100*e.user.audioTrack._source.getAudioAvgLevel():0,uid:e.getUserId()}))).call(e,(e,t)=>e.level-t.level);this._highStream&&this._highStream.audioTrack&&(r.push({level:100*this._highStream.audioTrack._source.getAudioAvgLevel(),uid:this._highStream._userId}),r=rd(r).call(r,(e,t)=>e.level-t.level)),this.emit(O.VOLUME_INDICATOR,r)},C.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),e.onSuccess()}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,n){let r=t.reportApiInvoke(this._sessionId,{name:A.START_LIVE_STREAMING,options:[e,n],tag:z.TRACER});if(!n){if("h264"!==this._codec)return e=new m(l.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),r.onError(e),u.reject(e);if(!this._highStream)return e=new m(l.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),r.onError(e),u.reject(e)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e)?(e=new m(l.LIVE_STREAMING_TASK_CONFLICT),r.onError(e),u.reject(e)):(n=n?ma.TRANSCODE:ma.RAW,this._createLiveStreamingClient(n).startLiveStreamingTask(e,n).then(()=>r.onSuccess()).catch(e=>{throw r.onError(e),e}))}setLiveTranscoding(e){let n=t.reportApiInvoke(this._sessionId,{name:A.SET_LIVE_TRANSCODING,options:[e],tag:z.TRACER});return this._createLiveStreamingClient(ma.TRANSCODE).setTranscodingConfig(e).then(()=>n.onSuccess()).catch(e=>{throw n.onError(e),e})}stopLiveStreaming(e){var n;let r=t.reportApiInvoke(this._sessionId,{name:A.STOP_LIVE_STREAMING,options:[e],tag:z.TRACER}),i=M(n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(n,t=>t&&t.hasUrl(e));return i.length?u.all(D(i).call(i,t=>t&&t.stopLiveStreamingTask(e))).then(()=>r.onSuccess()).catch(e=>{throw r.onError(e),e}):(n=new m(l.INVALID_PARAMS,"can not find live streaming url to stop"),r.onError(n),u.reject(n))}async addInjectStreamUrl(e,n){let r=t.reportApiInvoke(this._sessionId,{name:A.ADD_INJECT_STREAM_URL,options:[e,n],tag:z.TRACER});try{if(!this._joinInfo)throw new m(l.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let t=this._createLiveStreamingClient(ma.INJECT);t.setInjectStreamConfig(n,0),await t.startLiveStreamingTask(e,ma.INJECT)}catch(e){throw r.onError(e),e}r.onSuccess()}async removeInjectStreamUrl(){let e=t.reportApiInvoke(this._sessionId,{name:A.REMOVE_INJECT_STREAM_URL,options:[],tag:z.TRACER});try{var n,r;let e=this._createLiveStreamingClient(ma.INJECT),t=R(n=Kb(qc(r=e.streamingTasks).call(r))).call(n,e=>e.mode===ma.INJECT);if(!this._joinInfo||!t)throw new m(l.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(t.url)}catch(t){throw e.onError(t),t}e.onSuccess()}async startChannelMediaRelay(e){let n=t.reportApiInvoke(this._sessionId,{name:A.START_CHANNEL_MEDIA_RELAY,options:[e],tag:z.TRACER});try{ji(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}catch(e){return n.onError(e),e.throw()}n.onSuccess()}async updateChannelMediaRelay(e){let n=t.reportApiInvoke(this._sessionId,{name:A.UPDATE_CHANNEL_MEDIA_RELAY,options:[e],tag:z.TRACER});try{ji(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}catch(e){return n.onError(e),e.throw()}n.onSuccess()}async stopChannelMediaRelay(){let e=t.reportApiInvoke(this._sessionId,{name:A.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:z.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(t){return e.onError(t),t.throw()}e.onSuccess()}sendMetadata(e){if(!this._joinInfo)throw new m(l.INVALID_OPERATION,"can not send metadata, no join info");if(1024<new Blob([e]).size)throw new m(l.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ha.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Kl(e)})}async sendCustomReportMessage(e){cc(e)||(e=[e]),r(e).call(e,sl);let n=t.reportApiInvoke(this._sessionId,{name:A.SEND_CUSTOM_REPORT_MESSAGE,options:[],tag:z.TRACER});if(!this._joinInfo)return e=new m(l.INVALID_OPERATION,"can not send custom report, no join info"),n.onError(e),e.throw();await t.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._highStream?this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId):se}getRemoteAudioStats(){var e;let t={};return r(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteAudioTrackStats(e.connectionId)}),t}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):te}getRemoteVideoStats(){var e;let t={};return r(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteVideoTrackStats(e.connectionId)}),t}_reset(){var e,t,n;k.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Cb.CancelToken.source(),this._streamFallbackTypeCacheMap=new Y,this._remoteStreamTypeCacheMap=new Y,this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,r(e=this._users).call(e,e=>{e.audioTrack&&(e.audioTrack.stop(),e.audioTrack._isDestroyed=!0),e.videoTrack&&(e.videoTrack.stop(),e.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),r(t=this._bindEnabledTracks).call(t,e=>{e.off(L.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(L.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),r(n=this._remoteStream).call(n,e=>{e.closeP2PConnection(!0)}),this._remoteStream=new Y,this._publishMutex=new $b,this._subscribeMutex=new Y,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_renewSession(){var e,t;let r=na(32,"").toUpperCase();k.debug(n(e=n(t="[".concat(this._clientId,"] renewSession ")).call(t,this._sessionId," => ")).call(e,r)),this._sessionId=r,this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo)throw new m(l.INVALID_OPERATION,"Can't publish stream, no join info!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new m(l.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&C.FORCE_TURN&&!C.TURN_ENABLE_TCP&&!C.TURN_ENABLE_UDP)throw new m(l.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(k.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(e),this._highStream;this._highStream=new fl(this._statsCollector,this._joinInfo,this._codec),await this._highStream.addTracks(e);try{await this._gateway.publish(this._highStream,"high")}catch(e){throw this._highStream=void 0,e}return this._highStream.on(G.CONNECTION_STATE_CHANGE,(e,t)=>{this._highStream&&("connected"===e?this.emit(O.MEDIA_RECONNECT_END,this._highStream.getUserId()):"connecting"===e&&this.emit(O.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(e){if(!this._joinInfo)throw new m(l.INVALID_OPERATION,"Can't publish stream, no join info!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new m(l.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||"connected"!==this._highStream.connectionState)throw new m(l.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new m(l.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();k.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new fl(this._statsCollector,this._joinInfo,this._codec,!0),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([e]);try{await this._gateway.publish(this._lowStream,"low")}catch(e){throw this._lowStream=void 0,e}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new m(l.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let n=()=>new Tp(this._joinInfo,this._config.websocketRetryConfig||Na,this._config.httpRetryConfig||Na),r=e=>{e.onLiveStreamError=(e,n)=>{t.reportApiInvoke(this._sessionId,{name:A.ON_LIVE_STREAM_ERROR,options:[e,n],tag:z.TRACER}).onSuccess(),this.emit(O.LIVE_STREAMING_ERROR,e,n)},e.onLiveStreamWarning=(e,n)=>{t.reportApiInvoke(this._sessionId,{name:A.ON_LIVE_STREAM_WARNING,options:[e,n],tag:z.TRACER}).onSuccess(),this.emit(O.LIVE_STREAMING_WARNING,e,n)},e.on(Qc.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new m(l.INVALID_OPERATION,"can not find join info to get worker manager"));Zh(e,this._joinInfo,this._axiosCancelSource.token,Na).then(t).catch(n)})};switch(e){case ma.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=n(),r(this._liveRawStreamingClient)),this._liveRawStreamingClient;case ma.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=n(),r(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case ma.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=n(),this._injectStreamingClient.on(Qc.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new m(l.INVALID_OPERATION,"can not find join info to get worker manager"));Zh(e,this._joinInfo,this._axiosCancelSource.token,Na).then(t).catch(n)}),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.emit(O.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Vp(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Na,this._config.httpRetryConfig||Na),this._channelMediaRelayClient.on("state",e=>{"RELAY_STATE_FAILURE"===e&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(O.CHANNEL_MEDIA_RELAY_STATE,e)}),this._channelMediaRelayClient.on("event",e=>{this.emit(O.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient):new m(l.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Ea.DISCONNECT_P2P,()=>{var e;this._highStream&&"disconnected"!==this._highStream.connectionState&&(k.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"disconnected"!==this._lowStream.connectionState&&(k.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),r(e=this._remoteStream).call(e,(e,t)=>{var r;k.debug(n(r="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(r,t)),e.readyToReconnectPC()})}),this._gateway.on(Ea.CONNECTION_STATE_CHANGE,(e,t,i)=>{var o,a;let s=()=>{this.emit(O.CONNECTION_STATE_CHANGE,e,t,i)};if(k.info(n(o=n(a="[".concat(this._clientId,"] connection state change: ")).call(a,t," -> ")).call(o,e)),"DISCONNECTED"===e)return this._reset(),this._renewSession(),void s();var c,u;if("RECONNECTING"===e)this._highStream&&"connecting"===this._highStream.connectionState&&(k.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"connecting"===this._lowStream.connectionState&&(k.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),r(c=this._remoteStream).call(c,(e,t)=>{var r;"connecting"===e.connectionState&&(k.debug(n(r="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(r,t)),e.readyToReconnectPC())}),r(u=this._users).call(u,e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if("CONNECTED"===e){var l,d;r(l=this._streamFallbackTypeCacheMap).call(l,(e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e))}),r(d=this._remoteStreamTypeCacheMap).call(d,(e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e))}),this._highStream&&"connecting"===this._highStream.connectionState&&this._highStream.reconnectPC().then(()=>{this._lowStream&&"connecting"===this._lowStream.connectionState&&this._lowStream.reconnectPC().catch(e=>{k.error("[".concat(this._clientId,"] republish low stream error"),e.toString()),this.emit(O.ERROR,{reason:e})})}).catch(e=>{k.error("[".concat(this._clientId,"] republish high stream error"),e.toString()),this.emit(O.ERROR,{reason:e})}),this._userOfflineTimeout=window.setTimeout(()=>{var e;if("CONNECTED"===this.connectionState){this._userOfflineTimeout=void 0;var t=M(e=this._users).call(e,e=>!e._trust_in_room_);r(t).call(t,e=>{var t;k.debug(n(t="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(t,e.uid)),this._handleUserOffline({uid:e.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var e;"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,r(e=this._users).call(e,e=>{var t,r,i,o,a;e._trust_audio_mute_state_||(k.debug(n(t="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(t,e.uid)),this._handleMuteStream(e.uid,"audio",!1)),e._trust_video_mute_state_||(k.debug(n(r="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(r,e.uid)),this._handleMuteStream(e.uid,"video",!1)),e._trust_audio_enabled_state_||(k.debug(n(i="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(i,e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),!e._trust_video_enabled_state_&&e._video_enabled_&&(k.debug(n(o="[".concat(this._clientId,"] auto dispatch enable local video ")).call(o,e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_stream_added_state_||(k.debug(n(a="[".concat(this._clientId,"] auto dispatch stream remove ")).call(a,e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3)}s()}),this._gateway.on(Ea.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new m(l.UNEXPECTED_ERROR,"can not recover, no join info"));Xh(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Na).then(t=>{var n;this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res),e(D(n=t.gatewayInfo.gatewayAddrs).call(n,e=>"wss://".concat(e)))}).catch(t)}),this._gateway.on(Ea.NETWORK_QUALITY,e=>{}),this._gateway.on(Ea.STREAM_TYPE_CHANGE,(e,n)=>{this.emit(O.STREAM_TYPE_CHANGED,e,n),t.reportApiInvoke(this._sessionId,{name:A.STREAM_TYPE_CHANGE,options:[e,n],tag:z.TRACER}).onSuccess(w({uid:e,streamType:n}))}),this._gateway.on(Ea.IS_P2P_DISCONNECTED,e=>{var t,i,o;let a=[];return this._highStream&&a.push(this._highStream),r(t=this._remoteStream).call(t,e=>a.push(e)),0===a.length||0===M(a).call(a,e=>"connected"===e.connectionState).length?e(!0):(k.debug(n(i="[".concat(this._clientId,"] ")).call(i,D(o=M(a).call(a,e=>"connected"===e.connectionState)).call(o,e=>e.connectionId)," is connected")),void e(!1))}),this._gateway.on(Ea.NEED_RENEW_SESSION,()=>{this._renewSession()}),this._gateway.signal.on(X.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(X.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(X.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.uint_id)),this._gateway.signal.on(X.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.uint_id)),this._gateway.signal.on(X.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(X.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(X.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(X.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(X.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(X.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(X.RECEIVE_METADATA,e=>{{var t=window.atob(e.metadata);let n=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)n[e]=t.charCodeAt(e);t=n}this.emit(O.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(X.ON_CRYPT_ERROR,()=>{cd(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.emit(O.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(X.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(X.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(O.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(X.ON_STREAM_FALLBACK_UPDATE,e=>{var t,r;k.debug(n(t=n(r="[".concat(this._clientId,"] stream fallback peerId: ")).call(r,e.stream_id,", attr: ")).call(t,e.stream_type)),this.emit(O.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(X.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(X.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.onRequestTimeout=(e,n)=>{if(this._joinInfo)switch(e){case ha.PUBLISH:var r;if(!n)break;if(!(e="high"===n.stream_type?this._highStream:this._lowStream))break;"offer"===n.state&&t.publish(this._joinInfo.sid,{lts:e.startTime,succ:!1,ec:l.TIMEOUT,audio:n.audio,video:n.video,p2pid:n.p2p_id,publishRequestid:e.ID,screenshare:!(!e.videoTrack||-1===E(r=e.videoTrack._hints).call(r,ib.SCREEN_TRACK)),audioName:e.audioTrack&&e.audioTrack.getTrackLabel(),videoName:e.videoTrack&&e.videoTrack.getTrackLabel()});break;case ha.SUBSCRIBE:(r=this._remoteStream.get(n.stream_id))&&n&&t.subscribe(this._joinInfo.sid,{lts:r.startTime,succ:!1,ec:l.TIMEOUT,audio:!!n.audio,video:!!n.video,peerid:n.stream_id,subscribeRequestid:r.ID,p2pid:r.pc.ID})}}}}class Yp extends Ok{constructor(e,t={}){super(),this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}set currentState(e){e!==this._currentState&&(this._currentState=e,this.emit(gb.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}startSourceNode(){var e;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=ya(e=this.handleSourceNodeEnded).call(e,this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let mi=new Y;var Zp=fa.setInterval;let hl=va().name;vc("PROCESS_ID",function(){var e,t,r,i;return n(e=n(t=n(r=n(i="process-".concat(na(8,""),"-")).call(i,na(4,""),"-")).call(r,na(4,""),"-")).call(t,na(4,""),"-")).call(e,na(12,""))}()),function(){let e=va();if(ea.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ea.getStreamFromExtension=e.name===da.CHROME&&34<Number(e.version),window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var t=new RTCPeerConnection,n=!1;try{t.addTransceiver("audio"),n=!0}catch(e){}t.close(),t=n}else t=!1;ea.supportUnifiedPlan=t,ea.supportMinBitrate=e.name===da.CHROME||e.name===da.EDGE,t=va(),t=!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Te()||t.name===da.SAFARI||t.name===da.FIREFOX&&64<=Number(t.version)),ea.supportSetRtpSenderParameters=t,e.name!==da.SAFARI&&va().name!==da.WECHAT||(ea.supportDualStream=!1),(t=va()).name===da.SAFARI&&12>Number(t.version)?t=!1:t=!!(t=yc()).createMediaStreamDestination&&!!t.createMediaStreamDestination().stream,ea.webAudioMediaStreamDest=t,ea.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,ea.supportWebGL="undefined"!=typeof WebGLRenderingContext,ea.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Te()||(ea.webAudioWithAEC=!0),t=((t=va()).os===aa.WIN_10||t.os===aa.WIN_81||t.os===aa.WIN_7||t.os===aa.LINUX||t.os===aa.MAC_OS||t.os===aa.MAC_OS_X)&&t.name===da.CHROME&&74<=Number(t.version),ea.supportShareAudio=t,k.info("browser compatibility",w(ea),w(e))}();let vb={VERSION:$a,BUILD:"v4.1.0-0-g64d4440(9/4/2020, 5:57:23 PM)",setParameter:vc,getSupportedCodec:async function(e){let t=null;e?(t=new Xk({}),t.addStream(e)):t=new Yk({});{let n={video:[],audio:[]};(e=await t.createOfferSDP()).match(/ VP8/i)&&n.video.push("VP8"),e.match(/ H264/i)&&n.video.push("H264"),e.match(/ opus/i)&&n.audio.push("OPUS"),e=n}return t.close(),e},checkSystemRequirements:function(){let e=t.reportApiInvoke(null,{name:A.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:z.TRACER});var n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;n=window.RTCPeerConnection&&n&&r,r=!1;let i=va();return i.name===da.CHROME&&58<=Number(i.version)&&i.os!==aa.IOS&&(r=!0),i.name===da.FIREFOX&&56<=Number(i.version)&&(r=!0),i.name===da.OPERA&&45<=Number(i.version)&&(r=!0),i.name===da.SAFARI&&11<=Number(i.version)&&(r=!0),va().name!==da.WECHAT&&va().name!==da.QQ||i.os===aa.IOS||(r=!0),k.debug("checkSystemRequirements, api:",n,"browser",r),n=n&&r,e.onSuccess(n),n},getDevices:function(e){return ub.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ub.getRecordingDevices(e)},getCameras:function(e){return ub.getCamerasDevices(e)},getElectronScreenSources:Lh,getPlaybackDevices:function(e){return ub.getSpeakers(e)},createClient:function(e={codec:"vp8",mode:"rtc"}){let n=t.reportApiInvoke(null,{name:A.CREATE_CLIENT,options:[e],tag:z.TRACER});try{Xa(e.codec,"config.codec",["vp8","h264"]),Xa(e.mode,"config.mode",["rtc","live"]),void 0!==e.proxyServer&&Ga(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Ah(e.turnServer),void 0!==e.httpRetryConfig&&zh(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&zh(e.websocketRetryConfig)}catch(e){throw n.onError(e),e}return n.onSuccess(),new Xp(Bc({forceWaitGatewayResponse:!0},e,{role:"rtc"===e.mode?"host":e.role}))},createCameraVideoTrack:async function(e={}){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_CAM_VIDEO_TRACK,options:[lf({},e)]}),r=gf(e);var i=na(8,"track-");let o=null;k.info("start create camera video track with config",w(e),"trackId",i);try{o=(await Bb({video:r},i)).getVideoTracks()[0]||null}catch(e){throw n.onError(e),e}return o?(e.optimizationMode&&mf(i,o,e,e.encoderConfig&&uc(e.encoderConfig)),e=new el(o,e,r,e.optimizationMode,i),n.onSuccess(e.getTrackId()),k.info("create camera video success, trackId:",i),e):(i=new m(l.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(i),i.throw())},createCustomVideoTrack:function(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new bb(e.mediaStreamTrack,{bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.optimizationMode);return n.onSuccess(r.getTrackId()),k.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(e={},n="disable"){let r=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_SCREEN_VIDEO_TRACK,options:[lf({},e),n]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";var i={};e.screenSourceType&&(i.mediaSource=e.screenSourceType),e.extensionId&&Xc()&&(i.extensionId=e.extensionId),e.electronScreenSourceId&&(i.sourceId=e.electronScreenSourceId);var o=e.encoderConfig?Fe(e.encoderConfig):null;i.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&o.frameRate&&("number"==typeof o.frameRate?(i.mandatory.maxFrameRate=o.frameRate,i.mandatory.minFrameRate=o.frameRate):(i.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,i.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),i.frameRate=o.frameRate),o&&o.width&&(i.width=o.width),o&&o.height&&(i.height=o.height),o=i;let a=na(8,"track-"),s=null;i=null;let c=ea;if(!c.supportShareAudio&&"enable"===n)return e=new m(l.NOT_SUPPORT,"your browser or platform is not support share-screen with audio"),r.onError(e),e.throw();k.info("start create screen video track with config",e,"withAudio",n,"trackId",a);try{let e=await Bb({screen:o,screenAudio:"auto"===n?c.supportShareAudio:"enable"===n},a);s=e.getVideoTracks()[0]||null,i=e.getAudioTracks()[0]||null}catch(e){throw r.onError(e),e}return s?i||"enable"!==n?(e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(mf(a,s,e,e.encoderConfig&&Fe(e.encoderConfig)),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax)),(e=new bb(s,e.encoderConfig?Fe(e.encoderConfig):{},e.optimizationMode,a))._hints.push(ib.SCREEN_TRACK),i?(n=new Va(i),r.onSuccess([e.getTrackId(),n.getTrackId()]),k.info("create screen video track success","video:",e.getTrackId(),"audio:",n.getTrackId()),[e,n]):(r.onSuccess(e.getTrackId()),k.info("create screen video track success","video:",e.getTrackId()),e)):(s&&s.stop(),e=new m(l.SHARE_AUDIO_NOT_ALLOWED),r.onError(e),e.throw()):(e=new m(l.UNEXPECTED_ERROR,"can not find track in media stream"),r.onError(e),e.throw())},createMicrophoneAndCameraTracks:async function(e={},r={}){var i,o,a;let s=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_MIC_AND_CAM_TRACKS,options:[e,r]}),c=gf(r),u=ci(e),d=na(8,"track-"),h=na(8,"track-"),p=null,f=null;k.info(n(i=n(o=n(a="start create camera video track(".concat(h,") and microphone audio track(")).call(a,d,") with config, audio: ")).call(o,w(e),", video: ")).call(i,w(r)));try{var g;let e=await Bb({audio:u,video:c},n(g="".concat(d,"-")).call(g,h));p=e.getAudioTracks()[0],f=e.getVideoTracks()[0]}catch(e){throw s.onError(e),e}if(!p||!f){var v=new m(l.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(v),v.throw()}return r.optimizationMode&&mf(h,f,r,r.encoderConfig&&uc(r.encoderConfig)),e=new rg(p,e,u,d),r=new el(f,r,c,r.optimizationMode,h),s.onSuccess([e.getTrackId(),r.getTrackId()]),k.info(n(v="create camera video track(".concat(h,") and microphone audio track(")).call(v,d,") success")),[e,r]},createMicrophoneAudioTrack:async function(e={}){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=ci(e);var i=na(8,"track-");let o=null;k.info("start create microphone audio track with config",w(e),"trackId",i);try{o=(await Bb({audio:r},i)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}return o?(e=new rg(o,e,r,i),n.onSuccess(e.getTrackId()),k.info("create microphone audio track success, trackId:",i),e):(i=new m(l.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(i),i.throw())},createCustomAudioTrack:function(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Va(e.mediaStreamTrack,e.encoderConfig?Ed(e.encoderConfig):{});return k.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){let n=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CREATE_BUFFER_AUDIO_TRACK,options:[e]}),r=na(8,"track-");k.info("start create buffer source audio track with config",w(e),"trackId",r);let i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await nm(e.source,e.cacheOnlineFile)}catch(e){return n.onError(e),e.throw()}let o=new Yp(e.source);return e=new vp(i,o,e.encoderConfig?Ed(e.encoderConfig):{},r),k.info("create buffer source audio track success, trackId:",r),n.onSuccess(e.getTrackId()),e},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){k.enableLogUpload()},disableLogUpload:function(){k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ki},checkAudioTrackIsActive:async function(e,r=5e3){let i=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Va||e instanceof zd)){var o=new m(l.INVALID_TRACK,"the parameter is not a audio track");return i.onError(o),o.throw()}r&&1e3>r&&(r=1e3);let a=e instanceof Va?e.getTrackLabel():"remote_track",s=o=e.getVolumeLevel(),c=o,d=v();return new u(t=>{let o=Zp(()=>{var u=e.getVolumeLevel();s=u>s?u:s,c=u<c?u:c,u=1e-4<s-c;var l,h=v()-d;(u||h>r)&&(clearInterval(o),h={duration:h,deviceLabel:a,maxVolumeLevel:s,result:u},k.info(n(l="[track-".concat(e.getTrackId(),"] check audio track active completed. ")).call(l,w(h))),i.onSuccess(h),t(u))},200)})},checkVideoTrackIsActive:async function(e,r=5e3){var i;let o=t.reportApiInvoke(null,{tag:z.TRACER,name:A.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof bb||e instanceof yd))return e=new m(l.INVALID_TRACK,"the parameter is not a video track"),o.onError(e),e.throw();r&&1e3>r&&(r=1e3);var a=e instanceof bb?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack();let c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,hl===da.SAFARI&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([s]),c.play();let u=document.createElement("canvas");u.width=160,u.height=120;let d=s=0;try{let e=v();s=await om(c,r,u,4),d=v()-e}catch(e){throw o.onError(e),e}return hl===da.SAFARI&&(c.pause(),c.remove()),c.srcObject=null,a={duration:d,changedPicNum:s,deviceLabel:a,result:r=4<s},k.info(n(i="[track-".concat(e.getTrackId(),"] check video track active completed. ")).call(i,w(a))),o.onSuccess(a),r}};return ub.on(Rb.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",w(e)),vb.onCameraChanged&&vb.onCameraChanged(e)}),ub.on(Rb.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",w(e)),vb.onMicrophoneChanged&&vb.onMicrophoneChanged(e)}),ub.on(Rb.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",w(e)),vb.onPlaybackDeviceChanged&&vb.onPlaybackDeviceChanged(e)}),jb.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),vb.onAudioAutoplayFailed&&vb.onAudioAutoplayFailed()},wd.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),vb.onAudioAutoplayFailed&&vb.onAudioAutoplayFailed()}),vb}))}).call(this,__webpack_require__(8),__webpack_require__(10))},function(e,t,n){"use strict";n.r(t);var r,i=n(12),o=n.n(i);"undefined"!=typeof window&&(r=window.AudioContext||window.webkitAudioContext);var a=null;t.default=function(e){var t=new o.a;if(console.log("options %% ",e),!r)return t;var n,i,s,c=(e=e||{}).smoothing||.1,u=e.interval||100,l=e.volumeThreshold,d=e.play,h=!0,p=e.sampleSize,f=e.positiveSampleThreshold,g=e.isAudioAnalyserLogsEnabled;a||(a=new r),(s=a.createAnalyser()).fftSize=512,s.smoothingTimeConstant=c,i=new Float32Array(s.frequencyBinCount),t.init=function(e){e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(n=a.createMediaElementSource(e),void 0===d&&(d=!0),l=l||-50):(n=a.createMediaStreamSource(e),l=l||-50),n.connect(s),d&&s.connect(a.destination),v()},t.speaking=!1,t.suspend=function(){a.suspend()},t.resume=function(){a.resume()},Object.defineProperty(t,"state",{get:function(){return a.state}}),a.onstatechange=function(){t.emit("state_change",a.state)},t.setThreshold=function(e){l=e},t.setInterval=function(e){u=e},t.stop=function(){h=!1,t.emit("volume_change",-100,l),t.speaking&&(t.speaking=!1,t.emit("stopped_speaking")),s.disconnect(),n.disconnect()},t.speakingHistory=[];for(var m=0;m<10;m++)t.speakingHistory.push(0);var v=function(){setTimeout((function(){if(h){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var r=4,i=t.length;r<i;r++)t[r]>n&&t[r]<0&&(n=t[r]);return n}(s,i);_(e),t.emit("volume_change",e,l);var n=0;if(e>l&&!t.speaking){for(var r=t.speakingHistory.length-p;r<t.speakingHistory.length;r++)n+=t.speakingHistory[r];_(n),n>=f&&(t.speaking=!0,t.emit("speaking"))}else if(e<l&&t.speaking){for(r=0;r<t.speakingHistory.length;r++)n+=t.speakingHistory[r];n<3&&(t.speaking=!1,t.emit("stopped_speaking"))}t.speakingHistory.shift(),t.speakingHistory.push(0+(e>l)),_(t.speakingHistory),v()}}),u)},_=function(e){g&&console.log(e)};return t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(6),u=s(n(22));n(23),n(25);var l=n(4),d=n(7),h={apiKey:"AIzaSyD3MZLNERDmM2KgltguYVSKfxblXOJqv7U",authDomain:"airmeet-chat-test.firebaseapp.com",databaseURL:"https://airmeet-chat-test.firebaseio.com",projectId:"airmeet-chat-test",storageBucket:"airmeet-chat-test.appspot.com",messagingSenderId:"791080540077",appId:"1:791080540077:web:87d0d42c298a840244b324"},p=function(e){function t(){var t=e.call(this)||this;return t._dataRefs={},t._typeBaseData={},t.firebaseApp=u.default.initializeApp(h),t.db=u.default.database(t.firebaseApp),t}return i(t,e),t.getInstance=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(n){return this.firebaseClient?[2,this.firebaseClient]:(this.firebaseClient=new t,[2,this.firebaseClient.init(e)])}))}))},t.prototype.init=function(e){return o(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){return[2,new Promise((function(r,i){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.fetchFirebaseToken(e)];case 1:return n=a.sent(),[3,3];case 2:return o=a.sent(),i(o),[2];case 3:return this.firebaseApp.auth().signInWithCustomToken(n).then((function(e){r(t.firebaseClient)})).catch((function(e){i(e)})),[2]}}))}))}))]}))}))},t.prototype.fetchFirebaseToken=function(e){return fetch("http://localhost:8080/firebase/generateToken?userId="+e,{method:"GET",headers:{accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json().then((function(t){return{json:t,response:e}})).catch((function(e){var t={tag:l.logTags.AM_FIREBASE,code:16001,msg:"Failed to fetch Firebase token: "+e};return d.logger.error(t),{json:{},response:null}}))})).then((function(e){var t=e.json;if(t.token)return t.token;throw new Error("Failed to fetch Firebase auth token")}))},t.prototype.getEmitter=function(){return this._emitter},t.prototype.ref=function(e,t){return void 0===t&&(t={}),this.db.ref(""+e)},t.prototype.getDataRef=function(e,t){if(void 0===t&&(t={}),this._dataRefs[e])return this._dataRefs[e];var n=this.ref(e,t);return this._dataRefs[e]=n,n},t.prototype.disconnect=function(){this.db&&this.db.goOffline()},t.prototype.getDatabase=function(){return u.default.database},t}(c.EventEmitter);t.default=p},function(e,t,n){"use strict";n.r(t);var r=n(2);n.d(t,"default",(function(){return r.a}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.a.registerVersion("firebase","8.1.1","app")},function(e,t,n){"use strict";n.r(t);n(24)},function(e,t,n){"use strict";(function(e){var t=n(2);(function(){var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};var i=function(t){t=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e,t];for(var n=0;n<t.length;++n){var r=t[n];if(r&&r.Math==Math)return r}return globalThis}(this);function o(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}function a(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:o(e)}}!function(e,t){if(t){var n=i;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];a in n||(n[a]={}),n=n[a]}(t=t(o=n[e=e[e.length-1]]))!=o&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Promise",(function(e){function t(e){this.b=0,this.c=void 0,this.a=[];var t=this.f();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.a=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.b=function(e){if(null==this.a){this.a=[];var t=this;this.c((function(){t.g()}))}this.a.push(e)};var o=i.setTimeout;n.prototype.c=function(e){o(e,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.f(e)}}}this.a=null},n.prototype.f=function(e){this.c((function(){throw e}))},t.prototype.f=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.v),reject:e(this.g)}},t.prototype.v=function(e){if(e===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.o(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.m(e):this.h(e)}},t.prototype.m=function(e){var t=void 0;try{t=e.then}catch(e){return void this.g(e)}"function"==typeof t?this.u(t,e):this.h(e)},t.prototype.g=function(e){this.i(2,e)},t.prototype.h=function(e){this.i(1,e)},t.prototype.i=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.b);this.b=e,this.c=t,this.l()},t.prototype.l=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)s.b(this.a[e]);this.a=null}};var s=new n;return t.prototype.o=function(e){var t=this.f();e.Pa(t.resolve,t.reject)},t.prototype.u=function(e,t){var n=this.f();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(e){o(e)}}:t}var i,o,a=new t((function(e,t){i=e,o=t}));return this.Pa(r(e,i),r(n,o)),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.Pa=function(e,t){function n(){switch(r.b){case 1:e(r.c);break;case 2:t(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=a(e),o=i.next();!o.done;o=i.next())r(o.value).Pa(t,n)}))},t.all=function(e){var n=a(e),i=n.next();return i.done?r([]):new t((function(e,t){function o(t){return function(n){a[t]=n,0==--s&&e(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).Pa(o(a.length-1),t),i=n.next()}while(!i.done)}))},t}));var s=s||{},c=this||self,u=/^[\w+/_-]+[=]{0,2}$/,l=null;function d(e){return(e=e.querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&u.test(e)?e:""}function h(){}function p(e){var t=typeof e;return"object"!=t?t:e?Array.isArray(e)?"array":t:"null"}function f(e){var t=p(e);return"array"==t||"object"==t&&"number"==typeof e.length}function g(e){return"function"==p(e)}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function v(e){return Object.prototype.hasOwnProperty.call(e,_)&&e[_]||(e[_]=++E)}var _="closure_uid_"+(1e9*Math.random()>>>0),E=0;function y(e,t,n){return e.call.apply(e.bind,arguments)}function T(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function S(e,t,n){return(S=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:T).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var I=Date.now;function R(e,t){function n(){}n.prototype=t.prototype,e.$a=t.prototype,e.prototype=new n,e.prototype.constructor=e}function C(e){return e}function A(e,t,n){this.code=O+e,this.message=t||k[e]||"",this.a=n||null}function w(e){var t=e&&e.code;return t?new A(t.substring(O.length),e.message,e.serverResponse):null}R(A,Error),A.prototype.w=function(){var e={code:this.code,message:this.message};return this.a&&(e.serverResponse=this.a),e},A.prototype.toJSON=function(){return this.w()};var N,O="auth/",k={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},L={kd:{Sa:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},rd:{Sa:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://securetoken.googleapis.com/v1/token",Va:"https://identitytoolkit.googleapis.com/v2/",id:"p"},td:{Sa:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},ud:{Sa:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",Ya:"https://test-securetoken.sandbox.googleapis.com/v1/token",Va:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function P(e){for(var t in L)if(L[t].id===e)return{firebaseEndpoint:(e=L[t]).Sa,secureTokenEndpoint:e.Ya,identityPlatformEndpoint:e.Va};return null}function D(e){if(!e)return!1;try{return!!e.$goog_Thenable}catch(e){return!1}}function M(e){if(Error.captureStackTrace)Error.captureStackTrace(this,M);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))}function U(e,t){for(var n="",r=(e=e.split("%s")).length-1,i=0;i<r;i++)n+=e[i]+(i<t.length?t[i]:"%s");M.call(this,n+e[r])}function x(e,t){throw new U("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))}function j(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function F(e,t){e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}function V(){this.b=this.a=null}N=P("__EID__")?"__EID__":void 0,R(M,Error),M.prototype.name="CustomError",R(U,M),U.prototype.name="AssertionError",j.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next,e.next=null}else e=this.c();return e};var B=new j((function(){return new G}),(function(e){e.reset()}));function W(){var e=Tt,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null),t}function G(){this.next=this.b=this.a=null}V.prototype.add=function(e,t){var n=B.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},G.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null},G.prototype.reset=function(){this.next=this.b=this.a=null};var H=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},q=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};var K=Array.prototype.filter?function(e,t){return Array.prototype.filter.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=[],i=0,o="string"==typeof e?e.split(""):e,a=0;a<n;a++)if(a in o){var s=o[a];t.call(void 0,s,a,e)&&(r[i++]=s)}return r},Y=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=Array(n),i="string"==typeof e?e.split(""):e,o=0;o<n;o++)o in i&&(r[o]=t.call(void 0,i[o],o,e));return r},z=Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t,void 0)}:function(e,t){for(var n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e))return!0;return!1};function Q(e,t){return 0<=H(e,t)}function X(e,t){var n;return(n=0<=(t=H(e,t)))&&Array.prototype.splice.call(e,t,1),n}function J(e,t){!function(e,t){for(var n="string"==typeof e?e.split(""):e,r=e.length-1;0<=r;--r)r in n&&t.call(void 0,n[r],r,e)}(e,(function(n,r){t.call(void 0,n,r,e)&&1==Array.prototype.splice.call(e,r,1).length&&0}))}function Z(e){return Array.prototype.concat.apply([],arguments)}function $(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}var ee,te=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]},ne=/&/g,re=/</g,ie=/>/g,oe=/"/g,ae=/'/g,se=/\x00/g,ce=/[\x00&<>"']/;function ue(e,t){return-1!=e.indexOf(t)}function le(e,t){return e<t?-1:e>t?1:0}e:{var de=c.navigator;if(de){var he=de.userAgent;if(he){ee=he;break e}}ee=""}function pe(e){return ue(ee,e)}function fe(e,t){for(var n in e)t.call(void 0,e[n],n,e)}function ge(e){for(var t in e)return!1;return!0}function me(e){var t,n={};for(t in e)n[t]=e[t];return n}var ve="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _e(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var o=0;o<ve.length;o++)n=ve[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Ee(e,t){e:{try{var n=e&&e.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||c).Element&&r.Location){var i=r;break e}}catch(e){}i=null}if(i&&void 0!==i[t]&&(!e||!(e instanceof i[t])&&(e instanceof i.Location||e instanceof i.Element))){if(m(e))try{var o=e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e)}catch(e){o="<object could not be stringified>"}else o=void 0===e?"undefined":null===e?"null":typeof e;x("Argument is not a %s (or a non-Element, non-Location mock); got: %s",t,o)}}function ye(e,t){this.a=e===Ie&&t||"",this.b=be}function Te(e){return e instanceof ye&&e.constructor===ye&&e.b===be?e.a:(x("expected object of type Const, got '"+e+"'"),"type_error:Const")}ye.prototype.sa=!0,ye.prototype.ra=function(){return this.a},ye.prototype.toString=function(){return"Const{"+this.a+"}"};var Se,be={},Ie={};function Re(){if(void 0===Se){var e=null,t=c.trustedTypes;if(t&&t.createPolicy){try{e=t.createPolicy("goog#html",{createHTML:C,createScript:C,createScriptURL:C})}catch(e){c.console&&c.console.error(e.message)}Se=e}else Se=e}return Se}function Ce(e,t){this.a=t===ke?e:""}function Ae(e){return e instanceof Ce&&e.constructor===Ce?e.a:(x("expected object of type TrustedResourceUrl, got '"+e+"' of type "+p(e)),"type_error:TrustedResourceUrl")}function we(e,t){var n=Te(e);if(!Oe.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(e){var t=Re();return new Ce(e=t?t.createScriptURL(e):e,ke)}(e=n.replace(Ne,(function(e,r){if(!Object.prototype.hasOwnProperty.call(t,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(t));return(e=t[r])instanceof ye?Te(e):encodeURIComponent(String(e))})))}Ce.prototype.sa=!0,Ce.prototype.ra=function(){return this.a.toString()},Ce.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Ne=/%{(\w+)}/g,Oe=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ke={};function Le(e,t){this.a=t===Fe?e:""}function Pe(e){return e instanceof Le&&e.constructor===Le?e.a:(x("expected object of type SafeUrl, got '"+e+"' of type "+p(e)),"type_error:SafeUrl")}Le.prototype.sa=!0,Le.prototype.ra=function(){return this.a.toString()},Le.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var De=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|font\/\w+|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,Me=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,Ue=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function xe(e){if(e instanceof Le)return e;if(e="object"==typeof e&&e.sa?e.ra():String(e),Ue.test(e))e=new Le(e,Fe);else{var t=(e=(e=String(e)).replace(/(%0A|%0D)/g,"")).match(Me);e=t&&De.test(t[1])?new Le(e,Fe):null}return e}function je(e){return e instanceof Le?e:(e="object"==typeof e&&e.sa?e.ra():String(e),Ue.test(e)||(e="about:invalid#zClosurez"),new Le(e,Fe))}var Fe={},Ve=new Le("about:invalid#zClosurez",Fe);function Be(e,t,n){this.a=n===We?e:""}Be.prototype.sa=!0,Be.prototype.ra=function(){return this.a.toString()},Be.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var We={};function Ge(e,t,n,r){return e=e instanceof Le?e:je(e),t=t||c,n=n instanceof ye?Te(n):n||"",t.open(Pe(e),n,r,void 0)}function He(e,t){for(var n=e.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function qe(e){return ce.test(e)&&(-1!=e.indexOf("&")&&(e=e.replace(ne,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(re,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(ie,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(oe,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(ae,"&#39;")),-1!=e.indexOf("\0")&&(e=e.replace(se,"&#0;"))),e}function Ke(e){return Ke[" "](e),e}Ke[" "]=h;var Ye,ze,Qe=pe("Opera"),Xe=pe("Trident")||pe("MSIE"),Je=pe("Edge"),Ze=Je||Xe,$e=pe("Gecko")&&!(ue(ee.toLowerCase(),"webkit")&&!pe("Edge"))&&!(pe("Trident")||pe("MSIE"))&&!pe("Edge"),et=ue(ee.toLowerCase(),"webkit")&&!pe("Edge");function tt(){var e=c.document;return e?e.documentMode:void 0}e:{var nt="",rt=(ze=ee,$e?/rv:([^\);]+)(\)|;)/.exec(ze):Je?/Edge\/([\d\.]+)/.exec(ze):Xe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ze):et?/WebKit\/(\S+)/.exec(ze):Qe?/(?:Version)[ \/]?(\S+)/.exec(ze):void 0);if(rt&&(nt=rt?rt[1]:""),Xe){var it=tt();if(null!=it&&it>parseFloat(nt)){Ye=String(it);break e}}Ye=nt}var ot,at={};function st(e){return function(e,t){var n=at;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(){for(var t=0,n=te(String(Ye)).split("."),r=te(String(e)).split("."),i=Math.max(n.length,r.length),o=0;0==t&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;t=le(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||le(0==a[2].length,0==s[2].length)||le(a[2],s[2]),a=a[3],s=s[3]}while(0==t)}return 0<=t}))}if(c.document&&Xe){var ct=tt();ot=ct||(parseInt(Ye,10)||void 0)}else ot=void 0;var ut=ot;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(ze){}var lt=!Xe||9<=Number(ut);function dt(e){var t=document;return"string"==typeof e?t.getElementById(e):e}function ht(e,t){fe(t,(function(t,n){t&&"object"==typeof t&&t.sa&&(t=t.ra()),"style"==n?e.style.cssText=t:"class"==n?e.className=t:"for"==n?e.htmlFor=t:gt.hasOwnProperty(n)?e.setAttribute(gt[n],t):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?e.setAttribute(n,t):e[n]=t}))}var pt,ft,gt={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function mt(e,t,n){function r(n){n&&t.appendChild("string"==typeof n?e.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];if(!f(o)||m(o)&&0<o.nodeType)r(o);else{e:{if(o&&"number"==typeof o.length){if(m(o)){var a="function"==typeof o.item||"string"==typeof o.item;break e}if(g(o)){a="function"==typeof o.item;break e}}a=!1}q(a?$(o):o,r)}}}function vt(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)}function _t(e){c.setTimeout((function(){throw e}),0)}function Et(e,t){ft||function(){if(c.Promise&&c.Promise.resolve){var e=c.Promise.resolve(void 0);ft=function(){e.then(St)}}else ft=function(){var e=St;!g(c.setImmediate)||c.Window&&c.Window.prototype&&!pe("Edge")&&c.Window.prototype.setImmediate==c.setImmediate?(pt||(pt=function(){var e=c.MessageChannel;if(void 0===e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!pe("Presto")&&(e=function(){var e=vt(document,"IFRAME");e.style.display="none",document.documentElement.appendChild(e);var t=e.contentWindow;(e=t.document).open(),e.close();var n="callImmediate"+Math.random(),r="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host;e=S((function(e){"*"!=r&&e.origin!=r||e.data!=n||this.port1.onmessage()}),this),t.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(n,r)}}}),void 0!==e&&!pe("Trident")&&!pe("MSIE")){var t=new e,n={},r=n;return t.port1.onmessage=function(){if(void 0!==n.next){var e=(n=n.next).Fb;n.Fb=null,e()}},function(e){r.next={Fb:e},r=r.next,t.port2.postMessage(0)}}return function(e){c.setTimeout(e,0)}}()),pt(e)):c.setImmediate(e)}}(),yt||(ft(),yt=!0),Tt.add(e,t)}var yt=!1,Tt=new V;function St(){for(var e;e=W();){try{e.a.call(e.b)}catch(e){_t(e)}F(B,e)}yt=!1}function bt(e,t){if(this.a=It,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,e!=h)try{var n=this;e.call(t,(function(e){Ut(n,Rt,e)}),(function(e){if(!(e instanceof Gt))try{if(e instanceof Error)throw e;throw Error("Promise rejected.")}catch(e){}Ut(n,Ct,e)}))}catch(e){Ut(this,Ct,e)}}var It=0,Rt=2,Ct=3;function At(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}At.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var wt=new j((function(){return new At}),(function(e){e.reset()}));function Nt(e,t,n){var r=wt.get();return r.g=e,r.b=t,r.f=n,r}function Ot(e){if(e instanceof bt)return e;var t=new bt(h);return Ut(t,Rt,e),t}function kt(e){return new bt((function(t,n){n(e)}))}function Lt(e,t,n){xt(e,t,n,null)||Et(b(t,e))}function Pt(e){return new bt((function(t){var n=e.length,r=[];if(n)for(var i=function(e,i,o){n--,r[e]=i?{Ob:!0,value:o}:{Ob:!1,reason:o},0==n&&t(r)},o=0;o<e.length;o++)Lt(e[o],b(i,o,!0),b(i,o,!1));else t(r)}))}function Dt(e,t){e.b||e.a!=Rt&&e.a!=Ct||jt(e),e.f?e.f.next=t:e.b=t,e.f=t}function Mt(e,t,n,r){var i=Nt(null,null,null);return i.a=new bt((function(e,o){i.g=t?function(n){try{var i=t.call(r,n);e(i)}catch(e){o(e)}}:e,i.b=n?function(t){try{var i=n.call(r,t);void 0===i&&t instanceof Gt?o(t):e(i)}catch(e){o(e)}}:o})),i.a.c=e,Dt(e,i),i.a}function Ut(e,t,n){e.a==It&&(e===n&&(t=Ct,n=new TypeError("Promise cannot resolve to itself")),e.a=1,xt(n,e.Zc,e.$c,e)||(e.i=n,e.a=t,e.c=null,jt(e),t!=Ct||n instanceof Gt||function(e,t){e.g=!0,Et((function(){e.g&&Wt.call(null,t)}))}(e,n)))}function xt(e,t,n,r){if(e instanceof bt)return Dt(e,Nt(t||h,n||null,r)),!0;if(D(e))return e.then(t,n,r),!0;if(m(e))try{var i=e.then;if(g(i))return function(e,t,n,r,i){function o(e){a||(a=!0,r.call(i,e))}var a=!1;try{t.call(e,(function(e){a||(a=!0,n.call(i,e))}),o)}catch(e){o(e)}}(e,i,t,n,r),!0}catch(e){return n.call(r,e),!0}return!1}function jt(e){e.h||(e.h=!0,Et(e.fc,e))}function Ft(e){var t=null;return e.b&&(t=e.b,e.b=t.next,t.next=null),e.b||(e.f=null),t}function Vt(e,t,n,r){if(n==Ct&&t.b&&!t.c)for(;e&&e.g;e=e.c)e.g=!1;if(t.a)t.a.c=null,Bt(t,n,r);else try{t.c?t.g.call(t.f):Bt(t,n,r)}catch(e){Wt.call(null,e)}F(wt,t)}function Bt(e,t,n){t==Rt?e.g.call(e.f,n):e.b&&e.b.call(e.f,n)}bt.prototype.then=function(e,t,n){return Mt(this,g(e)?e:null,g(t)?t:null,n)},bt.prototype.$goog_Thenable=!0,(n=bt.prototype).na=function(e,t){return(e=Nt(e,e,t)).c=!0,Dt(this,e),this},n.s=function(e,t){return Mt(this,null,e,t)},n.cancel=function(e){if(this.a==It){var t=new Gt(e);Et((function(){!function e(t,n){if(t.a==It)if(t.c){var r=t.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==t&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==It&&1==i?e(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):Ft(r),Vt(r,o,Ct,n)))}t.c=null}else Ut(t,Ct,n)}(this,t)}),this)}},n.Zc=function(e){this.a=It,Ut(this,Rt,e)},n.$c=function(e){this.a=It,Ut(this,Ct,e)},n.fc=function(){for(var e;e=Ft(this);)Vt(this,e,this.a,this.i);this.h=!1};var Wt=_t;function Gt(e){M.call(this,e)}function Ht(){0!=qt&&(Kt[v(this)]=this),this.xa=this.xa,this.oa=this.oa}R(Gt,M),Gt.prototype.name="cancel";var qt=0,Kt={};function Yt(e){if(!e.xa&&(e.xa=!0,e.Da(),0!=qt)){var t=v(e);if(0!=qt&&e.oa&&0<e.oa.length)throw Error(e+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Kt[t]}}Ht.prototype.xa=!1,Ht.prototype.Da=function(){if(this.oa)for(;this.oa.length;)this.oa.shift()()};var zt=Object.freeze||function(e){return e},Qt=!Xe||9<=Number(ut),Xt=Xe&&!st("9"),Jt=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{c.addEventListener("test",h,t),c.removeEventListener("test",h,t)}catch(e){}return e}();function Zt(e,t){this.type=e,this.b=this.target=t,this.defaultPrevented=!1}function $t(e,t){if(Zt.call(this,e?e.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.b=t,t=e.relatedTarget){if($e){e:{try{Ke(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:en[e.pointerType]||"",this.a=e,e.defaultPrevented&&this.preventDefault()}}Zt.prototype.preventDefault=function(){this.defaultPrevented=!0},R($t,Zt);var en=zt({2:"touch",3:"pen",4:"mouse"});$t.prototype.preventDefault=function(){$t.$a.preventDefault.call(this);var e=this.a;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Xt)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch(e){}},$t.prototype.g=function(){return this.a};var tn="closure_listenable_"+(1e6*Math.random()|0),nn=0;function rn(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.Ua=i,this.key=++nn,this.va=this.Oa=!1}function on(e){e.va=!0,e.listener=null,e.proxy=null,e.src=null,e.Ua=null}function an(e){this.src=e,this.a={},this.b=0}function sn(e,t){var n=t.type;n in e.a&&X(e.a[n],t)&&(on(t),0==e.a[n].length&&(delete e.a[n],e.b--))}function cn(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.va&&o.listener==t&&o.capture==!!n&&o.Ua==r)return i}return-1}an.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var a=cn(e,t,r,i);return-1<a?(t=e[a],n||(t.Oa=!1)):((t=new rn(t,this.src,o,!!r,i)).Oa=n,e.push(t)),t};var un="closure_lm_"+(1e6*Math.random()|0),ln={};function dn(e,t,n,r,i){if(r&&r.once)pn(e,t,n,r,i);else if(Array.isArray(t))for(var o=0;o<t.length;o++)dn(e,t[o],n,r,i);else n=Sn(n),e&&e[tn]?In(e,t,n,m(r)?!!r.capture:!!r,i):hn(e,t,n,!1,r,i)}function hn(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,s=yn(e);if(s||(e[un]=s=new an(e)),!(n=s.add(t,n,r,a,o)).proxy){if(r=function(){var e=En,t=Qt?function(n){return e.call(t.src,t.listener,n)}:function(n){if(!(n=e.call(t.src,t.listener,n)))return n};return t}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Jt||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(mn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}0}}function pn(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)pn(e,t[o],n,r,i);else n=Sn(n),e&&e[tn]?Rn(e,t,n,m(r)?!!r.capture:!!r,i):hn(e,t,n,!0,r,i)}function fn(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)fn(e,t[o],n,r,i);else r=m(r)?!!r.capture:!!r,n=Sn(n),e&&e[tn]?(e=e.v,(t=String(t).toString())in e.a&&(-1<(n=cn(o=e.a[t],n,r,i))&&(on(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.a[t],e.b--)))):e&&(e=yn(e))&&(t=e.a[t.toString()],e=-1,t&&(e=cn(t,n,r,i)),(n=-1<e?t[e]:null)&&gn(n))}function gn(e){if("number"!=typeof e&&e&&!e.va){var t=e.src;if(t&&t[tn])sn(t.v,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(mn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=yn(t))?(sn(n,e),0==n.b&&(n.src=null,t[un]=null)):on(e)}}}function mn(e){return e in ln?ln[e]:ln[e]="on"+e}function vn(e,t,n,r){var i=!0;if((e=yn(e))&&(t=e.a[t.toString()]))for(t=t.concat(),e=0;e<t.length;e++){var o=t[e];o&&o.capture==n&&!o.va&&(o=_n(o,r),i=i&&!1!==o)}return i}function _n(e,t){var n=e.listener,r=e.Ua||e.src;return e.Oa&&gn(e),n.call(r,t)}function En(e,t){if(e.va)return!0;if(!Qt){if(!t)e:{t=["window","event"];for(var n=c,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}if(t=new $t(r=t,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){e:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break e}catch(e){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=t.b;i;i=i.parentNode)r.push(i);for(e=e.type,i=r.length-1;0<=i;i--){t.b=r[i];var o=vn(r[i],e,!0,t);n=n&&o}for(i=0;i<r.length;i++)t.b=r[i],o=vn(r[i],e,!1,t),n=n&&o}return n}return _n(e,new $t(t,this))}function yn(e){return(e=e[un])instanceof an?e:null}var Tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sn(e){return g(e)?e:(e[Tn]||(e[Tn]=function(t){return e.handleEvent(t)}),e[Tn])}function bn(){Ht.call(this),this.v=new an(this),this.$b=this,this.fb=null}function In(e,t,n,r,i){e.v.add(String(t),n,!1,r,i)}function Rn(e,t,n,r,i){e.v.add(String(t),n,!0,r,i)}function Cn(e,t,n,r){if(!(t=e.v.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a=t[o];if(a&&!a.va&&a.capture==n){var s=a.listener,c=a.Ua||a.src;a.Oa&&sn(e.v,a),i=!1!==s.call(c,r)&&i}}return i&&!r.defaultPrevented}function An(e,t,n){if(g(e))n&&(e=S(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=S(e.handleEvent,e)}return 2147483647<Number(t)?-1:c.setTimeout(e,t||0)}function wn(e){var t=null;return new bt((function(n,r){-1==(t=An((function(){n(void 0)}),e))&&r(Error("Failed to schedule timer."))})).s((function(e){throw c.clearTimeout(t),e}))}function Nn(e){if(e.V&&"function"==typeof e.V)return e.V();if("string"==typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function On(e){if(e.Y&&"function"==typeof e.Y)return e.Y();if(!e.V||"function"!=typeof e.V){if(f(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}function kn(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof kn)for(n=e.Y(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ln(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Pn(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)Pn(i,r=e.a[t])||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}function Pn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}R(bn,Ht),bn.prototype[tn]=!0,bn.prototype.addEventListener=function(e,t,n,r){dn(this,e,t,n,r)},bn.prototype.removeEventListener=function(e,t,n,r){fn(this,e,t,n,r)},bn.prototype.dispatchEvent=function(e){var t,n=this.fb;if(n)for(t=[];n;n=n.fb)t.push(n);n=this.$b;var r=e.type||e;if("string"==typeof e)e=new Zt(e,n);else if(e instanceof Zt)e.target=e.target||n;else{var i=e;_e(e=new Zt(r,n),i)}if(i=!0,t)for(var o=t.length-1;0<=o;o--){var a=e.b=t[o];i=Cn(a,r,!0,e)&&i}if(i=Cn(a=e.b=n,r,!0,e)&&i,i=Cn(a,r,!1,e)&&i,t)for(o=0;o<t.length;o++)i=Cn(a=e.b=t[o],r,!1,e)&&i;return i},bn.prototype.Da=function(){if(bn.$a.Da.call(this),this.v){var e,t=this.v;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)on(n[r]);delete t.a[e],t.b--}}this.fb=null},(n=kn.prototype).V=function(){Ln(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},n.Y=function(){return Ln(this),this.a.concat()},n.clear=function(){this.b={},this.c=this.a.length=0},n.get=function(e,t){return Pn(this.b,e)?this.b[e]:t},n.set=function(e,t){Pn(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},n.forEach=function(e,t){for(var n=this.Y(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var Dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Mn(e,t){var n;this.a=this.l=this.f="",this.g=null,this.h=this.c="",this.i=!1,e instanceof Mn?(this.i=void 0!==t?t:e.i,Un(this,e.f),this.l=e.l,this.a=e.a,xn(this,e.g),this.c=e.c,jn(this,rr(e.b)),this.h=e.h):e&&(n=String(e).match(Dn))?(this.i=!!t,Un(this,n[1]||"",!0),this.l=Gn(n[2]||""),this.a=Gn(n[3]||"",!0),xn(this,n[4]),this.c=Gn(n[5]||"",!0),jn(this,n[6]||"",!0),this.h=Gn(n[7]||"")):(this.i=!!t,this.b=new Jn(null,this.i))}function Un(e,t,n){e.f=n?Gn(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function xn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.g=t}else e.g=null}function jn(e,t,n){t instanceof Jn?(e.b=t,function(e,t){t&&!e.f&&(Zn(e),e.c=null,e.a.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(er(this,t),nr(this,n,e))}),e)),e.f=t}(e.b,e.i)):(n||(t=Hn(t,Qn)),e.b=new Jn(t,e.i))}function Fn(e,t,n){e.b.set(t,n)}function Vn(e,t){return e.b.get(t)}function Bn(e){return e instanceof Mn?new Mn(e):new Mn(e,void 0)}function Wn(e,t,n,r){var i=new Mn(null,void 0);return e&&Un(i,e),t&&(i.a=t),n&&xn(i,n),r&&(i.c=r),i}function Gn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Hn(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,qn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function qn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Mn.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Hn(t,Kn,!0),":");var n=this.a;return(n||"file"==t)&&(e.push("//"),(t=this.l)&&e.push(Hn(t,Kn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.g)&&e.push(":",String(n))),(n=this.c)&&(this.a&&"/"!=n.charAt(0)&&e.push("/"),e.push(Hn(n,"/"==n.charAt(0)?zn:Yn,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.h)&&e.push("#",Hn(n,Xn)),e.join("")},Mn.prototype.resolve=function(e){var t=new Mn(this),n=!!e.f;n?Un(t,e.f):n=!!e.l,n?t.l=e.l:n=!!e.a,n?t.a=e.a:n=null!=e.g;var r=e.c;if(n)xn(t,e.g);else if(n=!!e.c){if("/"!=r.charAt(0))if(this.a&&!this.c)r="/"+r;else{var i=t.c.lastIndexOf("/");-1!=i&&(r=t.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(ue(i,"./")||ue(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?t.c=r:n=""!==e.b.toString(),n?jn(t,rr(e.b)):n=!!e.h,n&&(t.h=e.h),t};var Kn=/[#\/\?@]/g,Yn=/[#\?:]/g,zn=/[#\?]/g,Qn=/[#\?@]/g,Xn=/#/g;function Jn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function Zn(e){e.a||(e.a=new kn,e.b=0,e.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.c,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function $n(e){var t=On(e);if(void 0===t)throw Error("Keys are undefined");var n=new Jn(null,void 0);e=Nn(e);for(var r=0;r<t.length;r++){var i=t[r],o=e[r];Array.isArray(o)?nr(n,i,o):n.add(i,o)}return n}function er(e,t){Zn(e),t=ir(e,t),Pn(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Pn((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Ln(e)))}function tr(e,t){return Zn(e),t=ir(e,t),Pn(e.a.b,t)}function nr(e,t,n){er(e,t),0<n.length&&(e.c=null,e.a.set(ir(e,t),$(n)),e.b+=n.length)}function rr(e){var t=new Jn;return t.c=e.c,e.a&&(t.a=new kn(e.a),t.b=e.b),t}function ir(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}function or(e){var t=[];return function e(t,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(Array.isArray(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),e(t,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),ur(i,r),r.push(":"),e(t,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":ur(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new ar,e,t),t.join("")}function ar(){}(n=Jn.prototype).add=function(e,t){Zn(this),this.c=null,e=ir(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},n.clear=function(){this.a=this.c=null,this.b=0},n.forEach=function(e,t){Zn(this),this.a.forEach((function(n,r){q(n,(function(n){e.call(t,n,r,this)}),this)}),this)},n.Y=function(){Zn(this);for(var e=this.a.V(),t=this.a.Y(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},n.V=function(e){Zn(this);var t=[];if("string"==typeof e)tr(this,e)&&(t=Z(t,this.a.get(ir(this,e))));else{e=this.a.V();for(var n=0;n<e.length;n++)t=Z(t,e[n])}return t},n.set=function(e,t){return Zn(this),this.c=null,tr(this,e=ir(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.Y(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.V(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),e.push(a)}}return this.c=e.join("&")};var sr={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},cr=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function ur(e,t){t.push('"',e.replace(cr,(function(e){var t=sr[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),sr[e]=t),t})),'"')}function lr(){var e=Nr();return Xe&&!!ut&&11==ut||/Edge\/\d+/.test(e)}function dr(){return c.window&&c.window.location.href||self&&self.location&&self.location.href||""}function hr(e,t){t=t||c.window;var n="about:blank";e&&(n=Pe(xe(e)||Ve)),t.location.href=n}function pr(e){return!!((e=(e||Nr()).toLowerCase()).match(/android/)||e.match(/webos/)||e.match(/iphone|ipad|ipod/)||e.match(/blackberry/)||e.match(/windows phone/)||e.match(/iemobile/))}function fr(e){e=e||c.window;try{e.close()}catch(e){}}function gr(e,t,n){var r=Math.floor(1e9*Math.random()).toString();t=t||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-t)/2;for(a in t={width:t,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Nr().toLowerCase(),r&&(t.target=r,ue(n,"crios/")&&(t.target="_blank")),Cr(Nr())==Ir&&(e=e||"http://localhost",t.scrollbars=!0),n=e||"",(e=t)||(e={}),r=window,t=n instanceof Le?n:xe(void 0!==n.href?n.href:String(n))||Ve,n=e.target||n.target,i=[],e)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+e[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(e[a]?1:0))}var a=i.join(",");if((pe("iPhone")&&!pe("iPod")&&!pe("iPad")||pe("iPad")||pe("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(Ee(a=vt(document,"A"),"HTMLAnchorElement"),t=t instanceof Le?t:je(t),a.href=Pe(t),a.setAttribute("target",n),e.noreferrer&&a.setAttribute("rel","noreferrer"),(e=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(e),a={}):e.noreferrer?(a=Ge("",r,n,a),e=Pe(t),a&&(Ze&&ue(e,";")&&(e="'"+e.replace(/'/g,"%27")+"'"),a.opener=null,e='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+qe(e)+'">',e=new Be(e=(r=Re())?r.createHTML(e):e,null,We),r=a.document)&&(r.write(function(e){return e instanceof Be&&e.constructor===Be?e.a:(x("expected object of type SafeHtml, got '"+e+"' of type "+p(e)),"type_error:SafeHtml")}(e)),r.close())):(a=Ge(t,r,n,a))&&e.noopener&&(a.opener=null),a)try{a.focus()}catch(e){}return a}var mr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vr=/^[^@]+@[^@]+$/;function _r(){var e=null;return new bt((function(t){"complete"==c.document.readyState?t():(e=function(){t()},pn(window,"load",e))})).s((function(t){throw fn(window,"load",e),t}))}function Er(e){return e=e||Nr(),!("file:"!==Dr()&&"ionic:"!==Dr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function yr(){var e=c.window;try{return!(!e||e==e.top)}catch(e){return!1}}function Tr(){return void 0!==c.WorkerGlobalScope&&"function"==typeof c.importScripts}function Sr(){return t.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":t.a.INTERNAL.hasOwnProperty("node")?"Node":Tr()?"Worker":"Browser"}function br(){var e=Sr();return"ReactNative"===e||"Node"===e}var Ir="Firefox",Rr="Chrome";function Cr(e){var t=e.toLowerCase();return ue(t,"opera/")||ue(t,"opr/")||ue(t,"opios/")?"Opera":ue(t,"iemobile")?"IEMobile":ue(t,"msie")||ue(t,"trident/")?"IE":ue(t,"edge/")?"Edge":ue(t,"firefox/")?Ir:ue(t,"silk/")?"Silk":ue(t,"blackberry")?"Blackberry":ue(t,"webos")?"Webos":!ue(t,"safari/")||ue(t,"chrome/")||ue(t,"crios/")||ue(t,"android")?!ue(t,"chrome/")&&!ue(t,"crios/")||ue(t,"edge/")?ue(t,"android")?"Android":(e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==e.length?e[1]:"Other":Rr:"Safari"}var Ar={ld:"FirebaseCore-web",nd:"FirebaseUI-web"};function wr(e,t){t=t||[];var n,r=[],i={};for(n in Ar)i[Ar[n]]=!0;for(n=0;n<t.length;n++)void 0!==i[t[n]]&&(delete i[t[n]],r.push(t[n]));return r.sort(),(t=r).length||(t=["FirebaseCore-web"]),"Browser"===(r=Sr())?r=Cr(i=Nr()):"Worker"===r&&(r=Cr(i=Nr())+"-"+r),r+"/JsCore/"+e+"/"+t.join(",")}function Nr(){return c.navigator&&c.navigator.userAgent||""}function Or(e,t){e=e.split("."),t=t||c;for(var n=0;n<e.length&&"object"==typeof t&&null!=t;n++)t=t[e[n]];return n!=e.length&&(t=void 0),t}function kr(){try{var e=c.localStorage,t=Fr();if(e)return e.setItem(t,"1"),e.removeItem(t),!lr()||!!c.indexedDB}catch(e){return Tr()&&!!c.indexedDB}return!1}function Lr(){return(Pr()||"chrome-extension:"===Dr()||Er())&&!br()&&kr()&&!Tr()}function Pr(){return"http:"===Dr()||"https:"===Dr()}function Dr(){return c.location&&c.location.protocol||null}function Mr(e){return!pr(e=e||Nr())&&Cr(e)!=Ir}function Ur(e){return void 0===e?null:or(e)}function xr(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&void 0!==e[t]&&(n[t]=e[t]);return n}function jr(e){if(null!==e)return JSON.parse(e)}function Fr(e){return e||Math.floor(1e9*Math.random()).toString()}function Vr(e){return"Safari"!=Cr(e=e||Nr())&&!e.toLowerCase().match(/iphone|ipad|ipod/)}function Br(){var e=c.___jsl;if(e&&e.H)for(var t in e.H)if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=e.H[t].L.concat(),e.CP)for(var n=0;n<e.CP.length;n++)e.CP[n]=null}function Wr(e,t){if(e>t)throw Error("Short delay should be less than long delay!");this.a=e,this.c=t,e=Nr(),t=Sr(),this.b=pr(e)||"ReactNative"===t}function Gr(){var e=c.document;return!e||void 0===e.visibilityState||"visible"==e.visibilityState}function Hr(e){"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e)}function qr(e){try{var t=new Date(parseInt(e,10));if(!isNaN(t.getTime())&&!/[^0-9]/.test(e))return t.toUTCString()}catch(e){}return null}function Kr(){return!(!Or("fireauth.oauthhelper",c)&&!Or("fireauth.iframe",c))}Wr.prototype.get=function(){var e=c.navigator;return!e||"boolean"!=typeof e.onLine||!Pr()&&"chrome-extension:"!==Dr()&&void 0===e.connection||e.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Yr,zr={};function Qr(e){zr[e]||(zr[e]=!0,Hr(e))}try{var Xr={};Object.defineProperty(Xr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Xr,"abcd",{configurable:!0,enumerable:!0,value:2}),Yr=2==Xr.abcd}catch(ze){Yr=!1}function Jr(e,t,n){Yr?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,value:n}):e[t]=n}function Zr(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&Jr(e,n,t[n])}function $r(e){var t={};return Zr(t,e),t}function ei(e){var t=e;if("object"==typeof e&&null!=e)for(var n in t="length"in e?[]:{},e)Jr(t,n,ei(e[n]));return t}function ti(e){var t=e&&(e[ai]?"phone":null);if(!(t&&e&&e[oi]))throw new A("internal-error","Internal assert: invalid MultiFactorInfo object");Jr(this,"uid",e[oi]),Jr(this,"displayName",e[ri]||null);var n=null;e[ii]&&(n=new Date(e[ii]).toUTCString()),Jr(this,"enrollmentTime",n),Jr(this,"factorId",t)}function ni(e){try{var t=new si(e)}catch(e){t=null}return t}ti.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var ri="displayName",ii="enrolledAt",oi="mfaEnrollmentId",ai="phoneInfo";function si(e){ti.call(this,e),Jr(this,"phoneNumber",e[ai])}function ci(e){var t={},n=e[hi],r=e[fi],i=e[gi];if(e=ni(e[pi]),!i||i!=li&&i!=di&&!n||i==di&&!r||i==ui&&!e)throw Error("Invalid checkActionCode response!");i==di?(t[vi]=n||null,t[Ei]=n||null,t[mi]=r):(t[vi]=r||null,t[Ei]=r||null,t[mi]=n||null),t[_i]=e||null,Jr(this,Ti,i),Jr(this,yi,ei(t))}R(si,ti),si.prototype.w=function(){var e=si.$a.w.call(this);return e.phoneNumber=this.phoneNumber,e};var ui="REVERT_SECOND_FACTOR_ADDITION",li="EMAIL_SIGNIN",di="VERIFY_AND_CHANGE_EMAIL",hi="email",pi="mfaInfo",fi="newEmail",gi="requestType",mi="email",vi="fromEmail",_i="multiFactorInfo",Ei="previousEmail",yi="data",Ti="operation";function Si(e){var t=Vn(e=Bn(e),bi)||null,n=Vn(e,Ii)||null,r=Vn(e,Ai)||null;if(r=r&&Ni[r]||null,!t||!n||!r)throw new A("argument-error",bi+", "+Ii+"and "+Ai+" are required in a valid action code URL.");Zr(this,{apiKey:t,operation:r,code:n,continueUrl:Vn(e,Ri)||null,languageCode:Vn(e,Ci)||null,tenantId:Vn(e,wi)||null})}var bi="apiKey",Ii="oobCode",Ri="continueUrl",Ci="languageCode",Ai="mode",wi="tenantId",Ni={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ui,signIn:li,verifyAndChangeEmail:di,verifyEmail:"VERIFY_EMAIL"};function Oi(e){try{return new Si(e)}catch(e){return null}}function ki(e){var t=e[Ui];if(void 0===t)throw new A("missing-continue-uri");if("string"!=typeof t||"string"==typeof t&&!t.length)throw new A("invalid-continue-uri");this.h=t,this.b=this.a=null,this.g=!1;var n=e[Li];if(n&&"object"==typeof n){t=n[Fi];var r=n[xi];if(n=n[ji],"string"==typeof t&&t.length){if(this.a=t,void 0!==r&&"boolean"!=typeof r)throw new A("argument-error",xi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new A("argument-error",ji+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==t)throw new A("argument-error",Fi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new A("missing-android-pkg-name")}}else if(void 0!==n)throw new A("argument-error",Li+" property must be a non null object when specified.");if(this.f=null,(t=e[Mi])&&"object"==typeof t){if("string"==typeof(t=t[Vi])&&t.length)this.f=t;else if(void 0!==t)throw new A("argument-error",Vi+" property must be a non empty string when specified.")}else if(void 0!==t)throw new A("argument-error",Mi+" property must be a non null object when specified.");if(void 0!==(t=e[Di])&&"boolean"!=typeof t)throw new A("argument-error",Di+" property must be a boolean when specified.");if(this.c=!!t,void 0!==(e=e[Pi])&&("string"!=typeof e||"string"==typeof e&&!e.length))throw new A("argument-error",Pi+" property must be a non empty string when specified.");this.i=e||null}var Li="android",Pi="dynamicLinkDomain",Di="handleCodeInApp",Mi="iOS",Ui="url",xi="installApp",ji="minimumVersion",Fi="packageName",Vi="bundleId";function Bi(e){var t={};for(var n in t.continueUrl=e.h,t.canHandleCodeInApp=e.c,(t.androidPackageName=e.a)&&(t.androidMinimumVersion=e.b,t.androidInstallApp=e.g),t.iOSBundleId=e.f,t.dynamicLinkDomain=e.i,t)null===t[n]&&delete t[n];return t}var Wi=null;function Gi(e){var t="";return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=Wi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}!function(){if(!Wi){Wi={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var r=e.concat(t[n].split("")),i=0;i<r.length;i++){var o=r[i];void 0===Wi[o]&&(Wi[o]=i)}}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;t(i<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(e,(function(e){t+=String.fromCharCode(e)})),t}function Hi(e){var t=Ki(e);if(!(t&&t.sub&&t.iss&&t.aud&&t.exp))throw Error("Invalid JWT");this.g=e,this.c=t.exp,this.h=t.sub,I(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.f=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function qi(e){try{return new Hi(e)}catch(e){return null}}function Ki(e){if(!e)return null;if(3!=(e=e.split(".")).length)return null;for(var t=(4-(e=e[1]).length%4)%4,n=0;n<t;n++)e+=".";try{return JSON.parse(Gi(e))}catch(e){}return null}Hi.prototype.S=function(){return this.f},Hi.prototype.i=function(){return this.b},Hi.prototype.toString=function(){return this.g};var Yi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),zi=["client_id","response_type","scope","redirect_uri","state"],Qi={md:{Ja:"locale",ua:700,ta:600,fa:"facebook.com",Wa:zi},od:{Ja:null,ua:500,ta:750,fa:"github.com",Wa:zi},pd:{Ja:"hl",ua:515,ta:680,fa:"google.com",Wa:zi},vd:{Ja:"lang",ua:485,ta:705,fa:"twitter.com",Wa:Yi},jd:{Ja:"locale",ua:640,ta:600,fa:"apple.com",Wa:[]}};function Xi(e){for(var t in Qi)if(Qi[t].fa==e)return Qi[t];return null}function Ji(e){var t={};t["facebook.com"]=no,t["google.com"]=io,t["github.com"]=ro,t["twitter.com"]=oo;var n=e&&e[$i];try{if(n)return t[n]?new t[n](e):new to(e);if(void 0!==e[Zi])return new eo(e)}catch(e){}return null}var Zi="idToken",$i="providerId";function eo(e){var t=e[$i];if(!t&&e[Zi]){var n=qi(e[Zi]);n&&n.a&&(t=n.a)}if(!t)throw Error("Invalid additional user info!");"anonymous"!=t&&"custom"!=t||(t=null),n=!1,void 0!==e.isNewUser?n=!!e.isNewUser:"identitytoolkit#SignupNewUserResponse"===e.kind&&(n=!0),Jr(this,"providerId",t),Jr(this,"isNewUser",n)}function to(e){eo.call(this,e),Jr(this,"profile",ei((e=jr(e.rawUserInfo||"{}"))||{}))}function no(e){if(to.call(this,e),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function ro(e){if(to.call(this,e),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Jr(this,"username",this.profile&&this.profile.login||null)}function io(e){if(to.call(this,e),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function oo(e){if(to.call(this,e),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Jr(this,"username",e.screenName||null)}function ao(e){var t=Bn(e),n=Vn(t,"link"),r=Vn(Bn(n),"link");return t=Vn(t,"deep_link_id"),Vn(Bn(t),"link")||t||r||n||e}function so(e,t){if(!e&&!t)throw new A("internal-error","Internal assert: no raw session string available");if(e&&t)throw new A("internal-error","Internal assert: unable to determine the session type");this.a=e||null,this.b=t||null,this.type=this.a?co:uo}R(to,eo),R(no,to),R(ro,to),R(io,to),R(oo,to);var co="enroll",uo="signin";function lo(){}function ho(e,t){return e.then((function(e){if(e[$a]){var n=qi(e[$a]);if(!n||t!=n.h)throw new A("user-mismatch");return e}throw new A("user-mismatch")})).s((function(e){throw e&&e.code&&e.code==O+"user-not-found"?new A("user-mismatch"):e}))}function po(e,t){if(!t)throw new A("internal-error","failed to construct a credential");this.a=t,Jr(this,"providerId",e),Jr(this,"signInMethod",e)}function fo(e){return{pendingToken:e.a,requestUri:"http://localhost"}}function go(e){if(e&&e.providerId&&e.signInMethod&&0==e.providerId.indexOf("saml.")&&e.pendingToken)try{return new po(e.providerId,e.pendingToken)}catch(e){}return null}function mo(e,t,n){if(this.a=null,t.idToken||t.accessToken)t.idToken&&Jr(this,"idToken",t.idToken),t.accessToken&&Jr(this,"accessToken",t.accessToken),t.nonce&&!t.pendingToken&&Jr(this,"nonce",t.nonce),t.pendingToken&&(this.a=t.pendingToken);else{if(!t.oauthToken||!t.oauthTokenSecret)throw new A("internal-error","failed to construct a credential");Jr(this,"accessToken",t.oauthToken),Jr(this,"secret",t.oauthTokenSecret)}Jr(this,"providerId",e),Jr(this,"signInMethod",n)}function vo(e){var t={};return e.idToken&&(t.id_token=e.idToken),e.accessToken&&(t.access_token=e.accessToken),e.secret&&(t.oauth_token_secret=e.secret),t.providerId=e.providerId,e.nonce&&!e.a&&(t.nonce=e.nonce),t={postBody:$n(t).toString(),requestUri:"http://localhost"},e.a&&(delete t.postBody,t.pendingToken=e.a),t}function _o(e){if(e&&e.providerId&&e.signInMethod){var t={idToken:e.oauthIdToken,accessToken:e.oauthTokenSecret?null:e.oauthAccessToken,oauthTokenSecret:e.oauthTokenSecret,oauthToken:e.oauthTokenSecret&&e.oauthAccessToken,nonce:e.nonce,pendingToken:e.pendingToken};try{return new mo(e.providerId,t,e.signInMethod)}catch(e){}}return null}function Eo(e,t){this.Pc=t||[],Zr(this,{providerId:e,isOAuthProvider:!0}),this.Hb={},this.ob=(Xi(e)||{}).Ja||null,this.nb=null}function yo(e){if("string"!=typeof e||0!=e.indexOf("saml."))throw new A("argument-error",'SAML provider IDs must be prefixed with "saml."');Eo.call(this,e,[])}function To(e){Eo.call(this,e,zi),this.a=[]}function So(){To.call(this,"facebook.com")}function bo(e){if(!e)throw new A("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return m(e)&&(t=e.accessToken),(new So).credential({accessToken:t})}function Io(){To.call(this,"github.com")}function Ro(e){if(!e)throw new A("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return m(e)&&(t=e.accessToken),(new Io).credential({accessToken:t})}function Co(){To.call(this,"google.com"),this.Ca("profile")}function Ao(e,t){var n=e;return m(e)&&(n=e.idToken,t=e.accessToken),(new Co).credential({idToken:n,accessToken:t})}function wo(){Eo.call(this,"twitter.com",Yi)}function No(e,t){var n=e;if(m(n)||(n={oauthToken:e,oauthTokenSecret:t}),!n.oauthToken||!n.oauthTokenSecret)throw new A("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new mo("twitter.com",n,"twitter.com")}function Oo(e,t,n){this.a=e,this.f=t,Jr(this,"providerId","password"),Jr(this,"signInMethod",n===Lo.EMAIL_LINK_SIGN_IN_METHOD?Lo.EMAIL_LINK_SIGN_IN_METHOD:Lo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function ko(e){return e&&e.email&&e.password?new Oo(e.email,e.password,e.signInMethod):null}function Lo(){Zr(this,{providerId:"password",isOAuthProvider:!1})}function Po(e,t){if(!(t=Do(t)))throw new A("argument-error","Invalid email link!");return new Oo(e,t.code,Lo.EMAIL_LINK_SIGN_IN_METHOD)}function Do(e){return(e=Oi(e=ao(e)))&&e.operation===li?e:null}function Mo(e){if(!(e.cb&&e.bb||e.La&&e.ea))throw new A("internal-error");this.a=e,Jr(this,"providerId","phone"),this.fa="phone",Jr(this,"signInMethod","phone")}function Uo(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var t={};return q(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){e[n]&&(t[n]=e[n])})),new Mo(t)}return null}function xo(e){return e.a.La&&e.a.ea?{temporaryProof:e.a.La,phoneNumber:e.a.ea}:{sessionInfo:e.a.cb,code:e.a.bb}}function jo(e){try{this.a=e||t.a.auth()}catch(e){throw new A("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Zr(this,{providerId:"phone",isOAuthProvider:!1})}function Fo(e,t){if(!e)throw new A("missing-verification-id");if(!t)throw new A("missing-verification-code");return new Mo({cb:e,bb:t})}function Vo(e){if(e.temporaryProof&&e.phoneNumber)return new Mo({La:e.temporaryProof,ea:e.phoneNumber});var t=e&&e.providerId;if(!t||"password"===t)return null;var n=e&&e.oauthAccessToken,r=e&&e.oauthTokenSecret,i=e&&e.nonce,o=e&&e.oauthIdToken,a=e&&e.pendingToken;try{switch(t){case"google.com":return Ao(o,n);case"facebook.com":return bo(n);case"github.com":return Ro(n);case"twitter.com":return No(n,r);default:return n||r||o||a?a?0==t.indexOf("saml.")?new po(t,a):new mo(t,{pendingToken:a,idToken:e.oauthIdToken,accessToken:e.oauthAccessToken},t):new To(t).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(e){return null}}function Bo(e){if(!e.isOAuthProvider)throw new A("invalid-oauth-provider")}function Wo(e,t,n,r,i,o,a){if(this.c=e,this.b=t||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new A("invalid-auth-event");if(this.g&&this.a)throw new A("invalid-auth-event");if(this.g&&!this.f)throw new A("invalid-auth-event")}function Go(e){return(e=e||{}).type?new Wo(e.type,e.eventId,e.urlResponse,e.sessionId,e.error&&w(e.error),e.postBody,e.tenantId):null}function Ho(){this.b=null,this.a=[]}so.prototype.Ha=function(){return this.a?Ot(this.a):Ot(this.b)},so.prototype.w=function(){return this.type==co?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},lo.prototype.ja=function(){},lo.prototype.b=function(){},lo.prototype.c=function(){},lo.prototype.w=function(){},po.prototype.ja=function(e){return Ts(e,fo(this))},po.prototype.b=function(e,t){var n=fo(this);return n.idToken=t,Ss(e,n)},po.prototype.c=function(e,t){return ho(bs(e,fo(this)),t)},po.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},mo.prototype.ja=function(e){return Ts(e,vo(this))},mo.prototype.b=function(e,t){var n=vo(this);return n.idToken=t,Ss(e,n)},mo.prototype.c=function(e,t){return ho(bs(e,vo(this)),t)},mo.prototype.w=function(){var e={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(e.oauthIdToken=this.idToken),this.accessToken&&(e.oauthAccessToken=this.accessToken),this.secret&&(e.oauthTokenSecret=this.secret),this.nonce&&(e.nonce=this.nonce),this.a&&(e.pendingToken=this.a),e},Eo.prototype.Ka=function(e){return this.Hb=me(e),this},R(yo,Eo),R(To,Eo),To.prototype.Ca=function(e){return Q(this.a,e)||this.a.push(e),this},To.prototype.Pb=function(){return $(this.a)},To.prototype.credential=function(e,t){var n;if(!(n=m(e)?{idToken:e.idToken||null,accessToken:e.accessToken||null,nonce:e.rawNonce||null}:{idToken:e||null,accessToken:t||null}).idToken&&!n.accessToken)throw new A("argument-error","credential failed: must provide the ID token and/or the access token.");return new mo(this.providerId,n,this.providerId)},R(So,To),Jr(So,"PROVIDER_ID","facebook.com"),Jr(So,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),R(Io,To),Jr(Io,"PROVIDER_ID","github.com"),Jr(Io,"GITHUB_SIGN_IN_METHOD","github.com"),R(Co,To),Jr(Co,"PROVIDER_ID","google.com"),Jr(Co,"GOOGLE_SIGN_IN_METHOD","google.com"),R(wo,Eo),Jr(wo,"PROVIDER_ID","twitter.com"),Jr(wo,"TWITTER_SIGN_IN_METHOD","twitter.com"),Oo.prototype.ja=function(e){return this.signInMethod==Lo.EMAIL_LINK_SIGN_IN_METHOD?ic(e,ks,{email:this.a,oobCode:this.f}):ic(e,$s,{email:this.a,password:this.f})},Oo.prototype.b=function(e,t){return this.signInMethod==Lo.EMAIL_LINK_SIGN_IN_METHOD?ic(e,Ls,{idToken:t,email:this.a,oobCode:this.f}):ic(e,qs,{idToken:t,email:this.a,password:this.f})},Oo.prototype.c=function(e,t){return ho(this.ja(e),t)},Oo.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},Zr(Lo,{PROVIDER_ID:"password"}),Zr(Lo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Zr(Lo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Mo.prototype.ja=function(e){return e.eb(xo(this))},Mo.prototype.b=function(e,t){var n=xo(this);return n.idToken=t,ic(e,tc,n)},Mo.prototype.c=function(e,t){var n=xo(this);return n.operation="REAUTH",ho(e=ic(e,nc,n),t)},Mo.prototype.w=function(){var e={providerId:"phone"};return this.a.cb&&(e.verificationId=this.a.cb),this.a.bb&&(e.verificationCode=this.a.bb),this.a.La&&(e.temporaryProof=this.a.La),this.a.ea&&(e.phoneNumber=this.a.ea),e},jo.prototype.eb=function(e,t){var n=this.a.a;return Ot(t.verify()).then((function(r){if("string"!=typeof r)throw new A("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(t.type){case"recaptcha":var i=m(e)?e.session:null,o=m(e)?e.phoneNumber:e;return(i&&i.type==co?i.Ha().then((function(e){return function(e,t){return ic(e,Ys,t).then((function(e){return e.phoneSessionInfo.sessionInfo}))}(n,{idToken:e,phoneEnrollmentInfo:{phoneNumber:o,recaptchaToken:r}})})):i&&i.type==uo?i.Ha().then((function(t){return function(e,t){return ic(e,zs,t).then((function(e){return e.phoneResponseInfo.sessionInfo}))}(n,{mfaPendingCredential:t,mfaEnrollmentId:e.multiFactorHint&&e.multiFactorHint.uid||e.multiFactorUid,phoneSignInInfo:{recaptchaToken:r}})})):function(e,t){return ic(e,Gs,t)}(n,{phoneNumber:o,recaptchaToken:r})).then((function(e){return"function"==typeof t.reset&&t.reset(),e}),(function(e){throw"function"==typeof t.reset&&t.reset(),e}));default:throw new A("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Zr(jo,{PROVIDER_ID:"phone"}),Zr(jo,{PHONE_SIGN_IN_METHOD:"phone"}),Wo.prototype.getUid=function(){var e=[];return e.push(this.c),this.b&&e.push(this.b),this.f&&e.push(this.f),this.h&&e.push(this.h),e.join("-")},Wo.prototype.S=function(){return this.h},Wo.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}};var qo,Ko=null;function Yo(e){var t="unauthorized-domain",n=void 0,r=Bn(e);e=r.a,"chrome-extension"==(r=r.f)?n=He("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):"http"==r||"https"==r?n=He("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):t="operation-not-supported-in-this-environment",A.call(this,t,n)}function zo(e,t,n){A.call(this,e,n),(e=t||{}).Ib&&Jr(this,"email",e.Ib),e.ea&&Jr(this,"phoneNumber",e.ea),e.credential&&Jr(this,"credential",e.credential),e.Yb&&Jr(this,"tenantId",e.Yb)}function Qo(e){if(e.code){var t=e.code||"";0==t.indexOf(O)&&(t=t.substring(O.length));var n={credential:Vo(e),Yb:e.tenantId};if(e.email)n.Ib=e.email;else if(e.phoneNumber)n.ea=e.phoneNumber;else if(!n.credential)return new A(t,e.message||void 0);return new zo(t,n,e.message)}return null}function Xo(){}function Jo(e){return e.c||(e.c=e.b())}function Zo(){}function $o(e){if(!e.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++){var r=t[n];try{return new ActiveXObject(r),e.f=r}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return e.f}function ea(){}function ta(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=S(this.pc,this),this.a.onerror=S(this.Rb,this),this.a.onprogress=S(this.qc,this),this.a.ontimeout=S(this.uc,this)}function na(e,t){e.readyState=t,e.onreadystatechange&&e.onreadystatechange()}function ra(e,t,n){this.reset(e,t,n,void 0,void 0)}R(Yo,A),R(zo,A),zo.prototype.w=function(){var e={code:this.code,message:this.message};this.email&&(e.email=this.email),this.phoneNumber&&(e.phoneNumber=this.phoneNumber),this.tenantId&&(e.tenantId=this.tenantId);var t=this.credential&&this.credential.w();return t&&_e(e,t),e},zo.prototype.toJSON=function(){return this.w()},Xo.prototype.c=null,R(Zo,Xo),Zo.prototype.a=function(){var e=$o(this);return e?new ActiveXObject(e):new XMLHttpRequest},Zo.prototype.b=function(){var e={};return $o(this)&&(e[0]=!0,e[1]=!0),e},qo=new Zo,R(ea,Xo),ea.prototype.a=function(){var e=new XMLHttpRequest;if("withCredentials"in e)return e;if("undefined"!=typeof XDomainRequest)return new ta;throw Error("Unsupported browser")},ea.prototype.b=function(){return{}},(n=ta.prototype).open=function(e,t,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(e,t)},n.send=function(e){if(e){if("string"!=typeof e)throw Error("Only string data is supported");this.a.send(e)}else this.a.send()},n.abort=function(){this.a.abort()},n.setRequestHeader=function(){},n.getResponseHeader=function(e){return"content-type"==e.toLowerCase()?this.a.contentType:""},n.pc=function(){this.status=200,this.response=this.responseText=this.a.responseText,na(this,4)},n.Rb=function(){this.status=500,this.response=this.responseText="",na(this,4)},n.uc=function(){this.Rb()},n.qc=function(){this.status=200,na(this,1)},n.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},ra.prototype.a=null;function ia(e){this.f=e,this.b=this.c=this.a=null}function oa(e,t){this.name=e,this.value=t}ra.prototype.reset=function(e,t,n,r,i){"number"==typeof i||0,r||I(),delete this.a},oa.prototype.toString=function(){return this.name};var aa=new oa("SEVERE",1e3),sa=new oa("WARNING",900),ca=new oa("CONFIG",700),ua=new oa("FINE",500);ia.prototype.log=function(e,t,n){if(e.value>=function e(t){return t.c?t.c:t.a?e(t.a):(x("Root logger has no level set."),null)}(this).value)for(g(t)&&(t=t()),e=new ra(e,String(t),this.f),n&&(e.a=n),n=this;n;)n=n.a};var la={},da=null;function ha(e){var t;if(da||(da=new ia(""),la[""]=da,da.c=ca),!(t=la[e])){t=new ia(e);var n=e.lastIndexOf("."),r=e.substr(n+1);(n=ha(e.substr(0,n))).b||(n.b={}),n.b[r]=t,t.a=n,la[e]=t}return t}function pa(e,t){e&&e.log(ua,t,void 0)}function fa(e){this.f=e}function ga(e){bn.call(this),this.u=e,this.h=void 0,this.readyState=ma,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.o="GET",this.f="",this.a=!1,this.i=ha("goog.net.FetchXmlHttp"),this.m=this.c=this.g=null}R(fa,Xo),fa.prototype.a=function(){return new ga(this.f)},fa.prototype.b=function(e){return function(){return e}}({}),R(ga,bn);var ma=0;function va(e){e.c.read().then(e.oc.bind(e)).catch(e.Ta.bind(e))}function _a(e){e.readyState=4,e.g=null,e.c=null,e.m=null,Ea(e)}function Ea(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function ya(e){bn.call(this),this.headers=new kn,this.O=e||null,this.c=!1,this.A=this.a=null,this.h=this.P=this.l="",this.f=this.N=this.i=this.G=!1,this.g=0,this.o=null,this.m=Ta,this.u=this.R=!1}(n=ga.prototype).open=function(e,t){if(this.readyState!=ma)throw this.abort(),Error("Error reopening a connection");this.o=e,this.f=t,this.readyState=1,Ea(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var t={headers:this.l,method:this.o,credentials:this.h,cache:void 0};e&&(t.body=e),this.u.fetch(new Request(this.f,t)).then(this.tc.bind(this),this.Ta.bind(this))},n.abort=function(){this.response=this.responseText="",this.l=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,_a(this)),this.readyState=ma},n.tc=function(e){this.a&&(this.g=e,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=e.headers,this.readyState=2,Ea(this)),this.a&&(this.readyState=3,Ea(this),this.a&&("arraybuffer"===this.responseType?e.arrayBuffer().then(this.rc.bind(this),this.Ta.bind(this)):void 0!==c.ReadableStream&&"body"in e?(this.response=this.responseText="",this.c=e.body.getReader(),this.m=new TextDecoder,va(this)):e.text().then(this.sc.bind(this),this.Ta.bind(this)))))},n.oc=function(e){if(this.a){var t=this.m.decode(e.value?e.value:new Uint8Array(0),{stream:!e.done});t&&(this.response=this.responseText+=t),e.done?_a(this):Ea(this),3==this.readyState&&va(this)}},n.sc=function(e){this.a&&(this.response=this.responseText=e,_a(this))},n.rc=function(e){this.a&&(this.response=e,_a(this))},n.Ta=function(e){var t=this.i;t&&t.log(sa,"Failed to fetch url "+this.f,e instanceof Error?e:Error(e)),this.a&&_a(this)},n.setRequestHeader=function(e,t){this.l.append(e,t)},n.getResponseHeader=function(e){return this.b?this.b.get(e.toLowerCase())||"":((e=this.i)&&e.log(sa,"Attempting to get response header but no headers have been received for url: "+this.f,void 0),"")},n.getAllResponseHeaders=function(){if(!this.b){var e=this.i;return e&&e.log(sa,"Attempting to get all response headers but no headers have been received for url: "+this.f,void 0),""}e=[];for(var t=this.b.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ga.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(e){this.h=e?"include":"same-origin"}}),R(ya,bn);var Ta="";ya.prototype.b=ha("goog.net.XhrIo");var Sa=/^https?$/i,ba=["POST","PUT"];function Ia(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.P=n,e.G=!1,e.c=!0,e.a=e.O?e.O.a():qo.a(),e.A=e.O?Jo(e.O):Jo(qo),e.a.onreadystatechange=S(e.Ub,e);try{pa(e.b,Pa(e,"Opening Xhr")),e.N=!0,e.a.open(n,String(t),!0),e.N=!1}catch(t){return pa(e.b,Pa(e,"Error opening Xhr: "+t.message)),void Ca(e,t)}t=r||"";var o=new kn(e.headers);i&&function(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"==typeof e)q(e,t,void 0);else for(var n=On(e),r=Nn(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}(i,(function(e,t){o.set(t,e)})),i=function(e){e:{for(var t=Ra,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(o.Y()),r=c.FormData&&t instanceof c.FormData,!Q(ba,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(e,t){this.a.setRequestHeader(t,e)}),e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.R&&(e.a.withCredentials=e.R);try{Oa(e),0<e.g&&(e.u=function(e){return Xe&&st(9)&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(e.a),pa(e.b,Pa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.u)),e.u?(e.a.timeout=e.g,e.a.ontimeout=S(e.Ma,e)):e.o=An(e.Ma,e.g,e)),pa(e.b,Pa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){pa(e.b,Pa(e,"Send error: "+t.message)),Ca(e,t)}}function Ra(e){return"content-type"==e.toLowerCase()}function Ca(e,t){e.c=!1,e.a&&(e.f=!0,e.a.abort(),e.f=!1),e.h=t,Aa(e),Na(e)}function Aa(e){e.G||(e.G=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}function wa(e){if(e.c&&void 0!==s)if(e.A[1]&&4==ka(e)&&2==La(e))pa(e.b,Pa(e,"Local request error detected and ignored"));else if(e.i&&4==ka(e))An(e.Ub,0,e);else if(e.dispatchEvent("readystatechange"),4==ka(e)){pa(e.b,Pa(e,"Request complete")),e.c=!1;try{var t,n=La(e);e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(Dn)[1]||null;if(!o&&c.self&&c.self.location){var a=c.self.location.protocol;o=a.substr(0,a.length-1)}i=!Sa.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var u=2<ka(e)?e.a.statusText:""}catch(t){pa(e.b,"Can not get status: "+t.message),u=""}e.h=u+" ["+La(e)+"]",Aa(e)}}finally{Na(e)}}}function Na(e,t){if(e.a){Oa(e);var n=e.a,r=e.A[0]?h:null;e.a=null,e.A=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(aa,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function Oa(e){e.a&&e.u&&(e.a.ontimeout=null),e.o&&(c.clearTimeout(e.o),e.o=null)}function ka(e){return e.a?e.a.readyState:0}function La(e){try{return 2<ka(e)?e.a.status:-1}catch(e){return-1}}function Pa(e,t){return t+" ["+e.P+" "+e.l+" "+La(e)+"]"}function Da(e){var t=qa;this.g=[],this.u=t,this.o=e||null,this.f=this.a=!1,this.c=void 0,this.m=this.A=this.i=!1,this.h=0,this.b=null,this.l=0}function Ma(e,t,n){e.a=!0,e.c=n,e.f=!t,Fa(e)}function Ua(e){if(e.a){if(!e.m)throw new Va(e);e.m=!1}}function xa(e,t,n,r){e.g.push([t,n,r]),e.a&&Fa(e)}function ja(e){return z(e.g,(function(e){return g(e[1])}))}function Fa(e){if(e.h&&e.a&&ja(e)){var t=e.h,n=Ga[t];n&&(c.clearTimeout(n.a),delete Ga[t]),e.h=0}e.b&&(e.b.l--,delete e.b),t=e.c;for(var r=n=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,t);void 0!==s&&(e.f=e.f&&(s==t||s instanceof Error),e.c=t=s),(D(t)||"function"==typeof c.Promise&&t instanceof c.Promise)&&(r=!0,e.i=!0)}catch(r){t=r,e.f=!0,ja(e)||(n=!0)}}e.c=t,r&&(s=S(e.v,e,!0),r=S(e.v,e,!1),t instanceof Da?(xa(t,s,r),t.A=!0):t.then(s,r)),n&&(t=new Wa(t),Ga[t.a]=t,e.h=t.a)}function Va(){M.call(this)}function Ba(){M.call(this)}function Wa(e){this.a=c.setTimeout(S(this.c,this),0),this.b=e}(n=ya.prototype).Ma=function(){void 0!==s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",pa(this.b,Pa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},n.abort=function(){this.a&&this.c&&(pa(this.b,Pa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Na(this))},n.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Na(this,!0)),ya.$a.Da.call(this)},n.Ub=function(){this.xa||(this.N||this.i||this.f?wa(this):this.Ic())},n.Ic=function(){wa(this)},n.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var e=this.b;return e&&e.log(aa,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(e){return pa(this.b,"Can not get response: "+e.message),null}},Da.prototype.cancel=function(e){if(this.a)this.c instanceof Da&&this.c.cancel();else{if(this.b){var t=this.b;delete this.b,e?t.cancel(e):(t.l--,0>=t.l&&t.cancel())}this.u?this.u.call(this.o,this):this.m=!0,this.a||(e=new Ba(this),Ua(this),Ma(this,!1,e))}},Da.prototype.v=function(e,t){this.i=!1,Ma(this,e,t)},Da.prototype.then=function(e,t,n){var r,i,o=new bt((function(e,t){r=e,i=t}));return xa(this,r,(function(e){e instanceof Ba?o.cancel():i(e)})),o.then(e,t,n)},Da.prototype.$goog_Thenable=!0,R(Va,M),Va.prototype.message="Deferred has already fired",Va.prototype.name="AlreadyCalledError",R(Ba,M),Ba.prototype.message="Deferred was canceled",Ba.prototype.name="CanceledError",Wa.prototype.c=function(){throw delete Ga[this.a],this.b};var Ga={};function Ha(e){var t={},n=t.document||document,r=Ae(e).toString(),i=vt(document,"SCRIPT"),o={Vb:i,Ma:void 0},a=new Da(o),s=null,u=null!=t.timeout?t.timeout:5e3;return 0<u&&(s=window.setTimeout((function(){Ka(i,!0);var e=new Qa(za,"Timeout reached for loading script "+r);Ua(a),Ma(a,!1,e)}),u),o.Ma=s),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ka(i,t.wd||!1,s),Ua(a),Ma(a,!0,null))},i.onerror=function(){Ka(i,!0,s);var e=new Qa(Ya,"Error while loading script "+r);Ua(a),Ma(a,!1,e)},_e(o=t.attributes||{},{type:"text/javascript",charset:"UTF-8"}),ht(i,o),function(e,t){Ee(e,"HTMLScriptElement"),e.src=Ae(t),(t=e.ownerDocument&&e.ownerDocument.defaultView)&&t!=c?t=d(t.document):(null===l&&(l=d(c.document)),t=l),t&&e.setAttribute("nonce",t)}(i,e),function(e){var t;return(t=(e||document).getElementsByTagName("HEAD"))&&0!=t.length?t[0]:e.documentElement}(n).appendChild(i),a}function qa(){if(this&&this.Vb){var e=this.Vb;e&&"SCRIPT"==e.tagName&&Ka(e,!0,this.Ma)}}function Ka(e,t,n){null!=n&&c.clearTimeout(n),e.onload=h,e.onerror=h,e.onreadystatechange=h,t&&window.setTimeout((function(){e&&e.parentNode&&e.parentNode.removeChild(e)}),0)}var Ya=0,za=1;function Qa(e,t){var n="Jsloader error (code #"+e+")";t&&(n+=": "+t),M.call(this,n),this.code=e}function Xa(e){this.f=e}function Ja(e,n,r){if(this.c=e,e=n||{},this.l=e.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.v=e.secureTokenTimeout||es,this.g=me(e.secureTokenHeaders||ts),this.h=e.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=e.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.m=e.firebaseTimeout||ns,this.a=me(e.firebaseHeaders||rs),r&&(this.a["X-Client-Version"]=r,this.g["X-Client-Version"]=r),r="Node"==Sr(),!(r=c.XMLHttpRequest||r&&t.a.INTERNAL.node&&t.a.INTERNAL.node.XMLHttpRequest)&&!Tr())throw new A("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,Tr()?this.f=new fa(self):br()?this.f=new Xa(r):this.f=new ea,this.b=null}R(Qa,M),R(Xa,Xo),Xa.prototype.a=function(){return new this.f},Xa.prototype.b=function(){return{}};var Za,$a="idToken",es=new Wr(3e4,6e4),ts={"Content-Type":"application/x-www-form-urlencoded"},ns=new Wr(3e4,6e4),rs={"Content-Type":"application/json"};function is(e,t){t?e.a["X-Firebase-Locale"]=t:delete e.a["X-Firebase-Locale"]}function os(e,t){t&&(e.l=as("https://securetoken.googleapis.com/v1/token",t),e.h=as("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",t),e.i=as("https://identitytoolkit.googleapis.com/v2/",t))}function as(e,t){return e=Bn(e),t=Bn(t.url),e.c=e.a+e.c,Un(e,t.f),e.a=t.a,xn(e,t.g),e.toString()}function ss(e,t){t?(e.a["X-Client-Version"]=t,e.g["X-Client-Version"]=t):(delete e.a["X-Client-Version"],delete e.g["X-Client-Version"])}function cs(e,t,n,r,i,o,a){(function(){var e=Nr();return!((e=Cr(e)!=Rr?null:(e=e.match(/\sChrome\/(\d+)/i))&&2==e.length?parseInt(e[1],10):null)&&30>e)&&(!Xe||!ut||9<ut)})()||Tr()?e=S(e.u,e):(Za||(Za=new bt((function(e,t){!function(e,t){if(((window.gapi||{}).client||{}).request)e();else{c[ls]=function(){((window.gapi||{}).client||{}).request?e():t(Error("CORS_UNSUPPORTED"))},function(e,t){xa(e,null,t,void 0)}(Ha(we(us,{onload:ls})),(function(){t(Error("CORS_UNSUPPORTED"))}))}}(e,t)}))),e=S(e.o,e)),e(t,n,r,i,o,a)}Ja.prototype.S=function(){return this.b},Ja.prototype.u=function(e,t,n,r,i,o){if(Tr()&&(void 0===c.fetch||void 0===c.Headers||void 0===c.Request))throw new A("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new ya(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout((function(){a.dispatchEvent("timeout")}),o)}In(a,"complete",(function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return pa(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}t&&t(e)})),Rn(a,"ready",(function(){s&&clearTimeout(s),Yt(this)})),Rn(a,"timeout",(function(){s&&clearTimeout(s),Yt(this),t&&t(null)})),Ia(a,e,n,r,i)};var us=new ye(Ie,"https://apis.google.com/js/client.js?onload=%{onload}"),ls="__fcb"+Math.floor(1e6*Math.random()).toString();function ds(e,t,n,r,i,o,a){var s=Bn(t+n);Fn(s,"key",e.c),a&&Fn(s,"cb",I().toString());var c="GET"==r;if(c)for(var u in i)i.hasOwnProperty(u)&&Fn(s,u,i[u]);return new bt((function(t,n){cs(e,s.toString(),(function(e){e?e.error?n(ac(e,o||{})):t(e):n(new A("network-request-failed"))}),r,c?void 0:or(xr(i)),e.a,e.m.get())}))}function hs(e){if("string"!=typeof(e=e.email)||!vr.test(e))throw new A("invalid-email")}function ps(e){"email"in e&&hs(e)}function fs(e){if(!e[$a]){if(e.mfaPendingCredential)throw new A("multi-factor-auth-required",null,me(e));throw new A("internal-error")}}function gs(e){if(e.phoneNumber||e.temporaryProof){if(!e.phoneNumber||!e.temporaryProof)throw new A("internal-error")}else{if(!e.sessionInfo)throw new A("missing-verification-id");if(!e.code)throw new A("missing-verification-code")}}Ja.prototype.o=function(e,t,n,r,i){var o=this;Za.then((function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:e,method:n,body:r,headers:i,authType:"none",callback:function(e){window.gapi.auth.setToken(a),t&&t(e)}})})).s((function(e){t&&t({error:{message:e&&e.message||"CORS_UNSUPPORTED"}})}))},Ja.prototype.yb=function(){return ic(this,Ks,{})},Ja.prototype.Ab=function(e,t){return ic(this,Hs,{idToken:e,email:t})},Ja.prototype.Bb=function(e,t){return ic(this,qs,{idToken:e,password:t})};var ms={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function vs(e){if(!e.phoneVerificationInfo)throw new A("internal-error");if(!e.phoneVerificationInfo.sessionInfo)throw new A("missing-verification-id");if(!e.phoneVerificationInfo.code)throw new A("missing-verification-code")}function _s(e){if(!e.requestUri||!e.sessionId&&!e.postBody&&!e.pendingToken)throw new A("internal-error")}function Es(e,t){return t.oauthIdToken&&t.providerId&&0==t.providerId.indexOf("oidc.")&&!t.pendingToken&&(e.sessionId?t.nonce=e.sessionId:e.postBody&&(tr(e=new Jn(e.postBody),"nonce")&&(t.nonce=e.get("nonce")))),t}function ys(e){var t=null;if(e.needConfirmation?(e.code="account-exists-with-different-credential",t=Qo(e)):"FEDERATED_USER_ID_ALREADY_LINKED"==e.errorMessage?(e.code="credential-already-in-use",t=Qo(e)):"EMAIL_EXISTS"==e.errorMessage?(e.code="email-already-in-use",t=Qo(e)):e.errorMessage&&(t=oc(e.errorMessage)),t)throw t;fs(e)}function Ts(e,t){return t.returnIdpCredential=!0,ic(e,Qs,t)}function Ss(e,t){return t.returnIdpCredential=!0,ic(e,Js,t)}function bs(e,t){return t.returnIdpCredential=!0,t.autoCreate=!1,ic(e,Xs,t)}function Is(e){if(!e.oobCode)throw new A("invalid-action-code")}(n=Ja.prototype).Cb=function(e,t){var n={idToken:e},r=[];return fe(ms,(function(e,i){var o=t[i];null===o?r.push(e):i in t&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),ic(this,Hs,n)},n.ub=function(e,t){return _e(e={requestType:"PASSWORD_RESET",email:e},t),ic(this,Fs,e)},n.vb=function(e,t){return _e(e={requestType:"EMAIL_SIGNIN",email:e},t),ic(this,Us,e)},n.tb=function(e,t){return _e(e={requestType:"VERIFY_EMAIL",idToken:e},t),ic(this,xs,e)},n.Db=function(e,t,n){return _e(e={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:e,newEmail:t},n),ic(this,js,e)},n.eb=function(e){return ic(this,ec,e)},n.mb=function(e,t){return ic(this,Ws,{oobCode:e,newPassword:t})},n.Qa=function(e){return ic(this,Cs,{oobCode:e})},n.ib=function(e){return ic(this,Rs,{oobCode:e})};var Rs={endpoint:"setAccountInfo",B:Is,Z:"email",C:!0},Cs={endpoint:"resetPassword",B:Is,F:function(e){var t=e.requestType;if(!t||!e.email&&"EMAIL_SIGNIN"!=t&&"VERIFY_AND_CHANGE_EMAIL"!=t)throw new A("internal-error")},C:!0},As={endpoint:"signupNewUser",B:function(e){if(hs(e),!e.password)throw new A("weak-password")},F:fs,U:!0,C:!0},ws={endpoint:"createAuthUri",C:!0},Ns={endpoint:"deleteAccount",M:["idToken"]},Os={endpoint:"setAccountInfo",M:["idToken","deleteProvider"],B:function(e){if(!Array.isArray(e.deleteProvider))throw new A("internal-error")}},ks={endpoint:"emailLinkSignin",M:["email","oobCode"],B:hs,F:fs,U:!0,C:!0},Ls={endpoint:"emailLinkSignin",M:["idToken","email","oobCode"],B:hs,F:fs,U:!0},Ps={endpoint:"accounts/mfaEnrollment:finalize",M:["idToken","phoneVerificationInfo"],B:vs,F:fs,C:!0,Na:!0},Ds={endpoint:"accounts/mfaSignIn:finalize",M:["mfaPendingCredential","phoneVerificationInfo"],B:vs,F:fs,C:!0,Na:!0},Ms={endpoint:"getAccountInfo"},Us={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(e){if("EMAIL_SIGNIN"!=e.requestType)throw new A("internal-error");hs(e)},Z:"email",C:!0},xs={endpoint:"getOobConfirmationCode",M:["idToken","requestType"],B:function(e){if("VERIFY_EMAIL"!=e.requestType)throw new A("internal-error")},Z:"email",C:!0},js={endpoint:"getOobConfirmationCode",M:["idToken","newEmail","requestType"],B:function(e){if("VERIFY_AND_CHANGE_EMAIL"!=e.requestType)throw new A("internal-error")},Z:"email",C:!0},Fs={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(e){if("PASSWORD_RESET"!=e.requestType)throw new A("internal-error");hs(e)},Z:"email",C:!0},Vs={kb:!0,endpoint:"getProjectConfig",Tb:"GET"},Bs={kb:!0,endpoint:"getRecaptchaParam",Tb:"GET",F:function(e){if(!e.recaptchaSiteKey)throw new A("internal-error")}},Ws={endpoint:"resetPassword",B:Is,Z:"email",C:!0},Gs={endpoint:"sendVerificationCode",M:["phoneNumber","recaptchaToken"],Z:"sessionInfo",C:!0},Hs={endpoint:"setAccountInfo",M:["idToken"],B:ps,U:!0},qs={endpoint:"setAccountInfo",M:["idToken"],B:function(e){if(ps(e),!e.password)throw new A("weak-password")},F:fs,U:!0},Ks={endpoint:"signupNewUser",F:fs,U:!0,C:!0},Ys={endpoint:"accounts/mfaEnrollment:start",M:["idToken","phoneEnrollmentInfo"],B:function(e){if(!e.phoneEnrollmentInfo)throw new A("internal-error");if(!e.phoneEnrollmentInfo.phoneNumber)throw new A("missing-phone-number");if(!e.phoneEnrollmentInfo.recaptchaToken)throw new A("missing-app-credential")},F:function(e){if(!e.phoneSessionInfo||!e.phoneSessionInfo.sessionInfo)throw new A("internal-error")},C:!0,Na:!0},zs={endpoint:"accounts/mfaSignIn:start",M:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],B:function(e){if(!e.phoneSignInInfo||!e.phoneSignInInfo.recaptchaToken)throw new A("missing-app-credential")},F:function(e){if(!e.phoneResponseInfo||!e.phoneResponseInfo.sessionInfo)throw new A("internal-error")},C:!0,Na:!0},Qs={endpoint:"verifyAssertion",B:_s,Xa:Es,F:ys,U:!0,C:!0},Xs={endpoint:"verifyAssertion",B:_s,Xa:Es,F:function(e){if(e.errorMessage&&"USER_NOT_FOUND"==e.errorMessage)throw new A("user-not-found");if(e.errorMessage)throw oc(e.errorMessage);fs(e)},U:!0,C:!0},Js={endpoint:"verifyAssertion",B:function(e){if(_s(e),!e.idToken)throw new A("internal-error")},Xa:Es,F:ys,U:!0},Zs={endpoint:"verifyCustomToken",B:function(e){if(!e.token)throw new A("invalid-custom-token")},F:fs,U:!0,C:!0},$s={endpoint:"verifyPassword",B:function(e){if(hs(e),!e.password)throw new A("wrong-password")},F:fs,U:!0,C:!0},ec={endpoint:"verifyPhoneNumber",B:gs,F:fs,C:!0},tc={endpoint:"verifyPhoneNumber",B:function(e){if(!e.idToken)throw new A("internal-error");gs(e)},F:function(e){if(e.temporaryProof)throw e.code="credential-already-in-use",Qo(e);fs(e)}},nc={Gb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:gs,F:fs,C:!0},rc={endpoint:"accounts/mfaEnrollment:withdraw",M:["idToken","mfaEnrollmentId"],F:function(e){if(!!e[$a]^!!e.refreshToken)throw new A("internal-error")},C:!0,Na:!0};function ic(e,t,n){if(!function(e,t){if(!t||!t.length)return!0;if(!e)return!1;for(var n=0;n<t.length;n++){var r=e[t[n]];if(null==r||""===r)return!1}return!0}(n,t.M))return kt(new A("internal-error"));var r,i=!!t.Na,o=t.Tb||"POST";return Ot(n).then(t.B).then((function(){return t.U&&(n.returnSecureToken=!0),t.C&&e.b&&void 0===n.tenantId&&(n.tenantId=e.b),ds(e,i?e.i:e.h,t.endpoint,o,n,t.Gb,t.kb||!1)})).then((function(e){return r=e,t.Xa?t.Xa(n,r):r})).then(t.F).then((function(){if(!t.Z)return r;if(!(t.Z in r))throw new A("internal-error");return r[t.Z]}))}function oc(e){return ac({error:{errors:[{message:e}],code:400,message:e}})}function ac(e,t){var n=(e.error&&e.error.errors&&e.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new A(r[n]):null)return n;for(var i in n=e.error&&e.error.message||"",_e(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},t||{}),t=(t=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<t.length?t[1]:void 0,r)if(0===n.indexOf(i))return new A(r[i],t);return!t&&e&&(t=Ur(e)),new A("internal-error",t)}function sc(e){this.b=e,this.a=null,this.qb=function(e){return(dc||(dc=new bt((function(e,t){function n(){Br(),Or("gapi.load")("gapi.iframes",{callback:e,ontimeout:function(){Br(),t(Error("Network Error"))},timeout:uc.get()})}if(Or("gapi.iframes.Iframe"))e();else if(Or("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();c[r]=function(){Or("gapi.load")?n():t(Error("Network Error"))},Ot(Ha(r=we(cc,{onload:r}))).s((function(){t(Error("Network Error"))}))}})).s((function(e){throw dc=null,e})))).then((function(){return new bt((function(t,n){Or("gapi.iframes.getContext")().open({where:document.body,url:e.b,messageHandlersFilter:Or("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),t()}e.a=r,e.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),lc.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var cc=new ye(Ie,"https://apis.google.com/js/api.js?onload=%{onload}"),uc=new Wr(3e4,6e4),lc=new Wr(5e3,15e3),dc=null;function hc(e,t,n,r){this.l=e,this.h=t,this.i=n,this.g=r,this.f=null,this.g?e=Wn((e=Bn(this.g.url)).f,e.a,e.g,"/emulator/auth/iframe"):e=Wn("https",this.l,null,"/__/auth/iframe"),this.a=e,Fn(this.a,"apiKey",this.h),Fn(this.a,"appName",this.i),this.b=null,this.c=[]}function pc(e,t,n,r,i,o){this.u=e,this.o=t,this.c=n,this.v=r,this.m=o,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function fc(e){try{return t.a.app(e).auth().Ga()}catch(e){return[]}}function gc(e,t,n,r,i,o){this.o=e,this.g=t,this.b=n,this.f=o,this.c=r||null,this.i=i||null,this.l=this.u=this.A=null,this.h=[],this.v=this.a=null}function mc(e){var t=dr();return function(e){return ic(e,Vs,{}).then((function(e){return e.authorizedDomains||[]}))}(e).then((function(e){e:{var n=Bn(t),r=n.f;n=n.a;for(var i=0;i<e.length;i++){var o=e[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=Bn(o).a==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:mr.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){e=!0;break e}}e=!1}if(!e)throw new Yo(dr())}))}function vc(e){return e.v||(e.v=_r().then((function(){if(!e.u){var t=e.c,n=e.i,r=fc(e.b),i=new hc(e.o,e.g,e.b,e.f);i.f=t,i.b=n,i.c=$(r||[]),e.u=i.toString()}e.m=new sc(e.u),function(e){if(!e.m)throw Error("IfcHandler must be initialized!");!function(e,t){e.qb.then((function(){e.a.register("authEvent",t,Or("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(e.m,(function(t){var n={};if(t&&t.authEvent){var r=!1;for(t=Go(t.authEvent),n=0;n<e.h.length;n++)r=e.h[n](t)||r;return(n={}).status=r?"ACK":"ERROR",Ot(n)}return n.status="ERROR",Ot(n)}))}(e)}))),e.v}function _c(e){return e.l||(e.A=e.c?wr(e.c,fc(e.b)):null,e.l=new Ja(e.g,P(e.i),e.A),e.f&&os(e.l,e.f)),e.l}function Ec(e,t,n,r,i,o,a,s,c,u,l,d){return(e=new pc(e,t,n,r,i,d)).l=o,e.g=a,e.i=s,e.b=me(c||null),e.f=u,e.xb(l).toString()}function yc(e){if(this.a=e||t.a.INTERNAL.reactNative&&t.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new A("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Tc(e){this.b=e,this.a={},this.f=S(this.c,this)}hc.prototype.toString=function(){return this.f?Fn(this.a,"v",this.f):er(this.a.b,"v"),this.b?Fn(this.a,"eid",this.b):er(this.a.b,"eid"),this.c.length?Fn(this.a,"fw",this.c.join(",")):er(this.a.b,"fw"),this.a.toString()},pc.prototype.xb=function(e){return this.h=e,this},pc.prototype.toString=function(){if(this.m){var e=Bn(this.m.url);e=Wn(e.f,e.a,e.g,"/emulator/auth/handler")}else e=Wn("https",this.u,null,"/__/auth/handler");if(Fn(e,"apiKey",this.o),Fn(e,"appName",this.c),Fn(e,"authType",this.v),this.a.isOAuthProvider){var n=this.a;try{var r=t.a.app(this.c).auth().ka()}catch(e){r=null}for(var i in n.nb=r,Fn(e,"providerId",this.a.providerId),n=xr((r=this.a).Hb))n[i]=n[i].toString();i=r.Pc,n=me(n);for(var o=0;o<i.length;o++){var a=i[o];a in n&&delete n[a]}r.ob&&r.nb&&!n[r.ob]&&(n[r.ob]=r.nb),ge(n)||Fn(e,"customParameters",Ur(n))}if("function"==typeof this.a.Pb&&((r=this.a.Pb()).length&&Fn(e,"scopes",r.join(","))),this.l?Fn(e,"redirectUrl",this.l):er(e.b,"redirectUrl"),this.g?Fn(e,"eventId",this.g):er(e.b,"eventId"),this.i?Fn(e,"v",this.i):er(e.b,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Vn(e,s)&&Fn(e,s,this.b[s]);return this.h?Fn(e,"tid",this.h):er(e.b,"tid"),this.f?Fn(e,"eid",this.f):er(e.b,"eid"),(s=fc(this.c)).length&&Fn(e,"fw",s.join(",")),e.toString()},(n=gc.prototype).Nb=function(e,t,n){var r=new A("popup-closed-by-user"),i=new A("web-storage-unsupported"),o=this,a=!1;return this.la().then((function(){(function(e){var t={type:"webStorageSupport"};return vc(e).then((function(){return function(e,t){return e.qb.then((function(){return new bt((function(n){e.a.send(t.type,t,n,Or("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(e.m,t)})).then((function(e){if(e&&e.length&&void 0!==e[0].webStorageSupport)return e[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(e&&fr(e),t(i),a=!0)}))})).s((function(){})).then((function(){if(!a)return function(e){return new bt((function(t){return function n(){wn(2e3).then((function(){if(e&&!e.closed)return n();t()}))}()}))}(e)})).then((function(){if(!a)return wn(n).then((function(){t(r)}))}))},n.Wb=function(){var e=Nr();return!Mr(e)&&!Vr(e)},n.Sb=function(){return!1},n.Lb=function(e,t,n,r,i,o,a,s){if(!e)return kt(new A("popup-blocked"));if(a&&!Mr())return this.la().s((function(t){fr(e),i(t)})),r(),Ot();this.a||(this.a=mc(_c(this)));var c=this;return this.a.then((function(){var t=c.la().s((function(t){throw fr(e),i(t),t}));return r(),t})).then((function(){(Bo(n),a)||hr(Ec(c.o,c.g,c.b,t,n,null,o,c.c,void 0,c.i,s,c.f),e)})).s((function(e){throw"auth/network-request-failed"==e.code&&(c.a=null),e}))},n.Mb=function(e,t,n,r){this.a||(this.a=mc(_c(this)));var i=this;return this.a.then((function(){Bo(t),hr(Ec(i.o,i.g,i.b,e,t,dr(),n,i.c,void 0,i.i,r,i.f))})).s((function(e){throw"auth/network-request-failed"==e.code&&(i.a=null),e}))},n.la=function(){var e=this;return vc(this).then((function(){return e.m.qb})).s((function(){throw e.a=null,new A("network-request-failed")}))},n.Zb=function(){return!0},n.Ea=function(e){this.h.push(e)},n.Ra=function(e){J(this.h,(function(t){return t==e}))},(n=yc.prototype).get=function(e){return Ot(this.a.getItem(e)).then((function(e){return e&&jr(e)}))},n.set=function(e,t){return Ot(this.a.setItem(e,Ur(t)))},n.T=function(e){return Ot(this.a.removeItem(e))},n.ca=function(){},n.ia=function(){};var Sc,bc=[];function Ic(e,t,n){ge(e.a)&&e.b.addEventListener("message",e.f),void 0===e.a[t]&&(e.a[t]=[]),e.a[t].push(n)}function Rc(e){this.a=e}function Cc(e){this.c=e,this.b=!1,this.a=[]}function Ac(e,t,n,r){var i,o,a,s,c=n||{},u=null;if(e.b)return kt(Error("connection_unavailable"));var l=r?800:50,d="undefined"!=typeof MessageChannel?new MessageChannel:null;return new bt((function(n,r){d?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),d.port1.start(),a=setTimeout((function(){r(Error("unsupported_event"))}),l),u={messageChannel:d,onMessage:o=function(e){e.data.eventId===i&&("ack"===e.data.status?(clearTimeout(a),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===e.data.status?(clearTimeout(s),void 0!==e.data.response?n(e.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},e.a.push(u),d.port1.addEventListener("message",o),e.c.postMessage({eventType:t,eventId:i,data:c},[d.port2])):r(Error("connection_unavailable"))})).then((function(t){return wc(e,u),t})).s((function(t){throw wc(e,u),t}))}function wc(e,t){if(t){var n=t.messageChannel,r=t.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),J(e.a,(function(e){return e==t}))}}function Nc(){if(!Pc())throw new A("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.v=c.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.l=null,this.o=!1,this.h=null;var e=this;Tr()&&self?(this.m=function(){var e=Tr()?self:null;if(q(bc,(function(n){n.b==e&&(t=n)})),!t){var t=new Tc(e);bc.push(t)}return t}(),Ic(this.m,"keyChanged",(function(t,n){return jc(e).then((function(t){return 0<t.length&&q(e.a,(function(e){e(t)})),{keyProcessed:Q(t,n.key)}}))})),Ic(this.m,"ping",(function(){return Ot(["keyChanged"])}))):function(){var e=c.navigator;return e&&e.serviceWorker?Ot().then((function(){return e.serviceWorker.ready})).then((function(e){return e.active||null})).s((function(){return null})):Ot(null)}().then((function(t){(e.h=t)&&(e.g=new Cc(new Rc(t)),Ac(e.g,"ping",null,!0).then((function(t){t[0].fulfilled&&Q(t[0].value,"keyChanged")&&(e.o=!0)})).s((function(){})))}))}function Oc(e){return new bt((function(t,n){var r=e.v.open("firebaseLocalStorageDb",1);r.onerror=function(e){try{e.preventDefault()}catch(e){}n(Error(e.target.error))},r.onupgradeneeded=function(e){e=e.target.result;try{e.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){n(e)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?t(r):function(e){return new bt((function(t,n){var r=e.v.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){t()},r.onerror=function(e){n(Error(e.target.error))}}))}(e).then((function(){return Oc(e)})).then((function(e){t(e)})).s((function(e){n(e)}))}}))}function kc(e){return e.i||(e.i=Oc(e)),e.i}function Lc(e,t){var n=0;return new bt((function r(i,o){kc(e).then(t).then(i).s((function(t){if(!(3<++n))return kc(e).then((function(t){return t.close(),e.i=void 0,r(i,o)}));o(t)}))}))}function Pc(){try{return!!c.indexedDB}catch(e){return!1}}function Dc(e){return e.objectStore("firebaseLocalStorage")}function Mc(e,t){return e.transaction(["firebaseLocalStorage"],t?"readwrite":"readonly")}function Uc(e){return new bt((function(t,n){e.onsuccess=function(e){e&&e.target?t(e.target.result):t()},e.onerror=function(e){n(e.target.error)}}))}function xc(e,t){return e.g&&e.h&&function(){var e=c.navigator;return e&&e.serviceWorker&&e.serviceWorker.controller||null}()===e.h?Ac(e.g,"keyChanged",{key:t},e.o).then((function(){})).s((function(){})):Ot()}function jc(e){return kc(e).then((function(e){var t=Dc(Mc(e,!1));return t.getAll?Uc(t.getAll()):new bt((function(e,n){var r=[],i=t.openCursor();i.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},i.onerror=function(e){n(e.target.error)}}))})).then((function(t){var n={},r=[];if(0==e.b){for(r=0;r<t.length;r++)n[t[r].fbase_key]=t[r].value;r=function e(t,n){var r,i=[];for(r in t)r in n?typeof t[r]!=typeof n[r]?i.push(r):"object"==typeof t[r]&&null!=t[r]&&null!=n[r]?0<e(t[r],n[r]).length&&i.push(r):t[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in t||i.push(r);return i}(e.c,n),e.c=n}return r}))}function Fc(e){e.l&&e.l.cancel("STOP_EVENT"),e.f&&(clearTimeout(e.f),e.f=null)}function Vc(e){var t=this,n=null;this.a=[],this.type="indexedDB",this.c=e,this.b=Ot().then((function(){if(Pc()){var e=Fr(),r="__sak"+e;return Sc||(Sc=new Nc),(n=Sc).set(r,e).then((function(){return n.get(r)})).then((function(t){if(t!==e)throw Error("indexedDB not supported!");return n.T(r)})).then((function(){return n})).s((function(){return t.c}))}return t.c})).then((function(e){return t.type=e.type,e.ca((function(e){q(t.a,(function(t){t(e)}))})),e}))}function Bc(){this.a={},this.type="inMemory"}function Wc(){if(!function(){var e="Node"==Sr();if(!(e=Gc()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.localStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==Sr())throw new A("internal-error","The LocalStorage compatibility library was not found.");throw new A("web-storage-unsupported")}this.a=Gc()||t.a.INTERNAL.node.localStorage,this.type="localStorage"}function Gc(){try{var e=c.localStorage,t=Fr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(e){return null}}function Hc(){this.type="nullStorage"}function qc(){if(!function(){var e="Node"==Sr();if(!(e=Kc()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.sessionStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==Sr())throw new A("internal-error","The SessionStorage compatibility library was not found.");throw new A("web-storage-unsupported")}this.a=Kc()||t.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Kc(){try{var e=c.sessionStorage,t=Fr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(e){return null}}function Yc(){var e={};e.Browser=Xc,e.Node=Jc,e.ReactNative=Zc,e.Worker=$c,this.a=e[Sr()]}Tc.prototype.c=function(e){var t=e.data.eventType,n=e.data.eventId,r=this.a[t];if(r&&0<r.length){e.ports[0].postMessage({status:"ack",eventId:n,eventType:t,response:null});var i=[];q(r,(function(t){i.push(Ot().then((function(){return t(e.origin,e.data.data)})))})),Pt(i).then((function(r){var i=[];q(r,(function(e){i.push({fulfilled:e.Ob,value:e.value,reason:e.reason?e.reason.message:void 0})})),q(i,(function(e){for(var t in e)void 0===e[t]&&delete e[t]})),e.ports[0].postMessage({status:"done",eventId:n,eventType:t,response:i})}))}},Rc.prototype.postMessage=function(e,t){this.a.postMessage(e,t)},Cc.prototype.close=function(){for(;0<this.a.length;)wc(this,this.a[0]);this.b=!0},(n=Nc.prototype).set=function(e,t){var n=this,r=!1;return Lc(this,(function(t){return Uc((t=Dc(Mc(t,!0))).get(e))})).then((function(i){return Lc(n,(function(o){if(o=Dc(Mc(o,!0)),i)return i.value=t,Uc(o.put(i));n.b++,r=!0;var a={};return a.fbase_key=e,a.value=t,Uc(o.add(a))}))})).then((function(){return n.c[e]=t,xc(n,e)})).na((function(){r&&n.b--}))},n.get=function(e){return Lc(this,(function(t){return Uc(Dc(Mc(t,!1)).get(e))})).then((function(e){return e&&e.value}))},n.T=function(e){var t=this,n=!1;return Lc(this,(function(r){return n=!0,t.b++,Uc(Dc(Mc(r,!0)).delete(e))})).then((function(){return delete t.c[e],xc(t,e)})).na((function(){n&&t.b--}))},n.ca=function(e){0==this.a.length&&function(e){Fc(e),function t(){e.f=setTimeout((function(){e.l=jc(e).then((function(t){0<t.length&&q(e.a,(function(e){e(t)}))})).then((function(){t()})).s((function(e){"STOP_EVENT"!=e.message&&t()}))}),800)}()}(this),this.a.push(e)},n.ia=function(e){J(this.a,(function(t){return t==e})),0==this.a.length&&Fc(this)},(n=Vc.prototype).get=function(e){return this.b.then((function(t){return t.get(e)}))},n.set=function(e,t){return this.b.then((function(n){return n.set(e,t)}))},n.T=function(e){return this.b.then((function(t){return t.T(e)}))},n.ca=function(e){this.a.push(e)},n.ia=function(e){J(this.a,(function(t){return t==e}))},(n=Bc.prototype).get=function(e){return Ot(this.a[e])},n.set=function(e,t){return this.a[e]=t,Ot()},n.T=function(e){return delete this.a[e],Ot()},n.ca=function(){},n.ia=function(){},(n=Wc.prototype).get=function(e){var t=this;return Ot().then((function(){return jr(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return Ot().then((function(){var r=Ur(t);null===r?n.T(e):n.a.setItem(e,r)}))},n.T=function(e){var t=this;return Ot().then((function(){t.a.removeItem(e)}))},n.ca=function(e){c.window&&dn(c.window,"storage",e)},n.ia=function(e){c.window&&fn(c.window,"storage",e)},(n=Hc.prototype).get=function(){return Ot(null)},n.set=function(){return Ot()},n.T=function(){return Ot()},n.ca=function(){},n.ia=function(){},(n=qc.prototype).get=function(e){var t=this;return Ot().then((function(){return jr(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return Ot().then((function(){var r=Ur(t);null===r?n.T(e):n.a.setItem(e,r)}))},n.T=function(e){var t=this;return Ot().then((function(){t.a.removeItem(e)}))},n.ca=function(){},n.ia=function(){};var zc,Qc,Xc={D:Wc,ab:qc},Jc={D:Wc,ab:qc},Zc={D:yc,ab:Hc},$c={D:Wc,ab:Hc},eu={qd:"local",NONE:"none",sd:"session"};function tu(){var e=!(Vr(Nr())||!yr()),t=Mr(),n=kr();this.v=e,this.h=t,this.l=n,this.a={},zc||(zc=new Yc),e=zc;try{this.g=!lr()&&Kr()||!c.indexedDB?new e.a.D:new Vc(Tr()?new Bc:new e.a.D)}catch(e){this.g=new Bc,this.h=!0}try{this.i=new e.a.ab}catch(e){this.i=new Bc}this.m=new Bc,this.f=S(this.Xb,this),this.b={}}function nu(){return Qc||(Qc=new tu),Qc}function ru(e,t){switch(t){case"session":return e.i;case"none":return e.m;default:return e.g}}function iu(e,t){return"firebase:"+e.name+(t?":"+t:"")}function ou(e,t,n){return n=iu(t,n),"local"==t.D&&(e.b[n]=null),ru(e,t.D).T(n)}function au(e){e.c&&(clearInterval(e.c),e.c=null)}function su(e){this.a=e,this.b=nu()}(n=tu.prototype).get=function(e,t){return ru(this,e.D).get(iu(e,t))},n.set=function(e,t,n){var r=iu(e,n),i=this,o=ru(this,e.D);return o.set(r,t).then((function(){return o.get(r)})).then((function(t){"local"==e.D&&(i.b[r]=t)}))},n.addListener=function(e,t,n){e=iu(e,t),this.l&&(this.b[e]=c.localStorage.getItem(e)),ge(this.a)&&(ru(this,"local").ca(this.f),this.h||(lr()||!Kr())&&c.indexedDB||!this.l||function(e){au(e),e.c=setInterval((function(){for(var t in e.a){var n=c.localStorage.getItem(t),r=e.b[t];n!=r&&(e.b[t]=n,n=new $t({type:"storage",key:t,target:window,oldValue:r,newValue:n,a:!0}),e.Xb(n))}}),1e3)}(this)),this.a[e]||(this.a[e]=[]),this.a[e].push(n)},n.removeListener=function(e,t,n){e=iu(e,t),this.a[e]&&(J(this.a[e],(function(e){return e==n})),0==this.a[e].length&&delete this.a[e]),ge(this.a)&&(ru(this,"local").ia(this.f),au(this))},n.Xb=function(e){if(e&&e.g){var t=e.a.key;if(null==t)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=c.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.lb(n))}else if(0==t.indexOf("firebase:")&&this.a[t]){if(void 0!==e.a.a?ru(this,"local").ia(this.f):au(this),this.v)if(n=c.localStorage.getItem(t),(r=e.a.newValue)!==n)null!==r?c.localStorage.setItem(t,r):c.localStorage.removeItem(t);else if(this.b[t]===r&&void 0===e.a.a)return;var o=this;n=function(){void 0===e.a.a&&o.b[t]===c.localStorage.getItem(t)||(o.b[t]=c.localStorage.getItem(t),o.lb(t))},Xe&&ut&&10==ut&&c.localStorage.getItem(t)!==e.a.newValue&&e.a.newValue!==e.a.oldValue?setTimeout(n,10):n()}}else q(e,S(this.lb,this))},n.lb=function(e){this.a[e]&&q(this.a[e],(function(e){e()}))};var cu,uu={name:"authEvent",D:"local"};function lu(){this.a=nu()}function du(e,t){this.b=hu,this.f=c.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=e,this.h=t,this.l=c.Int32Array?new Int32Array(64):Array(64),void 0===cu&&(cu=c.Int32Array?new Int32Array(Eu):Eu),this.reset()}R(du,(function(){this.b=-1}));for(var hu=64,pu=hu-1,fu=[],gu=0;gu<pu;gu++)fu[gu]=0;var mu=Z(128,fu);function vu(e){for(var t=e.f,n=e.l,r=0,i=0;i<t.length;)n[r++]=t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3],i=4*r;for(t=16;64>t;t++){i=0|n[t-15],r=0|n[t-2];var o=(0|n[t-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[t-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[t]=o+a|0}r=0|e.a[0],i=0|e.a[1];var s=0|e.a[2],c=0|e.a[3],u=0|e.a[4],l=0|e.a[5],d=0|e.a[6];for(o=0|e.a[7],t=0;64>t;t++){var h=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))|0)+((a=(a=u&l^~u&d)+(0|cu[t])|0)+(0|n[t])|0)|0,o=d,d=l,l=u,u=c+a|0,c=s,s=i,i=r,r=a+h|0}e.a[0]=e.a[0]+r|0,e.a[1]=e.a[1]+i|0,e.a[2]=e.a[2]+s|0,e.a[3]=e.a[3]+c|0,e.a[4]=e.a[4]+u|0,e.a[5]=e.a[5]+l|0,e.a[6]=e.a[6]+d|0,e.a[7]=e.a[7]+o|0}function _u(e,t,n){void 0===n&&(n=t.length);var r=0,i=e.c;if("string"==typeof t)for(;r<n;)e.f[i++]=t.charCodeAt(r++),i==e.b&&(vu(e),i=0);else{if(!f(t))throw Error("message must be string or array");for(;r<n;){var o=t[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");e.f[i++]=o,i==e.b&&(vu(e),i=0)}}e.c=i,e.g+=n}du.prototype.reset=function(){this.g=this.c=0,this.a=c.Int32Array?new Int32Array(this.h):$(this.h)};var Eu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function yu(){du.call(this,8,Tu)}R(yu,du);var Tu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Su(e,t,n,r,i,o){this.m=e,this.i=t,this.l=n,this.v=r||null,this.u=i||null,this.o=o,this.h=t+":"+n,this.A=new lu,this.g=new su(this.h),this.f=null,this.b=[],this.a=this.c=null}function bu(e){return new A("invalid-cordova-configuration",e)}function Iu(e){var t=new yu;_u(t,e),e=[];var n=8*t.g;56>t.c?_u(t,mu,56-t.c):_u(t,mu,t.b-(t.c-56));for(var r=63;56<=r;r--)t.f[r]=255&n,n/=256;for(vu(t),r=n=0;r<t.i;r++)for(var i=24;0<=i;i-=8)e[n++]=t.a[r]>>i&255;return function(e){return Y(e,(function(e){return 1<(e=e.toString(16)).length?e:"0"+e})).join("")}(e)}function Ru(e,t){for(var n=0;n<e.b.length;n++)try{e.b[n](t)}catch(e){}}function Cu(e){return e.f||(e.f=e.la().then((function(){return new bt((function(t){e.Ea((function n(r){return t(r),e.Ra(n),!1})),function(e){function t(t){r=!0,i&&i.cancel(),Au(e).then((function(r){var i=n;if(r&&t&&t.url){var o=null;-1!=(i=ao(t.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=jr(Vn(o=Bn(i),"firebaseError")||null))?w(o):null)?new Wo(r.c,r.b,null,null,o,null,r.S()):new Wo(r.c,r.b,i,r.f,null,null,r.S())),i=o||n}Ru(e,i)}))}var n=new Wo("unknown",null,null,null,new A("no-auth-event")),r=!1,i=wn(500).then((function(){return Au(e).then((function(){r||Ru(e,n)}))})),o=c.handleOpenURL;c.handleOpenURL=function(e){if(0==e.toLowerCase().indexOf(Or("BuildInfo.packageName",c).toLowerCase()+"://")&&t({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}},Ko||(Ko=new Ho),function(e){var t=Ko;t.a.push(e),t.b||(t.b=function(e){for(var n=0;n<t.a.length;n++)t.a[n](e)},"function"==typeof(e=Or("universalLinks.subscribe",c))&&e(null,t.b))}(t)}(e)}))}))),e.f}function Au(e){var t=null;return function(e){return e.b.get(uu,e.a).then((function(e){return Go(e)}))}(e.g).then((function(n){return t=n,ou((n=e.g).b,uu,n.a)})).then((function(){return t}))}function wu(e){this.a=e,this.b=nu()}(n=Su.prototype).la=function(){return this.Ia?this.Ia:this.Ia=(Er(void 0)?_r().then((function(){return new bt((function(e,t){var n=c.document,r=setTimeout((function(){t(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),e()}),!1)}))})):kt(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof Or("universalLinks.subscribe",c))throw bu("cordova-universal-links-plugin-fix is not installed");if(void 0===Or("BuildInfo.packageName",c))throw bu("cordova-plugin-buildinfo is not installed");if("function"!=typeof Or("cordova.plugins.browsertab.openUrl",c))throw bu("cordova-plugin-browsertab is not installed");if("function"!=typeof Or("cordova.InAppBrowser.open",c))throw bu("cordova-plugin-inappbrowser is not installed")}),(function(){throw new A("cordova-not-ready")}))},n.Nb=function(e,t){return t(new A("operation-not-supported-in-this-environment")),Ot()},n.Lb=function(){return kt(new A("operation-not-supported-in-this-environment"))},n.Zb=function(){return!1},n.Wb=function(){return!0},n.Sb=function(){return!0},n.Mb=function(e,t,n,r){if(this.c)return kt(new A("redirect-operation-pending"));var i=this,o=c.document,a=null,s=null,u=null,l=null;return this.c=Ot().then((function(){return Bo(t),Cu(i)})).then((function(){return function(e,t,n,r,i){var o=function(){for(var e=20,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}(),a=new Wo(t,r,null,o,new A("no-auth-event"),null,i),s=Or("BuildInfo.packageName",c);if("string"!=typeof s)throw new A("invalid-cordova-configuration");var u=Or("BuildInfo.displayName",c),l={};if(Nr().toLowerCase().match(/iphone|ipad|ipod/))l.ibi=s;else{if(!Nr().toLowerCase().match(/android/))return kt(new A("operation-not-supported-in-this-environment"));l.apn=s}u&&(l.appDisplayName=u),o=Iu(o),l.sessionId=o;var d=Ec(e.m,e.i,e.l,t,n,null,r,e.v,l,e.u,i,e.o);return e.la().then((function(){var t=e.h;return e.A.a.set(uu,a.w(),t)})).then((function(){var t=Or("cordova.plugins.browsertab.isAvailable",c);if("function"!=typeof t)throw new A("invalid-cordova-configuration");var n=null;t((function(t){if(t){if("function"!=typeof(n=Or("cordova.plugins.browsertab.openUrl",c)))throw new A("invalid-cordova-configuration");n(d)}else{if("function"!=typeof(n=Or("cordova.InAppBrowser.open",c)))throw new A("invalid-cordova-configuration");t=Nr(),e.a=n(d,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,e,t,n,r)})).then((function(){return new bt((function(e,t){s=function(){var t=Or("cordova.plugins.browsertab.close",c);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Ea(s),u=function(){a||(a=wn(2e3).then((function(){t(new A("redirect-cancelled-by-user"))})))},l=function(){Gr()&&u()},o.addEventListener("resume",u,!1),Nr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",l,!1)})).s((function(e){return Au(i).then((function(){throw e}))}))})).na((function(){u&&o.removeEventListener("resume",u,!1),l&&o.removeEventListener("visibilitychange",l,!1),a&&a.cancel(),s&&i.Ra(s),i.c=null}))},n.Ea=function(e){this.b.push(e),Cu(this).s((function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new Wo("unknown",null,null,null,new A("no-auth-event")),e(t))}))},n.Ra=function(e){J(this.b,(function(t){return t==e}))};var Nu={name:"pendingRedirect",D:"session"};function Ou(e){return ou(e.b,Nu,e.a)}function ku(e,t,n,r){this.i={},this.u=0,this.O=e,this.m=t,this.v=n,this.G=r,this.h=[],this.f=!1,this.l=S(this.o,this),this.b=new Ku,this.A=new Ju,this.g=new wu(Hu(this.m,this.v)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.A,this.c.linkViaPopup=this.A,this.c.reauthViaPopup=this.A,this.a=Lu(this.O,this.m,this.v,N,this.G)}function Lu(e,n,r,i,o){var a=t.a.SDK_VERSION||null;return Er()?new Su(e,n,r,a,i,o):new gc(e,n,r,a,i,o)}function Pu(e){e.f||(e.f=!0,e.a.Ea(e.l));var t=e.a;return e.a.la().s((function(n){throw e.a==t&&e.reset(),n}))}function Du(e){e.a.Wb()&&Pu(e).s((function(t){var n=new Wo("unknown",null,null,null,new A("operation-not-supported-in-this-environment"));Vu(t)&&e.o(n)})),e.a.Sb()||Yu(e.b)}function Mu(e,t){Q(e.h,t)||e.h.push(t),e.f||function(e){return e.b.get(Nu,e.a).then((function(e){return"pending"==e}))}(e.g).then((function(t){t?Ou(e.g).then((function(){Pu(e).s((function(t){var n=new Wo("unknown",null,null,null,new A("operation-not-supported-in-this-environment"));Vu(t)&&e.o(n)}))})):Du(e)})).s((function(){Du(e)}))}function Uu(e,t){J(e.h,(function(e){return e==t}))}ku.prototype.reset=function(){this.f=!1,this.a.Ra(this.l),this.a=Lu(this.O,this.m,this.v,null,this.G),this.i={}},ku.prototype.o=function(e){if(!e)throw new A("invalid-auth-event");if(6e5<=I()-this.u&&(this.i={},this.u=0),e&&e.getUid()&&this.i.hasOwnProperty(e.getUid()))return!1;for(var t=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.Eb(e.c,e.b)){(t=this.c[e.c])&&(t.h(e,r),e&&(e.f||e.b)&&(this.i[e.getUid()]=!0,this.u=I())),t=!0;break}}return Yu(this.b),t};var xu=new Wr(2e3,1e4),ju=new Wr(3e4,6e4);function Fu(e,t,n,r,i,o,a){return e.a.Lb(t,n,r,(function(){e.f||(e.f=!0,e.a.Ea(e.l))}),(function(){e.reset()}),i,o,a)}function Vu(e){return!(!e||"auth/cordova-not-ready"!=e.code)}function Bu(e,t,n,r,i){var o;return function(e){return e.b.set(Nu,"pending",e.a)}(e.g).then((function(){return e.a.Mb(t,n,r,i).s((function(t){if(Vu(t))throw new A("operation-not-supported-in-this-environment");return o=t,Ou(e.g).then((function(){throw o}))})).then((function(){return e.a.Zb()?new bt((function(){})):Ou(e.g).then((function(){return e.qa()})).then((function(){})).s((function(){}))}))}))}function Wu(e,t,n,r,i){return e.a.Nb(r,(function(e){t.ma(n,null,e,i)}),xu.get())}ku.prototype.qa=function(){return this.b.qa()};var Gu={};function Hu(e,t,n){return e=e+":"+t,n&&(e=e+":"+n.url),e}function qu(e,t,n,r){var i=Hu(t,n,r);return Gu[i]||(Gu[i]=new ku(e,t,n,r)),Gu[i]}function Ku(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Yu(e){e.g||(e.g=!0,Xu(e,!1,null,null))}function zu(e){e.g&&!e.i&&Xu(e,!1,null,null)}function Qu(e,t){if(e.b=function(){return Ot(t)},e.f.length)for(var n=0;n<e.f.length;n++)e.f[n](t)}function Xu(e,t,n,r){t?r?function(e,t){if(e.b=function(){return kt(t)},e.c.length)for(var n=0;n<e.c.length;n++)e.c[n](t)}(e,r):Qu(e,n):Qu(e,{user:null}),e.f=[],e.c=[]}function Ju(){}function Zu(){this.hb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.hb},set:function(e){this.hb=e},enumerable:!1})}function $u(e,t){this.a=t,Jr(this,"verificationId",e)}function el(e,t,n,r){return new jo(e).eb(t,n).then((function(e){return new $u(e,r)}))}function tl(e){var t=Ki(e);if(!(t&&t.exp&&t.auth_time&&t.iat))throw new A("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Zr(this,{token:e,expirationTime:qr(1e3*t.exp),authTime:qr(1e3*t.auth_time),issuedAtTime:qr(1e3*t.iat),signInProvider:t.firebase&&t.firebase.sign_in_provider?t.firebase.sign_in_provider:null,signInSecondFactor:t.firebase&&t.firebase.sign_in_second_factor?t.firebase.sign_in_second_factor:null,claims:t})}function nl(e,t,n){var r=t&&t[il];if(!r)throw new A("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=e,this.f=me(t),this.g=n,this.c=new so(null,r),this.b=[];var i=this;q(t[rl]||[],(function(e){(e=ni(e))&&i.b.push(e)})),Jr(this,"auth",this.a),Jr(this,"session",this.c),Jr(this,"hints",this.b)}Ku.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Ku.prototype.h=function(e,t){if(e){this.reset(),this.g=!0;var n=e.c,r=e.b,i=e.a&&"auth/web-storage-unsupported"==e.a.code,o=e.a&&"auth/operation-not-supported-in-this-environment"==e.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?e.a?(Xu(this,!0,null,e.a),Ot()):t.Fa(n,r)?function(e,t,n){n=n.Fa(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.S(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then((function(t){Xu(e,s,t,null)})).s((function(t){Xu(e,s,null,t)}))}(this,e,t):kt(new A("invalid-auth-event")):(Xu(this,!1,null,null),Ot())}else kt(new A("invalid-auth-event"))},Ku.prototype.qa=function(){var e=this;return new bt((function(t,n){e.b?e.b().then(t,n):(e.f.push(t),e.c.push(n),function(e){var t=new A("timeout");e.a&&e.a.cancel(),e.a=wn(ju.get()).then((function(){e.b||(e.g=!0,Xu(e,!0,null,t))}))}(e))}))},Ju.prototype.h=function(e,t){if(e){var n=e.c,r=e.b;e.a?(t.ma(e.c,null,e.a,e.b),Ot()):t.Fa(n,r)?function(e,t){var n=e.b,r=e.c;t.Fa(r,n)(e.g,e.f,e.S(),e.i).then((function(e){t.ma(r,e,null,n)})).s((function(e){t.ma(r,null,e,n)}))}(e,t):kt(new A("invalid-auth-event"))}else kt(new A("invalid-auth-event"))},$u.prototype.confirm=function(e){return e=Fo(this.verificationId,e),this.a(e)};var rl="mfaInfo",il="mfaPendingCredential";function ol(e,t,n,r){A.call(this,"multi-factor-auth-required",r,t),this.b=new nl(e,t,n),Jr(this,"resolver",this.b)}function al(e,t,n){if(e&&m(e.serverResponse)&&"auth/multi-factor-auth-required"===e.code)try{return new ol(t,e.serverResponse,n,e.message)}catch(e){}return null}function sl(){}function cl(e){Jr(this,"factorId",e.fa),this.a=e}function ul(e){if(cl.call(this,e),this.a.fa!=jo.PROVIDER_ID)throw new A("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function ll(e,t){for(var n in Zt.call(this,e),t)this[n]=t[n]}function dl(e,t){this.a=e,this.b=[],this.c=S(this.xc,this),dn(this.a,"userReloaded",this.c);var n=[];t&&t.multiFactor&&t.multiFactor.enrolledFactors&&q(t.multiFactor.enrolledFactors,(function(e){var t=null,r={};if(e){e.uid&&(r[oi]=e.uid),e.displayName&&(r[ri]=e.displayName),e.enrollmentTime&&(r[ii]=new Date(e.enrollmentTime).toISOString()),e.phoneNumber&&(r[ai]=e.phoneNumber);try{t=new si(r)}catch(e){}e=t}else e=null;e&&n.push(e)})),hl(this,n)}function hl(e,t){e.b=t,Jr(e,"enrolledFactors",t)}function pl(e,t,n){if(this.h=e,this.i=t,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function fl(e){this.c=e,this.b=this.a=null}function gl(e){return e.b&&1e3*e.b.c||0}function ml(e,t){var n=t.refreshToken;e.b=qi(t[$a]||""),e.a=n}function vl(e,t){return function(e,t){return new bt((function(n,r){"refresh_token"==t.grant_type&&t.refresh_token||"authorization_code"==t.grant_type&&t.code?cs(e,e.l+"?key="+encodeURIComponent(e.c),(function(e){e?e.error?r(ac(e)):e.access_token&&e.refresh_token?n(e):r(new A("internal-error")):r(new A("network-request-failed"))}),"POST",$n(t).toString(),e.g,e.v.get()):r(new A("internal-error"))}))}(e.c,t).then((function(t){return e.b=qi(t.access_token),e.a=t.refresh_token,{accessToken:e.b.toString(),refreshToken:e.a}})).s((function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t}))}function _l(e,t){this.a=e||null,this.b=t||null,Zr(this,{lastSignInTime:qr(t||null),creationTime:qr(e||null)})}function El(e,t,n,r,i,o){Zr(this,{uid:e,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:t})}function yl(e,n,r){this.G=[],this.l=e.apiKey,this.m=e.appName,this.o=e.authDomain||null;var i=t.a.SDK_VERSION?wr(t.a.SDK_VERSION):null;this.a=new Ja(this.l,P(N),i),e.emulatorConfig&&os(this.a,e.emulatorConfig),this.b=new fl(this.a),wl(this,n[$a]),ml(this.b,n),Jr(this,"refreshToken",this.b.a),kl(this,r||{}),bn.call(this),this.P=!1,this.o&&Lr()&&(this.i=qu(this.o,this.l,this.m)),this.R=[],this.f=null,this.u=function(e){return new pl((function(){return e.I(!0)}),(function(e){return!(!e||"auth/network-request-failed"!=e.code)}),(function(){var t=gl(e.b)-I()-3e5;return 0<t?t:0}))}(this),this.$=S(this.gb,this);var o=this;this.pa=null,this.Ba=function(e){o.wa(e.h)},this.ba=null,this.za=function(e){os(o.a,e.c)},this.W=null,this.X=[],this.Aa=function(e){bl(o,e.f)},this.aa=null,this.N=new dl(this,r),Jr(this,"multiFactor",this.N)}function Tl(e,t){e.ba&&fn(e.ba,"languageCodeChanged",e.Ba),(e.ba=t)&&dn(t,"languageCodeChanged",e.Ba)}function Sl(e,t){e.W&&fn(e.W,"emulatorConfigChanged",e.za),(e.W=t)&&dn(t,"emulatorConfigChanged",e.za)}function bl(e,n){e.X=n,ss(e.a,t.a.SDK_VERSION?wr(t.a.SDK_VERSION,e.X):null)}function Il(e,t){e.aa&&fn(e.aa,"frameworkChanged",e.Aa),(e.aa=t)&&dn(t,"frameworkChanged",e.Aa)}function Rl(e){try{return t.a.app(e.m).auth()}catch(t){throw new A("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Cl(e){e.A||e.u.b||(e.u.start(),fn(e,"tokenChanged",e.$),dn(e,"tokenChanged",e.$))}function Al(e){fn(e,"tokenChanged",e.$),e.u.stop()}function wl(e,t){e.ya=t,Jr(e,"_lat",t)}function Nl(e){for(var t=[],n=0;n<e.R.length;n++)t.push(e.R[n](e));return Pt(t).then((function(){return e}))}function Ol(e){e.i&&!e.P&&(e.P=!0,Mu(e.i,e))}function kl(e,t){Zr(e,{uid:t.uid,displayName:t.displayName||null,photoURL:t.photoURL||null,email:t.email||null,emailVerified:t.emailVerified||!1,phoneNumber:t.phoneNumber||null,isAnonymous:t.isAnonymous||!1,tenantId:t.tenantId||null,metadata:new _l(t.createdAt,t.lastLoginAt),providerData:[]}),e.a.b=e.tenantId}function Ll(){}function Pl(e){return Ot().then((function(){if(e.A)throw new A("app-deleted")}))}function Dl(e){return Y(e.providerData,(function(e){return e.providerId}))}function Ml(e,t){t&&(Ul(e,t.providerId),e.providerData.push(t))}function Ul(e,t){J(e.providerData,(function(e){return e.providerId==t}))}function xl(e,t,n){("uid"!=t||n)&&e.hasOwnProperty(t)&&Jr(e,t,n)}function jl(e,t){e!=t&&(Zr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Jr(e,"metadata",function(e){return new _l(e.a,e.b)}(t.metadata)):Jr(e,"metadata",new _l),q(t.providerData,(function(t){Ml(e,t)})),function(e,t){e.b=t.b,e.a=t.a}(e.b,t.b),Jr(e,"refreshToken",e.b.a),hl(e.N,t.N.b))}function Fl(e){return e.I().then((function(t){var n=e.isAnonymous;return function(e,t){return ic(e.a,Ms,{idToken:t}).then(S(e.Jc,e))}(e,t).then((function(){return n||xl(e,"isAnonymous",!1),t}))}))}function Vl(e,t){t[$a]&&e.ya!=t[$a]&&(ml(e.b,t),e.dispatchEvent(new ll("tokenChanged")),wl(e,t[$a]),xl(e,"refreshToken",e.b.a))}function Bl(e,t){return Fl(e).then((function(){if(Q(Dl(e),t))return Nl(e).then((function(){throw new A("provider-already-linked")}))}))}function Wl(e,t,n){return $r({user:e,credential:Vo(t),additionalUserInfo:t=Ji(t),operationType:n})}function Gl(e,t){return Vl(e,t),e.reload().then((function(){return e}))}function Hl(e,n,r,i,o){if(!Lr())return kt(new A("operation-not-supported-in-this-environment"));if(e.f&&!o)return kt(e.f);var a=Xi(r.providerId),s=Fr(e.uid+":::"),c=null;(!Mr()||yr())&&e.o&&r.isOAuthProvider&&(c=Ec(e.o,e.l,e.m,n,r,null,s,t.a.SDK_VERSION||null,null,null,e.tenantId));var u=gr(c,a&&a.ua,a&&a.ta);return i=i().then((function(){if(Kl(e),!o)return e.I().then((function(){}))})).then((function(){return Fu(e.i,u,n,r,s,!!c,e.tenantId)})).then((function(){return new bt((function(t,r){e.ma(n,null,new A("cancelled-popup-request"),e.h||null),e.g=t,e.O=r,e.h=s,e.c=Wu(e.i,e,n,u,s)}))})).then((function(e){return u&&fr(u),e?$r(e):null})).s((function(e){throw u&&fr(u),e})),Yl(e,i,o)}function ql(e,t,n,r,i){if(!Lr())return kt(new A("operation-not-supported-in-this-environment"));if(e.f&&!i)return kt(e.f);var o=null,a=Fr(e.uid+":::");return r=r().then((function(){if(Kl(e),!i)return e.I().then((function(){}))})).then((function(){return e.ga=a,Nl(e)})).then((function(t){return e.ha&&(t=(t=e.ha).b.set(Xl,e.w(),t.a)),t})).then((function(){return Bu(e.i,t,n,a,e.tenantId)})).s((function(t){if(o=t,e.ha)return Jl(e.ha);throw o})).then((function(){if(o)throw o})),Yl(e,r,i)}function Kl(e){if(!e.i||!e.P){if(e.i&&!e.P)throw new A("internal-error");throw new A("auth-domain-config-required")}}function Yl(e,t,n){var r=function(e,t,n){return e.f&&!n?(t.cancel(),kt(e.f)):t.s((function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.f||e.dispatchEvent(new ll("userInvalidated")),e.f=t),t}))}(e,t,n);return e.G.push(r),r.na((function(){X(e.G,r)})),r.s((function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=al(t.w(),Rl(e),S(e.ic,e))),n||t}))}function zl(e){if(!e.apiKey)return null;var t={apiKey:e.apiKey,authDomain:e.authDomain,appName:e.appName,emulatorConfig:e.emulatorConfig},n={};if(!e.stsTokenManager||!e.stsTokenManager.accessToken)return null;n[$a]=e.stsTokenManager.accessToken,n.refreshToken=e.stsTokenManager.refreshToken||null;var r=new yl(t,n,e);return e.providerData&&q(e.providerData,(function(e){e&&Ml(r,$r(e))})),e.redirectEventId&&(r.ga=e.redirectEventId),r}function Ql(e){this.a=e,this.b=nu()}nl.prototype.Qc=function(e){var t=this;return e.rb(this.a.a,this.c).then((function(e){var n=me(t.f);return delete n[rl],delete n[il],_e(n,e),t.g(n)}))},R(ol,A),sl.prototype.rb=function(e,t,n){return t.type==co?function(e,t,n,r){return n.Ha().then((function(n){return n={idToken:n},void 0!==r&&(n.displayName=r),_e(n,{phoneVerificationInfo:xo(e.a)}),ic(t,Ps,n)}))}(this,e,t,n):function(e,t,n){return n.Ha().then((function(n){return _e(n={mfaPendingCredential:n},{phoneVerificationInfo:xo(e.a)}),ic(t,Ds,n)}))}(this,e,t)},R(cl,sl),R(ul,cl),R(ll,Zt),(n=dl.prototype).xc=function(e){hl(this,function(e){var t=[];return q(e.mfaInfo||[],(function(e){(e=ni(e))&&t.push(e)})),t}(e.gd))},n.Qb=function(){return this.a.I().then((function(e){return new so(e,null)}))},n.ec=function(e,t){var n=this,r=this.a.a;return this.Qb().then((function(n){return e.rb(r,n,t)})).then((function(e){return Vl(n.a,e),n.a.reload()}))},n.ad=function(e){var t=this,n="string"==typeof e?e:e.uid,r=this.a.a;return this.a.I().then((function(e){return ic(r,rc,{idToken:e,mfaEnrollmentId:n})})).then((function(e){var r=K(t.b,(function(e){return e.uid!=n}));return hl(t,r),Vl(t.a,e),t.a.reload().s((function(e){if("auth/user-token-expired"!=e.code)throw e}))}))},n.w=function(){return{multiFactor:{enrolledFactors:Y(this.b,(function(e){return e.w()}))}}},pl.prototype.start=function(){this.a=this.c,function e(t,n){t.stop(),t.b=wn(function(e,t){return t?(e.a=e.c,e.g()):(t=e.a,e.a*=2,e.a>e.f&&(e.a=e.f),t)}(t,n)).then((function(){return function(){var e=c.document,t=null;return Gr()||!e?Ot():new bt((function(n){t=function(){Gr()&&(e.removeEventListener("visibilitychange",t,!1),n())},e.addEventListener("visibilitychange",t,!1)})).s((function(n){throw e.removeEventListener("visibilitychange",t,!1),n}))}()})).then((function(){return t.h()})).then((function(){e(t,!0)})).s((function(n){t.i(n)&&e(t,!1)}))}(this,!0)},pl.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},fl.prototype.w=function(){return{apiKey:this.c.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:gl(this)}},fl.prototype.getToken=function(e){return e=!!e,this.b&&!this.a?kt(new A("user-token-expired")):e||!this.b||I()>gl(this)-3e4?this.a?vl(this,{grant_type:"refresh_token",refresh_token:this.a}):Ot(null):Ot({accessToken:this.b.toString(),refreshToken:this.a})},_l.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},R(yl,bn),yl.prototype.wa=function(e){this.pa=e,is(this.a,e)},yl.prototype.ka=function(){return this.pa},yl.prototype.Ga=function(){return $(this.X)},yl.prototype.gb=function(){this.u.b&&(this.u.stop(),this.u.start())},Jr(yl.prototype,"providerId","firebase"),(n=yl.prototype).reload=function(){var e=this;return Yl(this,Pl(this).then((function(){return Fl(e).then((function(){return Nl(e)})).then(Ll)})))},n.nc=function(e){return this.I(e).then((function(e){return new tl(e)}))},n.I=function(e){var t=this;return Yl(this,Pl(this).then((function(){return t.b.getToken(e)})).then((function(e){if(!e)throw new A("internal-error");return e.accessToken!=t.ya&&(wl(t,e.accessToken),t.dispatchEvent(new ll("tokenChanged"))),xl(t,"refreshToken",e.refreshToken),e.accessToken})))},n.Jc=function(e){if(!(e=e.users)||!e.length)throw new A("internal-error");kl(this,{uid:(e=e[0]).localId,displayName:e.displayName,photoURL:e.photoUrl,email:e.email,emailVerified:!!e.emailVerified,phoneNumber:e.phoneNumber,lastLoginAt:e.lastLoginAt,createdAt:e.createdAt,tenantId:e.tenantId});for(var t=function(e){return(e=e.providerUserInfo)&&e.length?Y(e,(function(e){return new El(e.rawId,e.providerId,e.email,e.displayName,e.photoUrl,e.phoneNumber)})):[]}(e),n=0;n<t.length;n++)Ml(this,t[n]);xl(this,"isAnonymous",!(this.email&&e.passwordHash||this.providerData&&this.providerData.length)),this.dispatchEvent(new ll("userReloaded",{gd:e}))},n.Kc=function(e){return Qr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.sb(e)},n.sb=function(e){var t=this,n=null;return Yl(this,e.c(this.a,this.uid).then((function(e){return Vl(t,e),n=Wl(t,e,"reauthenticate"),t.f=null,t.reload()})).then((function(){return n})),!0)},n.Bc=function(e){return Qr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.pb(e)},n.pb=function(e){var t=this,n=null;return Yl(this,Bl(this,e.providerId).then((function(){return t.I()})).then((function(n){return e.b(t.a,n)})).then((function(e){return n=Wl(t,e,"link"),Gl(t,e)})).then((function(){return n})))},n.Cc=function(e,t){var n=this;return Yl(this,Bl(this,"phone").then((function(){return el(Rl(n),e,t,S(n.pb,n))})))},n.Lc=function(e,t){var n=this;return Yl(this,Ot().then((function(){return el(Rl(n),e,t,S(n.sb,n))})),!0)},n.Ab=function(e){var t=this;return Yl(this,this.I().then((function(n){return t.a.Ab(n,e)})).then((function(e){return Vl(t,e),t.reload()})))},n.dd=function(e){var t=this;return Yl(this,this.I().then((function(n){return e.b(t.a,n)})).then((function(e){return Vl(t,e),t.reload()})))},n.Bb=function(e){var t=this;return Yl(this,this.I().then((function(n){return t.a.Bb(n,e)})).then((function(e){return Vl(t,e),t.reload()})))},n.Cb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Pl(this);var t=this;return Yl(this,this.I().then((function(n){return t.a.Cb(n,{displayName:e.displayName,photoUrl:e.photoURL})})).then((function(e){return Vl(t,e),xl(t,"displayName",e.displayName||null),xl(t,"photoURL",e.photoUrl||null),q(t.providerData,(function(e){"password"===e.providerId&&(Jr(e,"displayName",t.displayName),Jr(e,"photoURL",t.photoURL))})),Nl(t)})).then(Ll))},n.bd=function(e){var t=this;return Yl(this,Fl(this).then((function(n){return Q(Dl(t),e)?function(e,t,n){return ic(e,Os,{idToken:t,deleteProvider:n})}(t.a,n,[e]).then((function(e){var n={};return q(e.providerUserInfo||[],(function(e){n[e.providerId]=!0})),q(Dl(t),(function(e){n[e]||Ul(t,e)})),n[jo.PROVIDER_ID]||Jr(t,"phoneNumber",null),Nl(t)})):Nl(t).then((function(){throw new A("no-such-provider")}))})))},n.delete=function(){var e=this;return Yl(this,this.I().then((function(t){return ic(e.a,Ns,{idToken:t})})).then((function(){e.dispatchEvent(new ll("userDeleted"))}))).then((function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");Tl(e,null),Sl(e,null),Il(e,null),e.G=[],e.A=!0,Al(e),Jr(e,"refreshToken",null),e.i&&Uu(e.i,e)}))},n.Eb=function(e,t){return!!("linkViaPopup"==e&&(this.h||null)==t&&this.g||"reauthViaPopup"==e&&(this.h||null)==t&&this.g||"linkViaRedirect"==e&&(this.ga||null)==t||"reauthViaRedirect"==e&&(this.ga||null)==t)},n.ma=function(e,t,n,r){"linkViaPopup"!=e&&"reauthViaPopup"!=e||r!=(this.h||null)||(n&&this.O?this.O(n):t&&!n&&this.g&&this.g(t),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},n.Fa=function(e,t){return"linkViaPopup"==e&&t==(this.h||null)?S(this.Jb,this):"reauthViaPopup"==e&&t==(this.h||null)?S(this.Kb,this):"linkViaRedirect"==e&&(this.ga||null)==t?S(this.Jb,this):"reauthViaRedirect"==e&&(this.ga||null)==t?S(this.Kb,this):null},n.Dc=function(e){var t=this;return Hl(this,"linkViaPopup",e,(function(){return Bl(t,e.providerId).then((function(){return Nl(t)}))}),!1)},n.Mc=function(e){return Hl(this,"reauthViaPopup",e,(function(){return Ot()}),!0)},n.Ec=function(e){var t=this;return ql(this,"linkViaRedirect",e,(function(){return Bl(t,e.providerId)}),!1)},n.Nc=function(e){return ql(this,"reauthViaRedirect",e,(function(){return Ot()}),!0)},n.Jb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Yl(this,this.I().then((function(n){return Ss(i.a,{requestUri:e,postBody:r,sessionId:t,idToken:n})})).then((function(e){return o=Wl(i,e,"link"),Gl(i,e)})).then((function(){return o})))},n.Kb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Yl(this,Ot().then((function(){return ho(bs(i.a,{requestUri:e,sessionId:t,postBody:r,tenantId:n}),i.uid)})).then((function(e){return o=Wl(i,e,"reauthenticate"),Vl(i,e),i.f=null,i.reload()})).then((function(){return o})),!0)},n.tb=function(e){var t=this,n=null;return Yl(this,this.I().then((function(t){return n=t,void 0===e||ge(e)?{}:Bi(new ki(e))})).then((function(e){return t.a.tb(n,e)})).then((function(e){if(t.email!=e)return t.reload()})).then((function(){})))},n.Db=function(e,t){var n=this,r=null;return Yl(this,this.I().then((function(e){return r=e,void 0===t||ge(t)?{}:Bi(new ki(t))})).then((function(t){return n.a.Db(r,e,t)})).then((function(e){if(n.email!=e)return n.reload()})).then((function(){})))},n.ic=function(e){var t=null,n=this;return Yl(this,e=ho(Ot(e),n.uid).then((function(e){return t=Wl(n,e,"reauthenticate"),Vl(n,e),n.f=null,n.reload()})).then((function(){return t})),!0)},n.toJSON=function(){return this.w()},n.w=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.w(),redirectEventId:this.ga||null};return this.metadata&&_e(e,this.metadata.w()),q(this.providerData,(function(t){e.providerData.push(function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}(t))})),_e(e,this.N.w()),e};var Xl={name:"redirectUser",D:"session"};function Jl(e){return ou(e.b,Xl,e.a)}function Zl(e){this.a=e,this.b=nu(),this.c=null,this.f=function(e){var t=td("local"),n=td("session"),r=td("none");return function(e,t,n){var r=iu(t,n),i=ru(e,t.D);return e.get(t,n).then((function(o){var a=null;try{a=jr(c.localStorage.getItem(r))}catch(e){}if(a&&!o)return c.localStorage.removeItem(r),e.set(t,a,n);a&&o&&"localStorage"!=i.type&&c.localStorage.removeItem(r)}))}(e.b,t,e.a).then((function(){return e.b.get(n,e.a)})).then((function(i){return i?n:e.b.get(r,e.a).then((function(n){return n?r:e.b.get(t,e.a).then((function(n){return n?t:e.b.get(ed,e.a).then((function(e){return e?td(e):t}))}))}))})).then((function(t){return e.c=t,$l(e,t.D)})).s((function(){e.c||(e.c=t)}))}(this),this.b.addListener(td("local"),this.a,S(this.g,this))}function $l(e,t){var n,r=[];for(n in eu)eu[n]!==t&&r.push(ou(e.b,td(eu[n]),e.a));return r.push(ou(e.b,ed,e.a)),function(e){return new bt((function(t,n){var r=e.length,i=[];if(r)for(var o=function(e,n){r--,i[e]=n,0==r&&t(i)},a=function(e){n(e)},s=0;s<e.length;s++)Lt(e[s],b(o,s),a);else t(i)}))}(r)}Zl.prototype.g=function(){var e=this,t=td("local");od(this,(function(){return Ot().then((function(){return e.c&&"local"!=e.c.D?e.b.get(t,e.a):null})).then((function(n){if(n)return $l(e,"local").then((function(){e.c=t}))}))}))};var ed={name:"persistence",D:"session"};function td(e){return{name:"authUser",D:e}}function nd(e,t){return od(e,(function(){return e.b.set(e.c,t.w(),e.a)}))}function rd(e){return od(e,(function(){return ou(e.b,e.c,e.a)}))}function id(e,t,n){return od(e,(function(){return e.b.get(e.c,e.a).then((function(e){return e&&t&&(e.authDomain=t),e&&n&&(e.emulatorConfig=n),zl(e||{})}))}))}function od(e,t){return e.f=e.f.then(t,t),e.f}function ad(e){if(this.m=!1,Jr(this,"settings",new Zu),Jr(this,"app",e),!gd(this).options||!gd(this).options.apiKey)throw new A("invalid-api-key");e=t.a.SDK_VERSION?wr(t.a.SDK_VERSION):null,this.a=new Ja(gd(this).options&&gd(this).options.apiKey,P(N),e),this.R=[],this.u=[],this.P=[],this.ac=t.a.INTERNAL.createSubscribe(S(this.yc,this)),this.X=void 0,this.bc=t.a.INTERNAL.createSubscribe(S(this.zc,this)),pd(this,null),this.l=new Zl(gd(this).options.apiKey+":"+gd(this).name),this.G=new Ql(gd(this).options.apiKey+":"+gd(this).name),this.$=Ed(this,function(e){var t=gd(e).options.authDomain,n=function(e){var t=function(e,t){return e.b.get(Xl,e.a).then((function(e){return e&&t&&(e.authDomain=t),zl(e||{})}))}(e.G,gd(e).options.authDomain).then((function(t){return(e.o=t)&&(t.ha=e.G),Jl(e.G)}));return Ed(e,t)}(e).then((function(){return id(e.l,t,e.f)})).then((function(t){return t?(t.ha=e.G,e.o&&(e.o.ga||null)==(t.ga||null)?t:t.reload().then((function(){return nd(e.l,t).then((function(){return t}))})).s((function(n){return"auth/network-request-failed"==n.code?t:rd(e.l)}))):null})).then((function(t){pd(e,t||null)}));return Ed(e,n)}(this)),this.i=Ed(this,function(e){return e.$.then((function(){return dd(e)})).s((function(){})).then((function(){if(!e.m)return e.pa()})).s((function(){})).then((function(){if(!e.m){e.ba=!0;var t=e.l;t.b.addListener(td("local"),t.a,e.pa)}}))}(this)),this.ba=!1,this.pa=S(this.Yc,this),this.Ba=S(this.da,this),this.ya=S(this.kc,this),this.za=S(this.vc,this),this.Aa=S(this.wc,this),this.b=null,function(e){var t=gd(e).options.authDomain,n=gd(e).options.apiKey;t&&Lr()&&(e.gb=e.$.then((function(){if(!e.m){if(e.b=qu(t,n,gd(e).name,e.f),Mu(e.b,e),md(e)&&Ol(md(e)),e.o){Ol(e.o);var r=e.o;r.wa(e.ka()),Tl(r,e),bl(r=e.o,e.N),Il(r,e),os((r=e.o).a,e.f),Sl(r,e),e.o=null}return e.b}})))}(this),this.INTERNAL={},this.INTERNAL.delete=S(this.delete,this),this.INTERNAL.logFramework=S(this.Fc,this),this.A=0,bn.call(this),function(e){Object.defineProperty(e,"lc",{get:function(){return this.ka()},set:function(e){this.wa(e)},enumerable:!1}),e.aa=null,Object.defineProperty(e,"ti",{get:function(){return this.S()},set:function(e){this.xb(e)},enumerable:!1}),e.W=null}(this),this.N=[],this.f=null}function sd(e){Zt.call(this,"languageCodeChanged"),this.h=e}function cd(e){Zt.call(this,"emulatorConfigChanged"),this.c=e}function ud(e){Zt.call(this,"frameworkChanged"),this.f=e}function ld(e){return e.gb||kt(new A("auth-domain-config-required"))}function dd(e){if(!Lr())return kt(new A("operation-not-supported-in-this-environment"));var t=ld(e).then((function(){return e.b.qa()})).then((function(e){return e?$r(e):null}));return Ed(e,t)}function hd(e,t){var n={};return n.apiKey=gd(e).options.apiKey,n.authDomain=gd(e).options.authDomain,n.appName=gd(e).name,e.f&&(n.emulatorConfig=e.f),e.$.then((function(){return function(e,t,n,r){var i=new yl(e,t);return n&&(i.ha=n),r&&bl(i,r),i.reload().then((function(){return i}))}(n,t,e.G,e.Ga())})).then((function(t){return md(e)&&t.uid==md(e).uid?(jl(md(e),t),e.da(t)):(pd(e,t),Ol(t),e.da(t))})).then((function(){_d(e)}))}function pd(e,t){md(e)&&(function(e,t){J(e.R,(function(e){return e==t}))}(md(e),e.Ba),fn(md(e),"tokenChanged",e.ya),fn(md(e),"userDeleted",e.za),fn(md(e),"userInvalidated",e.Aa),Al(md(e))),t&&(t.R.push(e.Ba),dn(t,"tokenChanged",e.ya),dn(t,"userDeleted",e.za),dn(t,"userInvalidated",e.Aa),0<e.A&&Cl(t)),Jr(e,"currentUser",t),t&&(t.wa(e.ka()),Tl(t,e),bl(t,e.N),Il(t,e),os(t.a,e.f),Sl(t,e))}function fd(e,t){var n=null,r=null;return Ed(e,t.then((function(t){return n=Vo(t),r=Ji(t),hd(e,t)}),(function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=al(t.w(),e,S(e.jc,e))),n||t})).then((function(){return $r({user:md(e),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function gd(e){return e.app}function md(e){return e.currentUser}function vd(e){return md(e)&&md(e)._lat||null}function _d(e){if(e.ba){for(var t=0;t<e.u.length;t++)e.u[t]&&e.u[t](vd(e));if(e.X!==e.getUid()&&e.P.length)for(e.X=e.getUid(),t=0;t<e.P.length;t++)e.P[t]&&e.P[t](vd(e))}}function Ed(e,t){return e.R.push(t),t.na((function(){X(e.R,t)})),t}function yd(){}function Td(){this.a={},this.b=1e12}Zl.prototype.wb=function(e){var t=null,n=this;return function(e){var t=new A("invalid-persistence-type"),n=new A("unsupported-persistence-type");e:{for(r in eu)if(eu[r]==e){var r=!0;break e}r=!1}if(!r||"string"!=typeof e)throw t;switch(Sr()){case"ReactNative":if("session"===e)throw n;break;case"Node":if("none"!==e)throw n;break;case"Worker":if("session"===e||!Pc()&&"none"!==e)throw n;break;default:if(!kr()&&"none"!==e)throw n}}(e),od(this,(function(){return e!=n.c.D?n.b.get(n.c,n.a).then((function(r){return t=r,$l(n,e)})).then((function(){if(n.c=td(e),t)return n.b.set(n.c,t,n.a)})):Ot()}))},R(ad,bn),R(sd,Zt),R(cd,Zt),R(ud,Zt),(n=ad.prototype).wb=function(e){return Ed(this,e=this.l.wb(e))},n.wa=function(e){this.aa===e||this.m||(this.aa=e,is(this.a,this.aa),this.dispatchEvent(new sd(this.ka())))},n.ka=function(){return this.aa},n.ed=function(){var e=c.navigator;this.wa(e&&(e.languages&&e.languages[0]||e.language||e.userLanguage)||null)},n.fd=function(e){if(!this.f){if(!/^https?:\/\//.test(e))throw new A("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");Hr("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),c.document&&_r().then((function(){var e=c.document.createElement("div");e.innerText="Running in emulator mode. Do not use with production credentials.",e.style.position="fixed",e.style.width="100%",e.style.backgroundColor="#ffffff",e.style.border=".1em solid #000000",e.style.color="#ff0000",e.style.bottom="0px",e.style.left="0px",e.style.margin="0px",e.style.zIndex=1e4,e.style.textAlign="center",e.classList.add("firebase-emulator-warning"),c.document.body.appendChild(e)})),this.f={url:e},this.settings.hb=!0,os(this.a,this.f),this.dispatchEvent(new cd(this.f))}},n.Fc=function(e){this.N.push(e),ss(this.a,t.a.SDK_VERSION?wr(t.a.SDK_VERSION,this.N):null),this.dispatchEvent(new ud(this.N))},n.Ga=function(){return $(this.N)},n.xb=function(e){this.W===e||this.m||(this.W=e,this.a.b=this.W)},n.S=function(){return this.W},n.toJSON=function(){return{apiKey:gd(this).options.apiKey,authDomain:gd(this).options.authDomain,appName:gd(this).name,currentUser:md(this)&&md(this).w()}},n.Eb=function(e,t){switch(e){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.h==t&&!!this.g;default:return!1}},n.ma=function(e,t,n,r){"signInViaPopup"==e&&this.h==r&&(n&&this.O?this.O(n):t&&!n&&this.g&&this.g(t),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},n.Fa=function(e,t){return"signInViaRedirect"==e||"signInViaPopup"==e&&this.h==t&&this.g?S(this.hc,this):null},n.hc=function(e,t,n,r){var i=this,o={requestUri:e,postBody:r,sessionId:t,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),i.$.then((function(){return fd(i,Ts(i.a,o))}))},n.Wc=function(e){if(!Lr())return kt(new A("operation-not-supported-in-this-environment"));var n=this,r=Xi(e.providerId),i=Fr(),o=null;(!Mr()||yr())&&gd(this).options.authDomain&&e.isOAuthProvider&&(o=Ec(gd(this).options.authDomain,gd(this).options.apiKey,gd(this).name,"signInViaPopup",e,null,i,t.a.SDK_VERSION||null,null,null,this.S(),this.f));var a=gr(o,r&&r.ua,r&&r.ta);return Ed(this,r=ld(this).then((function(t){return Fu(t,a,"signInViaPopup",e,i,!!o,n.S())})).then((function(){return new bt((function(e,t){n.ma("signInViaPopup",null,new A("cancelled-popup-request"),n.h),n.g=e,n.O=t,n.h=i,n.c=Wu(n.b,n,"signInViaPopup",a,i)}))})).then((function(e){return a&&fr(a),e?$r(e):null})).s((function(e){throw a&&fr(a),e})))},n.Xc=function(e){if(!Lr())return kt(new A("operation-not-supported-in-this-environment"));var t=this;return Ed(this,ld(this).then((function(){return function(e){return od(e,(function(){return e.b.set(ed,e.c.D,e.a)}))}(t.l)})).then((function(){return Bu(t.b,"signInViaRedirect",e,void 0,t.S())})))},n.qa=function(){var e=this;return dd(this).then((function(t){return e.b&&zu(e.b.b),t})).s((function(t){throw e.b&&zu(e.b.b),t}))},n.cd=function(e){if(!e)return kt(new A("null-user"));if(this.W!=e.tenantId)return kt(new A("tenant-id-mismatch"));var t=this,n={};n.apiKey=gd(this).options.apiKey,n.authDomain=gd(this).options.authDomain,n.appName=gd(this).name;var r=function(e,t,n,r){var i=e.b,o={};return o[$a]=i.b&&i.b.toString(),o.refreshToken=i.a,t=new yl(t||{apiKey:e.l,authDomain:e.o,appName:e.m},o),n&&(t.ha=n),r&&bl(t,r),jl(t,e),t}(e,n,t.G,t.Ga());return Ed(this,this.i.then((function(){if(gd(t).options.apiKey!=e.l)return r.reload()})).then((function(){return md(t)&&e.uid==md(t).uid?(jl(md(t),e),t.da(e)):(pd(t,r),Ol(r),t.da(r))})).then((function(){_d(t)})))},n.zb=function(){var e=this;return Ed(this,this.i.then((function(){return e.b&&zu(e.b.b),md(e)?(pd(e,null),rd(e.l).then((function(){_d(e)}))):Ot()})))},n.Yc=function(){var e=this;return id(this.l,gd(this).options.authDomain).then((function(t){if(!e.m){var n;if(n=md(e)&&t){n=md(e).uid;var r=t.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return jl(md(e),t),md(e).I();(md(e)||t)&&(pd(e,t),t&&(Ol(t),t.ha=e.G),e.b&&Mu(e.b,e),_d(e))}}))},n.da=function(e){return nd(this.l,e)},n.kc=function(){_d(this),this.da(md(this))},n.vc=function(){this.zb()},n.wc=function(){this.zb()},n.jc=function(e){var t=this;return this.i.then((function(){return fd(t,Ot(e))}))},n.yc=function(e){var t=this;this.addAuthTokenListener((function(){e.next(md(t))}))},n.zc=function(e){var t=this;!function(e,t){e.P.push(t),Ed(e,e.i.then((function(){!e.m&&Q(e.P,t)&&e.X!==e.getUid()&&(e.X=e.getUid(),t(vd(e)))})))}(this,(function(){e.next(md(t))}))},n.Hc=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){"function"==typeof e?e(md(r)):"function"==typeof e.next&&e.next(md(r))})),this.ac(e,t,n)},n.Gc=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){r.X=r.getUid(),"function"==typeof e?e(md(r)):"function"==typeof e.next&&e.next(md(r))})),this.bc(e,t,n)},n.mc=function(e){var t=this;return Ed(this,this.i.then((function(){return md(t)?md(t).I(e).then((function(e){return{accessToken:e}})):null})))},n.Sc=function(e){var t=this;return this.i.then((function(){return fd(t,ic(t.a,Zs,{token:e}))})).then((function(e){var n=e.user;return xl(n,"isAnonymous",!1),t.da(n),e}))},n.Tc=function(e,t){var n=this;return this.i.then((function(){return fd(n,ic(n.a,$s,{email:e,password:t}))}))},n.dc=function(e,t){var n=this;return this.i.then((function(){return fd(n,ic(n.a,As,{email:e,password:t}))}))},n.Za=function(e){var t=this;return this.i.then((function(){return fd(t,e.ja(t.a))}))},n.Rc=function(e){return Qr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Za(e)},n.yb=function(){var e=this;return this.i.then((function(){var t=md(e);if(t&&t.isAnonymous){var n=$r({providerId:null,isNewUser:!1});return $r({user:t,credential:null,additionalUserInfo:n,operationType:"signIn"})}return fd(e,e.a.yb()).then((function(t){var n=t.user;return xl(n,"isAnonymous",!0),e.da(n),t}))}))},n.getUid=function(){return md(this)&&md(this).uid||null},n.cc=function(e){this.addAuthTokenListener(e),this.A++,0<this.A&&md(this)&&Cl(md(this))},n.Oc=function(e){var t=this;q(this.u,(function(n){n==e&&t.A--})),0>this.A&&(this.A=0),0==this.A&&md(this)&&Al(md(this)),this.removeAuthTokenListener(e)},n.addAuthTokenListener=function(e){var t=this;this.u.push(e),Ed(this,this.i.then((function(){t.m||Q(t.u,e)&&e(vd(t))})))},n.removeAuthTokenListener=function(e){J(this.u,(function(t){return t==e}))},n.delete=function(){this.m=!0;for(var e=0;e<this.R.length;e++)this.R[e].cancel("app-deleted");return this.R=[],this.l&&(e=this.l).b.removeListener(td("local"),e.a,this.pa),this.b&&(Uu(this.b,this),zu(this.b.b)),Promise.resolve()},n.gc=function(e){return Ed(this,function(e,t){return ic(e,ws,{identifier:t,continueUri:Pr()?dr():"http://localhost"}).then((function(e){return e.signinMethods||[]}))}(this.a,e))},n.Ac=function(e){return!!Do(e)},n.vb=function(e,t){var n=this;return Ed(this,Ot().then((function(){var e=new ki(t);if(!e.c)throw new A("argument-error",Di+" must be true when sending sign in link to email");return Bi(e)})).then((function(t){return n.a.vb(e,t)})).then((function(){})))},n.hd=function(e){return this.Qa(e).then((function(e){return e.data.email}))},n.mb=function(e,t){return Ed(this,this.a.mb(e,t).then((function(){})))},n.Qa=function(e){return Ed(this,this.a.Qa(e).then((function(e){return new ci(e)})))},n.ib=function(e){return Ed(this,this.a.ib(e).then((function(){})))},n.ub=function(e,t){var n=this;return Ed(this,Ot().then((function(){return void 0===t||ge(t)?{}:Bi(new ki(t))})).then((function(t){return n.a.ub(e,t)})).then((function(){})))},n.Vc=function(e,t){return Ed(this,el(this,e,t,S(this.Za,this)))},n.Uc=function(e,t){var n=this;return Ed(this,Ot().then((function(){var r=t||dr(),i=Po(e,r);if(!(r=Do(r)))throw new A("argument-error","Invalid email link!");if(r.tenantId!==n.S())throw new A("tenant-id-mismatch");return n.Za(i)})))},yd.prototype.render=function(){},yd.prototype.reset=function(){},yd.prototype.getResponse=function(){},yd.prototype.execute=function(){};var Sd=null;function bd(e,t){return(t=Id(t))&&e.a[t]||null}function Id(e){return(e=void 0===e?1e12:e)?e.toString():null}function Rd(e,t){this.g=!1,this.c=t,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=dt(e);var n=this;this.i=function(){n.execute()},this.h?this.execute():dn(this.f,"click",this.i)}function Cd(e){if(e.g)throw Error("reCAPTCHA mock was already deleted!")}function Ad(){}function wd(){}Td.prototype.render=function(e,t){return this.a[this.b.toString()]=new Rd(e,t),this.b++},Td.prototype.reset=function(e){var t=bd(this,e);e=Id(e),t&&e&&(t.delete(),delete this.a[e])},Td.prototype.getResponse=function(e){return(e=bd(this,e))?e.getResponse():null},Td.prototype.execute=function(e){(e=bd(this,e))&&e.execute()},Rd.prototype.getResponse=function(){return Cd(this),this.b},Rd.prototype.execute=function(){Cd(this);var e=this;this.a||(this.a=setTimeout((function(){e.b=function(){for(var e=50,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}();var t=e.c.callback,n=e.c["expired-callback"];if(t)try{t(e.b)}catch(e){}e.a=setTimeout((function(){if(e.a=null,e.b=null,n)try{n()}catch(e){}e.h&&e.execute()}),6e4)}),500))},Rd.prototype.delete=function(){Cd(this),this.g=!0,clearTimeout(this.a),this.a=null,fn(this.f,"click",this.i)},Jr(Ad,"FACTOR_ID","phone"),wd.prototype.g=function(){return Sd||(Sd=new Td),Ot(Sd)},wd.prototype.c=function(){};var Nd=null;function Od(){this.b=c.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var kd=new ye(Ie,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Ld=new Wr(3e4,6e4);Od.prototype.g=function(e){var t=this;return new bt((function(n,r){var i=setTimeout((function(){r(new A("network-request-failed"))}),Ld.get());!c.grecaptcha||e!==t.f&&!t.b?(c[t.a]=function(){if(c.grecaptcha){t.f=e;var o=c.grecaptcha.render;c.grecaptcha.render=function(e,n){return e=o(e,n),t.b++,e},clearTimeout(i),n(c.grecaptcha)}else clearTimeout(i),r(new A("internal-error"));delete c[t.a]},Ot(Ha(we(kd,{onload:t.a,hl:e||""}))).s((function(){clearTimeout(i),r(new A("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(c.grecaptcha))}))},Od.prototype.c=function(){this.b--};var Pd=null;function Dd(e,t,n,r,i,o,a){if(Jr(this,"type","recaptcha"),this.c=this.f=null,this.A=!1,this.m=t,this.g=null,a?(Nd||(Nd=new wd),a=Nd):(Pd||(Pd=new Od),a=Pd),this.v=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[xd])throw new A("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[jd],!c.document)throw new A("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!dt(t)||!this.i&&dt(t).hasChildNodes())throw new A("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Ja(e,o||null,i||null),this.u=r||function(){return null};var s=this;this.l=[];var u=this.a[Md];this.a[Md]=function(e){if(Fd(s,e),"function"==typeof u)u(e);else if("string"==typeof u){var t=Or(u,c);"function"==typeof t&&t(e)}};var l=this.a[Ud];this.a[Ud]=function(){if(Fd(s,null),"function"==typeof l)l();else if("string"==typeof l){var e=Or(l,c);"function"==typeof e&&e()}}}var Md="callback",Ud="expired-callback",xd="sitekey",jd="size";function Fd(e,t){for(var n=0;n<e.l.length;n++)try{e.l[n](t)}catch(e){}}function Vd(e,t){return e.h.push(t),t.na((function(){X(e.h,t)})),t}function Bd(e){if(e.A)throw new A("internal-error","RecaptchaVerifier instance has been destroyed.")}function Wd(e,n,r){var i=!1;try{this.b=r||t.a.app()}catch(e){throw new A("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new A("invalid-api-key");r=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().Ga()}catch(e){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(e){}a=t.a.SDK_VERSION?wr(t.a.SDK_VERSION,a):null,Dd.call(this,r,e,n,(function(){try{var e=o.b.auth().ka()}catch(t){e=null}return e}),a,P(N),i)}function Gd(e,t,n,r){e:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<t.length;a++)if(t[a].optional)o=!0;else{if(o)throw new A("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=t.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=t[i].optional&&void 0===n[i],!t[i].K(n[i])&&!o){if(t=t[i],0>i||i>=Hd.length)throw new A("internal-error","Argument validator received an unsupported number of arguments.");n=Hd[i],r=(r?"":n+" argument ")+(t.name?'"'+t.name+'" ':"")+"must be "+t.J+".";break e}r=null}}if(r)throw new A("argument-error",e+" failed: "+r)}(n=Dd.prototype).Ia=function(){var e=this;return this.f?this.f:this.f=Vd(this,Ot().then((function(){if(Pr()&&!Tr())return _r();throw new A("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return e.v.g(e.u())})).then((function(t){return e.g=t,ic(e.o,Bs,{})})).then((function(t){e.a[xd]=t.recaptchaSiteKey})).s((function(t){throw e.f=null,t})))},n.render=function(){Bd(this);var e=this;return Vd(this,this.Ia().then((function(){if(null===e.c){var t=e.m;if(!e.i){var n=dt(t);t=function(e,t,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!lt&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',qe(a.name),'"'),a.type){o.push(' type="',qe(a.type),'"');var s={};_e(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=vt(i,o),a&&("string"==typeof a?o.className=a:Array.isArray(a)?o.className=a.join(" "):ht(o,a)),2<r.length&&mt(i,o,r),o}("DIV"),n.appendChild(t)}e.c=e.g.render(t,e.a)}return e.c})))},n.verify=function(){Bd(this);var e=this;return Vd(this,this.render().then((function(t){return new bt((function(n){var r=e.g.getResponse(t);if(r)n(r);else{var i=function(t){t&&(function(e,t){J(e.l,(function(e){return e==t}))}(e,i),n(t))};e.l.push(i),e.i&&e.g.execute(e.c)}}))})))},n.reset=function(){Bd(this),null!==this.c&&this.g.reset(this.c)},n.clear=function(){Bd(this),this.A=!0,this.v.c();for(var e=0;e<this.h.length;e++)this.h[e].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){e=dt(this.m);for(var t;t=e.firstChild;)e.removeChild(t)}},R(Wd,Dd);var Hd="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function qd(e,t){return{name:e||"",J:"a valid string",optional:!!t,K:function(e){return"string"==typeof e}}}function Kd(e,t){return{name:e||"",J:"a boolean",optional:!!t,K:function(e){return"boolean"==typeof e}}}function Yd(e,t){return{name:e||"",J:"a valid object",optional:!!t,K:m}}function zd(e,t){return{name:e||"",J:"a function",optional:!!t,K:function(e){return"function"==typeof e}}}function Qd(e,t){return{name:e||"",J:"null",optional:!!t,K:function(e){return null===e}}}function Xd(e){return{name:e?e+"Credential":"credential",J:e?"a valid "+e+" credential":"a valid credential",optional:!1,K:function(t){if(!t)return!1;var n=!e||t.providerId===e;return!(!t.ja||!n)}}}function Jd(e,t){return m(e)&&"string"==typeof e.type&&e.type===t&&"function"==typeof e.Ha}function Zd(e){return m(e)&&"string"==typeof e.uid}function $d(e,t,n,r){return{name:n||"",J:e.J+" or "+t.J,optional:!!r,K:function(n){return e.K(n)||t.K(n)}}}function eh(e,t){for(var n in t){var r=t[n].name;e[r]=rh(r,e[n],t[n].j)}}function th(e,t){for(var n in t){var r=t[n].name;r!==n&&Object.defineProperty(e,r,{get:b((function(e){return this[e]}),n),set:b((function(e,t,n,r){Gd(e,[n],[r],!0),this[t]=r}),r,n,t[n].jb),enumerable:!0})}}function nh(e,t,n,r){e[t]=rh(t,n,r)}function rh(e,t,n){function r(){var e=Array.prototype.slice.call(arguments);return Gd(o,n,e),t.apply(this,e)}if(!n)return t;var i,o=function(e){return(e=e.split("."))[e.length-1]}(e);for(i in t)r[i]=t[i];for(i in t.prototype)r.prototype[i]=t.prototype[i];return r}eh(ad.prototype,{ib:{name:"applyActionCode",j:[qd("code")]},Qa:{name:"checkActionCode",j:[qd("code")]},mb:{name:"confirmPasswordReset",j:[qd("code"),qd("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[qd("email"),qd("password")]},gc:{name:"fetchSignInMethodsForEmail",j:[qd("email")]},qa:{name:"getRedirectResult",j:[]},Ac:{name:"isSignInWithEmailLink",j:[qd("emailLink")]},Gc:{name:"onAuthStateChanged",j:[$d(Yd(),zd(),"nextOrObserver"),zd("opt_error",!0),zd("opt_completed",!0)]},Hc:{name:"onIdTokenChanged",j:[$d(Yd(),zd(),"nextOrObserver"),zd("opt_error",!0),zd("opt_completed",!0)]},ub:{name:"sendPasswordResetEmail",j:[qd("email"),$d(Yd("opt_actionCodeSettings",!0),Qd(null,!0),"opt_actionCodeSettings",!0)]},vb:{name:"sendSignInLinkToEmail",j:[qd("email"),Yd("actionCodeSettings")]},wb:{name:"setPersistence",j:[qd("persistence")]},Rc:{name:"signInAndRetrieveDataWithCredential",j:[Xd()]},yb:{name:"signInAnonymously",j:[]},Za:{name:"signInWithCredential",j:[Xd()]},Sc:{name:"signInWithCustomToken",j:[qd("token")]},Tc:{name:"signInWithEmailAndPassword",j:[qd("email"),qd("password")]},Uc:{name:"signInWithEmailLink",j:[qd("email"),qd("emailLink",!0)]},Vc:{name:"signInWithPhoneNumber",j:[qd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!=typeof e.type||"function"!=typeof e.verify)}}]},Wc:{name:"signInWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Xc:{name:"signInWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},cd:{name:"updateCurrentUser",j:[$d({name:"user",J:"an instance of Firebase User",optional:!1,K:function(e){return!!(e&&e instanceof yl)}},Qd(),"user")]},zb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[qd(null,!0)]},ed:{name:"useDeviceLanguage",j:[]},fd:{name:"useEmulator",j:[qd("url")]},hd:{name:"verifyPasswordResetCode",j:[qd("code")]}}),th(ad.prototype,{lc:{name:"languageCode",jb:$d(qd(),Qd(),"languageCode")},ti:{name:"tenantId",jb:$d(qd(),Qd(),"tenantId")}}),ad.Persistence=eu,ad.Persistence.LOCAL="local",ad.Persistence.SESSION="session",ad.Persistence.NONE="none",eh(yl.prototype,{delete:{name:"delete",j:[]},nc:{name:"getIdTokenResult",j:[Kd("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[Kd("opt_forceRefresh",!0)]},Bc:{name:"linkAndRetrieveDataWithCredential",j:[Xd()]},pb:{name:"linkWithCredential",j:[Xd()]},Cc:{name:"linkWithPhoneNumber",j:[qd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!=typeof e.type||"function"!=typeof e.verify)}}]},Dc:{name:"linkWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Ec:{name:"linkWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Kc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Xd()]},sb:{name:"reauthenticateWithCredential",j:[Xd()]},Lc:{name:"reauthenticateWithPhoneNumber",j:[qd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!=typeof e.type||"function"!=typeof e.verify)}}]},Mc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},tb:{name:"sendEmailVerification",j:[$d(Yd("opt_actionCodeSettings",!0),Qd(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[qd(null,!0)]},bd:{name:"unlink",j:[qd("provider")]},Ab:{name:"updateEmail",j:[qd("email")]},Bb:{name:"updatePassword",j:[qd("password")]},dd:{name:"updatePhoneNumber",j:[Xd("phone")]},Cb:{name:"updateProfile",j:[Yd("profile")]},Db:{name:"verifyBeforeUpdateEmail",j:[qd("email"),$d(Yd("opt_actionCodeSettings",!0),Qd(null,!0),"opt_actionCodeSettings",!0)]}}),eh(Td.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),eh(yd.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),eh(bt.prototype,{na:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),th(Zu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",jb:Kd("appVerificationDisabledForTesting")}}),eh($u.prototype,{confirm:{name:"confirm",j:[qd("verificationCode")]}}),nh(lo,"fromJSON",(function(e){e="string"==typeof e?JSON.parse(e):e;for(var t,n=[_o,ko,Uo,go],r=0;r<n.length;r++)if(t=n[r](e))return t;return null}),[$d(qd(),Yd(),"json")]),nh(Lo,"credential",(function(e,t){return new Oo(e,t)}),[qd("email"),qd("password")]),eh(Oo.prototype,{w:{name:"toJSON",j:[qd(null,!0)]}}),eh(So.prototype,{Ca:{name:"addScope",j:[qd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),nh(So,"credential",bo,[$d(qd(),Yd(),"token")]),nh(Lo,"credentialWithLink",Po,[qd("email"),qd("emailLink")]),eh(Io.prototype,{Ca:{name:"addScope",j:[qd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),nh(Io,"credential",Ro,[$d(qd(),Yd(),"token")]),eh(Co.prototype,{Ca:{name:"addScope",j:[qd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),nh(Co,"credential",Ao,[$d(qd(),$d(Yd(),Qd()),"idToken"),$d(qd(),Qd(),"accessToken",!0)]),eh(wo.prototype,{Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),nh(wo,"credential",No,[$d(qd(),Yd(),"token"),qd("secret",!0)]),eh(To.prototype,{Ca:{name:"addScope",j:[qd("scope")]},credential:{name:"credential",j:[$d(qd(),$d(Yd(),Qd()),"optionsOrIdToken"),$d(qd(),Qd(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),eh(mo.prototype,{w:{name:"toJSON",j:[qd(null,!0)]}}),eh(po.prototype,{w:{name:"toJSON",j:[qd(null,!0)]}}),nh(jo,"credential",Fo,[qd("verificationId"),qd("verificationCode")]),eh(jo.prototype,{eb:{name:"verifyPhoneNumber",j:[$d(qd(),{name:"phoneInfoOptions",J:"valid phone info options",optional:!1,K:function(e){return!!e&&(e.session&&e.phoneNumber?Jd(e.session,co)&&"string"==typeof e.phoneNumber:e.session&&e.multiFactorHint?Jd(e.session,uo)&&Zd(e.multiFactorHint):e.session&&e.multiFactorUid?Jd(e.session,uo)&&"string"==typeof e.multiFactorUid:!!e.phoneNumber&&"string"==typeof e.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!=typeof e.type||"function"!=typeof e.verify)}}]}}),eh(Mo.prototype,{w:{name:"toJSON",j:[qd(null,!0)]}}),eh(A.prototype,{toJSON:{name:"toJSON",j:[qd(null,!0)]}}),eh(zo.prototype,{toJSON:{name:"toJSON",j:[qd(null,!0)]}}),eh(Yo.prototype,{toJSON:{name:"toJSON",j:[qd(null,!0)]}}),eh(ol.prototype,{toJSON:{name:"toJSON",j:[qd(null,!0)]}}),eh(nl.prototype,{Qc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(e){return!!e&&!!e.rb}}]}}),eh(dl.prototype,{Qb:{name:"getSession",j:[]},ec:{name:"enroll",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(e){return!!e&&!!e.rb}},qd("displayName",!0)]},ad:{name:"unenroll",j:[$d({name:"multiFactorInfo",J:"a valid multiFactorInfo",optional:!1,K:Zd},qd(),"multiFactorInfoIdentifier")]}}),eh(Wd.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),nh(Si,"parseLink",Oi,[qd("link")]),nh(Ad,"assertion",(function(e){return new ul(e)}),[Xd("phone")]),function(){if(void 0===t.a||!t.a.INTERNAL||!t.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var e={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:li,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ui,VERIFY_AND_CHANGE_EMAIL:di,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:ad,AuthCredential:lo,Error:A};nh(e,"EmailAuthProvider",Lo,[]),nh(e,"FacebookAuthProvider",So,[]),nh(e,"GithubAuthProvider",Io,[]),nh(e,"GoogleAuthProvider",Co,[]),nh(e,"TwitterAuthProvider",wo,[]),nh(e,"OAuthProvider",To,[qd("providerId")]),nh(e,"SAMLAuthProvider",yo,[qd("providerId")]),nh(e,"PhoneAuthProvider",jo,[{name:"auth",J:"an instance of Firebase Auth",optional:!0,K:function(e){return!!(e&&e instanceof ad)}}]),nh(e,"RecaptchaVerifier",Wd,[$d(qd(),{name:"",J:"an HTML element",optional:!1,K:function(e){return!!(e&&e instanceof Element)}},"recaptchaContainer"),Yd("recaptchaParameters",!0),{name:"app",J:"an instance of Firebase App",optional:!0,K:function(e){return!!(e&&e instanceof t.a.app.App)}}]),nh(e,"ActionCodeURL",Si,[]),nh(e,"PhoneMultiFactorGenerator",Ad,[]),t.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(e){return new ad(e=e.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:e,instantiationMode:"LAZY",type:"PUBLIC"}),t.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(e){return{getUid:S((e=e.getProvider("auth").getImmediate()).getUid,e),getToken:S(e.mc,e),addAuthTokenListener:S(e.cc,e),removeAuthTokenListener:S(e.Oc,e)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),t.a.registerVersion("@firebase/auth","0.15.2"),t.a.INTERNAL.extendNamespace({User:yl})}()}).apply(void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).call(this,n(8))},function(e,t,n){"use strict";n.r(t);n(26)},function(e,t,n){"use strict";(function(e,t){var r,i=n(2),o=n(1),a=n(0),s=n(5),c=n(3),u=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(a.A)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(a.u)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),l=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(a.h)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),d=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new u(t)}}catch(e){}return new l},h=d("localStorage"),p=d("sessionStorage"),f=new s.b("@firebase/database"),g=(r=1,function(){return r++}),m=function(e){var t=Object(a.z)(e),n=new a.c;n.update(t);var r=n.digest();return a.f.encodeByteArray(r)},v=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=v.apply(null,i):n+="object"==typeof i?Object(a.A)(i):i,n+=" "}return n},_=null,E=!0,y=function(e,t){Object(a.d)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(f.logLevel=s.a.VERBOSE,_=f.log.bind(f),t&&p.set("logging_enabled",!0)):"function"==typeof e?_=e:(_=null,p.remove("logging_enabled"))},T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===E&&(E=!1,null===_&&!0===p.get("logging_enabled")&&y(!0)),_){var n=v.apply(null,e);_(n)}},S=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];T.apply(void 0,Object(o.f)([e],t))}},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+v.apply(void 0,Object(o.f)(e));f.error(n)},I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+v.apply(void 0,Object(o.f)(e));throw f.error(n),new Error(n)},R=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+v.apply(void 0,Object(o.f)(e));f.warn(n)},C=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},A="[MIN_NAME]",w="[MAX_NAME]",N=function(e,t){if(e===t)return 0;if(e===A||t===w)return-1;if(t===A||e===w)return 1;var n=x(e),r=x(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},O=function(e,t){return e===t?0:e<t?-1:1},k=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(a.A)(t))},L=function(e){if("object"!=typeof e||null===e)return Object(a.A)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(a.A)(t[i]),r+=":",r+=L(e[t[i]]);return r+="}"},P=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function D(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var M=function(e){Object(a.d)(!C(e),"Invalid JSON number");var t,n,r,i,o;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var s=[];for(o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var c=s.join(""),u="";for(o=0;o<64;o+=8){var l=parseInt(c.substr(o,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},U=new RegExp("^-?(0*)\\d{1,10}$"),x=function(e){if(U.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},j=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw R("Exception was thrown by user callback.",t),e}),Math.floor(0))}},F=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},V=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!1,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var o=N(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),B=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(a.y)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=Object(a.y)(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=Object(a.y)(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),W=function(){function e(e,t,n,r,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(Object(a.d)("string"==typeof e,"typeof type must == string"),Object(a.d)("object"==typeof t,"typeof params must == object"),"websocket"===e)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==e)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return D(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();var G,H,q,K,Y,z=function(e,t){var n=Q(e),r=n.namespace;"firebase.com"===n.domain&&I(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||I("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&R("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new W(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new V(n.pathString)}},Q=function(e){var t="",n="",r="",i="",a="",s=!0,c="https",u=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(c=e.substring(0,l-1),e=e.substring(l+2));var d=e.indexOf("/");-1===d&&(d=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(d,h)),d<h&&(i=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(d,h)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=Object(o.g)(e.split("&")),a=i.next();!a.done;a=i.next()){var s=a.value;if(0!==s.length){var c=s.split("=");2===c.length?r[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):R("Invalid query segment '"+s+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,h)));(l=t.indexOf(":"))>=0?(s="https"===c||"wss"===c,u=parseInt(t.substring(l+1),10)):l=t.length;var f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var g=t.indexOf(".");r=t.substring(0,g).toLowerCase(),n=t.substring(g+1),a=r}"ns"in p&&(a=p.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:s,scheme:c,pathString:i,namespace:a}},X=/[\[\].#$\/\u0000-\u001F\u007F]/,J=/[\[\].#$\u0000-\u001F\u007F]/,Z=function(e){return"string"==typeof e&&0!==e.length&&!X.test(e)},$=function(e){return"string"==typeof e&&0!==e.length&&!J.test(e)},ee=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!C(e)||e&&"object"==typeof e&&Object(a.h)(e,".sv")},te=function(e,t,n,r,i){i&&void 0===n||ne(Object(a.l)(e,t,i),n,r)},ne=function(e,t,n){var r=n instanceof V?new B(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(C(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>10485760/3&&Object(a.y)(t)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(D(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!Z(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),ne(e,n,r),r.pop()})),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},re=function(e,t,n,r,i){if(!i||void 0!==n){var o=Object(a.l)(e,t,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];D(n,(function(e,t){var n=new V(e);if(ne(o,t,r.child(n)),".priority"===n.getBack()&&!ee(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Z(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(V.comparePaths);var a=null;for(n=0;n<t.length;n++){if(r=t[n],null!==a&&a.contains(r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,s)}},ie=function(e,t,n,r){if(!r||void 0!==n){if(C(n))throw new Error(Object(a.l)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ee(n))throw new Error(Object(a.l)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},oe=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(a.l)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ae=function(e,t,n,r){if(!(r&&void 0===n||Z(n)))throw new Error(Object(a.l)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},se=function(e,t,n,r){if(!(r&&void 0===n||$(n)))throw new Error(Object(a.l)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ce=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),se(e,t,n,r)},ue=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},le=function(e,t,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Z(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),$(e)}(r))throw new Error(Object(a.l)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},de=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(a.l)(e,t,r)+"must be a boolean.")},he=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){Object(a.B)("OnDisconnect.cancel",0,1,arguments.length),Object(a.C)("OnDisconnect.cancel",1,e,!0);var t=new a.a;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){Object(a.B)("OnDisconnect.remove",0,1,arguments.length),ue("OnDisconnect.remove",this.path_),Object(a.C)("OnDisconnect.remove",1,e,!0);var t=new a.a;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){Object(a.B)("OnDisconnect.set",1,2,arguments.length),ue("OnDisconnect.set",this.path_),te("OnDisconnect.set",1,e,this.path_,!1),Object(a.C)("OnDisconnect.set",2,t,!0);var n=new a.a;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){Object(a.B)("OnDisconnect.setWithPriority",2,3,arguments.length),ue("OnDisconnect.setWithPriority",this.path_),te("OnDisconnect.setWithPriority",1,e,this.path_,!1),ie("OnDisconnect.setWithPriority",2,t,!1),Object(a.C)("OnDisconnect.setWithPriority",3,n,!0);var r=new a.a;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(Object(a.B)("OnDisconnect.update",1,2,arguments.length),ue("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,R("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}re("OnDisconnect.update",1,e,this.path_,!1),Object(a.C)("OnDisconnect.update",2,t,!0);var i=new a.a;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),pe=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(a.B)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),fe=(G="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",H=0,q=[],function(e){var t,n=e===H;H=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=G.charAt(e%64),e=Math.floor(e/64);Object(a.d)(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===q[t];t--)q[t]=0;q[t]++}else for(t=0;t<12;t++)q[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=G.charAt(q[t]);return Object(a.d)(20===i.length,"nextPushId: Length should be 20."),i}),ge=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),me=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new ge(A,e),r=new ge(A,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return ge.MIN},e}(),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.c)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return K},set:function(e){K=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return N(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw Object(a.e)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return ge.MIN},t.prototype.maxPost=function(){return new ge(w,K)},t.prototype.makePost=function(e,t){return Object(a.d)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ge(e,K)},t.prototype.toString=function(){return".key"},t}(me),_e=new ve;var Ee,ye,Te,Se=function(e){return"number"==typeof e?"number:"+M(e):"string:"+e},be=function(e){if(e.isLeafNode()){var t=e.val();Object(a.d)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(a.h)(t,".sv"),"Priority must be a string or number.")}else Object(a.d)(e===Y||e.isEmpty(),"priority of unexpected type.");Object(a.d)(e===Y||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ie=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(a.d)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),be(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Ee},set:function(e){Ee=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=t.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(a.d)(".priority"!==r||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Se(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?M(this.value_):this.value_,this.lazyHash_=m(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(a.d)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return Object(a.d)(i>=0,"Unknown leaf type: "+n),Object(a.d)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var Re,Ce,Ae=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?N(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return ge.MIN},t.prototype.maxPost=function(){return new ge(w,new Ie("[PRIORITY-POST]",Te))},t.prototype.makePost=function(e,t){var n=ye(e);return new ge(t,new Ie("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(me)),we=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Ne=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:ke.EMPTY_NODE,this.right=null!=o?o:ke.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return ke.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return ke.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Oe=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Ne(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),ke=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Ne.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ne.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new we(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new we(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new we(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new we(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Oe,e}(),Le=Math.log(2),Pe=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Le,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),De=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,a,s=r-t;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Ne(a,o.node,Ne.BLACK,null,null);var c=parseInt(s/2,10)+t,u=i(t,c),l=i(c+1,r);return o=e[c],a=n?n(o):o,new Ne(a,o.node,Ne.BLACK,u,l)},o=function(t){for(var r=null,o=null,a=e.length,s=function(t,r){var o=a-t,s=a;a-=t;var u=i(o+1,s),l=e[o],d=n?n(l):l;c(new Ne(d,l.node,r,null,u))},c=function(e){r?(r.left=e,r=e):(o=e,r=e)},u=0;u<t.count;++u){var l=t.nextBitIsOne(),d=Math.pow(2,t.count-(u+1));l?s(d,Ne.BLACK):(s(d,Ne.BLACK),s(d,Ne.RED))}return o}(new Pe(e.length));return new ke(r||t,o)},Me={},Ue=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(a.d)(Me&&Ae,"ChildrenNode.ts has not been loaded"),Re=Re||new e({".priority":Me},{".priority":Ae})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Object(a.x)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ke?t:null},e.prototype.hasIndex=function(e){return Object(a.h)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(a.d)(t!==_e,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],s=!1,c=n.getIterator(ge.Wrap),u=c.getNext();u;)s=s||t.isDefinedOn(u.node),i.push(u),u=c.getNext();r=s?De(i,t.getCompare()):Me;var l=t.toString(),d=Object(o.a)({},this.indexSet_);d[l]=t;var h=Object(o.a)({},this.indexes_);return h[l]=r,new e(h,d)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(a.v)(this.indexes_,(function(e,i){var o=Object(a.x)(r.indexSet_,i);if(Object(a.d)(o,"Missing index implementation for "+i),e===Me){if(o.isDefinedOn(t.node)){for(var s=[],c=n.getIterator(ge.Wrap),u=c.getNext();u;)u.name!==t.name&&s.push(u),u=c.getNext();return s.push(t),De(s,o.getCompare())}return Me}var l=n.get(t.name),d=e;return l&&(d=d.remove(new ge(t.name,l))),d.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(a.v)(this.indexes_,(function(e){if(e===Me)return e;var r=n.get(t.name);return r?e.remove(new ge(t.name,r)):e})),this.indexSet_)},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xe(e,t){return N(e.name,t.name)}function je(e,t){return N(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fe=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&be(this.priorityNode_),this.children_.isEmpty()&&Object(a.d)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ce||(Ce=new e(new ke(je),null,Ue.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ce},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ce:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(a.d)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new ge(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?Ce:this.priorityNode_;return new e(i,s,o)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;Object(a.d)(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ae,(function(a,s){n[a]=s.val(t),r++,o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1})),!t&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Se(this.getPriority().val())+":"),this.forEachChild(Ae,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":m(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ge(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new ge(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new ge(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,ge.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,ge.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ve?-1:0},e.prototype.withIndex=function(t){if(t===_e||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===_e||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Ae),r=t.getIterator(Ae),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===_e?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Ve=new(function(e){function t(){return e.call(this,new ke(je),Fe.EMPTY_NODE,Ue.Default)||this}return Object(o.c)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return Fe.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(Fe));Object.defineProperties(ge,{MIN:{value:new ge(A,Fe.EMPTY_NODE)},MAX:{value:new ge(w,Ve)}}),ve.__EMPTY_NODE=Fe.EMPTY_NODE,Ie.__childrenNodeConstructor=Fe,Y=Ve,function(e){Te=e}(Ve);function Be(e,t){if(void 0===t&&(t=null),null===e)return Fe.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(a.d)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Ie(e,Be(t));if(e instanceof Array){var n=Fe.EMPTY_NODE;return D(e,(function(t,r){if(Object(a.h)(e,t)&&"."!==t.substring(0,1)){var i=Be(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(Be(t))}var r=[],i=!1;if(D(e,(function(e,t){if("."!==e.substring(0,1)){var n=Be(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new ge(e,n)))}})),0===r.length)return Fe.EMPTY_NODE;var o=De(r,xe,(function(e){return e.name}),je);if(i){var s=De(r,Ae.getCompare());return new Fe(o,Be(t),new Ue({".priority":s},{".priority":Ae}))}return new Fe(o,Be(t),Ue.Default)}!function(e){ye=e}(Be);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var We,Ge=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?N(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return ge.MIN},t.prototype.maxPost=function(){return ge.MAX},t.prototype.makePost=function(e,t){var n=Be(e);return new ge(t,n)},t.prototype.toString=function(){return".value"},t}(me)),He=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(a.d)(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(o.c)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?N(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=Be(e),r=Fe.EMPTY_NODE.updateChild(this.indexPath_,n);return new ge(t,r)},t.prototype.maxPost=function(){var e=Fe.EMPTY_NODE.updateChild(this.indexPath_,Ve);return new ge(w,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(me),qe=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return Object(a.B)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return Object(a.B)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return Object(a.B)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return Object(a.B)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){Object(a.B)("DataSnapshot.child",0,1,arguments.length),t=String(t),se("DataSnapshot.child",1,t,!1);var n=new V(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,Ae)},e.prototype.hasChild=function(e){Object(a.B)("DataSnapshot.hasChild",1,1,arguments.length),se("DataSnapshot.hasChild",1,e,!1);var t=new V(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return Object(a.B)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if(Object(a.B)("DataSnapshot.forEach",1,1,arguments.length),Object(a.C)("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),Ae))}))},e.prototype.hasChildren=function(){return Object(a.B)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return Object(a.B)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return Object(a.B)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Ke=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(a.A)(this.snapshot.exportVal())},e}(),Ye=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),ze=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Ke("value",this,new qe(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.d)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ye(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Qe=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,Object(a.h)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ye(this,e,t):null},e.prototype.createEvent=function(e,t){Object(a.d)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Ke(e.type,this,new qe(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.d)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var a=r[0],s=i[0];return!(s!==a||t.callbacks_[a]&&this.callbacks_[s]&&t.callbacks_[a]!==this.callbacks_[s])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),Xe=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.d)(We,"Reference.ts has not been loaded"),We},set:function(e){We=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===_e){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==A)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==w)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Ae){if(null!=t&&!ee(t)||null!=n&&!ee(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(a.d)(e.getIndex()instanceof He||e.getIndex()===Ge,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return Object(a.B)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){Object(a.B)("Query.on",2,4,arguments.length),oe("Query.on",1,t,!1),Object(a.C)("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[t]=n,this.onChildEvent(s,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new ze(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Qe(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){Object(a.B)("Query.off",0,3,arguments.length),oe("Query.off",1,e,!0),Object(a.C)("Query.off",2,t,!0),Object(a.D)("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var o=t||null;r=new ze(o,null,n||null)}else e&&(t&&((i={})[e]=t),r=new Qe(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.get=function(){return this.repo.getValue(this)},e.prototype.once=function(t,n,r,i){var o=this;Object(a.B)("Query.once",1,4,arguments.length),oe("Query.once",1,t,!1),Object(a.C)("Query.once",2,n,!0);var s=e.getCancelAndContextArgs_("Query.once",r,i),c=!0,u=new a.a;u.promise.catch((function(){}));var l=function(e){c&&(c=!1,o.off(t,l),n&&n.bind(s.context)(e),u.resolve(e))};return this.on(t,l,(function(e){o.off(t,l),s.cancel&&s.cancel.bind(s.context)(e),u.reject(e)})),u.promise},e.prototype.limitToFirst=function(t){if(Object(a.B)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(Object(a.B)("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(Object(a.B)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');se("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new V(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new He(n),i=this.queryParams_.orderBy(r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){Object(a.B)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(_e);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){Object(a.B)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ae);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){Object(a.B)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ge);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.startAt",0,2,arguments.length),te("Query.startAt",1,t,this.path,!0),ae("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.endAt",0,2,arguments.length),te("Query.endAt",1,t,this.path,!0),ae("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(Object(a.B)("Query.equalTo",1,2,arguments.length),te("Query.equalTo",1,e,this.path,!1),ae("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return Object(a.B)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return Object(a.B)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=L(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(Object(a.B)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return r&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Object(a.C)(e,3,r.cancel,!0),r.context=n,Object(a.D)(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(a.l)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Je=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Ze=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=this.path_.child(t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),$e=function(e,t,n){return e&&"object"==typeof e?(Object(a.d)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?et(e[".sv"],t,n):"object"==typeof e[".sv"]?tt(e[".sv"],t):void Object(a.d)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},et=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Object(a.d)(!1,"Unexpected server value: "+e)}},tt=function(e,t,n){e.hasOwnProperty("increment")||Object(a.d)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&Object(a.d)(!1,"Unexpected increment value: "+r);var i=t.node();if(Object(a.d)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r},nt=function(e,t,n,r){return it(t,new Ze(n,e),r)},rt=function(e,t,n){return it(e,new Je(t),n)};function it(e,t,n){var r,i=e.getPriority().val(),o=$e(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var a=e,s=$e(a.getValue(),t,n);return s!==a.getValue()||o!==a.getPriority().val()?new Ie(s,Be(o)):e}var c=e;return r=c,o!==c.getPriority().val()&&(r=r.updatePriority(new Ie(o))),c.forEachChild(Ae,(function(e,i){var o=it(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ot,at=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(Ae,(function(e,t){n.remember(new V(e),t)})),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new V(e.toString()+"/"+n);r.forEachTree(i,t)}))},e.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ot||(ot={}));var st,ct,ut=function(){function e(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,Object(a.d)(!r||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),lt=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ot.ACK_USER_WRITE,this.source=ut.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(a.d)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new V(t));return new e(V.Empty,n,this.revert)}return Object(a.d)(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),dt=function(){function e(e,t){void 0===t&&(st||(st=new ke(O)),t=st),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return D(t,(function(e,t){n=n.set(new V(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:V.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new V(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?e.Empty:new e(this.value,o)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(V.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(e.child(r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,V.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),o=this.children.get(i);return o?o.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,V.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(V.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(e.child(n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e.Empty=new e(null),e}(),ht=function(){function e(e,t){this.source=e,this.path=t,this.type=ot.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,V.Empty):new e(this.source,this.path.popFront())},e}(),pt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ot.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,V.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),ft=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ot.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new V(t));return n.isEmpty()?null:n.value?new pt(this.source,V.Empty,n.value):new e(this.source,V.Empty,n)}return Object(a.d)(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),gt=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),mt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new gt(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new gt(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new gt(Fe.EMPTY_NODE,!1,!1),new gt(Fe.EMPTY_NODE,!1,!1)),e}(),vt=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),_t=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){Object(a.d)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(vt.childRemovedChange(t,s)):Object(a.d)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(vt.childAddedChange(t,n)):o.trackChildChange(vt.childChangedChange(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Ae,(function(e,r){t.hasChild(e)||n.trackChildChange(vt.childRemovedChange(e,r))})),t.isLeafNode()||t.forEachChild(Ae,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(vt.childChangedChange(t,r,i))}else n.trackChildChange(vt.childAddedChange(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?Fe.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Et=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(a.d)(t===vt.CHILD_ADDED||t===vt.CHILD_CHANGED||t===vt.CHILD_REMOVED,"Only child changes supported for tracking"),Object(a.d)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(t===vt.CHILD_ADDED&&i===vt.CHILD_REMOVED)this.changeMap.set(n,vt.childChangedChange(n,e.snapshotNode,r.snapshotNode));else if(t===vt.CHILD_REMOVED&&i===vt.CHILD_ADDED)this.changeMap.delete(n);else if(t===vt.CHILD_REMOVED&&i===vt.CHILD_CHANGED)this.changeMap.set(n,vt.childRemovedChange(n,r.oldSnap));else if(t===vt.CHILD_CHANGED&&i===vt.CHILD_ADDED)this.changeMap.set(n,vt.childAddedChange(n,e.snapshotNode));else{if(t!==vt.CHILD_CHANGED||i!==vt.CHILD_CHANGED)throw Object(a.e)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,vt.childChangedChange(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),yt=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Tt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new gt(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),St=function(e,t){this.viewCache=e,this.changes=t},bt=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){Object(a.d)(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(a.d)(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,s,c=new Et;if(n.type===ot.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(t,u.path,u.snap,r,i,c):(Object(a.d)(u.source.fromServer,"Unknown source."),s=u.source.tagged||t.getServerCache().isFiltered()&&!u.path.isEmpty(),o=this.applyServerOverwrite_(t,u.path,u.snap,r,i,s,c))}else if(n.type===ot.MERGE){var l=n;l.source.fromUser?o=this.applyUserMerge_(t,l.path,l.children,r,i,c):(Object(a.d)(l.source.fromServer,"Unknown source."),s=l.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,l.path,l.children,r,i,s,c))}else if(n.type===ot.ACK_USER_WRITE){var d=n;o=d.revert?this.revertUserWrite_(t,d.path,r,i,c):this.ackUserWrite_(t,d.path,d.affectedTree,r,i,c)}else{if(n.type!==ot.LISTEN_COMPLETE)throw Object(a.e)("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,c)}var h=c.getChanges();return e.maybeAddValueEvent_(t,o,h),new St(o,h)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(vt.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var s=void 0,c=void 0;if(t.isEmpty())if(Object(a.d)(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap(),l=u instanceof Fe?u:Fe.EMPTY_NODE,d=n.calcCompleteEventChildren(l);s=this.filter_.updateFullNode(e.getEventCache().getNode(),d,i)}else{var h=n.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),h,i)}else{var p=t.getFront();if(".priority"===p){Object(a.d)(1===t.getLength(),"Can't have a priority with additional path components");var f=o.getNode();c=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,f,c);s=null!=g?this.filter_.updatePriority(f,g):o.getNode()}else{var m=t.popFront(),v=void 0;if(o.isCompleteForChild(p)){c=e.getServerCache().getNode();var _=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),c);v=null!=_?o.getNode().getImmediateChild(p).updateChild(m,_):o.getNode().getImmediateChild(p)}else v=n.calcCompleteChild(p,e.getServerCache());s=null!=v?this.filter_.updateChild(o.getNode(),p,v,m,r,i):o.getNode()}}return e.updateEventSnap(s,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,o,a){var s,c=e.getServerCache(),u=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())s=u.updateFullNode(c.getNode(),n,null);else if(u.filtersNodes()&&!c.isFiltered()){var l=c.getNode().updateChild(t,n);s=u.updateFullNode(c.getNode(),l,null)}else{var d=t.getFront();if(!c.isCompleteForPath(t)&&t.getLength()>1)return e;var h=t.popFront(),p=c.getNode().getImmediateChild(d).updateChild(h,n);s=".priority"===d?u.updatePriority(c.getNode(),p):u.updateChild(c.getNode(),d,p,h,yt,null)}var f=e.updateServerSnap(s,c.isFullyInitialized()||t.isEmpty(),u.filtersNodes()),g=new Tt(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,g,a)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,o){var a,s,c=e.getEventCache(),u=new Tt(r,e,i);if(t.isEmpty())s=this.filter_.updateFullNode(e.getEventCache().getNode(),n,o),a=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var l=t.getFront();if(".priority"===l)s=this.filter_.updatePriority(e.getEventCache().getNode(),n),a=e.updateEventSnap(s,c.isFullyInitialized(),c.isFiltered());else{var d=t.popFront(),h=c.getNode().getImmediateChild(l),p=void 0;if(d.isEmpty())p=n;else{var f=u.getCompleteChild(l);p=null!=f?".priority"===d.getBack()&&f.getChild(d.parent()).isEmpty()?f:f.updateChild(d,n):Fe.EMPTY_NODE}if(h.equals(p))a=e;else{var g=this.filter_.updateChild(c.getNode(),l,p,d,u,o);a=e.updateEventSnap(g,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,o,a){var s=this,c=t;return r.foreach((function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())&&(c=s.applyUserOverwrite_(c,l,u,i,o,a))})),r.foreach((function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())||(c=s.applyUserOverwrite_(c,l,u,i,o,a))})),c},e.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,o,a){var s=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var c,u=e;c=t.isEmpty()?n:dt.Empty.setTree(t,n);var l=e.getServerCache().getNode();return c.children.inorderTraversal((function(t,n){if(l.hasChild(t)){var c=e.getServerCache().getNode().getImmediateChild(t),d=s.applyMerge_(c,n);u=s.applyServerOverwrite_(u,new V(t),d,r,i,o,a)}})),c.children.inorderTraversal((function(t,n){var c=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!l.hasChild(t)&&!c){var d=e.getServerCache().getNode().getImmediateChild(t),h=s.applyMerge_(d,n);u=s.applyServerOverwrite_(u,new V(t),h,r,i,o,a)}})),u},e.prototype.ackUserWrite_=function(e,t,n,r,i,o){if(null!=r.shadowingWrite(t))return e;var a=e.getServerCache().isFiltered(),s=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),r,i,a,o);if(t.isEmpty()){var c=dt.Empty;return s.getNode().forEachChild(_e,(function(e,t){c=c.set(new V(e),t)})),this.applyServerMerge_(e,t,c,r,i,a,o)}return e}var u=dt.Empty;return n.foreach((function(e,n){var r=t.child(e);s.isCompleteForPath(r)&&(u=u.set(e,s.getNode().getChild(r)))})),this.applyServerMerge_(e,t,u,r,i,a,o)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,n,yt,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var s=new Tt(n,e,r),c=e.getEventCache().getNode(),u=void 0;if(t.isEmpty()||".priority"===t.getFront()){var l=void 0;if(e.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var d=e.getServerCache().getNode();Object(a.d)(d instanceof Fe,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(d)}l=l,u=this.filter_.updateFullNode(c,l,i)}else{var h=t.getFront(),p=n.calcCompleteChild(h,e.getServerCache());null==p&&e.getServerCache().isCompleteForChild(h)&&(p=c.getImmediateChild(h)),(u=null!=p?this.filter_.updateChild(c,h,p,t.popFront(),s,i):e.getEventCache().getNode().hasChild(h)?this.filter_.updateChild(c,h,Fe.EMPTY_NODE,t.popFront(),s,i):c).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(V.Empty),e.updateEventSnap(u,o,this.filter_.filtersNodes())},e}(),It=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],o=[];return e.forEach((function(e){e.type===vt.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push(vt.childMovedChange(e.childName,e.snapshotNode))})),this.generateEventsForType_(i,vt.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,vt.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,vt.CHILD_MOVED,o,n,t),this.generateEventsForType_(i,vt.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,vt.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var o=this,a=n.filter((function(e){return e.type===t}));a.sort(this.compareChanges_.bind(this)),a.forEach((function(t){var n=o.materializeSingleChange_(t,i);r.forEach((function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,o.query_))}))}))},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw Object(a.e)("Should only compare child_ events.");var n=new ge(e.childName,e.snapshotNode),r=new ge(t.childName,t.snapshotNode);return this.index_.compare(n,r)},e}(),Rt=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new _t(n.getIndex()),i=n.getNodeFilter();this.processor_=new bt(i);var o=t.getServerCache(),a=t.getEventCache(),s=r.updateFullNode(Fe.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(Fe.EMPTY_NODE,a.getNode(),null),u=new gt(s,o.isFullyInitialized(),r.filtersNodes()),l=new gt(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new mt(l,u),this.eventGenerator_=new It(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){Object(a.d)(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===ot.MERGE&&null!==e.source.queryId&&(Object(a.d)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(a.d)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),Object(a.d)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(Ae,(function(e,t){n.push(vt.childAddedChange(e,t))}));return t.isFullyInitialized()&&n.push(vt.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),Ct=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.d)(ct,"Reference.ts has not been loaded"),ct},set:function(e){Object(a.d)(!ct,"__referenceConstructor has already been defined"),ct=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,n){var r,i,s=e.source.queryId;if(null!==s){var c=this.views.get(s);return Object(a.d)(null!=c,"SyncTree gave us an op for an invalid query."),c.applyOperation(e,t,n)}var u=[];try{for(var l=Object(o.g)(this.views.values()),d=l.next();!d.done;d=l.next()){c=d.value;u=u.concat(c.applyOperation(e,t,n))}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return u},e.prototype.addEventRegistration=function(e,t,n,r,i){var o=e.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),c=!1;s?c=!0:r instanceof Fe?(s=n.calcCompleteEventChildren(r),c=!1):(s=Fe.EMPTY_NODE,c=!1);var u=new mt(new gt(s,c,!1),new gt(r,i,!1));a=new Rt(e,u),this.views.set(o,a)}return a.addEventRegistration(t),a.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var i,a,s=t.queryIdentifier(),c=[],u=[],l=this.hasCompleteView();if("default"===s)try{for(var d=Object(o.g)(this.views.entries()),h=d.next();!h.done;h=d.next()){var p=Object(o.e)(h.value,2),f=p[0],g=p[1];u=u.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(f),g.getQuery().getQueryParams().loadsAllData()||c.push(g.getQuery()))}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}else(g=this.views.get(s))&&(u=u.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(s),g.getQuery().getQueryParams().loadsAllData()||c.push(g.getQuery())));return l&&!this.hasCompleteView()&&c.push(new e.__referenceConstructor(t.repo,t.path)),{removed:c,events:u}},e.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=Object(o.g)(this.views.values()),i=r.next();!i.done;i=r.next()){var a=i.value;a.getQuery().getQueryParams().loadsAllData()||n.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var i=Object(o.g)(this.views.values()),a=i.next();!a.done;a=i.next()){var s=a.value;r=r||s.getCompleteServerCache(e)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var n=Object(o.g)(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},e}(),At=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new dt(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,a=V.relativePath(i,t);return o=o.updateChild(a,n),new e(this.writeTree_.set(i,o))}var s=new dt(n);return new e(this.writeTree_.setTree(t,s))},e.prototype.addWrites=function(e,t){var n=this;return D(t,(function(t,r){n=n.addWrite(e.child(t),r)})),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,dt.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(V.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Ae,(function(t,n){e.push(new ge(t,n))})):this.writeTree_.children.inorderTraversal((function(t,n){null!=n.value&&e.push(new ge(t,n.value))})),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new dt(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(Object(a.d)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(t.child(n),o,r)})),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(t.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(V.Empty,this.writeTree_,e)},e.Empty=new e(new dt(null)),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wt=function(){function e(){this.visibleWrites_=At.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new Nt(e,this)},e.prototype.addOverwrite=function(e,t,n,r){Object(a.d)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){Object(a.d)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));Object(a.d)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var c=this.allWrites_[s];c.visible&&(s>=n&&this.recordContainsPath_(c,r.path)?i=!1:r.path.contains(c.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):D(r.children,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))}));return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(t);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(V.Empty)){var a=e.layerTree_(this.allWrites_,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t);u=n||Fe.EMPTY_NODE;return a.apply(u)}return null}var s=this.visibleWrites_.getCompleteNode(t);if(null!=s)return s;var c=this.visibleWrites_.childCompoundWrite(t);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite(V.Empty)){var u=n||Fe.EMPTY_NODE;return c.apply(u)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=Fe.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(Ae,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(Ae,(function(e,t){var r=i.childCompoundWrite(new V(e)).apply(t);n=n.updateImmediateChild(e,r)})),i.getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){Object(a.d)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(e),c=s.getCompleteNode(V.Empty);if(null!=c)a=c;else{if(null==t)return[];a=s.apply(t)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var u=[],l=o.getCompare(),d=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),h=d.getNext();h&&u.length<r;)0!==l(h,n)&&u.push(h),h=d.getNext();return u},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,V.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=At.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,c=void 0;if(o.snap)n.contains(s)?(c=V.relativePath(n,s),r=r.addWrite(c,o.snap)):s.contains(n)&&(c=V.relativePath(s,n),r=r.addWrite(V.Empty,o.snap.getChild(c)));else{if(!o.children)throw Object(a.e)("WriteRecord should have .snap or .children");if(n.contains(s))c=V.relativePath(n,s),r=r.addWrites(c,o.children);else if(s.contains(n))if((c=V.relativePath(s,n)).isEmpty())r=r.addWrites(V.Empty,o.children);else{var u=Object(a.x)(o.children,c.getFront());if(u){var l=u.getChild(c.popFront());r=r.addWrite(V.Empty,l)}}}}}return r},e}(),Nt=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Ot=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=dt.Empty,this.pendingWriteTree_=new wt,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new pt(ut.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=dt.fromObject(t);return this.applyOperationToSyncPoints_(new ft(ut.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=dt.Empty;return null!=n.snap?r=r.set(V.Empty,!0):D(n.children,(function(e,t){r=r.set(new V(e),t)})),this.applyOperationToSyncPoints_(new lt(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new pt(ut.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=dt.fromObject(t);return this.applyOperationToSyncPoints_(new ft(ut.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new ht(ut.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=e.parseQueryKey_(i),a=o.path,s=o.queryId,c=V.relativePath(a,t),u=new pt(ut.forServerTaggedQuery(s),c,n);return this.applyTaggedOperation_(a,u)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var o=e.parseQueryKey_(i),a=o.path,s=o.queryId,c=V.relativePath(a,t),u=dt.fromObject(n),l=new ft(ut.forServerTaggedQuery(s),c,u);return this.applyTaggedOperation_(a,l)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),o=i.path,a=i.queryId,s=V.relativePath(o,t),c=new ht(ut.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,c)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(e,t){var n=V.relativePath(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()}));var s,c=this.syncPointTree_.get(r);(c?(o=o||c.hasCompleteView(),i=i||c.getCompleteServerCache(V.Empty)):(c=new Ct,this.syncPointTree_=this.syncPointTree_.set(r,c)),null!=i)?s=!0:(s=!1,i=Fe.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=t.getCompleteServerCache(V.Empty);n&&(i=i.updateImmediateChild(e,n))})));var u=c.viewExistsForQuery(t);if(!u&&!t.getQueryParams().loadsAllData()){var l=e.makeQueryKey_(t);Object(a.d)(!this.queryToTagMap.has(l),"View does not exist, but we have a tag");var d=e.getNextQueryTag_();this.queryToTagMap.set(l,d),this.tagToQueryMap.set(d,l)}var h=this.pendingWriteTree_.childWrites(r),p=c.addEventRegistration(t,n,h,i,s);if(!u&&!o){var f=c.viewForQuery(t);p=p.concat(this.setupListener_(t,f))}return p},e.prototype.removeEventRegistration=function(t,n,r){var i=this,o=t.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===t.queryIdentifier()||a.viewExistsForQuery(t))){var c=a.removeEventRegistration(t,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var u=c.removed;s=c.events;var l=-1!==u.findIndex((function(e){return e.getQueryParams().loadsAllData()})),d=this.syncPointTree_.findOnPath(o,(function(e,t){return t.hasCompleteView()}));if(l&&!d){var h=this.syncPointTree_.subtree(o);if(!h.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(h),f=0;f<p.length;++f){var g=p[f],m=g.getQuery(),v=this.createListenerForView_(g);this.listenProvider_.startListening(e.queryForListening_(m),this.tagForQuery_(m),v.hashFn,v.onComplete)}}if(!d&&u.length>0&&!r)if(l){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else u.forEach((function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)}));this.removeTags_(u)}return s},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=V.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),D(n,(function(e,t){r=r.concat(t)})),r}))},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),c=this.syncPointTree_.subtree(r);if(i)Object(a.d)(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=c.fold((function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),D(n,(function(e,t){r=r.concat(t)})),r})),l=0;l<u.length;++l){var d=u[l];this.listenProvider_.stopListening(e.queryForListening_(d),this.tagForQuery_(d))}return s},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||Fe.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return Object(a.d)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new V(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);Object(a.d)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(V.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(V.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(V.Empty));var o=[],a=e.path.getFront(),s=e.operationForChild(a),c=t.children.get(a);if(c&&s){var u=n?n.getImmediateChild(a):null,l=r.child(a);o=o.concat(this.applyOperationHelper_(s,c,u,l))}return i&&(o=o.concat(i.applyOperation(e,r,n))),o},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,o=t.get(V.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(V.Empty));var a=[];return t.children.inorderTraversal((function(t,o){var s=n?n.getImmediateChild(t):null,c=r.child(t),u=e.operationForChild(t);u&&(a=a.concat(i.applyOperationDescendantsHelper_(u,o,s,c)))})),o&&(a=a.concat(o.applyOperation(e,r,n))),a},e.nextQueryTag_=1,e}(),kt=function(){function e(){this.rootNode_=Fe.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),Lt=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(a.h)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(a.j)(this.counters_)},e}(),Pt=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Lt),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),Dt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(o.a)({},e);return this.last_&&D(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Mt=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Dt(e);var n=1e4+2e4*Math.random();F(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;D(t,(function(t,i){i>0&&Object(a.h)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),F(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),Ut=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new xt(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),xt=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();_&&T("event: "+t.toString()),j(n)}}},e.prototype.getPath=function(){return this.path_},e}(),jt=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(a.d)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(o.f)(this.listeners_[e]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(a.d)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Ft=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(o.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.d)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(jt),Vt=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(a.p)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(o.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.d)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(jt),Bt=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&j((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),Wt=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=S(e),this.stats_=Pt.getCollection(t),this.urlFn=function(e){return t.connectionURL("long_polling",e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Bt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(a.r)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Gt((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(o.e)(e,5),i=r[0],a=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=a,n.password=s;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(o.e)(e,2),i=r[0],a=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,a)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(a.r)()&&(!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Object(a.A)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=Object(a.g)(t),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(a.r)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(a.A)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Gt=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(a.r)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=g(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(e){T("frame writing exception"),e.stack&&T(e.stack),T(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||T("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(a.r)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){T("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),Ht="";function qt(e){Ht=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt=null;"undefined"!=typeof MozWebSocket?Kt=MozWebSocket:"undefined"!=typeof WebSocket&&(Kt=WebSocket);var Yt=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=S(this.connId),this.stats_=Pt.getCollection(n),this.connURL=t.connectionURL_(n,i,o),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n){var r={v:"5"};return!Object(a.r)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL("websocket",r)},t.prototype.open=function(t,n){var r=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(Object(a.r)()){var i=this.nodeAdmin?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Ht+"/"+e.platform+"/"+i,"X-Firebase-GMPID":this.applicationId||""}},s={},c=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;c&&(o.proxy={origin:c}),this.mySock=new Kt(this.connURL,[],o)}else{o={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Kt(this.connURL,[],o)}}catch(e){this.log_("Error instantiating WebSocket.");var u=e.message||e.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Kt&&!t.forceDisallow_},t.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Object(a.u)(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if(Object(a.d)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=Object(a.A)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=P(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),zt=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Wt,Yt]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=Yt&&Yt.isAvailable(),a=i&&!Yt.previouslyFailed();if(t.webSocketOnly&&(i||R("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Yt];else{var s=this.transports_=[];try{for(var c=Object(o.g)(e.ALL_TRANSPORTS),u=c.next();!u.done;u=c.next()){var l=u.value;l&&l.isAvailable()&&s.push(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Qt=function(){function e(e,t,n,r,i,o,a,s){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=a,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=S("c:"+this.id+":"),this.transportManager_=new zt(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=F((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=k("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?b("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):b("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&R("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),F((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):F((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),Xt=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),Jt=function(e){function t(n,r,i,o,s,c,u){var l=e.call(this)||this;if(l.repoInfo_=n,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=o,l.onServerInfoUpdate_=s,l.authTokenProvider_=c,l.authOverride_=u,l.id=t.nextPersistentConnectionId_++,l.log_=S("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=1e3,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!Object(a.r)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Ft.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&Vt.getInstance().on("online",l.onOnline_,l),l}return Object(o.c)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(a.A)(i)),Object(a.d)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this,n=new a.a,r={p:e.path.toString(),q:e.queryObject()},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(o),n.promise},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(a.d)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(a.d)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};e.tag&&(a.q=r.queryObject(),a.t=e.tag),a.h=e.hashFn(),this.sendRequest("q",a,(function(a){var s=a.d,c=a.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",a),"ok"!==c&&n.removeListen_(i,o),e.onComplete&&e.onComplete(c,s))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&Object(a.h)(e,"w")){var n=Object(a.x)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();R("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(a.m)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(a.t)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(a.d)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(a.A)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):b("Unrecognized action received from server: "+Object(a.A)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(a.d)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,s=this,c=this.lastSessionId,u=!1,l=null,d=function(){l?l.close():(u=!0,i())};this.realtime_={close:d,sendRequest:function(e){Object(a.d)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then((function(e){u?T("getToken() completed but was canceled"):(T("getToken() completed. Creating connection."),s.authToken_=e&&e.accessToken,l=new Qt(o,s.repoInfo_,s.applicationId_,n,r,i,(function(e){R(e+" ("+s.repoInfo_.toString()+")"),s.interrupt("server_kill")}),c))})).then(null,(function(t){s.log_("Failed to get token: "+t),u||(e.repoInfo_.nodeAdmin&&R(t),d())}))}},t.prototype.interrupt=function(e){T("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){T("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(a.o)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return L(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new V(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){T("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=Object(o.g)(this.listens.values()),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var c=(n=void 0,Object(o.g)(s.values())),u=c.next();!u.done;u=c.next()){var l=u.value;this.sendListen_(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var d=0;d<this.outstandingPuts_.length;d++)this.outstandingPuts_[d]&&this.sendPut_(d);for(;this.onDisconnectRequestQueue_.length;){var h=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(h.action,h.pathString,h.data,h.onComplete)}for(d=0;d<this.outstandingGets_.length;d++)this.outstandingGets_[d]&&this.sendGet_(d)},t.prototype.sendConnectStats_=function(){var e={},t="js";Object(a.r)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Ht.replace(/\./g,"-")]=1,Object(a.p)()?e["framework.cordova"]=1:Object(a.s)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Vt.getInstance().currentlyOnline();return Object(a.o)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(Xt),Zt=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=S("p:rest:"),i.listens_={},i}return Object(o.c)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(a.d)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,s=e.path.toString();this.log_("Listen called for "+s+" "+e.queryIdentifier());var c=t.getListenId_(e,r),u={};this.listens_[c]=u;var l=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",l,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(s,n,!1,r),Object(a.x)(o.listens_,c)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=e.getQueryParams().toRestQueryStringParameters(),r=e.path.toString(),i=new a.a;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(a.w)(t);r.log_("Sending REST request for "+s);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+s+" received. status:",c.status,"response:",c.responseText);var e=null;if(c.status>=200&&c.status<300){try{e=Object(a.u)(c.responseText)}catch(e){R("Failed to parse JSON response for "+s+": "+c.responseText)}n(null,e)}else 401!==c.status&&404!==c.status&&R("Got unsuccessful REST response for "+s+" Status: "+c.status),n(c.status);n=null}},c.open("GET",s,!0),c.send()}))},t}(Xt),$t=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.app=n,this.authTokenProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ut,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new at,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.start=function(){var e=this;if(this.stats_=Pt.getCollection(this.repoInfo_),this.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Zt(this.repoInfo_,this.onDataUpdate_.bind(this),this.authTokenProvider_),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var t=this.app.options.databaseAuthVariableOverride;if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(a.A)(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new Jt(this.repoInfo_,this.app.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),this.authTokenProvider_,t),this.server_=this.persistentConnection_}this.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),this.statsReporter_=Pt.getOrCreateReporter(this.repoInfo_,(function(){return new Mt(e.stats_,e.server_)})),this.transactionsInit_(),this.infoData_=new kt,this.infoSyncTree_=new Ot({startListening:function(t,n,r,i){var o=[],a=e.infoData_.getNode(t.path);return a.isEmpty()||(o=e.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ot({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);e.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})},e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new V(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new V(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var s=Object(a.v)(t,(function(e){return Be(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var c=Be(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,c,r)}else if(n){var u=Object(a.v)(t,(function(e){return Be(e)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var l=Be(t);o=this.serverSyncTree_.applyServerOverwrite(i,l)}var d=i;o.length>0&&(d=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(d,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;D(e,(function(e,n){t.updateInfo_(e,n)}))},e.prototype.updateInfo_=function(e,t){var n=new V("/.info/"+e),r=Be(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.getValue=function(e){var t=this;return this.server_.get(e).then((function(n){var r=Be(n),i=t.serverSyncTree_.applyServerOverwrite(e.path,r);return t.eventQueue_.raiseEventsAtPath(e.path,i),Promise.resolve(new qe(r,e.getRef(),e.getQueryParams().getIndex()))}),(function(n){t.log_("get for query "+Object(a.A)(e)+" falling back to cache after error: "+n);var r=t.serverSyncTree_.calcCompleteEventCache(e.path);return r.isEmpty()?Promise.reject(new Error(n)):Promise.resolve(new qe(r,e.getRef(),e.getQueryParams().getIndex()))}))},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var o=this.generateServerValues(),a=Be(t,n),s=this.serverSyncTree_.calcCompleteEventCache(e),c=rt(a,s,o),u=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,c,u,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),a.val(!0),(function(t,n){var o="ok"===t;o||R("set at "+e+" failed: "+t);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(e,a),i.callOnCompleteCallback(r,t,n)}));var d=this.abortTransactions_(e);this.rerunTransactions_(d),this.eventQueue_.raiseEventsForChangedPath(d,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),a={};if(D(t,(function(t,n){i=!1,a[t]=nt(e.child(t),Be(n),r.serverSyncTree_,o)})),i)T("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserMerge(e,a,s);this.eventQueue_.queueEvents(c),this.server_.merge(e.toString(),t,(function(t,i){var o="ok"===t;o||R("update at "+e+" failed: "+t);var a=r.serverSyncTree_.ackUserWrite(s,!o),c=a.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(c,a),r.callOnCompleteCallback(n,t,i)})),D(t,(function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new at;this.onDisconnect_.forEachTree(V.Empty,(function(r,i){var o=nt(r,i,e.serverSyncTree_,t);n.remember(r,o)}));var r=[];n.forEachTree(V.Empty,(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new at,this.eventQueue_.raiseEventsForChangedPath(V.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=Be(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,o){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,o)}))},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,o=Be(t,n);this.server_.onDisconnectPut(e.toString(),o.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,t,n)}))},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Object(a.o)(t))return T("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,o){"ok"===i&&D(t,(function(t,n){var i=Be(n);r.onDisconnect_.remember(e.child(t),i)})),r.callOnCompleteCallback(n,i,o)}))},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new Dt(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);D(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),T.apply(void 0,Object(o.f)([n],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&j((function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,e(o)}}))},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new hn(this))},enumerable:!1,configurable:!0}),e}(),en=function(){function e(t){this.indexedFilter_=new _t(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new ge(t,n))||(n=Fe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Fe.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(Fe.EMPTY_NODE);var i=this;return t.forEachChild(Ae,(function(e,t){i.matches(new ge(e,t))||(r=r.updateImmediateChild(e,Fe.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),tn=function(){function e(e){this.rangedFilter_=new en(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new ge(t,n))||(n=Fe.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=Fe.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=Fe.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Fe.EMPTY_NODE);var s=void 0,c=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();u=function(e,t){return l(t,e)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();o=0;for(var d=!1;i.hasNext();){a=i.getNext();!d&&u(s,a)<=0&&(d=!0),d&&o<this.limit_&&u(a,c)<=0?o++:r=r.updateImmediateChild(a.name,Fe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();var c=e;Object(a.d)(c.numChildren()===this.limit_,"");var u=new ge(t,n),l=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(c.hasChild(t)){for(var h=c.getImmediateChild(t),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===t||c.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,u);if(d&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(vt.childChangedChange(t,n,h)),c.updateImmediateChild(t,n);null!=i&&i.trackChildChange(vt.childRemovedChange(t,h));var g=c.updateImmediateChild(t,Fe.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(vt.childAddedChange(p.name,p.node)),g.updateImmediateChild(p.name,p.node)):g}return n.isEmpty()?e:d&&o(l,u)>=0?(null!=i&&(i.trackChildChange(vt.childRemovedChange(l.name,l.node)),i.trackChildChange(vt.childAddedChange(t,n))),c.updateImmediateChild(t,n).updateImmediateChild(l.name,Fe.EMPTY_NODE)):e},e}(),nn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ae}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return Object(a.d)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(a.d)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:A},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(a.d)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(a.d)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:w},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(a.d)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==Ae&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ae},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new _t(this.getIndex()):this.hasLimit()?new tn(this):new en(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(this.index_===Ae?t=n.PRIORITY_INDEX:this.index_===Ge?t=n.VALUE_INDEX:this.index_===_e?t=n.KEY_INDEX:(Object(a.d)(this.index_ instanceof He,"Unrecognized index type!"),t=this.index_.toString()),r[n.ORDER_BY]=Object(a.A)(t),this.startSet_&&(r[n.START_AT]=Object(a.A)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(a.A)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(a.A)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(a.A)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),rn=function(e){function t(t,n){if(!(t instanceof $t))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,nn.DEFAULT,!1)||this}return Object(o.c)(t,e),t.prototype.getKey=function(){return Object(a.B)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return Object(a.B)("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof V||(null===this.path.getFront()?ce("Reference.child",1,e,!1):se("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){Object(a.B)("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){Object(a.B)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){Object(a.B)("Reference.set",1,2,arguments.length),ue("Reference.set",this.path),te("Reference.set",1,e,this.path,!1),Object(a.C)("Reference.set",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(Object(a.B)("Reference.update",1,2,arguments.length),ue("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,R("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}re("Reference.update",1,e,this.path,!1),Object(a.C)("Reference.update",2,t,!0);var i=new a.a;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(Object(a.B)("Reference.setWithPriority",2,3,arguments.length),ue("Reference.setWithPriority",this.path),te("Reference.setWithPriority",1,e,this.path,!1),ie("Reference.setWithPriority",2,t,!1),Object(a.C)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new a.a;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return Object(a.B)("Reference.remove",0,1,arguments.length),ue("Reference.remove",this.path),Object(a.C)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(Object(a.B)("Reference.transaction",1,3,arguments.length),ue("Reference.transaction",this.path),Object(a.C)("Reference.transaction",1,e,!1),Object(a.C)("Reference.transaction",2,t,!0),de("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new a.a;"function"==typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new pe(n,i)),"function"==typeof t&&t(e,n,i)};return this.repo.startTransaction(this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){Object(a.B)("Reference.setPriority",1,2,arguments.length),ue("Reference.setPriority",this.path),ie("Reference.setPriority",1,e,!1),Object(a.C)("Reference.setPriority",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){Object(a.B)("Reference.push",0,2,arguments.length),ue("Reference.push",this.path),te("Reference.push",1,e,this.path,!0),Object(a.C)("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=fe(r),o=this.child(i),s=this.child(i);return n=null!=e?o.set(e,t).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch((function(){})),o},t.prototype.onDisconnect=function(){return ue("Reference.onDisconnect",this.path),new he(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Xe);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xe.__referenceConstructor=rn,Ct.__referenceConstructor=rn;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var on,an=function(){this.children={},this.childCount=0,this.value=null},sn=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new an),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof V?t:new V(t),r=this,i=n.getFront();null!==i;){r=new e(i,r,Object(a.x)(r.node_.children,i)||new an),i=(n=n.popFront()).getFront()}return r},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){Object(a.d)(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;D(this.node_.children,(function(r,i){t(new e(r,n,i))}))},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},e.prototype.path=function(){return new V(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=Object(a.h)(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(on||(on={})),$t.MAX_TRANSACTION_RETRIES_=25,$t.prototype.transactionsInit_=function(){this.transactionQueueTree_=new sn},$t.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new rn(this,e);o.on("value",i);var s={path:e,update:t,onComplete:n,status:null,order:g(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=this.getLatestState_(e);s.currentInputSnapshot=c;var u=s.update(c.val());if(void 0===u){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var l=new qe(s.currentInputSnapshot,new rn(this,s.path),Ae);s.onComplete(null,!1,l)}}else{ne("transaction failed: Data returned ",u,s.path),s.status=on.RUN;var d=this.transactionQueueTree_.subTree(e),h=d.getValue()||[];h.push(s),d.setValue(h);var p=void 0;if("object"==typeof u&&null!==u&&Object(a.h)(u,".priority"))p=Object(a.x)(u,".priority"),Object(a.d)(ee(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(e)||Fe.EMPTY_NODE).getPriority().val();p=p;var f=this.generateServerValues(),m=Be(u,p),v=rt(m,c,f);s.currentOutputSnapshotRaw=m,s.currentOutputSnapshotResolved=v,s.currentWriteId=this.getNextWriteId_();var _=this.serverSyncTree_.applyUserOverwrite(e,v,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,_),this.sendReadyTransactions_()}},$t.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||Fe.EMPTY_NODE},$t.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);Object(a.d)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return e.status===on.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},$t.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,s=i.hash(),c=0;c<t.length;c++){var u=t[c];Object(a.d)(u.status===on.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=on.SENT,u.retryCount++;var l=V.relativePath(e,u.path);o=o.updateChild(l,u.currentOutputSnapshotRaw)}var d=o.val(!0),h=e;this.server_.put(h.toString(),d,(function(r){n.log_("transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<t.length;a++){if(t[a].status=on.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[a].currentWriteId)),t[a].onComplete){var s=t[a].currentOutputSnapshotResolved,c=new rn(n,t[a].path),u=new qe(s,c,Ae);o.push(t[a].onComplete.bind(null,null,!0,u))}t[a].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(a=0;a<o.length;a++)j(o[a])}else{if("datastale"===r)for(a=0;a<t.length;a++)t[a].status===on.SENT_NEEDS_ABORT?t[a].status=on.NEEDS_ABORT:t[a].status=on.RUN;else{R("transaction at "+h.toString()+" failed: "+r);for(a=0;a<t.length;a++)t[a].status=on.NEEDS_ABORT,t[a].abortReason=r}n.rerunTransactions_(e)}}),s)},$t.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},$t.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===on.RUN})).map((function(e){return e.currentWriteId})),s=0;s<e.length;s++){var c=e[s],u=V.relativePath(t,c.path),l=!1,d=void 0;if(Object(a.d)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===on.NEEDS_ABORT)l=!0,d=c.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else if(c.status===on.RUN)if(c.retryCount>=$t.MAX_TRANSACTION_RETRIES_)l=!0,d="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else{var h=this.getLatestState_(c.path,o);c.currentInputSnapshot=h;var p=e[s].update(h.val());if(void 0!==p){ne("transaction failed: Data returned ",p,c.path);var f=Be(p);"object"==typeof p&&null!=p&&Object(a.h)(p,".priority")||(f=f.updatePriority(h.getPriority()));var g=c.currentWriteId,m=this.generateServerValues(),v=rt(f,h,m);c.currentOutputSnapshotRaw=f,c.currentOutputSnapshotResolved=v,c.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(g),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(c.path,v,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(g,!0))}else l=!0,d="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],l&&(e[s].status=on.COMPLETED,n=e[s].unwatcher,setTimeout(n,Math.floor(0)),e[s].onComplete))if("nodata"===d){var _=new rn(this,e[s].path),E=e[s].currentInputSnapshot,y=new qe(E,_,Ae);r.push(e[s].onComplete.bind(null,null,!1,y))}else r.push(e[s].onComplete.bind(null,new Error(d),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)j(r[s]);this.sendReadyTransactions_()}},$t.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},$t.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},$t.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},$t.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==on.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},$t.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},$t.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===on.SENT_NEEDS_ABORT);else if(t[o].status===on.SENT)Object(a.d)(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=on.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(Object(a.d)(t[o].status===on.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r);for(o=0;o<n.length;o++)j(n[o])}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var cn,un=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(T("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',R(e)},e}(),ln=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),dn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return cn||(cn=new t),cn},t.prototype.interrupt=function(){var e,t,n,r;try{for(var i=Object(o.g)(Object.keys(this.repos_)),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var c=(n=void 0,Object(o.g)(Object.keys(this.repos_[s]))),u=c.next();!u.done;u=c.next()){var l=u.value;this.repos_[s][l].interrupt()}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype.resume=function(){var e,t,n,r;try{for(var i=Object(o.g)(Object.keys(this.repos_)),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var c=(n=void 0,Object(o.g)(Object.keys(this.repos_[s]))),u=c.next();!u.done;u=c.next()){var l=u.value;this.repos_[s][l].resume()}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype.applyEmulatorSettings=function(e,t,n){e.repoInfo_=new W(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),e.repoInfo_.nodeAdmin&&(e.authTokenProvider_=new ln)},t.prototype.databaseFromApp=function(t,n,r,i){var o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||I("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),T("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");var a,s=z(o,i),c=s.repoInfo,u=void 0;void 0!==e&&(u={}.FIREBASE_DATABASE_EMULATOR_HOST),u?(a=!0,o="http://"+u+"?ns="+c.namespace,c=(s=z(o,i)).repoInfo):a=!s.repoInfo.secure;var l=i&&a?new ln:new un(t,n);return le("Invalid Firebase Database URL",1,s),s.path.isEmpty()||I("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(c,t,l).database},t.prototype.deleteRepo=function(e){var t=Object(a.x)(this.repos_,e.app.name);t&&Object(a.x)(t,e.key)===e||I("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.key]},t.prototype.createRepo=function(e,t,n){var r=Object(a.x)(this.repos_,t.name);r||(r={},this.repos_[t.name]=r);var i=Object(a.x)(r,e.toURLString());return i&&I("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new $t(e,this.useRestClient_,t,n),r[e.toURLString()]=i,i},t.prototype.forceRestClient=function(e){this.useRestClient_=e},t}(),hn=function(){function e(e){var t=this;this.repoInternal_=e,this.instanceStarted_=!1,this.INTERNAL={delete:function(){return Object(o.b)(t,void 0,void 0,(function(){return Object(o.d)(this,(function(e){return this.checkDeleted_("delete"),dn.getInstance().deleteRepo(this.repo_),this.repoInternal_=null,this.rootInternal_=null,[2]}))}))}},e instanceof $t||I("Don't call new Database() directly - please use firebase.database().")}return Object.defineProperty(e.prototype,"repo_",{get:function(){return this.instanceStarted_||(this.repoInternal_.start(),this.instanceStarted_=!0),this.repoInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root_",{get:function(){return this.rootInternal_||(this.rootInternal_=new rn(this.repo_,V.Empty)),this.rootInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.useEmulator=function(e,t){this.checkDeleted_("useEmulator"),this.instanceStarted_?I("Cannot call useEmulator() after instance has already been initialized."):dn.getInstance().applyEmulatorSettings(this.repoInternal_,e,t)},e.prototype.ref=function(e){return this.checkDeleted_("ref"),Object(a.B)("database.ref",0,1,arguments.length),e instanceof rn?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),Object(a.B)(t,1,1,arguments.length);var n=z(e,this.repo_.repoInfo_.nodeAdmin);le(t,1,n);var r=n.repoInfo;return r.isCustomHost()||r.host===this.repo_.repoInfo_.host||I(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repoInternal_&&I("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){Object(a.B)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){Object(a.B)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}();var pn=Object.freeze({__proto__:null,forceLongPolling:function(){Yt.forceDisallow(),Wt.forceAllow()},forceWebSockets:function(){Wt.forceDisallow()},isWebSocketsAvailable:function(){return Yt.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,a=e.nodeAdmin,s=void 0!==a&&a;qt(r);var u=new c.c("auth-internal",new c.b("database-standalone"));return u.setComponent(new c.a("auth-internal",(function(){return i}),"PRIVATE")),{instance:dn.getInstance().databaseFromApp(t,u,n,s),namespace:o}}}),fn=Jt;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Jt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var gn=Qt,mn=W,vn=Object.freeze({__proto__:null,DataConnection:fn,RealTimeConnection:gn,hijackHash:function(e){var t=Jt.prototype.put;return Jt.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Jt.prototype.put=t}},ConnectionTarget:mn,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){dn.getInstance().forceRestClient(e)}}),_n=hn.ServerValue;!function(e){qt(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new c.a("database",(function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return dn.getInstance().databaseFromApp(n,r,t)}),"PUBLIC").setServiceProps({Reference:rn,Query:Xe,Database:hn,DataSnapshot:qe,enableLogging:y,INTERNAL:pn,ServerValue:_n,TEST_ACCESS:vn}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.8.1"),Object(a.r)()&&(t.exports=n)}(i.a)}).call(this,n(10),n(27)(e))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutManager=void 0;var a=n(9),s=n(4),c=n(7),u=function(){function e(e){this.isSideLayoutActive=!1,this.remoteUsersMarker={max:1,count:0,rendered:0},this.remoteUsersInfoList={},this.isRenderingNewUserInProcess=!1,this.renderedUsersSet=new Set,this.isAutoLayout=!1,this.OriginalToInternalRemoteUserIdMap={},this.airmeetRTCClient=e,this.isAutoLayout=e.isAutoLayout,this.localUserId=e.baseUserId;var t=e.localActiveSpeakersCount;c.logger.log({tag:s.logTags.AM_LAYOUT,msg:"LAYOUT MANAGER: IS AUTOLAYOUT ENABLED: "+this.isAutoLayout+", MaxActiveSpeakers: "+t}),this.remoteUsersMarker.max=t}return e.prototype.cleanup=function(){this.isSideLayoutActive=!1,this.remoteUsersMarker.rendered=0,this.remoteUsersInfoList={},this.isRenderingNewUserInProcess=!1,this.localUserId=null,this.isAutoLayout=!1,this.OriginalToInternalRemoteUserIdMap={},this.renderedUsersSet.clear()},e.getInstance=function(t){return this.layoutManager||(this.layoutManager=new e(t)),this.layoutManager},e.prototype.updateMaxSpeakers=function(e){this.remoteUsersMarker.max=e},e.prototype.addLocalVideoPlaceholder=function(){if(document.querySelector(".localVideo"))c.logger.log({tag:s.logTags.AM_LAYOUT,msg:"Local Video Placeholder already present, reusing the same"});else{var e=document.getElementById("videos"),t='<div class="videoContainer localVideo video-default-bg childVideo" user-id='+this.localUserId+'><div class="videoPlaceholder"></div></div>';e.insertAdjacentHTML("beforeend",t),this.updateLayout()}},e.prototype.formatActiveSpeakers=function(e,t,n,r){var i=[],a=e.pinnedUsers,u=0;a?(a=Object.keys(e.pinnedUsers),delete e.pinnedUsers,e=Object.keys(e),a=a.filter((function(n){return e.includes(n)&&!t.includes(n)}))):(a=[],e=Object.keys(e));var l=e.reverse();l=o(a,l),c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Ordered Active Users + Pinned Users: ",orderedActiveSpeakers:l});for(var d=[],h=new Set(r),p=0;p<l.length;p++){var f=l[p];if(u<n&&!t.includes(f)&&!d.includes(f))h.has(f)?(u++,d.push(f),h.delete(f)):h.has(f)||(u++,d.push(f),i.push(f));else if(u>=n)break}var g={newUsers:i,usersToRemove:Array.from(h)};return c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Formatted ASL : "+JSON.stringify(g)}),g},e.prototype.manageNewActiveUsersList=function(e){console.time("formatting"),console.time("Reshuffling");var t=this.airmeetRTCClient.getMyUserIds(),n=this.airmeetRTCClient.localActiveSpeakersCount,r=this.formatActiveSpeakers(e,t,n,this.renderedUsersSet),i=r.newUsers,o=r.usersToRemove;console.timeEnd("formatting"),i.length>0||o.length>0?this.resuffleVideoViews(i,o):(c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"No change in Active speaker List, not Reshuffling and Returning!"}),console.timeEnd("Reshuffling"))},e.prototype.resuffleVideoViews=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,a;return i(this,(function(i){switch(i.label){case 0:c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Reshuffling Views, adding: "+e+" removing: "+t}),n=Math.max(e.length,t.length),r=0,i.label=1;case 1:if(!(r<n))return[3,16];if(!e[r]||!t[r])return[3,6];c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Replacing user "+t[r]+" with "+e[r]}),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.replaceSpeaker(e[r],t[r])];case 3:return i.sent(),[3,5];case 4:return o=i.sent(),console.log(o),[3,5];case 5:return[3,15];case 6:if(!t[r])return[3,11];c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Removing user "+t[r]+" from view"}),i.label=7;case 7:return i.trys.push([7,9,,10]),!0,[4,this.removeSpeakerFromView(t[r],!0)];case 8:return i.sent(),[3,10];case 9:return a=i.sent(),console.log(a),[3,10];case 10:return[3,15];case 11:if(!e[r])return[3,15];c.logger.log({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Adding user "+e[r]+" to view "}),i.label=12;case 12:return i.trys.push([12,14,,15]),[4,this.addNewSpeakerToView(e[r])];case 13:return i.sent(),[3,15];case 14:return i.sent(),[3,15];case 15:return r++,[3,1];case 16:return console.timeEnd("Reshuffling"),[2]}}))}))},e.prototype.addNewSpeakerToView=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,u,l,d,h,p;return i(this,(function(i){switch(i.label){case 0:if(this.isRenderingNewUserInProcess)return h="Adding new user already in progress, returning!",console.log(h),[2,o(h)];if(t=this.airmeetRTCClient.getMyUserIds(),this.isRenderingNewUserInProcess=!0,Object.values(t).includes(e))return c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"I am the Active speaker, not rendering and returning : "+e}),this.isRenderingNewUserInProcess=!1,[2,o()];if(!this.remoteUsersInfoList[e])return c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Active speaker not found in remote user list, edge scenario :  "+e}),this.isRenderingNewUserInProcess=!1,[2,o()];if(this.remoteUsersInfoList[e].isRendered)return c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Active speaker is already rendered, do nothing on voice activity: "+e}),this.isRenderingNewUserInProcess=!1,[2,o()];if(!this.remoteUsersInfoList[e].isPublisher)return c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Not rendering Non-Publisher, case of a non-speaking New Joinee in the ASL:  "+e}),this.isRenderingNewUserInProcess=!1,[2,o()];if(this.remoteUsersInfoList[e].isVideoPaused)return c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Not rendering remote user as no video has been published or is in paused state:  "+e}),this.isRenderingNewUserInProcess=!1,[2,o()];if(!((r=this.remoteUsersMarker.max-this.remoteUsersMarker.rendered)>0))return[3,9];c.logger.info({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:r+" Slot available, attempting to render users video in the slot: "+e}),i.label=1;case 1:return i.trys.push([1,3,,4]),!0,[4,this.airmeetRTCClient.subscribeMedia(e,"video",!0)];case 2:return i.sent(),[3,4];case 3:return u=i.sent(),h="Failed to subscribe user : ,"+e+", "+u,this.isRenderingNewUserInProcess=!1,o(h),[2];case 4:if(!this.isAutoLayout)return[3,8];l=this.reserveSlotElement(e.toString()),i.label=5;case 5:return i.trys.push([5,7,,8]),!0,[4,this.airmeetRTCClient.autoPlayRemoteStream(e,"video",l)];case 6:return i.sent(),[3,8];case 7:return d=i.sent(),o(h="Failed to Play Remote Stream user : ,"+e+", "+d),[3,8];case 8:return this.updateRenderInfo(e),c.logger.info({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Sending out to-render event for user "+e+"} "}),this.airmeetRTCClient.emit("remote-user-to-render",{userId:a.UserIdManager.fetchOriginalUserId(e)}),this.isRenderingNewUserInProcess=!1,n(),[3,10];case 9:p="No Slots available, not rendering the new video stream: "+e,c.logger.info({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:p}),this.isRenderingNewUserInProcess=!1,o(),i.label=10;case 10:return[2]}}))}))}))},e.prototype.removeSpeakerFromView=function(e,t){var n=this;return new Promise((function(o,u){return r(n,void 0,void 0,(function(){return i(this,(function(n){return this.remoteUsersInfoList[e]&&this.remoteUsersInfoList[e].isRendered?(this.remoteUsersInfoList[e].isRendered=!1,this.renderedUsersSet.delete(e),--this.remoteUsersMarker.rendered,this.isAutoLayout&&(t?this.removeSlot(e):this.clearSlot(e)),c.logger.info({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Sending out to-unrender event for user "+e}),this.airmeetRTCClient.emit("remote-user-to-unrender",{userId:a.UserIdManager.fetchOriginalUserId(e)})):c.logger.info({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:"Old user has already been unsubscribed, possibly video is off and only audio-view was rendered"}),o(),[2]}))}))}))},e.prototype.replaceSpeaker=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),!1,[4,this.removeSpeakerFromView(t,!1)];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),c.logger.warn({tag:s.logTags.AM_ACTIVE_SPEAKERS,msg:n}),[3,3];case 3:return r.trys.push([3,5,,6]),[4,this.addNewSpeakerToView(e)];case 4:return r.sent(),[3,6];case 5:return r.sent(),[3,6];case 6:return r.trys.push([6,8,,9]),!0,[4,this.airmeetRTCClient.unsubscribeMedia(t,"video",!0)];case 7:return r.sent(),[3,9];case 8:return r.sent(),[3,9];case 9:return[2]}}))}))},e.prototype.manageViewOnRemoteTrackPublished=function(e,t){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(o){return[2,new Promise((function(o,a){return r(n,void 0,void 0,(function(){var n,r,u,l;return i(this,(function(i){switch(i.label){case 0:return this.remoteUsersInfoList[e]?(this.remoteUsersInfoList[e].isPublisher=!0,"video"!=t?[3,7]:this.remoteUsersInfoList[e].isRendered&&this.remoteUsersInfoList[e].isVideoPaused?(this.remoteUsersInfoList[e].isVideoPaused=!1,[4,this.subscribeUnpausedVideoAndFireEvent(e)]):[3,2]):(n={tag:s.logTags.AM_SUBSCRIPTION,msg:"Publishing User not found in remote user list, edge scenario, Returning :  "+e},c.logger.error(n),a(n),[2]);case 1:return i.sent(),o(),[3,6];case 2:this.remoteUsersInfoList[e].isVideoPaused=!1,i.label=3;case 3:return i.trys.push([3,5,,6]),[4,this.addNewSpeakerToView(e)];case 4:return i.sent(),o(),[3,6];case 5:return r=i.sent(),a(r),[3,6];case 6:return[3,17];case 7:if("audio"!=t)return[3,17];this.remoteUsersInfoList[e].isAudioMuted=!1,i.label=8;case 8:return i.trys.push([8,10,,11]),!0,[4,this.airmeetRTCClient.subscribeMedia(e,t,!0)];case 9:return i.sent(),[3,11];case 10:return u=i.sent(),[2,a(u)];case 11:if(!this.isAutoLayout)return[3,16];i.label=12;case 12:return i.trys.push([12,14,,15]),!0,[4,this.airmeetRTCClient.autoPlayRemoteStream(e,!0)];case 13:return i.sent(),o(),[3,15];case 14:return l=i.sent(),a(l),[3,15];case 15:return[3,17];case 16:o(),i.label=17;case 17:return[2]}}))}))}))]}))}))},e.prototype.subscribeUnpausedVideoAndFireEvent=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){return[2,new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,a;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),!0,[4,this.airmeetRTCClient.subscribeMedia(e,"video",!0)];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),c.logger.error({tag:s.logTags.AM_SUBSCRIPTION,msg:"Failed to subscribe Unpaused Remote Stream"}),o(t),[3,3];case 3:if(!this.isAutoLayout)return[3,8];r=document.querySelectorAll('div[internal-user-id="'+e+'"] .videoPlaceholder')[0],i.label=4;case 4:return i.trys.push([4,6,,7]),[4,this.airmeetRTCClient.autoPlayRemoteStream(e,"video",r)];case 5:return i.sent(),n(),[3,7];case 6:return a=i.sent(),c.logger.error({tag:s.logTags.AM_SUBSCRIPTION,msg:"Failed to Play Unpaused Remote Stream : ",userId:e}),o(a),[3,7];case 7:return[3,9];case 8:n(),i.label=9;case 9:return[2]}}))}))}))]}))}))},e.prototype.manageViewOnRemoteTrackUnpublished=function(e,t){if(this.remoteUsersInfoList[e])"video"==t?this.remoteUsersInfoList[e].isVideoPaused=!0:"audio"==t&&(this.remoteUsersInfoList[e].isAudioMuted=!0);else{var n={tag:s.logTags.AM_SUBSCRIPTION,msg:"UnPublishing User not found in remote user list, edge scenario, Returning :  "+e};c.logger.error(n)}},e.prototype.manageViewPostRemoteUserJoin=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s;return i(this,(function(i){return t=e.confId,n=e.userId,r=a.UserIdManager.isScreenUserId(n),o=r?a.UserIdManager.fetchOriginalScreenId(n):a.UserIdManager.fetchOriginalUserId(n),(!this.OriginalToInternalRemoteUserIdMap[o]||this.OriginalToInternalRemoteUserIdMap[o].length<1)&&this.airmeetRTCClient.emit("user-joined",{userId:o,isScreenUser:r}),(s=this.OriginalToInternalRemoteUserIdMap[o])?s.push(e.userId):this.OriginalToInternalRemoteUserIdMap[o]=[e.userId],this.remoteUsersInfoList[n]={originalUserId:o,conferenceId:t,isRendered:!1,isPublisher:!1,isVideoPaused:!1,isAudioMuted:!1},++this.remoteUsersMarker.count,[2]}))}))},e.prototype.manageViewPostRemoteUserLeave=function(e){e.confId;var t,n=e.userId,r=a.UserIdManager.isScreenUserId(n);t=r?a.UserIdManager.fetchOriginalScreenId(n):a.UserIdManager.fetchOriginalUserId(n);var i=this.OriginalToInternalRemoteUserIdMap[t];if(i){var o=i.indexOf(e.userId);o>-1&&i.splice(o,1),i.length<1&&delete this.OriginalToInternalRemoteUserIdMap[t]}if((!this.OriginalToInternalRemoteUserIdMap[t]||this.OriginalToInternalRemoteUserIdMap[t].length<1)&&this.airmeetRTCClient.emit("user-left",{userId:t,isScreenUser:r}),this.remoteUsersInfoList[n])if(this.remoteUsersInfoList[n].isPublisher){this.remoteUsersInfoList[n].isRendered=!1,this.renderedUsersSet.delete(n);--this.remoteUsersMarker.rendered,this.isAutoLayout&&this.removeSlot(n),delete this.remoteUsersInfoList[n],--this.remoteUsersMarker.count,r||(this.airmeetRTCClient.emit("remote-user-to-unrender",{userId:a.UserIdManager.fetchOriginalUserId(n)}),this.airmeetRTCClient.emit("remote-audio-track-unpublished",{userId:a.UserIdManager.fetchOriginalUserId(n)}))}else c.logger.log({tag:s.logTags.AM_LEAVE,msg:"An unpublisher/dummy user left, doing nothing"});else c.logger.log({tag:s.logTags.AM_LEAVE,msg:"Failed to gracefully leave, User not found"})},e.prototype.reserveSlotElement=function(e){var t=document.querySelector("#renderer-"+e);t||(this.addSlot(e),t=document.querySelector("#renderer-"+e));var n=a.UserIdManager.fetchOriginalUserId(e);return t.parentElement.setAttribute("internal-user-id",e),t.parentElement.setAttribute("user-id",n),t},e.prototype.addSlot=function(e){var t='<div class="videoContainer video-default-bg childVideo"><div class="videoPlaceholder" id="renderer'+e+'"></div></div>';(document.getElementById("videos").insertAdjacentHTML("beforeend",t),this.isSideLayoutActive)&&document.querySelector("#renderer"+e).parentElement.classList.add("sideListLayoutSmallVid")},e.prototype.removeSlot=function(e){document.querySelector("#renderer"+e).parentElement.remove(),this.updateLayout()},e.prototype.clearSlot=function(e){var t='<div class="videoPlaceholder" id="renderer'+e+'"></div>';document.querySelector("#renderer"+e).parentElement.innerHTML=t},e.prototype.updateRenderInfo=function(e){++this.remoteUsersMarker.rendered,this.remoteUsersInfoList[e].isRendered=!0,this.renderedUsersSet.add(e),this.isAutoLayout&&this.updateLayout()},e.prototype.updateLayout=function(){var e=this.remoteUsersMarker.rendered+1;this.isSideLayoutActive||(1==e?this.updateLayoutClass("layout1x1"):2==e?this.updateLayoutClass("layout2x1"):e>2&&e<5?this.updateLayoutClass("layout2x2"):e>=5&&e<10?this.updateLayoutClass("layout3x3"):e>=10&&e<17?this.updateLayoutClass("layout4x4"):e>=17&&e<25?this.updateLayoutClass("layout5x5"):e>=25&&this.updateLayoutClass("layout6x6"))},e.prototype.updateLayoutClass=function(e){for(var t=document.getElementsByClassName("videoContainer"),n=0;n<t.length;n++)if(t[n].classList.remove("sideListLayoutSmallVid"),t[n].className=t[n].className.replace(/(^|\s)layout\S+/g,""),"string"==typeof e)t[n].classList.add(e);else if("object"==typeof e)for(var r=0;r<e.length;r++)t[n].classList.add(e[r])},e.prototype.getLocalVideoElement=function(){return document.querySelectorAll('div[user-id="'+this.localUserId+'"] .videoPlaceholder')[0]},e.prototype.addScreenVideoandUpdateLayout=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o;return i(this,(function(i){switch(i.label){case 0:return!0,this.remoteUsersInfoList[e]&&(this.remoteUsersInfoList[e].isPublisher=!0,this.remoteUsersInfoList[e].isVideoPaused=!1),[4,this.airmeetRTCClient.subscribeMedia(e,"screen",!0)];case 1:return i.sent(),this.isAutoLayout?(t=document.getElementById("screenVideo"),n=a.UserIdManager.fetchOriginalScreenId(e),r='<div class="screenContainer childVideo" screen-user-id="'+n+'" internal-user-id="'+e+'"><div class="videoPlaceholder"></div><div class="streamStats rtcStats"><div id="resolutionStats">0x0</div><div id="packetsLostStats">0</div><div id="bitrateStats">0 kbps</div><div id="userId"></div></div>',t.insertAdjacentHTML("beforeend",r),this.changeToSideLayout(),this.isSideLayoutActive=!0,o=document.querySelectorAll('div[screen-user-id="'+n+'"] .videoPlaceholder')[0],!0,[4,this.airmeetRTCClient.autoPlayRemoteStream(e,"screen",o)]):[3,3];case 2:i.sent(),i.label=3;case 3:return this.airmeetRTCClient.emit("remote-screen-track-published",{userId:a.UserIdManager.fetchOriginalScreenId(e)}),[2]}}))}))},e.prototype.removeScreenVideoandUpdateLayout=function(e){if(this.isAutoLayout){document.getElementsByClassName("mainVideosContainer")[0].classList.remove("sideListLayout"),this.isSideLayoutActive=!1;var t=a.UserIdManager.fetchOriginalScreenId(e),n=document.querySelectorAll('div[screen-user-id="'+t+'"]')[0];null!=n&&n.remove(),this.updateLayout()}this.airmeetRTCClient.emit("remote-screen-track-unpublished",{userId:a.UserIdManager.fetchOriginalScreenId(e)})},e.prototype.changeToSideLayout=function(){document.getElementsByClassName("mainVideosContainer")[0].classList.add("sideListLayout"),this.updateLayoutClass("sideListLayoutSmallVid")},e}();t.LayoutManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCStateManager=void 0;var r=function(){function e(){this.rtcStates={screen:{prevState:null,currentState:0},publication:{prevState:null,currentState:0}}}return e.prototype.setState=function(e,t){if(this.rtcStates[e]){var n=this.rtcStates[e].currentState;this.rtcStates[e].prevState=n,this.rtcStates[e].currentState=t}},e.prototype.getState=function(e){var t;return this.rtcStates[e]&&(t=this.rtcStates[e].currentState),t},e.prototype.resetRTCStates=function(){this.rtcStates={screen:{prevState:null,currentState:0},publication:{prevState:null,currentState:0}}},e}();t.RTCStateManager=r}])}));